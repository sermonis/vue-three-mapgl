/*! MapGL 2014-07-03 */
(function() {
    var a = this
      , b = a._
      , c = {}
      , d = Array.prototype
      , e = Object.prototype
      , f = Function.prototype
      , g = Date.now || function() {
        return (new Date).getTime()
    }
      , h = d.push
      , i = d.slice
      , j = d.concat
      , k = e.toString
      , l = e.hasOwnProperty
      , m = d.forEach
      , n = d.map
      , o = d.reduce
      , p = d.reduceRight
      , q = d.filter
      , r = d.every
      , s = d.some
      , t = d.indexOf
      , u = d.lastIndexOf
      , v = Array.isArray
      , w = Object.keys
      , x = f.bind
      , y = function(a) {
        return a instanceof y ? a : this instanceof y ? (this._wrapped = a,
        void 0) : new y(a)
    };
    "undefined" != typeof exports ? ("undefined" != typeof module && module.exports && (exports = module.exports = y),
    exports._ = y) : a._ = y,
    y.VERSION = "1.5.2";
    var z = y.each = y.forEach = function(a, b, d) {
        if (null != a)
            if (m && a.forEach === m)
                a.forEach(b, d);
            else if (a.length === +a.length) {
                for (var e = 0, f = a.length; f > e; e++)
                    if (b.call(d, a[e], e, a) === c)
                        return
            } else
                for (var g = y.keys(a), e = 0, f = g.length; f > e; e++)
                    if (b.call(d, a[g[e]], g[e], a) === c)
                        return
    }
    ;
    y.map = y.collect = function(a, b, c) {
        var d = [];
        return null == a ? d : n && a.map === n ? a.map(b, c) : (z(a, function(a, e, f) {
            d.push(b.call(c, a, e, f))
        }),
        d)
    }
    ;
    var A = "Reduce of empty array with no initial value";
    y.reduce = y.foldl = y.inject = function(a, b, c, d) {
        var e = arguments.length > 2;
        if (null == a && (a = []),
        o && a.reduce === o)
            return d && (b = y.bind(b, d)),
            e ? a.reduce(b, c) : a.reduce(b);
        if (z(a, function(a, f, g) {
            e ? c = b.call(d, c, a, f, g) : (c = a,
            e = !0)
        }),
        !e)
            throw new TypeError(A);
        return c
    }
    ,
    y.reduceRight = y.foldr = function(a, b, c, d) {
        var e = arguments.length > 2;
        if (null == a && (a = []),
        p && a.reduceRight === p)
            return d && (b = y.bind(b, d)),
            e ? a.reduceRight(b, c) : a.reduceRight(b);
        var f = a.length;
        if (f !== +f) {
            var g = y.keys(a);
            f = g.length
        }
        if (z(a, function(h, i, j) {
            i = g ? g[--f] : --f,
            e ? c = b.call(d, c, a[i], i, j) : (c = a[i],
            e = !0)
        }),
        !e)
            throw new TypeError(A);
        return c
    }
    ,
    y.find = y.detect = function(a, b, c) {
        var d;
        return B(a, function(a, e, f) {
            return b.call(c, a, e, f) ? (d = a,
            !0) : void 0
        }),
        d
    }
    ,
    y.filter = y.select = function(a, b, c) {
        var d = [];
        return null == a ? d : q && a.filter === q ? a.filter(b, c) : (z(a, function(a, e, f) {
            b.call(c, a, e, f) && d.push(a)
        }),
        d)
    }
    ,
    y.reject = function(a, b, c) {
        return y.filter(a, function(a, d, e) {
            return !b.call(c, a, d, e)
        }, c)
    }
    ,
    y.every = y.all = function(a, b, d) {
        b || (b = y.identity);
        var e = !0;
        return null == a ? e : r && a.every === r ? a.every(b, d) : (z(a, function(a, f, g) {
            return (e = e && b.call(d, a, f, g)) ? void 0 : c
        }),
        !!e)
    }
    ;
    var B = y.some = y.any = function(a, b, d) {
        b || (b = y.identity);
        var e = !1;
        return null == a ? e : s && a.some === s ? a.some(b, d) : (z(a, function(a, f, g) {
            return e || (e = b.call(d, a, f, g)) ? c : void 0
        }),
        !!e)
    }
    ;
    y.contains = y.include = function(a, b) {
        return null == a ? !1 : t && a.indexOf === t ? -1 != a.indexOf(b) : B(a, function(a) {
            return a === b
        })
    }
    ,
    y.invoke = function(a, b) {
        var c = i.call(arguments, 2)
          , d = y.isFunction(b);
        return y.map(a, function(a) {
            return (d ? b : a[b]).apply(a, c)
        })
    }
    ,
    y.pluck = function(a, b) {
        return y.map(a, function(a) {
            return a[b]
        })
    }
    ,
    y.where = function(a, b, c) {
        return y.isEmpty(b) ? c ? void 0 : [] : y[c ? "find" : "filter"](a, function(a) {
            for (var c in b)
                if (b[c] !== a[c])
                    return !1;
            return !0
        })
    }
    ,
    y.findWhere = function(a, b) {
        return y.where(a, b, !0)
    }
    ,
    y.max = function(a, b, c) {
        if (!b && y.isArray(a) && a[0] === +a[0] && a.length < 65535)
            return Math.max.apply(Math, a);
        if (!b && y.isEmpty(a))
            return -1 / 0;
        var d = {
            computed: -1 / 0,
            value: -1 / 0
        };
        return z(a, function(a, e, f) {
            var g = b ? b.call(c, a, e, f) : a;
            g > d.computed && (d = {
                value: a,
                computed: g
            })
        }),
        d.value
    }
    ,
    y.min = function(a, b, c) {
        if (!b && y.isArray(a) && a[0] === +a[0] && a.length < 65535)
            return Math.min.apply(Math, a);
        if (!b && y.isEmpty(a))
            return 1 / 0;
        var d = {
            computed: 1 / 0,
            value: 1 / 0
        };
        return z(a, function(a, e, f) {
            var g = b ? b.call(c, a, e, f) : a;
            g < d.computed && (d = {
                value: a,
                computed: g
            })
        }),
        d.value
    }
    ,
    y.shuffle = function(a) {
        var b, c = 0, d = [];
        return z(a, function(a) {
            b = y.random(c++),
            d[c - 1] = d[b],
            d[b] = a
        }),
        d
    }
    ,
    y.sample = function(a, b, c) {
        return null == b || c ? (a.length !== +a.length && (a = y.values(a)),
        a[y.random(a.length - 1)]) : y.shuffle(a).slice(0, Math.max(0, b))
    }
    ;
    var C = function(a) {
        return y.isFunction(a) ? a : function(b) {
            return b[a]
        }
    };
    y.sortBy = function(a, b, c) {
        var d = null == b ? y.identity : C(b);
        return y.pluck(y.map(a, function(a, b, e) {
            return {
                value: a,
                index: b,
                criteria: d.call(c, a, b, e)
            }
        }).sort(function(a, b) {
            var c = a.criteria
              , d = b.criteria;
            if (c !== d) {
                if (c > d || void 0 === c)
                    return 1;
                if (d > c || void 0 === d)
                    return -1
            }
            return a.index - b.index
        }), "value")
    }
    ;
    var D = function(a) {
        return function(b, c, d) {
            var e = {}
              , f = null == c ? y.identity : C(c);
            return z(b, function(c, g) {
                var h = f.call(d, c, g, b);
                a(e, h, c)
            }),
            e
        }
    };
    y.groupBy = D(function(a, b, c) {
        (y.has(a, b) ? a[b] : a[b] = []).push(c)
    }),
    y.indexBy = D(function(a, b, c) {
        a[b] = c
    }),
    y.countBy = D(function(a, b) {
        y.has(a, b) ? a[b]++ : a[b] = 1
    }),
    y.sortedIndex = function(a, b, c, d) {
        c = null == c ? y.identity : C(c);
        for (var e = c.call(d, b), f = 0, g = a.length; g > f; ) {
            var h = f + g >>> 1;
            c.call(d, a[h]) < e ? f = h + 1 : g = h
        }
        return f
    }
    ,
    y.toArray = function(a) {
        return a ? y.isArray(a) ? i.call(a) : a.length === +a.length ? y.map(a, y.identity) : y.values(a) : []
    }
    ,
    y.size = function(a) {
        return null == a ? 0 : a.length === +a.length ? a.length : y.keys(a).length
    }
    ,
    y.first = y.head = y.take = function(a, b, c) {
        return null == a ? void 0 : null == b || c ? a[0] : i.call(a, 0, b)
    }
    ,
    y.initial = function(a, b, c) {
        return i.call(a, 0, a.length - (null == b || c ? 1 : b))
    }
    ,
    y.last = function(a, b, c) {
        return null == a ? void 0 : null == b || c ? a[a.length - 1] : i.call(a, Math.max(a.length - b, 0))
    }
    ,
    y.rest = y.tail = y.drop = function(a, b, c) {
        return i.call(a, null == b || c ? 1 : b)
    }
    ,
    y.compact = function(a) {
        return y.filter(a, y.identity)
    }
    ;
    var E = function(a, b, c) {
        return b && y.every(a, y.isArray) ? j.apply(c, a) : (z(a, function(a) {
            y.isArray(a) || y.isArguments(a) ? b ? h.apply(c, a) : E(a, b, c) : c.push(a)
        }),
        c)
    };
    y.flatten = function(a, b) {
        return E(a, b, [])
    }
    ,
    y.without = function(a) {
        return y.difference(a, i.call(arguments, 1))
    }
    ,
    y.uniq = y.unique = function(a, b, c, d) {
        y.isFunction(b) && (d = c,
        c = b,
        b = !1);
        var e = c ? y.map(a, c, d) : a
          , f = []
          , g = [];
        return z(e, function(c, d) {
            (b ? d && g[g.length - 1] === c : y.contains(g, c)) || (g.push(c),
            f.push(a[d]))
        }),
        f
    }
    ,
    y.union = function() {
        return y.uniq(y.flatten(arguments, !0))
    }
    ,
    y.intersection = function(a) {
        var b = i.call(arguments, 1);
        return y.filter(y.uniq(a), function(a) {
            return y.every(b, function(b) {
                return y.indexOf(b, a) >= 0
            })
        })
    }
    ,
    y.difference = function(a) {
        var b = j.apply(d, i.call(arguments, 1));
        return y.filter(a, function(a) {
            return !y.contains(b, a)
        })
    }
    ,
    y.zip = function() {
        for (var a = y.max(y.pluck(arguments, "length").concat(0)), b = new Array(a), c = 0; a > c; c++)
            b[c] = y.pluck(arguments, "" + c);
        return b
    }
    ,
    y.object = function(a, b) {
        if (null == a)
            return {};
        for (var c = {}, d = 0, e = a.length; e > d; d++)
            b ? c[a[d]] = b[d] : c[a[d][0]] = a[d][1];
        return c
    }
    ,
    y.indexOf = function(a, b, c) {
        if (null == a)
            return -1;
        var d = 0
          , e = a.length;
        if (c) {
            if ("number" != typeof c)
                return d = y.sortedIndex(a, b),
                a[d] === b ? d : -1;
            d = 0 > c ? Math.max(0, e + c) : c
        }
        if (t && a.indexOf === t)
            return a.indexOf(b, c);
        for (; e > d; d++)
            if (a[d] === b)
                return d;
        return -1
    }
    ,
    y.lastIndexOf = function(a, b, c) {
        if (null == a)
            return -1;
        var d = null != c;
        if (u && a.lastIndexOf === u)
            return d ? a.lastIndexOf(b, c) : a.lastIndexOf(b);
        for (var e = d ? c : a.length; e--; )
            if (a[e] === b)
                return e;
        return -1
    }
    ,
    y.range = function(a, b, c) {
        arguments.length <= 1 && (b = a || 0,
        a = 0),
        c = arguments[2] || 1;
        for (var d = Math.max(Math.ceil((b - a) / c), 0), e = 0, f = new Array(d); d > e; )
            f[e++] = a,
            a += c;
        return f
    }
    ;
    var F = function() {};
    y.bind = function(a, b) {
        var c, d;
        if (x && a.bind === x)
            return x.apply(a, i.call(arguments, 1));
        if (!y.isFunction(a))
            throw new TypeError;
        return c = i.call(arguments, 2),
        d = function() {
            if (!(this instanceof d))
                return a.apply(b, c.concat(i.call(arguments)));
            F.prototype = a.prototype;
            var e = new F;
            F.prototype = null;
            var f = a.apply(e, c.concat(i.call(arguments)));
            return Object(f) === f ? f : e
        }
    }
    ,
    y.partial = function(a) {
        var b = i.call(arguments, 1);
        return function() {
            return a.apply(this, b.concat(i.call(arguments)))
        }
    }
    ,
    y.bindAll = function(a) {
        var b = i.call(arguments, 1);
        if (0 === b.length)
            throw new Error("bindAll must be passed function names");
        return z(b, function(b) {
            a[b] = y.bind(a[b], a)
        }),
        a
    }
    ,
    y.memoize = function(a, b) {
        var c = {};
        return b || (b = y.identity),
        function() {
            var d = b.apply(this, arguments);
            return y.has(c, d) ? c[d] : c[d] = a.apply(this, arguments)
        }
    }
    ,
    y.delay = function(a, b) {
        var c = i.call(arguments, 2);
        return setTimeout(function() {
            return a.apply(null, c)
        }, b)
    }
    ,
    y.defer = function(a) {
        return y.delay.apply(y, [a, 1].concat(i.call(arguments, 1)))
    }
    ,
    y.throttle = function(a, b, c) {
        var d, e, f, h = null, i = 0;
        c || (c = {});
        var j = function() {
            i = c.leading === !1 ? 0 : g(),
            h = null,
            f = a.apply(d, e)
        };
        return function() {
            var k = g();
            i || c.leading !== !1 || (i = k);
            var l = b - (k - i);
            return d = this,
            e = arguments,
            0 >= l ? (clearTimeout(h),
            h = null,
            i = k,
            f = a.apply(d, e)) : h || c.trailing === !1 || (h = setTimeout(j, l)),
            f
        }
    }
    ,
    y.debounce = function(a, b, c) {
        var d, e, f, h, i;
        return function() {
            f = this,
            e = arguments,
            h = g();
            var j = function() {
                var k = g() - h;
                b > k ? d = setTimeout(j, b - k) : (d = null,
                c || (i = a.apply(f, e)))
            }
              , k = c && !d;
            return d || (d = setTimeout(j, b)),
            k && (i = a.apply(f, e)),
            i
        }
    }
    ,
    y.once = function(a) {
        var b, c = !1;
        return function() {
            return c ? b : (c = !0,
            b = a.apply(this, arguments),
            a = null,
            b)
        }
    }
    ,
    y.wrap = function(a, b) {
        return function() {
            var c = [a];
            return h.apply(c, arguments),
            b.apply(this, c)
        }
    }
    ,
    y.compose = function() {
        var a = arguments;
        return function() {
            for (var b = arguments, c = a.length - 1; c >= 0; c--)
                b = [a[c].apply(this, b)];
            return b[0]
        }
    }
    ,
    y.after = function(a, b) {
        return function() {
            return --a < 1 ? b.apply(this, arguments) : void 0
        }
    }
    ,
    y.keys = w || function(a) {
        if (a !== Object(a))
            throw new TypeError("Invalid object");
        var b = [];
        for (var c in a)
            y.has(a, c) && b.push(c);
        return b
    }
    ,
    y.values = function(a) {
        for (var b = y.keys(a), c = b.length, d = new Array(c), e = 0; c > e; e++)
            d[e] = a[b[e]];
        return d
    }
    ,
    y.pairs = function(a) {
        for (var b = y.keys(a), c = b.length, d = new Array(c), e = 0; c > e; e++)
            d[e] = [b[e], a[b[e]]];
        return d
    }
    ,
    y.invert = function(a) {
        for (var b = {}, c = y.keys(a), d = 0, e = c.length; e > d; d++)
            b[a[c[d]]] = c[d];
        return b
    }
    ,
    y.functions = y.methods = function(a) {
        var b = [];
        for (var c in a)
            y.isFunction(a[c]) && b.push(c);
        return b.sort()
    }
    ,
    y.extend = function(a) {
        return z(i.call(arguments, 1), function(b) {
            if (b)
                for (var c in b)
                    a[c] = b[c]
        }),
        a
    }
    ,
    y.pick = function(a) {
        var b = {}
          , c = j.apply(d, i.call(arguments, 1));
        return z(c, function(c) {
            c in a && (b[c] = a[c])
        }),
        b
    }
    ,
    y.omit = function(a) {
        var b = {}
          , c = j.apply(d, i.call(arguments, 1));
        for (var e in a)
            y.contains(c, e) || (b[e] = a[e]);
        return b
    }
    ,
    y.defaults = function(a) {
        return z(i.call(arguments, 1), function(b) {
            if (b)
                for (var c in b)
                    void 0 === a[c] && (a[c] = b[c])
        }),
        a
    }
    ,
    y.clone = function(a) {
        return y.isObject(a) ? y.isArray(a) ? a.slice() : y.extend({}, a) : a
    }
    ,
    y.tap = function(a, b) {
        return b(a),
        a
    }
    ;
    var G = function(a, b, c, d) {
        if (a === b)
            return 0 !== a || 1 / a == 1 / b;
        if (null == a || null == b)
            return a === b;
        a instanceof y && (a = a._wrapped),
        b instanceof y && (b = b._wrapped);
        var e = k.call(a);
        if (e != k.call(b))
            return !1;
        switch (e) {
        case "[object String]":
            return a == String(b);
        case "[object Number]":
            return a != +a ? b != +b : 0 == a ? 1 / a == 1 / b : a == +b;
        case "[object Date]":
        case "[object Boolean]":
            return +a == +b;
        case "[object RegExp]":
            return a.source == b.source && a.global == b.global && a.multiline == b.multiline && a.ignoreCase == b.ignoreCase
        }
        if ("object" != typeof a || "object" != typeof b)
            return !1;
        for (var f = c.length; f--; )
            if (c[f] == a)
                return d[f] == b;
        var g = a.constructor
          , h = b.constructor;
        if (g !== h && !(y.isFunction(g) && g instanceof g && y.isFunction(h) && h instanceof h))
            return !1;
        c.push(a),
        d.push(b);
        var i = 0
          , j = !0;
        if ("[object Array]" == e) {
            if (i = a.length,
            j = i == b.length)
                for (; i-- && (j = G(a[i], b[i], c, d)); )
                    ;
        } else {
            for (var l in a)
                if (y.has(a, l) && (i++,
                !(j = y.has(b, l) && G(a[l], b[l], c, d))))
                    break;
            if (j) {
                for (l in b)
                    if (y.has(b, l) && !i--)
                        break;
                j = !i
            }
        }
        return c.pop(),
        d.pop(),
        j
    };
    y.isEqual = function(a, b) {
        return G(a, b, [], [])
    }
    ,
    y.isEmpty = function(a) {
        if (null == a)
            return !0;
        if (y.isArray(a) || y.isString(a))
            return 0 === a.length;
        for (var b in a)
            if (y.has(a, b))
                return !1;
        return !0
    }
    ,
    y.isElement = function(a) {
        return !(!a || 1 !== a.nodeType)
    }
    ,
    y.isArray = v || function(a) {
        return "[object Array]" == k.call(a)
    }
    ,
    y.isObject = function(a) {
        return a === Object(a)
    }
    ,
    z(["Arguments", "Function", "String", "Number", "Date", "RegExp"], function(a) {
        y["is" + a] = function(b) {
            return k.call(b) == "[object " + a + "]"
        }
    }),
    y.isArguments(arguments) || (y.isArguments = function(a) {
        return !(!a || !y.has(a, "callee"))
    }
    ),
    "function" != typeof /./ && (y.isFunction = function(a) {
        return "function" == typeof a
    }
    ),
    y.isFinite = function(a) {
        return isFinite(a) && !isNaN(parseFloat(a))
    }
    ,
    y.isNaN = function(a) {
        return y.isNumber(a) && a != +a
    }
    ,
    y.isBoolean = function(a) {
        return a === !0 || a === !1 || "[object Boolean]" == k.call(a)
    }
    ,
    y.isNull = function(a) {
        return null === a
    }
    ,
    y.isUndefined = function(a) {
        return void 0 === a
    }
    ,
    y.has = function(a, b) {
        return l.call(a, b)
    }
    ,
    y.noConflict = function() {
        return a._ = b,
        this
    }
    ,
    y.identity = function(a) {
        return a
    }
    ,
    y.times = function(a, b, c) {
        for (var d = Array(Math.max(0, a)), e = 0; a > e; e++)
            d[e] = b.call(c, e);
        return d
    }
    ,
    y.random = function(a, b) {
        return null == b && (b = a,
        a = 0),
        a + Math.floor(Math.random() * (b - a + 1))
    }
    ;
    var H = {
        escape: {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#x27;"
        }
    };
    H.unescape = y.invert(H.escape);
    var I = {
        escape: new RegExp("[" + y.keys(H.escape).join("") + "]","g"),
        unescape: new RegExp("(" + y.keys(H.unescape).join("|") + ")","g")
    };
    y.each(["escape", "unescape"], function(a) {
        y[a] = function(b) {
            return null == b ? "" : ("" + b).replace(I[a], function(b) {
                return H[a][b]
            })
        }
    }),
    y.result = function(a, b) {
        if (null == a)
            return void 0;
        var c = a[b];
        return y.isFunction(c) ? c.call(a) : c
    }
    ,
    y.mixin = function(a) {
        z(y.functions(a), function(b) {
            var c = y[b] = a[b];
            y.prototype[b] = function() {
                var a = [this._wrapped];
                return h.apply(a, arguments),
                N.call(this, c.apply(y, a))
            }
        })
    }
    ;
    var J = 0;
    y.uniqueId = function(a) {
        var b = ++J + "";
        return a ? a + b : b
    }
    ,
    y.templateSettings = {
        evaluate: /<%([\s\S]+?)%>/g,
        interpolate: /<%=([\s\S]+?)%>/g,
        escape: /<%-([\s\S]+?)%>/g
    };
    var K = /(.)^/
      , L = {
        "'": "'",
        "\\": "\\",
        "\r": "r",
        "\n": "n",
        "	": "t",
        "\u2028": "u2028",
        "\u2029": "u2029"
    }
      , M = /\\|'|\r|\n|\t|\u2028|\u2029/g;
    y.template = function(a, b, c) {
        var d;
        c = y.defaults({}, c, y.templateSettings);
        var e = new RegExp([(c.escape || K).source, (c.interpolate || K).source, (c.evaluate || K).source].join("|") + "|$","g")
          , f = 0
          , g = "__p+='";
        a.replace(e, function(b, c, d, e, h) {
            return g += a.slice(f, h).replace(M, function(a) {
                return "\\" + L[a]
            }),
            c && (g += "'+\n((__t=(" + c + "))==null?'':_.escape(__t))+\n'"),
            d && (g += "'+\n((__t=(" + d + "))==null?'':__t)+\n'"),
            e && (g += "';\n" + e + "\n__p+='"),
            f = h + b.length,
            b
        }),
        g += "';\n",
        c.variable || (g = "with(obj||{}){\n" + g + "}\n"),
        g = "var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n" + g + "return __p;\n";
        try {
            d = new Function(c.variable || "obj","_",g)
        } catch (h) {
            throw h.source = g,
            h
        }
        if (b)
            return d(b, y);
        var i = function(a) {
            return d.call(this, a, y)
        };
        return i.source = "function(" + (c.variable || "obj") + "){\n" + g + "}",
        i
    }
    ,
    y.chain = function(a) {
        return y(a).chain()
    }
    ;
    var N = function(a) {
        return this._chain ? y(a).chain() : a
    };
    y.mixin(y),
    z(["pop", "push", "reverse", "shift", "sort", "splice", "unshift"], function(a) {
        var b = d[a];
        y.prototype[a] = function() {
            var c = this._wrapped;
            return b.apply(c, arguments),
            "shift" != a && "splice" != a || 0 !== c.length || delete c[0],
            N.call(this, c)
        }
    }),
    z(["concat", "join", "slice"], function(a) {
        var b = d[a];
        y.prototype[a] = function() {
            return N.call(this, b.apply(this._wrapped, arguments))
        }
    }),
    y.extend(y.prototype, {
        chain: function() {
            return this._chain = !0,
            this
        },
        value: function() {
            return this._wrapped
        }
    })
}
).call(this),
function(a) {
    if ("function" == typeof bootstrap)
        bootstrap("promise", a);
    else if ("object" == typeof exports)
        module.exports = a();
    else if ("function" == typeof define && define.amd)
        define(a);
    else if ("undefined" != typeof ses) {
        if (!ses.ok())
            return;
        ses.makeQ = a
    } else
        Q = a()
}(function() {
    "use strict";
    function a(a) {
        return function() {
            return X.apply(a, arguments)
        }
    }
    function b(a) {
        return a === Object(a)
    }
    function c(a) {
        return "[object StopIteration]" === db(a) || a instanceof T
    }
    function d(a, b) {
        if (Q && b.stack && "object" == typeof a && null !== a && a.stack && -1 === a.stack.indexOf(fb)) {
            for (var c = [], d = b; d; d = d.source)
                d.stack && c.unshift(d.stack);
            c.unshift(a.stack);
            var f = c.join("\n" + fb + "\n");
            a.stack = e(f)
        }
    }
    function e(a) {
        for (var b = a.split("\n"), c = [], d = 0; d < b.length; ++d) {
            var e = b[d];
            h(e) || f(e) || !e || c.push(e)
        }
        return c.join("\n")
    }
    function f(a) {
        return -1 !== a.indexOf("(module.js:") || -1 !== a.indexOf("(node.js:")
    }
    function g(a) {
        var b = /at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);
        if (b)
            return [b[1], Number(b[2])];
        var c = /at ([^ ]+):(\d+):(?:\d+)$/.exec(a);
        if (c)
            return [c[1], Number(c[2])];
        var d = /.*@(.+):(\d+)$/.exec(a);
        return d ? [d[1], Number(d[2])] : void 0
    }
    function h(a) {
        var b = g(a);
        if (!b)
            return !1;
        var c = b[0]
          , d = b[1];
        return c === S && d >= U && kb >= d
    }
    function i() {
        if (Q)
            try {
                throw new Error
            } catch (a) {
                var b = a.stack.split("\n")
                  , c = b[0].indexOf("@") > 0 ? b[1] : b[2]
                  , d = g(c);
                if (!d)
                    return;
                return S = d[0],
                d[1]
            }
    }
    function j(a, b, c) {
        return function() {
            return "undefined" != typeof console && "function" == typeof console.warn && console.warn(b + " is deprecated, use " + c + " instead.", new Error("").stack),
            a.apply(a, arguments)
        }
    }
    function k(a) {
        return r(a) ? a : s(a) ? D(a) : C(a)
    }
    function l() {
        function a(a) {
            b = a,
            f.source = a,
            Z(c, function(b, c) {
                W(function() {
                    a.promiseDispatch.apply(a, c)
                })
            }, void 0),
            c = void 0,
            d = void 0
        }
        var b, c = [], d = [], e = ab(l.prototype), f = ab(o.prototype);
        if (f.promiseDispatch = function(a, e, f) {
            var g = Y(arguments);
            c ? (c.push(g),
            "when" === e && f[1] && d.push(f[1])) : W(function() {
                b.promiseDispatch.apply(b, g)
            })
        }
        ,
        f.valueOf = j(function() {
            if (c)
                return f;
            var a = q(b);
            return r(a) && (b = a),
            a
        }, "valueOf", "inspect"),
        f.inspect = function() {
            return b ? b.inspect() : {
                state: "pending"
            }
        }
        ,
        k.longStackSupport && Q)
            try {
                throw new Error
            } catch (g) {
                f.stack = g.stack.substring(g.stack.indexOf("\n") + 1)
            }
        return e.promise = f,
        e.resolve = function(c) {
            b || a(k(c))
        }
        ,
        e.fulfill = function(c) {
            b || a(C(c))
        }
        ,
        e.reject = function(c) {
            b || a(B(c))
        }
        ,
        e.notify = function(a) {
            b || Z(d, function(b, c) {
                W(function() {
                    c(a)
                })
            }, void 0)
        }
        ,
        e
    }
    function m(a) {
        if ("function" != typeof a)
            throw new TypeError("resolver must be a function.");
        var b = l();
        try {
            a(b.resolve, b.reject, b.notify)
        } catch (c) {
            b.reject(c)
        }
        return b.promise
    }
    function n(a) {
        return m(function(b, c) {
            for (var d = 0, e = a.length; e > d; d++)
                k(a[d]).then(b, c)
        })
    }
    function o(a, b, c) {
        void 0 === b && (b = function(a) {
            return B(new Error("Promise does not support operation: " + a))
        }
        ),
        void 0 === c && (c = function() {
            return {
                state: "unknown"
            }
        }
        );
        var d = ab(o.prototype);
        if (d.promiseDispatch = function(c, e, f) {
            var g;
            try {
                g = a[e] ? a[e].apply(d, f) : b.call(d, e, f)
            } catch (h) {
                g = B(h)
            }
            c && c(g)
        }
        ,
        d.inspect = c,
        c) {
            var e = c();
            "rejected" === e.state && (d.exception = e.reason),
            d.valueOf = j(function() {
                var a = c();
                return "pending" === a.state || "rejected" === a.state ? d : a.value
            })
        }
        return d
    }
    function p(a, b, c, d) {
        return k(a).then(b, c, d)
    }
    function q(a) {
        if (r(a)) {
            var b = a.inspect();
            if ("fulfilled" === b.state)
                return b.value
        }
        return a
    }
    function r(a) {
        return b(a) && "function" == typeof a.promiseDispatch && "function" == typeof a.inspect
    }
    function s(a) {
        return b(a) && "function" == typeof a.then
    }
    function t(a) {
        return r(a) && "pending" === a.inspect().state
    }
    function u(a) {
        return !r(a) || "fulfilled" === a.inspect().state
    }
    function v(a) {
        return r(a) && "rejected" === a.inspect().state
    }
    function w() {
        ib || "undefined" == typeof window || window.Touch || !window.console || console.warn("[Q] Unhandled rejection reasons (should be empty):", gb),
        ib = !0
    }
    function x() {
        for (var a = 0; a < gb.length; a++) {
            var b = gb[a];
            console.warn("Unhandled rejection reason:", b)
        }
    }
    function y() {
        gb.length = 0,
        hb.length = 0,
        ib = !1,
        jb || (jb = !0,
        "undefined" != typeof process && process.on && process.on("exit", x))
    }
    function z(a, b) {
        jb && (hb.push(a),
        b && "undefined" != typeof b.stack ? gb.push(b.stack) : gb.push("(no stack) " + b),
        w())
    }
    function A(a) {
        if (jb) {
            var b = $(hb, a);
            -1 !== b && (hb.splice(b, 1),
            gb.splice(b, 1))
        }
    }
    function B(a) {
        var b = o({
            when: function(b) {
                return b && A(this),
                b ? b(a) : this
            }
        }, function() {
            return this
        }, function() {
            return {
                state: "rejected",
                reason: a
            }
        });
        return z(b, a),
        b
    }
    function C(a) {
        return o({
            when: function() {
                return a
            },
            get: function(b) {
                return a[b]
            },
            set: function(b, c) {
                a[b] = c
            },
            "delete": function(b) {
                delete a[b]
            },
            post: function(b, c) {
                return null === b || void 0 === b ? a.apply(void 0, c) : a[b].apply(a, c)
            },
            apply: function(b, c) {
                return a.apply(b, c)
            },
            keys: function() {
                return cb(a)
            }
        }, void 0, function() {
            return {
                state: "fulfilled",
                value: a
            }
        })
    }
    function D(a) {
        var b = l();
        return W(function() {
            try {
                a.then(b.resolve, b.reject, b.notify)
            } catch (c) {
                b.reject(c)
            }
        }),
        b.promise
    }
    function E(a) {
        return o({
            isDef: function() {}
        }, function(b, c) {
            return K(a, b, c)
        }, function() {
            return k(a).inspect()
        })
    }
    function F(a, b, c) {
        return k(a).spread(b, c)
    }
    function G(a) {
        return function() {
            function b(a, b) {
                var g;
                if (eb) {
                    try {
                        g = d[a](b)
                    } catch (h) {
                        return B(h)
                    }
                    return g.done ? g.value : p(g.value, e, f)
                }
                try {
                    g = d[a](b)
                } catch (h) {
                    return c(h) ? h.value : B(h)
                }
                return p(g, e, f)
            }
            var d = a.apply(this, arguments)
              , e = b.bind(b, "next")
              , f = b.bind(b, "throw");
            return e()
        }
    }
    function H(a) {
        k.done(k.async(a)())
    }
    function I(a) {
        throw new T(a)
    }
    function J(a) {
        return function() {
            return F([this, L(arguments)], function(b, c) {
                return a.apply(b, c)
            })
        }
    }
    function K(a, b, c) {
        return k(a).dispatch(b, c)
    }
    function L(a) {
        return p(a, function(a) {
            var b = 0
              , c = l();
            return Z(a, function(d, e, f) {
                var g;
                r(e) && "fulfilled" === (g = e.inspect()).state ? a[f] = g.value : (++b,
                p(e, function(d) {
                    a[f] = d,
                    0 === --b && c.resolve(a)
                }, c.reject, function(a) {
                    c.notify({
                        index: f,
                        value: a
                    })
                }))
            }, void 0),
            0 === b && c.resolve(a),
            c.promise
        })
    }
    function M(a) {
        return p(a, function(a) {
            return a = _(a, k),
            p(L(_(a, function(a) {
                return p(a, V, V)
            })), function() {
                return a
            })
        })
    }
    function N(a) {
        return k(a).allSettled()
    }
    function O(a, b) {
        return k(a).then(void 0, void 0, b)
    }
    function P(a, b) {
        return k(a).nodeify(b)
    }
    var Q = !1;
    try {
        throw new Error
    } catch (R) {
        Q = !!R.stack
    }
    var S, T, U = i(), V = function() {}, W = function() {
        function a() {
            for (; b.next; ) {
                b = b.next;
                var c = b.task;
                b.task = void 0;
                var e = b.domain;
                e && (b.domain = void 0,
                e.enter());
                try {
                    c()
                } catch (g) {
                    if (f)
                        throw e && e.exit(),
                        setTimeout(a, 0),
                        e && e.enter(),
                        g;
                    setTimeout(function() {
                        throw g
                    }, 0)
                }
                e && e.exit()
            }
            d = !1
        }
        var b = {
            task: void 0,
            next: null
        }
          , c = b
          , d = !1
          , e = void 0
          , f = !1;
        if (W = function(a) {
            c = c.next = {
                task: a,
                domain: f && process.domain,
                next: null
            },
            d || (d = !0,
            e())
        }
        ,
        "undefined" != typeof process && process.nextTick)
            f = !0,
            e = function() {
                process.nextTick(a)
            }
            ;
        else if ("function" == typeof setImmediate)
            e = "undefined" != typeof window ? setImmediate.bind(window, a) : function() {
                setImmediate(a)
            }
            ;
        else if ("undefined" != typeof MessageChannel) {
            var g = new MessageChannel;
            g.port1.onmessage = function() {
                e = h,
                g.port1.onmessage = a,
                a()
            }
            ;
            var h = function() {
                g.port2.postMessage(0)
            };
            e = function() {
                setTimeout(a, 0),
                h()
            }
        } else
            e = function() {
                setTimeout(a, 0)
            }
            ;
        return W
    }(), X = Function.call, Y = a(Array.prototype.slice), Z = a(Array.prototype.reduce || function(a, b) {
        var c = 0
          , d = this.length;
        if (1 === arguments.length)
            for (; ; ) {
                if (c in this) {
                    b = this[c++];
                    break
                }
                if (++c >= d)
                    throw new TypeError
            }
        for (; d > c; c++)
            c in this && (b = a(b, this[c], c));
        return b
    }
    ), $ = a(Array.prototype.indexOf || function(a) {
        for (var b = 0; b < this.length; b++)
            if (this[b] === a)
                return b;
        return -1
    }
    ), _ = a(Array.prototype.map || function(a, b) {
        var c = this
          , d = [];
        return Z(c, function(e, f, g) {
            d.push(a.call(b, f, g, c))
        }, void 0),
        d
    }
    ), ab = Object.create || function(a) {
        function b() {}
        return b.prototype = a,
        new b
    }
    , bb = a(Object.prototype.hasOwnProperty), cb = Object.keys || function(a) {
        var b = [];
        for (var c in a)
            bb(a, c) && b.push(c);
        return b
    }
    , db = a(Object.prototype.toString);
    T = "undefined" != typeof ReturnValue ? ReturnValue : function(a) {
        this.value = a
    }
    ;
    var eb;
    try {
        new Function("(function* (){ yield 1; })"),
        eb = !0
    } catch (R) {
        eb = !1
    }
    var fb = "From previous event:";
    k.resolve = k,
    k.nextTick = W,
    k.longStackSupport = !1,
    k.defer = l,
    l.prototype.makeNodeResolver = function() {
        var a = this;
        return function(b, c) {
            b ? a.reject(b) : arguments.length > 2 ? a.resolve(Y(arguments, 1)) : a.resolve(c)
        }
    }
    ,
    k.promise = m,
    k.passByCopy = function(a) {
        return a
    }
    ,
    o.prototype.passByCopy = function() {
        return this
    }
    ,
    k.join = function(a, b) {
        return k(a).join(b)
    }
    ,
    o.prototype.join = function(a) {
        return k([this, a]).spread(function(a, b) {
            if (a === b)
                return a;
            throw new Error("Can't join: not the same: " + a + " " + b)
        })
    }
    ,
    k.race = n,
    o.prototype.race = function() {
        return this.then(k.race)
    }
    ,
    k.makePromise = o,
    o.prototype.toString = function() {
        return "[object Promise]"
    }
    ,
    o.prototype.then = function(a, b, c) {
        function e(b) {
            try {
                return "function" == typeof a ? a(b) : b
            } catch (c) {
                return B(c)
            }
        }
        function f(a) {
            if ("function" == typeof b) {
                d(a, h);
                try {
                    return b(a)
                } catch (c) {
                    return B(c)
                }
            }
            return B(a)
        }
        function g(a) {
            return "function" == typeof c ? c(a) : a
        }
        var h = this
          , i = l()
          , j = !1;
        return W(function() {
            h.promiseDispatch(function(a) {
                j || (j = !0,
                i.resolve(e(a)))
            }, "when", [function(a) {
                j || (j = !0,
                i.resolve(f(a)))
            }
            ])
        }),
        h.promiseDispatch(void 0, "when", [void 0, function(a) {
            var b, c = !1;
            try {
                b = g(a)
            } catch (d) {
                if (c = !0,
                !k.onerror)
                    throw d;
                k.onerror(d)
            }
            c || i.notify(b)
        }
        ]),
        i.promise
    }
    ,
    k.when = p,
    o.prototype.thenResolve = function(a) {
        return this.then(function() {
            return a
        })
    }
    ,
    k.thenResolve = function(a, b) {
        return k(a).thenResolve(b)
    }
    ,
    o.prototype.thenReject = function(a) {
        return this.then(function() {
            throw a
        })
    }
    ,
    k.thenReject = function(a, b) {
        return k(a).thenReject(b)
    }
    ,
    k.nearer = q,
    k.isPromise = r,
    k.isPromiseAlike = s,
    k.isPending = t,
    o.prototype.isPending = function() {
        return "pending" === this.inspect().state
    }
    ,
    k.isFulfilled = u,
    o.prototype.isFulfilled = function() {
        return "fulfilled" === this.inspect().state
    }
    ,
    k.isRejected = v,
    o.prototype.isRejected = function() {
        return "rejected" === this.inspect().state
    }
    ;
    var gb = []
      , hb = []
      , ib = !1
      , jb = !0;
    k.resetUnhandledRejections = y,
    k.getUnhandledReasons = function() {
        return gb.slice()
    }
    ,
    k.stopUnhandledRejectionTracking = function() {
        y(),
        "undefined" != typeof process && process.on && process.removeListener("exit", x),
        jb = !1
    }
    ,
    y(),
    k.reject = B,
    k.fulfill = C,
    k.master = E,
    k.spread = F,
    o.prototype.spread = function(a, b) {
        return this.all().then(function(b) {
            return a.apply(void 0, b)
        }, b)
    }
    ,
    k.async = G,
    k.spawn = H,
    k["return"] = I,
    k.promised = J,
    k.dispatch = K,
    o.prototype.dispatch = function(a, b) {
        var c = this
          , d = l();
        return W(function() {
            c.promiseDispatch(d.resolve, a, b)
        }),
        d.promise
    }
    ,
    k.get = function(a, b) {
        return k(a).dispatch("get", [b])
    }
    ,
    o.prototype.get = function(a) {
        return this.dispatch("get", [a])
    }
    ,
    k.set = function(a, b, c) {
        return k(a).dispatch("set", [b, c])
    }
    ,
    o.prototype.set = function(a, b) {
        return this.dispatch("set", [a, b])
    }
    ,
    k.del = k["delete"] = function(a, b) {
        return k(a).dispatch("delete", [b])
    }
    ,
    o.prototype.del = o.prototype["delete"] = function(a) {
        return this.dispatch("delete", [a])
    }
    ,
    k.mapply = k.post = function(a, b, c) {
        return k(a).dispatch("post", [b, c])
    }
    ,
    o.prototype.mapply = o.prototype.post = function(a, b) {
        return this.dispatch("post", [a, b])
    }
    ,
    k.send = k.mcall = k.invoke = function(a, b) {
        return k(a).dispatch("post", [b, Y(arguments, 2)])
    }
    ,
    o.prototype.send = o.prototype.mcall = o.prototype.invoke = function(a) {
        return this.dispatch("post", [a, Y(arguments, 1)])
    }
    ,
    k.fapply = function(a, b) {
        return k(a).dispatch("apply", [void 0, b])
    }
    ,
    o.prototype.fapply = function(a) {
        return this.dispatch("apply", [void 0, a])
    }
    ,
    k["try"] = k.fcall = function(a) {
        return k(a).dispatch("apply", [void 0, Y(arguments, 1)])
    }
    ,
    o.prototype.fcall = function() {
        return this.dispatch("apply", [void 0, Y(arguments)])
    }
    ,
    k.fbind = function(a) {
        var b = k(a)
          , c = Y(arguments, 1);
        return function() {
            return b.dispatch("apply", [this, c.concat(Y(arguments))])
        }
    }
    ,
    o.prototype.fbind = function() {
        var a = this
          , b = Y(arguments);
        return function() {
            return a.dispatch("apply", [this, b.concat(Y(arguments))])
        }
    }
    ,
    k.keys = function(a) {
        return k(a).dispatch("keys", [])
    }
    ,
    o.prototype.keys = function() {
        return this.dispatch("keys", [])
    }
    ,
    k.all = L,
    o.prototype.all = function() {
        return L(this)
    }
    ,
    k.allResolved = j(M, "allResolved", "allSettled"),
    o.prototype.allResolved = function() {
        return M(this)
    }
    ,
    k.allSettled = N,
    o.prototype.allSettled = function() {
        return this.then(function(a) {
            return L(_(a, function(a) {
                function b() {
                    return a.inspect()
                }
                return a = k(a),
                a.then(b, b)
            }))
        })
    }
    ,
    k.fail = k["catch"] = function(a, b) {
        return k(a).then(void 0, b)
    }
    ,
    o.prototype.fail = o.prototype["catch"] = function(a) {
        return this.then(void 0, a)
    }
    ,
    k.progress = O,
    o.prototype.progress = function(a) {
        return this.then(void 0, void 0, a)
    }
    ,
    k.fin = k["finally"] = function(a, b) {
        return k(a)["finally"](b)
    }
    ,
    o.prototype.fin = o.prototype["finally"] = function(a) {
        return a = k(a),
        this.then(function(b) {
            return a.fcall().then(function() {
                return b
            })
        }, function(b) {
            return a.fcall().then(function() {
                throw b
            })
        })
    }
    ,
    k.done = function(a, b, c, d) {
        return k(a).done(b, c, d)
    }
    ,
    o.prototype.done = function(a, b, c) {
        var e = function(a) {
            W(function() {
                if (d(a, f),
                !k.onerror)
                    throw a;
                k.onerror(a)
            })
        }
          , f = a || b || c ? this.then(a, b, c) : this;
        "object" == typeof process && process && process.domain && (e = process.domain.bind(e)),
        f.then(void 0, e)
    }
    ,
    k.timeout = function(a, b, c) {
        return k(a).timeout(b, c)
    }
    ,
    o.prototype.timeout = function(a, b) {
        var c = l()
          , d = setTimeout(function() {
            c.reject(new Error(b || "Timed out after " + a + " ms"))
        }, a);
        return this.then(function(a) {
            clearTimeout(d),
            c.resolve(a)
        }, function(a) {
            clearTimeout(d),
            c.reject(a)
        }, c.notify),
        c.promise
    }
    ,
    k.delay = function(a, b) {
        return void 0 === b && (b = a,
        a = void 0),
        k(a).delay(b)
    }
    ,
    o.prototype.delay = function(a) {
        return this.then(function(b) {
            var c = l();
            return setTimeout(function() {
                c.resolve(b)
            }, a),
            c.promise
        })
    }
    ,
    k.nfapply = function(a, b) {
        return k(a).nfapply(b)
    }
    ,
    o.prototype.nfapply = function(a) {
        var b = l()
          , c = Y(a);
        return c.push(b.makeNodeResolver()),
        this.fapply(c).fail(b.reject),
        b.promise
    }
    ,
    k.nfcall = function(a) {
        var b = Y(arguments, 1);
        return k(a).nfapply(b)
    }
    ,
    o.prototype.nfcall = function() {
        var a = Y(arguments)
          , b = l();
        return a.push(b.makeNodeResolver()),
        this.fapply(a).fail(b.reject),
        b.promise
    }
    ,
    k.nfbind = k.denodeify = function(a) {
        var b = Y(arguments, 1);
        return function() {
            var c = b.concat(Y(arguments))
              , d = l();
            return c.push(d.makeNodeResolver()),
            k(a).fapply(c).fail(d.reject),
            d.promise
        }
    }
    ,
    o.prototype.nfbind = o.prototype.denodeify = function() {
        var a = Y(arguments);
        return a.unshift(this),
        k.denodeify.apply(void 0, a)
    }
    ,
    k.nbind = function(a, b) {
        var c = Y(arguments, 2);
        return function() {
            function d() {
                return a.apply(b, arguments)
            }
            var e = c.concat(Y(arguments))
              , f = l();
            return e.push(f.makeNodeResolver()),
            k(d).fapply(e).fail(f.reject),
            f.promise
        }
    }
    ,
    o.prototype.nbind = function() {
        var a = Y(arguments, 0);
        return a.unshift(this),
        k.nbind.apply(void 0, a)
    }
    ,
    k.nmapply = k.npost = function(a, b, c) {
        return k(a).npost(b, c)
    }
    ,
    o.prototype.nmapply = o.prototype.npost = function(a, b) {
        var c = Y(b || [])
          , d = l();
        return c.push(d.makeNodeResolver()),
        this.dispatch("post", [a, c]).fail(d.reject),
        d.promise
    }
    ,
    k.nsend = k.nmcall = k.ninvoke = function(a, b) {
        var c = Y(arguments, 2)
          , d = l();
        return c.push(d.makeNodeResolver()),
        k(a).dispatch("post", [b, c]).fail(d.reject),
        d.promise
    }
    ,
    o.prototype.nsend = o.prototype.nmcall = o.prototype.ninvoke = function(a) {
        var b = Y(arguments, 1)
          , c = l();
        return b.push(c.makeNodeResolver()),
        this.dispatch("post", [a, b]).fail(c.reject),
        c.promise
    }
    ,
    k.nodeify = P,
    o.prototype.nodeify = function(a) {
        return a ? (this.then(function(b) {
            W(function() {
                a(null, b)
            })
        }, function(b) {
            W(function() {
                a(b)
            })
        }),
        void 0) : this
    }
    ;
    var kb = i();
    return k
});
var THREE = {
    REVISION: "66"
};
self.console = self.console || {
    info: function() {},
    log: function() {},
    debug: function() {},
    warn: function() {},
    error: function() {}
},
function() {
    for (var a = 0, b = ["ms", "moz", "webkit", "o"], c = 0; c < b.length && !self.requestAnimationFrame; ++c)
        self.requestAnimationFrame = self[b[c] + "RequestAnimationFrame"],
        self.cancelAnimationFrame = self[b[c] + "CancelAnimationFrame"] || self[b[c] + "CancelRequestAnimationFrame"];
    void 0 === self.requestAnimationFrame && void 0 !== self.setTimeout && (self.requestAnimationFrame = function(b) {
        var c = Date.now()
          , d = Math.max(0, 16 - (c - a))
          , e = self.setTimeout(function() {
            b(c + d)
        }, d);
        return a = c + d,
        e
    }
    ),
    void 0 === self.cancelAnimationFrame && void 0 !== self.clearTimeout && (self.cancelAnimationFrame = function(a) {
        self.clearTimeout(a)
    }
    )
}(),
THREE.CullFaceNone = 0,
THREE.CullFaceBack = 1,
THREE.CullFaceFront = 2,
THREE.CullFaceFrontBack = 3,
THREE.FrontFaceDirectionCW = 0,
THREE.FrontFaceDirectionCCW = 1,
THREE.BasicShadowMap = 0,
THREE.PCFShadowMap = 1,
THREE.PCFSoftShadowMap = 2,
THREE.FrontSide = 0,
THREE.BackSide = 1,
THREE.DoubleSide = 2,
THREE.NoShading = 0,
THREE.FlatShading = 1,
THREE.SmoothShading = 2,
THREE.NoColors = 0,
THREE.FaceColors = 1,
THREE.VertexColors = 2,
THREE.NoBlending = 0,
THREE.NormalBlending = 1,
THREE.AdditiveBlending = 2,
THREE.SubtractiveBlending = 3,
THREE.MultiplyBlending = 4,
THREE.CustomBlending = 5,
THREE.AddEquation = 100,
THREE.SubtractEquation = 101,
THREE.ReverseSubtractEquation = 102,
THREE.ZeroFactor = 200,
THREE.OneFactor = 201,
THREE.SrcColorFactor = 202,
THREE.OneMinusSrcColorFactor = 203,
THREE.SrcAlphaFactor = 204,
THREE.OneMinusSrcAlphaFactor = 205,
THREE.DstAlphaFactor = 206,
THREE.OneMinusDstAlphaFactor = 207,
THREE.DstColorFactor = 208,
THREE.OneMinusDstColorFactor = 209,
THREE.SrcAlphaSaturateFactor = 210,
THREE.MultiplyOperation = 0,
THREE.MixOperation = 1,
THREE.AddOperation = 2,
THREE.UVMapping = function() {}
,
THREE.CubeReflectionMapping = function() {}
,
THREE.CubeRefractionMapping = function() {}
,
THREE.SphericalReflectionMapping = function() {}
,
THREE.SphericalRefractionMapping = function() {}
,
THREE.RepeatWrapping = 1e3,
THREE.ClampToEdgeWrapping = 1001,
THREE.MirroredRepeatWrapping = 1002,
THREE.NearestFilter = 1003,
THREE.NearestMipMapNearestFilter = 1004,
THREE.NearestMipMapLinearFilter = 1005,
THREE.LinearFilter = 1006,
THREE.LinearMipMapNearestFilter = 1007,
THREE.LinearMipMapLinearFilter = 1008,
THREE.UnsignedByteType = 1009,
THREE.ByteType = 1010,
THREE.ShortType = 1011,
THREE.UnsignedShortType = 1012,
THREE.IntType = 1013,
THREE.UnsignedIntType = 1014,
THREE.FloatType = 1015,
THREE.UnsignedShort4444Type = 1016,
THREE.UnsignedShort5551Type = 1017,
THREE.UnsignedShort565Type = 1018,
THREE.AlphaFormat = 1019,
THREE.RGBFormat = 1020,
THREE.RGBAFormat = 1021,
THREE.LuminanceFormat = 1022,
THREE.LuminanceAlphaFormat = 1023,
THREE.RGB_S3TC_DXT1_Format = 2001,
THREE.RGBA_S3TC_DXT1_Format = 2002,
THREE.RGBA_S3TC_DXT3_Format = 2003,
THREE.RGBA_S3TC_DXT5_Format = 2004,
THREE.Color = function(a) {
    return 3 === arguments.length ? this.setRGB(arguments[0], arguments[1], arguments[2]) : this.set(a)
}
,
THREE.Color.prototype = {
    constructor: THREE.Color,
    r: 1,
    g: 1,
    b: 1,
    set: function(a) {
        return a instanceof THREE.Color ? this.copy(a) : "number" == typeof a ? this.setHex(a) : "string" == typeof a && this.setStyle(a),
        this
    },
    setHex: function(a) {
        return a = Math.floor(a),
        this.r = (a >> 16 & 255) / 255,
        this.g = (a >> 8 & 255) / 255,
        this.b = (255 & a) / 255,
        this
    },
    setRGB: function(a, b, c) {
        return this.r = a,
        this.g = b,
        this.b = c,
        this
    },
    setHSL: function(a, b, c) {
        if (0 === b)
            this.r = this.g = this.b = c;
        else {
            var d = function(a, b, c) {
                return 0 > c && (c += 1),
                c > 1 && (c -= 1),
                1 / 6 > c ? a + 6 * (b - a) * c : .5 > c ? b : 2 / 3 > c ? a + 6 * (b - a) * (2 / 3 - c) : a
            }
              , e = .5 >= c ? c * (1 + b) : c + b - c * b
              , f = 2 * c - e;
            this.r = d(f, e, a + 1 / 3),
            this.g = d(f, e, a),
            this.b = d(f, e, a - 1 / 3)
        }
        return this
    },
    setStyle: function(a) {
        if (/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a)) {
            var b = /^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a);
            return this.r = Math.min(255, parseInt(b[1], 10)) / 255,
            this.g = Math.min(255, parseInt(b[2], 10)) / 255,
            this.b = Math.min(255, parseInt(b[3], 10)) / 255,
            this
        }
        if (/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(a)) {
            var b = /^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(a);
            return this.r = Math.min(100, parseInt(b[1], 10)) / 100,
            this.g = Math.min(100, parseInt(b[2], 10)) / 100,
            this.b = Math.min(100, parseInt(b[3], 10)) / 100,
            this
        }
        if (/^\#([0-9a-f]{6})$/i.test(a)) {
            var b = /^\#([0-9a-f]{6})$/i.exec(a);
            return this.setHex(parseInt(b[1], 16)),
            this
        }
        if (/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a)) {
            var b = /^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a);
            return this.setHex(parseInt(b[1] + b[1] + b[2] + b[2] + b[3] + b[3], 16)),
            this
        }
        return /^(\w+)$/i.test(a) ? (this.setHex(THREE.ColorKeywords[a]),
        this) : void 0
    },
    copy: function(a) {
        return this.r = a.r,
        this.g = a.g,
        this.b = a.b,
        this
    },
    copyGammaToLinear: function(a) {
        return this.r = a.r * a.r,
        this.g = a.g * a.g,
        this.b = a.b * a.b,
        this
    },
    copyLinearToGamma: function(a) {
        return this.r = Math.sqrt(a.r),
        this.g = Math.sqrt(a.g),
        this.b = Math.sqrt(a.b),
        this
    },
    convertGammaToLinear: function() {
        var a = this.r
          , b = this.g
          , c = this.b;
        return this.r = a * a,
        this.g = b * b,
        this.b = c * c,
        this
    },
    convertLinearToGamma: function() {
        return this.r = Math.sqrt(this.r),
        this.g = Math.sqrt(this.g),
        this.b = Math.sqrt(this.b),
        this
    },
    getHex: function() {
        return 255 * this.r << 16 ^ 255 * this.g << 8 ^ 255 * this.b << 0
    },
    getHexString: function() {
        return ("000000" + this.getHex().toString(16)).slice(-6)
    },
    getHSL: function(a) {
        var b, c, d = a || {
            h: 0,
            s: 0,
            l: 0
        }, e = this.r, f = this.g, g = this.b, h = Math.max(e, f, g), i = Math.min(e, f, g), j = (i + h) / 2;
        if (i === h)
            b = 0,
            c = 0;
        else {
            var k = h - i;
            switch (c = .5 >= j ? k / (h + i) : k / (2 - h - i),
            h) {
            case e:
                b = (f - g) / k + (g > f ? 6 : 0);
                break;
            case f:
                b = (g - e) / k + 2;
                break;
            case g:
                b = (e - f) / k + 4
            }
            b /= 6
        }
        return d.h = b,
        d.s = c,
        d.l = j,
        d
    },
    getStyle: function() {
        return "rgb(" + (255 * this.r | 0) + "," + (255 * this.g | 0) + "," + (255 * this.b | 0) + ")"
    },
    offsetHSL: function(a, b, c) {
        var d = this.getHSL();
        return d.h += a,
        d.s += b,
        d.l += c,
        this.setHSL(d.h, d.s, d.l),
        this
    },
    add: function(a) {
        return this.r += a.r,
        this.g += a.g,
        this.b += a.b,
        this
    },
    addColors: function(a, b) {
        return this.r = a.r + b.r,
        this.g = a.g + b.g,
        this.b = a.b + b.b,
        this
    },
    addScalar: function(a) {
        return this.r += a,
        this.g += a,
        this.b += a,
        this
    },
    multiply: function(a) {
        return this.r *= a.r,
        this.g *= a.g,
        this.b *= a.b,
        this
    },
    multiplyScalar: function(a) {
        return this.r *= a,
        this.g *= a,
        this.b *= a,
        this
    },
    lerp: function(a, b) {
        return this.r += (a.r - this.r) * b,
        this.g += (a.g - this.g) * b,
        this.b += (a.b - this.b) * b,
        this
    },
    equals: function(a) {
        return a.r === this.r && a.g === this.g && a.b === this.b
    },
    fromArray: function(a) {
        return this.r = a[0],
        this.g = a[1],
        this.b = a[2],
        this
    },
    toArray: function() {
        return [this.r, this.g, this.b]
    },
    clone: function() {
        return (new THREE.Color).setRGB(this.r, this.g, this.b)
    }
},
THREE.ColorKeywords = {
    aliceblue: 15792383,
    antiquewhite: 16444375,
    aqua: 65535,
    aquamarine: 8388564,
    azure: 15794175,
    beige: 16119260,
    bisque: 16770244,
    black: 0,
    blanchedalmond: 16772045,
    blue: 255,
    blueviolet: 9055202,
    brown: 10824234,
    burlywood: 14596231,
    cadetblue: 6266528,
    chartreuse: 8388352,
    chocolate: 13789470,
    coral: 16744272,
    cornflowerblue: 6591981,
    cornsilk: 16775388,
    crimson: 14423100,
    cyan: 65535,
    darkblue: 139,
    darkcyan: 35723,
    darkgoldenrod: 12092939,
    darkgray: 11119017,
    darkgreen: 25600,
    darkgrey: 11119017,
    darkkhaki: 12433259,
    darkmagenta: 9109643,
    darkolivegreen: 5597999,
    darkorange: 16747520,
    darkorchid: 10040012,
    darkred: 9109504,
    darksalmon: 15308410,
    darkseagreen: 9419919,
    darkslateblue: 4734347,
    darkslategray: 3100495,
    darkslategrey: 3100495,
    darkturquoise: 52945,
    darkviolet: 9699539,
    deeppink: 16716947,
    deepskyblue: 49151,
    dimgray: 6908265,
    dimgrey: 6908265,
    dodgerblue: 2003199,
    firebrick: 11674146,
    floralwhite: 16775920,
    forestgreen: 2263842,
    fuchsia: 16711935,
    gainsboro: 14474460,
    ghostwhite: 16316671,
    gold: 16766720,
    goldenrod: 14329120,
    gray: 8421504,
    green: 32768,
    greenyellow: 11403055,
    grey: 8421504,
    honeydew: 15794160,
    hotpink: 16738740,
    indianred: 13458524,
    indigo: 4915330,
    ivory: 16777200,
    khaki: 15787660,
    lavender: 15132410,
    lavenderblush: 16773365,
    lawngreen: 8190976,
    lemonchiffon: 16775885,
    lightblue: 11393254,
    lightcoral: 15761536,
    lightcyan: 14745599,
    lightgoldenrodyellow: 16448210,
    lightgray: 13882323,
    lightgreen: 9498256,
    lightgrey: 13882323,
    lightpink: 16758465,
    lightsalmon: 16752762,
    lightseagreen: 2142890,
    lightskyblue: 8900346,
    lightslategray: 7833753,
    lightslategrey: 7833753,
    lightsteelblue: 11584734,
    lightyellow: 16777184,
    lime: 65280,
    limegreen: 3329330,
    linen: 16445670,
    magenta: 16711935,
    maroon: 8388608,
    mediumaquamarine: 6737322,
    mediumblue: 205,
    mediumorchid: 12211667,
    mediumpurple: 9662683,
    mediumseagreen: 3978097,
    mediumslateblue: 8087790,
    mediumspringgreen: 64154,
    mediumturquoise: 4772300,
    mediumvioletred: 13047173,
    midnightblue: 1644912,
    mintcream: 16121850,
    mistyrose: 16770273,
    moccasin: 16770229,
    navajowhite: 16768685,
    navy: 128,
    oldlace: 16643558,
    olive: 8421376,
    olivedrab: 7048739,
    orange: 16753920,
    orangered: 16729344,
    orchid: 14315734,
    palegoldenrod: 15657130,
    palegreen: 10025880,
    paleturquoise: 11529966,
    palevioletred: 14381203,
    papayawhip: 16773077,
    peachpuff: 16767673,
    peru: 13468991,
    pink: 16761035,
    plum: 14524637,
    powderblue: 11591910,
    purple: 8388736,
    red: 16711680,
    rosybrown: 12357519,
    royalblue: 4286945,
    saddlebrown: 9127187,
    salmon: 16416882,
    sandybrown: 16032864,
    seagreen: 3050327,
    seashell: 16774638,
    sienna: 10506797,
    silver: 12632256,
    skyblue: 8900331,
    slateblue: 6970061,
    slategray: 7372944,
    slategrey: 7372944,
    snow: 16775930,
    springgreen: 65407,
    steelblue: 4620980,
    tan: 13808780,
    teal: 32896,
    thistle: 14204888,
    tomato: 16737095,
    turquoise: 4251856,
    violet: 15631086,
    wheat: 16113331,
    white: 16777215,
    whitesmoke: 16119285,
    yellow: 16776960,
    yellowgreen: 10145074
},
THREE.Quaternion = function(a, b, c, d) {
    this._x = a || 0,
    this._y = b || 0,
    this._z = c || 0,
    this._w = void 0 !== d ? d : 1
}
,
THREE.Quaternion.prototype = {
    constructor: THREE.Quaternion,
    _x: 0,
    _y: 0,
    _z: 0,
    _w: 0,
    _euler: void 0,
    _updateEuler: function() {
        void 0 !== this._euler && this._euler.setFromQuaternion(this, void 0, !1)
    },
    get x() {
        return this._x
    },
    set x(a) {
        this._x = a,
        this._updateEuler()
    },
    get y() {
        return this._y
    },
    set y(a) {
        this._y = a,
        this._updateEuler()
    },
    get z() {
        return this._z
    },
    set z(a) {
        this._z = a,
        this._updateEuler()
    },
    get w() {
        return this._w
    },
    set w(a) {
        this._w = a,
        this._updateEuler()
    },
    set: function(a, b, c, d) {
        return this._x = a,
        this._y = b,
        this._z = c,
        this._w = d,
        this._updateEuler(),
        this
    },
    copy: function(a) {
        return this._x = a._x,
        this._y = a._y,
        this._z = a._z,
        this._w = a._w,
        this._updateEuler(),
        this
    },
    setFromEuler: function(a, b) {
        if (a instanceof THREE.Euler == !1)
            throw new Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");
        var c = Math.cos(a._x / 2)
          , d = Math.cos(a._y / 2)
          , e = Math.cos(a._z / 2)
          , f = Math.sin(a._x / 2)
          , g = Math.sin(a._y / 2)
          , h = Math.sin(a._z / 2);
        return "XYZ" === a.order ? (this._x = f * d * e + c * g * h,
        this._y = c * g * e - f * d * h,
        this._z = c * d * h + f * g * e,
        this._w = c * d * e - f * g * h) : "YXZ" === a.order ? (this._x = f * d * e + c * g * h,
        this._y = c * g * e - f * d * h,
        this._z = c * d * h - f * g * e,
        this._w = c * d * e + f * g * h) : "ZXY" === a.order ? (this._x = f * d * e - c * g * h,
        this._y = c * g * e + f * d * h,
        this._z = c * d * h + f * g * e,
        this._w = c * d * e - f * g * h) : "ZYX" === a.order ? (this._x = f * d * e - c * g * h,
        this._y = c * g * e + f * d * h,
        this._z = c * d * h - f * g * e,
        this._w = c * d * e + f * g * h) : "YZX" === a.order ? (this._x = f * d * e + c * g * h,
        this._y = c * g * e + f * d * h,
        this._z = c * d * h - f * g * e,
        this._w = c * d * e - f * g * h) : "XZY" === a.order && (this._x = f * d * e - c * g * h,
        this._y = c * g * e - f * d * h,
        this._z = c * d * h + f * g * e,
        this._w = c * d * e + f * g * h),
        b !== !1 && this._updateEuler(),
        this
    },
    setFromAxisAngle: function(a, b) {
        var c = b / 2
          , d = Math.sin(c);
        return this._x = a.x * d,
        this._y = a.y * d,
        this._z = a.z * d,
        this._w = Math.cos(c),
        this._updateEuler(),
        this
    },
    setFromRotationMatrix: function(a) {
        var b, c = a.elements, d = c[0], e = c[4], f = c[8], g = c[1], h = c[5], i = c[9], j = c[2], k = c[6], l = c[10], m = d + h + l;
        return m > 0 ? (b = .5 / Math.sqrt(m + 1),
        this._w = .25 / b,
        this._x = (k - i) * b,
        this._y = (f - j) * b,
        this._z = (g - e) * b) : d > h && d > l ? (b = 2 * Math.sqrt(1 + d - h - l),
        this._w = (k - i) / b,
        this._x = .25 * b,
        this._y = (e + g) / b,
        this._z = (f + j) / b) : h > l ? (b = 2 * Math.sqrt(1 + h - d - l),
        this._w = (f - j) / b,
        this._x = (e + g) / b,
        this._y = .25 * b,
        this._z = (i + k) / b) : (b = 2 * Math.sqrt(1 + l - d - h),
        this._w = (g - e) / b,
        this._x = (f + j) / b,
        this._y = (i + k) / b,
        this._z = .25 * b),
        this._updateEuler(),
        this
    },
    inverse: function() {
        return this.conjugate().normalize(),
        this
    },
    conjugate: function() {
        return this._x *= -1,
        this._y *= -1,
        this._z *= -1,
        this._updateEuler(),
        this
    },
    lengthSq: function() {
        return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w
    },
    length: function() {
        return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w)
    },
    normalize: function() {
        var a = this.length();
        return 0 === a ? (this._x = 0,
        this._y = 0,
        this._z = 0,
        this._w = 1) : (a = 1 / a,
        this._x = this._x * a,
        this._y = this._y * a,
        this._z = this._z * a,
        this._w = this._w * a),
        this
    },
    multiply: function(a, b) {
        return void 0 !== b ? (console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),
        this.multiplyQuaternions(a, b)) : this.multiplyQuaternions(this, a)
    },
    multiplyQuaternions: function(a, b) {
        var c = a._x
          , d = a._y
          , e = a._z
          , f = a._w
          , g = b._x
          , h = b._y
          , i = b._z
          , j = b._w;
        return this._x = c * j + f * g + d * i - e * h,
        this._y = d * j + f * h + e * g - c * i,
        this._z = e * j + f * i + c * h - d * g,
        this._w = f * j - c * g - d * h - e * i,
        this._updateEuler(),
        this
    },
    multiplyVector3: function(a) {
        return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),
        a.applyQuaternion(this)
    },
    slerp: function(a, b) {
        var c = this._x
          , d = this._y
          , e = this._z
          , f = this._w
          , g = f * a._w + c * a._x + d * a._y + e * a._z;
        if (0 > g ? (this._w = -a._w,
        this._x = -a._x,
        this._y = -a._y,
        this._z = -a._z,
        g = -g) : this.copy(a),
        g >= 1)
            return this._w = f,
            this._x = c,
            this._y = d,
            this._z = e,
            this;
        var h = Math.acos(g)
          , i = Math.sqrt(1 - g * g);
        if (Math.abs(i) < .001)
            return this._w = .5 * (f + this._w),
            this._x = .5 * (c + this._x),
            this._y = .5 * (d + this._y),
            this._z = .5 * (e + this._z),
            this;
        var j = Math.sin((1 - b) * h) / i
          , k = Math.sin(b * h) / i;
        return this._w = f * j + this._w * k,
        this._x = c * j + this._x * k,
        this._y = d * j + this._y * k,
        this._z = e * j + this._z * k,
        this._updateEuler(),
        this
    },
    equals: function(a) {
        return a._x === this._x && a._y === this._y && a._z === this._z && a._w === this._w
    },
    fromArray: function(a) {
        return this._x = a[0],
        this._y = a[1],
        this._z = a[2],
        this._w = a[3],
        this._updateEuler(),
        this
    },
    toArray: function() {
        return [this._x, this._y, this._z, this._w]
    },
    clone: function() {
        return new THREE.Quaternion(this._x,this._y,this._z,this._w)
    }
},
THREE.Quaternion.slerp = function(a, b, c, d) {
    return c.copy(a).slerp(b, d)
}
,
THREE.Vector2 = function(a, b) {
    this.x = a || 0,
    this.y = b || 0
}
,
THREE.Vector2.prototype = {
    constructor: THREE.Vector2,
    set: function(a, b) {
        return this.x = a,
        this.y = b,
        this
    },
    setX: function(a) {
        return this.x = a,
        this
    },
    setY: function(a) {
        return this.y = a,
        this
    },
    setComponent: function(a, b) {
        switch (a) {
        case 0:
            this.x = b;
            break;
        case 1:
            this.y = b;
            break;
        default:
            throw new Error("index is out of range: " + a)
        }
    },
    getComponent: function(a) {
        switch (a) {
        case 0:
            return this.x;
        case 1:
            return this.y;
        default:
            throw new Error("index is out of range: " + a)
        }
    },
    copy: function(a) {
        return this.x = a.x,
        this.y = a.y,
        this
    },
    add: function(a, b) {
        return void 0 !== b ? (console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
        this.addVectors(a, b)) : (this.x += a.x,
        this.y += a.y,
        this)
    },
    addVectors: function(a, b) {
        return this.x = a.x + b.x,
        this.y = a.y + b.y,
        this
    },
    addScalar: function(a) {
        return this.x += a,
        this.y += a,
        this
    },
    sub: function(a, b) {
        return void 0 !== b ? (console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
        this.subVectors(a, b)) : (this.x -= a.x,
        this.y -= a.y,
        this)
    },
    subVectors: function(a, b) {
        return this.x = a.x - b.x,
        this.y = a.y - b.y,
        this
    },
    multiplyScalar: function(a) {
        return this.x *= a,
        this.y *= a,
        this
    },
    divideScalar: function(a) {
        if (0 !== a) {
            var b = 1 / a;
            this.x *= b,
            this.y *= b
        } else
            this.x = 0,
            this.y = 0;
        return this
    },
    min: function(a) {
        return this.x > a.x && (this.x = a.x),
        this.y > a.y && (this.y = a.y),
        this
    },
    max: function(a) {
        return this.x < a.x && (this.x = a.x),
        this.y < a.y && (this.y = a.y),
        this
    },
    clamp: function(a, b) {
        return this.x < a.x ? this.x = a.x : this.x > b.x && (this.x = b.x),
        this.y < a.y ? this.y = a.y : this.y > b.y && (this.y = b.y),
        this
    },
    clampScalar: function() {
        var a, b;
        return function(c, d) {
            return void 0 === a && (a = new THREE.Vector2,
            b = new THREE.Vector2),
            a.set(c, c),
            b.set(d, d),
            this.clamp(a, b)
        }
    }(),
    floor: function() {
        return this.x = Math.floor(this.x),
        this.y = Math.floor(this.y),
        this
    },
    ceil: function() {
        return this.x = Math.ceil(this.x),
        this.y = Math.ceil(this.y),
        this
    },
    round: function() {
        return this.x = Math.round(this.x),
        this.y = Math.round(this.y),
        this
    },
    roundToZero: function() {
        return this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x),
        this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y),
        this
    },
    negate: function() {
        return this.multiplyScalar(-1)
    },
    dot: function(a) {
        return this.x * a.x + this.y * a.y
    },
    lengthSq: function() {
        return this.x * this.x + this.y * this.y
    },
    length: function() {
        return Math.sqrt(this.x * this.x + this.y * this.y)
    },
    normalize: function() {
        return this.divideScalar(this.length())
    },
    distanceTo: function(a) {
        return Math.sqrt(this.distanceToSquared(a))
    },
    distanceToSquared: function(a) {
        var b = this.x - a.x
          , c = this.y - a.y;
        return b * b + c * c
    },
    setLength: function(a) {
        var b = this.length();
        return 0 !== b && a !== b && this.multiplyScalar(a / b),
        this
    },
    lerp: function(a, b) {
        return this.x += (a.x - this.x) * b,
        this.y += (a.y - this.y) * b,
        this
    },
    equals: function(a) {
        return a.x === this.x && a.y === this.y
    },
    fromArray: function(a) {
        return this.x = a[0],
        this.y = a[1],
        this
    },
    toArray: function() {
        return [this.x, this.y]
    },
    clone: function() {
        return new THREE.Vector2(this.x,this.y)
    }
},
THREE.Vector3 = function(a, b, c) {
    this.x = a || 0,
    this.y = b || 0,
    this.z = c || 0
}
,
THREE.Vector3.prototype = {
    constructor: THREE.Vector3,
    set: function(a, b, c) {
        return this.x = a,
        this.y = b,
        this.z = c,
        this
    },
    setX: function(a) {
        return this.x = a,
        this
    },
    setY: function(a) {
        return this.y = a,
        this
    },
    setZ: function(a) {
        return this.z = a,
        this
    },
    setComponent: function(a, b) {
        switch (a) {
        case 0:
            this.x = b;
            break;
        case 1:
            this.y = b;
            break;
        case 2:
            this.z = b;
            break;
        default:
            throw new Error("index is out of range: " + a)
        }
    },
    getComponent: function(a) {
        switch (a) {
        case 0:
            return this.x;
        case 1:
            return this.y;
        case 2:
            return this.z;
        default:
            throw new Error("index is out of range: " + a)
        }
    },
    copy: function(a) {
        return this.x = a.x,
        this.y = a.y,
        this.z = a.z,
        this
    },
    add: function(a, b) {
        return void 0 !== b ? (console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
        this.addVectors(a, b)) : (this.x += a.x,
        this.y += a.y,
        this.z += a.z,
        this)
    },
    addScalar: function(a) {
        return this.x += a,
        this.y += a,
        this.z += a,
        this
    },
    addVectors: function(a, b) {
        return this.x = a.x + b.x,
        this.y = a.y + b.y,
        this.z = a.z + b.z,
        this
    },
    sub: function(a, b) {
        return void 0 !== b ? (console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
        this.subVectors(a, b)) : (this.x -= a.x,
        this.y -= a.y,
        this.z -= a.z,
        this)
    },
    subVectors: function(a, b) {
        return this.x = a.x - b.x,
        this.y = a.y - b.y,
        this.z = a.z - b.z,
        this
    },
    multiply: function(a, b) {
        return void 0 !== b ? (console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),
        this.multiplyVectors(a, b)) : (this.x *= a.x,
        this.y *= a.y,
        this.z *= a.z,
        this)
    },
    multiplyScalar: function(a) {
        return this.x *= a,
        this.y *= a,
        this.z *= a,
        this
    },
    multiplyVectors: function(a, b) {
        return this.x = a.x * b.x,
        this.y = a.y * b.y,
        this.z = a.z * b.z,
        this
    },
    applyEuler: function() {
        var a;
        return function(b) {
            return b instanceof THREE.Euler == !1 && console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),
            void 0 === a && (a = new THREE.Quaternion),
            this.applyQuaternion(a.setFromEuler(b)),
            this
        }
    }(),
    applyAxisAngle: function() {
        var a;
        return function(b, c) {
            return void 0 === a && (a = new THREE.Quaternion),
            this.applyQuaternion(a.setFromAxisAngle(b, c)),
            this
        }
    }(),
    applyMatrix3: function(a) {
        var b = this.x
          , c = this.y
          , d = this.z
          , e = a.elements;
        return this.x = e[0] * b + e[3] * c + e[6] * d,
        this.y = e[1] * b + e[4] * c + e[7] * d,
        this.z = e[2] * b + e[5] * c + e[8] * d,
        this
    },
    applyMatrix4: function(a) {
        var b = this.x
          , c = this.y
          , d = this.z
          , e = a.elements;
        return this.x = e[0] * b + e[4] * c + e[8] * d + e[12],
        this.y = e[1] * b + e[5] * c + e[9] * d + e[13],
        this.z = e[2] * b + e[6] * c + e[10] * d + e[14],
        this
    },
    applyProjection: function(a) {
        var b = this.x
          , c = this.y
          , d = this.z
          , e = a.elements
          , f = 1 / (e[3] * b + e[7] * c + e[11] * d + e[15]);
        return this.x = (e[0] * b + e[4] * c + e[8] * d + e[12]) * f,
        this.y = (e[1] * b + e[5] * c + e[9] * d + e[13]) * f,
        this.z = (e[2] * b + e[6] * c + e[10] * d + e[14]) * f,
        this
    },
    applyQuaternion: function(a) {
        var b = this.x
          , c = this.y
          , d = this.z
          , e = a.x
          , f = a.y
          , g = a.z
          , h = a.w
          , i = h * b + f * d - g * c
          , j = h * c + g * b - e * d
          , k = h * d + e * c - f * b
          , l = -e * b - f * c - g * d;
        return this.x = i * h + l * -e + j * -g - k * -f,
        this.y = j * h + l * -f + k * -e - i * -g,
        this.z = k * h + l * -g + i * -f - j * -e,
        this
    },
    transformDirection: function(a) {
        var b = this.x
          , c = this.y
          , d = this.z
          , e = a.elements;
        return this.x = e[0] * b + e[4] * c + e[8] * d,
        this.y = e[1] * b + e[5] * c + e[9] * d,
        this.z = e[2] * b + e[6] * c + e[10] * d,
        this.normalize(),
        this
    },
    divide: function(a) {
        return this.x /= a.x,
        this.y /= a.y,
        this.z /= a.z,
        this
    },
    divideScalar: function(a) {
        if (0 !== a) {
            var b = 1 / a;
            this.x *= b,
            this.y *= b,
            this.z *= b
        } else
            this.x = 0,
            this.y = 0,
            this.z = 0;
        return this
    },
    min: function(a) {
        return this.x > a.x && (this.x = a.x),
        this.y > a.y && (this.y = a.y),
        this.z > a.z && (this.z = a.z),
        this
    },
    max: function(a) {
        return this.x < a.x && (this.x = a.x),
        this.y < a.y && (this.y = a.y),
        this.z < a.z && (this.z = a.z),
        this
    },
    clamp: function(a, b) {
        return this.x < a.x ? this.x = a.x : this.x > b.x && (this.x = b.x),
        this.y < a.y ? this.y = a.y : this.y > b.y && (this.y = b.y),
        this.z < a.z ? this.z = a.z : this.z > b.z && (this.z = b.z),
        this
    },
    clampScalar: function() {
        var a, b;
        return function(c, d) {
            return void 0 === a && (a = new THREE.Vector3,
            b = new THREE.Vector3),
            a.set(c, c, c),
            b.set(d, d, d),
            this.clamp(a, b)
        }
    }(),
    floor: function() {
        return this.x = Math.floor(this.x),
        this.y = Math.floor(this.y),
        this.z = Math.floor(this.z),
        this
    },
    ceil: function() {
        return this.x = Math.ceil(this.x),
        this.y = Math.ceil(this.y),
        this.z = Math.ceil(this.z),
        this
    },
    round: function() {
        return this.x = Math.round(this.x),
        this.y = Math.round(this.y),
        this.z = Math.round(this.z),
        this
    },
    roundToZero: function() {
        return this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x),
        this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y),
        this.z = this.z < 0 ? Math.ceil(this.z) : Math.floor(this.z),
        this
    },
    negate: function() {
        return this.multiplyScalar(-1)
    },
    dot: function(a) {
        return this.x * a.x + this.y * a.y + this.z * a.z
    },
    lengthSq: function() {
        return this.x * this.x + this.y * this.y + this.z * this.z
    },
    length: function() {
        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z)
    },
    lengthManhattan: function() {
        return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z)
    },
    normalize: function() {
        return this.divideScalar(this.length())
    },
    setLength: function(a) {
        var b = this.length();
        return 0 !== b && a !== b && this.multiplyScalar(a / b),
        this
    },
    lerp: function(a, b) {
        return this.x += (a.x - this.x) * b,
        this.y += (a.y - this.y) * b,
        this.z += (a.z - this.z) * b,
        this
    },
    cross: function(a, b) {
        if (void 0 !== b)
            return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),
            this.crossVectors(a, b);
        var c = this.x
          , d = this.y
          , e = this.z;
        return this.x = d * a.z - e * a.y,
        this.y = e * a.x - c * a.z,
        this.z = c * a.y - d * a.x,
        this
    },
    crossVectors: function(a, b) {
        var c = a.x
          , d = a.y
          , e = a.z
          , f = b.x
          , g = b.y
          , h = b.z;
        return this.x = d * h - e * g,
        this.y = e * f - c * h,
        this.z = c * g - d * f,
        this
    },
    projectOnVector: function() {
        var a, b;
        return function(c) {
            return void 0 === a && (a = new THREE.Vector3),
            a.copy(c).normalize(),
            b = this.dot(a),
            this.copy(a).multiplyScalar(b)
        }
    }(),
    projectOnPlane: function() {
        var a;
        return function(b) {
            return void 0 === a && (a = new THREE.Vector3),
            a.copy(this).projectOnVector(b),
            this.sub(a)
        }
    }(),
    reflect: function() {
        var a;
        return function(b) {
            return void 0 === a && (a = new THREE.Vector3),
            this.sub(a.copy(b).multiplyScalar(2 * this.dot(b)))
        }
    }(),
    angleTo: function(a) {
        var b = this.dot(a) / (this.length() * a.length());
        return Math.acos(THREE.Math.clamp(b, -1, 1))
    },
    distanceTo: function(a) {
        return Math.sqrt(this.distanceToSquared(a))
    },
    distanceToSquared: function(a) {
        var b = this.x - a.x
          , c = this.y - a.y
          , d = this.z - a.z;
        return b * b + c * c + d * d
    },
    setEulerFromRotationMatrix: function() {
        console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")
    },
    setEulerFromQuaternion: function() {
        console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")
    },
    getPositionFromMatrix: function(a) {
        return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),
        this.setFromMatrixPosition(a)
    },
    getScaleFromMatrix: function(a) {
        return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),
        this.setFromMatrixScale(a)
    },
    getColumnFromMatrix: function(a, b) {
        return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),
        this.setFromMatrixColumn(a, b)
    },
    setFromMatrixPosition: function(a) {
        return this.x = a.elements[12],
        this.y = a.elements[13],
        this.z = a.elements[14],
        this
    },
    setFromMatrixScale: function(a) {
        var b = this.set(a.elements[0], a.elements[1], a.elements[2]).length()
          , c = this.set(a.elements[4], a.elements[5], a.elements[6]).length()
          , d = this.set(a.elements[8], a.elements[9], a.elements[10]).length();
        return this.x = b,
        this.y = c,
        this.z = d,
        this
    },
    setFromMatrixColumn: function(a, b) {
        var c = 4 * a
          , d = b.elements;
        return this.x = d[c],
        this.y = d[c + 1],
        this.z = d[c + 2],
        this
    },
    equals: function(a) {
        return a.x === this.x && a.y === this.y && a.z === this.z
    },
    fromArray: function(a) {
        return this.x = a[0],
        this.y = a[1],
        this.z = a[2],
        this
    },
    toArray: function() {
        return [this.x, this.y, this.z]
    },
    clone: function() {
        return new THREE.Vector3(this.x,this.y,this.z)
    }
},
THREE.Vector4 = function(a, b, c, d) {
    this.x = a || 0,
    this.y = b || 0,
    this.z = c || 0,
    this.w = void 0 !== d ? d : 1
}
,
THREE.Vector4.prototype = {
    constructor: THREE.Vector4,
    set: function(a, b, c, d) {
        return this.x = a,
        this.y = b,
        this.z = c,
        this.w = d,
        this
    },
    setX: function(a) {
        return this.x = a,
        this
    },
    setY: function(a) {
        return this.y = a,
        this
    },
    setZ: function(a) {
        return this.z = a,
        this
    },
    setW: function(a) {
        return this.w = a,
        this
    },
    setComponent: function(a, b) {
        switch (a) {
        case 0:
            this.x = b;
            break;
        case 1:
            this.y = b;
            break;
        case 2:
            this.z = b;
            break;
        case 3:
            this.w = b;
            break;
        default:
            throw new Error("index is out of range: " + a)
        }
    },
    getComponent: function(a) {
        switch (a) {
        case 0:
            return this.x;
        case 1:
            return this.y;
        case 2:
            return this.z;
        case 3:
            return this.w;
        default:
            throw new Error("index is out of range: " + a)
        }
    },
    copy: function(a) {
        return this.x = a.x,
        this.y = a.y,
        this.z = a.z,
        this.w = void 0 !== a.w ? a.w : 1,
        this
    },
    add: function(a, b) {
        return void 0 !== b ? (console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
        this.addVectors(a, b)) : (this.x += a.x,
        this.y += a.y,
        this.z += a.z,
        this.w += a.w,
        this)
    },
    addScalar: function(a) {
        return this.x += a,
        this.y += a,
        this.z += a,
        this.w += a,
        this
    },
    addVectors: function(a, b) {
        return this.x = a.x + b.x,
        this.y = a.y + b.y,
        this.z = a.z + b.z,
        this.w = a.w + b.w,
        this
    },
    sub: function(a, b) {
        return void 0 !== b ? (console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
        this.subVectors(a, b)) : (this.x -= a.x,
        this.y -= a.y,
        this.z -= a.z,
        this.w -= a.w,
        this)
    },
    subVectors: function(a, b) {
        return this.x = a.x - b.x,
        this.y = a.y - b.y,
        this.z = a.z - b.z,
        this.w = a.w - b.w,
        this
    },
    multiplyScalar: function(a) {
        return this.x *= a,
        this.y *= a,
        this.z *= a,
        this.w *= a,
        this
    },
    applyMatrix4: function(a) {
        var b = this.x
          , c = this.y
          , d = this.z
          , e = this.w
          , f = a.elements;
        return this.x = f[0] * b + f[4] * c + f[8] * d + f[12] * e,
        this.y = f[1] * b + f[5] * c + f[9] * d + f[13] * e,
        this.z = f[2] * b + f[6] * c + f[10] * d + f[14] * e,
        this.w = f[3] * b + f[7] * c + f[11] * d + f[15] * e,
        this
    },
    divideScalar: function(a) {
        if (0 !== a) {
            var b = 1 / a;
            this.x *= b,
            this.y *= b,
            this.z *= b,
            this.w *= b
        } else
            this.x = 0,
            this.y = 0,
            this.z = 0,
            this.w = 1;
        return this
    },
    setAxisAngleFromQuaternion: function(a) {
        this.w = 2 * Math.acos(a.w);
        var b = Math.sqrt(1 - a.w * a.w);
        return 1e-4 > b ? (this.x = 1,
        this.y = 0,
        this.z = 0) : (this.x = a.x / b,
        this.y = a.y / b,
        this.z = a.z / b),
        this
    },
    setAxisAngleFromRotationMatrix: function(a) {
        var b, c, d, e, f = .01, g = .1, h = a.elements, i = h[0], j = h[4], k = h[8], l = h[1], m = h[5], n = h[9], o = h[2], p = h[6], q = h[10];
        if (Math.abs(j - l) < f && Math.abs(k - o) < f && Math.abs(n - p) < f) {
            if (Math.abs(j + l) < g && Math.abs(k + o) < g && Math.abs(n + p) < g && Math.abs(i + m + q - 3) < g)
                return this.set(1, 0, 0, 0),
                this;
            b = Math.PI;
            var r = (i + 1) / 2
              , s = (m + 1) / 2
              , t = (q + 1) / 2
              , u = (j + l) / 4
              , v = (k + o) / 4
              , w = (n + p) / 4;
            return r > s && r > t ? f > r ? (c = 0,
            d = .707106781,
            e = .707106781) : (c = Math.sqrt(r),
            d = u / c,
            e = v / c) : s > t ? f > s ? (c = .707106781,
            d = 0,
            e = .707106781) : (d = Math.sqrt(s),
            c = u / d,
            e = w / d) : f > t ? (c = .707106781,
            d = .707106781,
            e = 0) : (e = Math.sqrt(t),
            c = v / e,
            d = w / e),
            this.set(c, d, e, b),
            this
        }
        var x = Math.sqrt((p - n) * (p - n) + (k - o) * (k - o) + (l - j) * (l - j));
        return Math.abs(x) < .001 && (x = 1),
        this.x = (p - n) / x,
        this.y = (k - o) / x,
        this.z = (l - j) / x,
        this.w = Math.acos((i + m + q - 1) / 2),
        this
    },
    min: function(a) {
        return this.x > a.x && (this.x = a.x),
        this.y > a.y && (this.y = a.y),
        this.z > a.z && (this.z = a.z),
        this.w > a.w && (this.w = a.w),
        this
    },
    max: function(a) {
        return this.x < a.x && (this.x = a.x),
        this.y < a.y && (this.y = a.y),
        this.z < a.z && (this.z = a.z),
        this.w < a.w && (this.w = a.w),
        this
    },
    clamp: function(a, b) {
        return this.x < a.x ? this.x = a.x : this.x > b.x && (this.x = b.x),
        this.y < a.y ? this.y = a.y : this.y > b.y && (this.y = b.y),
        this.z < a.z ? this.z = a.z : this.z > b.z && (this.z = b.z),
        this.w < a.w ? this.w = a.w : this.w > b.w && (this.w = b.w),
        this
    },
    clampScalar: function() {
        var a, b;
        return function(c, d) {
            return void 0 === a && (a = new THREE.Vector4,
            b = new THREE.Vector4),
            a.set(c, c, c, c),
            b.set(d, d, d, d),
            this.clamp(a, b)
        }
    }(),
    floor: function() {
        return this.x = Math.floor(this.x),
        this.y = Math.floor(this.y),
        this.z = Math.floor(this.z),
        this.w = Math.floor(this.w),
        this
    },
    ceil: function() {
        return this.x = Math.ceil(this.x),
        this.y = Math.ceil(this.y),
        this.z = Math.ceil(this.z),
        this.w = Math.ceil(this.w),
        this
    },
    round: function() {
        return this.x = Math.round(this.x),
        this.y = Math.round(this.y),
        this.z = Math.round(this.z),
        this.w = Math.round(this.w),
        this
    },
    roundToZero: function() {
        return this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x),
        this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y),
        this.z = this.z < 0 ? Math.ceil(this.z) : Math.floor(this.z),
        this.w = this.w < 0 ? Math.ceil(this.w) : Math.floor(this.w),
        this
    },
    negate: function() {
        return this.multiplyScalar(-1)
    },
    dot: function(a) {
        return this.x * a.x + this.y * a.y + this.z * a.z + this.w * a.w
    },
    lengthSq: function() {
        return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w
    },
    length: function() {
        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)
    },
    lengthManhattan: function() {
        return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z) + Math.abs(this.w)
    },
    normalize: function() {
        return this.divideScalar(this.length())
    },
    setLength: function(a) {
        var b = this.length();
        return 0 !== b && a !== b && this.multiplyScalar(a / b),
        this
    },
    lerp: function(a, b) {
        return this.x += (a.x - this.x) * b,
        this.y += (a.y - this.y) * b,
        this.z += (a.z - this.z) * b,
        this.w += (a.w - this.w) * b,
        this
    },
    equals: function(a) {
        return a.x === this.x && a.y === this.y && a.z === this.z && a.w === this.w
    },
    fromArray: function(a) {
        return this.x = a[0],
        this.y = a[1],
        this.z = a[2],
        this.w = a[3],
        this
    },
    toArray: function() {
        return [this.x, this.y, this.z, this.w]
    },
    clone: function() {
        return new THREE.Vector4(this.x,this.y,this.z,this.w)
    }
},
THREE.Euler = function(a, b, c, d) {
    this._x = a || 0,
    this._y = b || 0,
    this._z = c || 0,
    this._order = d || THREE.Euler.DefaultOrder
}
,
THREE.Euler.RotationOrders = ["XYZ", "YZX", "ZXY", "XZY", "YXZ", "ZYX"],
THREE.Euler.DefaultOrder = "XYZ",
THREE.Euler.prototype = {
    constructor: THREE.Euler,
    _x: 0,
    _y: 0,
    _z: 0,
    _order: THREE.Euler.DefaultOrder,
    _quaternion: void 0,
    _updateQuaternion: function() {
        void 0 !== this._quaternion && this._quaternion.setFromEuler(this, !1)
    },
    get x() {
        return this._x
    },
    set x(a) {
        this._x = a,
        this._updateQuaternion()
    },
    get y() {
        return this._y
    },
    set y(a) {
        this._y = a,
        this._updateQuaternion()
    },
    get z() {
        return this._z
    },
    set z(a) {
        this._z = a,
        this._updateQuaternion()
    },
    get order() {
        return this._order
    },
    set order(a) {
        this._order = a,
        this._updateQuaternion()
    },
    set: function(a, b, c, d) {
        return this._x = a,
        this._y = b,
        this._z = c,
        this._order = d || this._order,
        this._updateQuaternion(),
        this
    },
    copy: function(a) {
        return this._x = a._x,
        this._y = a._y,
        this._z = a._z,
        this._order = a._order,
        this._updateQuaternion(),
        this
    },
    setFromRotationMatrix: function(a, b) {
        function c(a) {
            return Math.min(Math.max(a, -1), 1)
        }
        var d = a.elements
          , e = d[0]
          , f = d[4]
          , g = d[8]
          , h = d[1]
          , i = d[5]
          , j = d[9]
          , k = d[2]
          , l = d[6]
          , m = d[10];
        return b = b || this._order,
        "XYZ" === b ? (this._y = Math.asin(c(g)),
        Math.abs(g) < .99999 ? (this._x = Math.atan2(-j, m),
        this._z = Math.atan2(-f, e)) : (this._x = Math.atan2(l, i),
        this._z = 0)) : "YXZ" === b ? (this._x = Math.asin(-c(j)),
        Math.abs(j) < .99999 ? (this._y = Math.atan2(g, m),
        this._z = Math.atan2(h, i)) : (this._y = Math.atan2(-k, e),
        this._z = 0)) : "ZXY" === b ? (this._x = Math.asin(c(l)),
        Math.abs(l) < .99999 ? (this._y = Math.atan2(-k, m),
        this._z = Math.atan2(-f, i)) : (this._y = 0,
        this._z = Math.atan2(h, e))) : "ZYX" === b ? (this._y = Math.asin(-c(k)),
        Math.abs(k) < .99999 ? (this._x = Math.atan2(l, m),
        this._z = Math.atan2(h, e)) : (this._x = 0,
        this._z = Math.atan2(-f, i))) : "YZX" === b ? (this._z = Math.asin(c(h)),
        Math.abs(h) < .99999 ? (this._x = Math.atan2(-j, i),
        this._y = Math.atan2(-k, e)) : (this._x = 0,
        this._y = Math.atan2(g, m))) : "XZY" === b ? (this._z = Math.asin(-c(f)),
        Math.abs(f) < .99999 ? (this._x = Math.atan2(l, i),
        this._y = Math.atan2(g, e)) : (this._x = Math.atan2(-j, m),
        this._y = 0)) : console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: " + b),
        this._order = b,
        this._updateQuaternion(),
        this
    },
    setFromQuaternion: function(a, b, c) {
        function d(a) {
            return Math.min(Math.max(a, -1), 1)
        }
        var e = a.x * a.x
          , f = a.y * a.y
          , g = a.z * a.z
          , h = a.w * a.w;
        return b = b || this._order,
        "XYZ" === b ? (this._x = Math.atan2(2 * (a.x * a.w - a.y * a.z), h - e - f + g),
        this._y = Math.asin(d(2 * (a.x * a.z + a.y * a.w))),
        this._z = Math.atan2(2 * (a.z * a.w - a.x * a.y), h + e - f - g)) : "YXZ" === b ? (this._x = Math.asin(d(2 * (a.x * a.w - a.y * a.z))),
        this._y = Math.atan2(2 * (a.x * a.z + a.y * a.w), h - e - f + g),
        this._z = Math.atan2(2 * (a.x * a.y + a.z * a.w), h - e + f - g)) : "ZXY" === b ? (this._x = Math.asin(d(2 * (a.x * a.w + a.y * a.z))),
        this._y = Math.atan2(2 * (a.y * a.w - a.z * a.x), h - e - f + g),
        this._z = Math.atan2(2 * (a.z * a.w - a.x * a.y), h - e + f - g)) : "ZYX" === b ? (this._x = Math.atan2(2 * (a.x * a.w + a.z * a.y), h - e - f + g),
        this._y = Math.asin(d(2 * (a.y * a.w - a.x * a.z))),
        this._z = Math.atan2(2 * (a.x * a.y + a.z * a.w), h + e - f - g)) : "YZX" === b ? (this._x = Math.atan2(2 * (a.x * a.w - a.z * a.y), h - e + f - g),
        this._y = Math.atan2(2 * (a.y * a.w - a.x * a.z), h + e - f - g),
        this._z = Math.asin(d(2 * (a.x * a.y + a.z * a.w)))) : "XZY" === b ? (this._x = Math.atan2(2 * (a.x * a.w + a.y * a.z), h - e + f - g),
        this._y = Math.atan2(2 * (a.x * a.z + a.y * a.w), h + e - f - g),
        this._z = Math.asin(d(2 * (a.z * a.w - a.x * a.y)))) : console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: " + b),
        this._order = b,
        c !== !1 && this._updateQuaternion(),
        this
    },
    reorder: function() {
        var a = new THREE.Quaternion;
        return function(b) {
            a.setFromEuler(this),
            this.setFromQuaternion(a, b)
        }
    }(),
    fromArray: function(a) {
        return this._x = a[0],
        this._y = a[1],
        this._z = a[2],
        void 0 !== a[3] && (this._order = a[3]),
        this._updateQuaternion(),
        this
    },
    toArray: function() {
        return [this._x, this._y, this._z, this._order]
    },
    equals: function(a) {
        return a._x === this._x && a._y === this._y && a._z === this._z && a._order === this._order
    },
    clone: function() {
        return new THREE.Euler(this._x,this._y,this._z,this._order)
    }
},
THREE.Line3 = function(a, b) {
    this.start = void 0 !== a ? a : new THREE.Vector3,
    this.end = void 0 !== b ? b : new THREE.Vector3
}
,
THREE.Line3.prototype = {
    constructor: THREE.Line3,
    set: function(a, b) {
        return this.start.copy(a),
        this.end.copy(b),
        this
    },
    copy: function(a) {
        return this.start.copy(a.start),
        this.end.copy(a.end),
        this
    },
    center: function(a) {
        var b = a || new THREE.Vector3;
        return b.addVectors(this.start, this.end).multiplyScalar(.5)
    },
    delta: function(a) {
        var b = a || new THREE.Vector3;
        return b.subVectors(this.end, this.start)
    },
    distanceSq: function() {
        return this.start.distanceToSquared(this.end)
    },
    distance: function() {
        return this.start.distanceTo(this.end)
    },
    at: function(a, b) {
        var c = b || new THREE.Vector3;
        return this.delta(c).multiplyScalar(a).add(this.start)
    },
    closestPointToPointParameter: function() {
        var a = new THREE.Vector3
          , b = new THREE.Vector3;
        return function(c, d) {
            a.subVectors(c, this.start),
            b.subVectors(this.end, this.start);
            var e = b.dot(b)
              , f = b.dot(a)
              , g = f / e;
            return d && (g = THREE.Math.clamp(g, 0, 1)),
            g
        }
    }(),
    closestPointToPoint: function(a, b, c) {
        var d = this.closestPointToPointParameter(a, b)
          , e = c || new THREE.Vector3;
        return this.delta(e).multiplyScalar(d).add(this.start)
    },
    applyMatrix4: function(a) {
        return this.start.applyMatrix4(a),
        this.end.applyMatrix4(a),
        this
    },
    equals: function(a) {
        return a.start.equals(this.start) && a.end.equals(this.end)
    },
    clone: function() {
        return (new THREE.Line3).copy(this)
    }
},
THREE.Box2 = function(a, b) {
    this.min = void 0 !== a ? a : new THREE.Vector2(1 / 0,1 / 0),
    this.max = void 0 !== b ? b : new THREE.Vector2(-1 / 0,-1 / 0)
}
,
THREE.Box2.prototype = {
    constructor: THREE.Box2,
    set: function(a, b) {
        return this.min.copy(a),
        this.max.copy(b),
        this
    },
    setFromPoints: function(a) {
        if (a.length > 0) {
            var b = a[0];
            this.min.copy(b),
            this.max.copy(b);
            for (var c = 1, d = a.length; d > c; c++)
                b = a[c],
                b.x < this.min.x ? this.min.x = b.x : b.x > this.max.x && (this.max.x = b.x),
                b.y < this.min.y ? this.min.y = b.y : b.y > this.max.y && (this.max.y = b.y)
        } else
            this.makeEmpty();
        return this
    },
    setFromCenterAndSize: function() {
        var a = new THREE.Vector2;
        return function(b, c) {
            var d = a.copy(c).multiplyScalar(.5);
            return this.min.copy(b).sub(d),
            this.max.copy(b).add(d),
            this
        }
    }(),
    copy: function(a) {
        return this.min.copy(a.min),
        this.max.copy(a.max),
        this
    },
    makeEmpty: function() {
        return this.min.x = this.min.y = 1 / 0,
        this.max.x = this.max.y = -1 / 0,
        this
    },
    empty: function() {
        return this.max.x < this.min.x || this.max.y < this.min.y
    },
    center: function(a) {
        var b = a || new THREE.Vector2;
        return b.addVectors(this.min, this.max).multiplyScalar(.5)
    },
    size: function(a) {
        var b = a || new THREE.Vector2;
        return b.subVectors(this.max, this.min)
    },
    expandByPoint: function(a) {
        return this.min.min(a),
        this.max.max(a),
        this
    },
    expandByVector: function(a) {
        return this.min.sub(a),
        this.max.add(a),
        this
    },
    expandByScalar: function(a) {
        return this.min.addScalar(-a),
        this.max.addScalar(a),
        this
    },
    containsPoint: function(a) {
        return a.x < this.min.x || a.x > this.max.x || a.y < this.min.y || a.y > this.max.y ? !1 : !0
    },
    containsBox: function(a) {
        return this.min.x <= a.min.x && a.max.x <= this.max.x && this.min.y <= a.min.y && a.max.y <= this.max.y ? !0 : !1
    },
    getParameter: function(a, b) {
        var c = b || new THREE.Vector2;
        return c.set((a.x - this.min.x) / (this.max.x - this.min.x), (a.y - this.min.y) / (this.max.y - this.min.y))
    },
    isIntersectionBox: function(a) {
        return a.max.x < this.min.x || a.min.x > this.max.x || a.max.y < this.min.y || a.min.y > this.max.y ? !1 : !0
    },
    clampPoint: function(a, b) {
        var c = b || new THREE.Vector2;
        return c.copy(a).clamp(this.min, this.max)
    },
    distanceToPoint: function() {
        var a = new THREE.Vector2;
        return function(b) {
            var c = a.copy(b).clamp(this.min, this.max);
            return c.sub(b).length()
        }
    }(),
    intersect: function(a) {
        return this.min.max(a.min),
        this.max.min(a.max),
        this
    },
    union: function(a) {
        return this.min.min(a.min),
        this.max.max(a.max),
        this
    },
    translate: function(a) {
        return this.min.add(a),
        this.max.add(a),
        this
    },
    equals: function(a) {
        return a.min.equals(this.min) && a.max.equals(this.max)
    },
    clone: function() {
        return (new THREE.Box2).copy(this)
    }
},
THREE.Box3 = function(a, b) {
    this.min = void 0 !== a ? a : new THREE.Vector3(1 / 0,1 / 0,1 / 0),
    this.max = void 0 !== b ? b : new THREE.Vector3(-1 / 0,-1 / 0,-1 / 0)
}
,
THREE.Box3.prototype = {
    constructor: THREE.Box3,
    set: function(a, b) {
        return this.min.copy(a),
        this.max.copy(b),
        this
    },
    addPoint: function(a) {
        a.x < this.min.x ? this.min.x = a.x : a.x > this.max.x && (this.max.x = a.x),
        a.y < this.min.y ? this.min.y = a.y : a.y > this.max.y && (this.max.y = a.y),
        a.z < this.min.z ? this.min.z = a.z : a.z > this.max.z && (this.max.z = a.z)
    },
    setFromPoints: function(a) {
        if (a.length > 0) {
            var b = a[0];
            this.min.copy(b),
            this.max.copy(b);
            for (var c = 1, d = a.length; d > c; c++)
                this.addPoint(a[c])
        } else
            this.makeEmpty();
        return this
    },
    setFromCenterAndSize: function() {
        var a = new THREE.Vector3;
        return function(b, c) {
            var d = a.copy(c).multiplyScalar(.5);
            return this.min.copy(b).sub(d),
            this.max.copy(b).add(d),
            this
        }
    }(),
    setFromObject: function() {
        var a = new THREE.Vector3;
        return function(b) {
            var c = this;
            return b.updateMatrixWorld(!0),
            this.makeEmpty(),
            b.traverse(function(b) {
                if (void 0 !== b.geometry && void 0 !== b.geometry.vertices)
                    for (var d = b.geometry.vertices, e = 0, f = d.length; f > e; e++)
                        a.copy(d[e]),
                        a.applyMatrix4(b.matrixWorld),
                        c.expandByPoint(a)
            }),
            this
        }
    }(),
    copy: function(a) {
        return this.min.copy(a.min),
        this.max.copy(a.max),
        this
    },
    makeEmpty: function() {
        return this.min.x = this.min.y = this.min.z = 1 / 0,
        this.max.x = this.max.y = this.max.z = -1 / 0,
        this
    },
    empty: function() {
        return this.max.x < this.min.x || this.max.y < this.min.y || this.max.z < this.min.z
    },
    center: function(a) {
        var b = a || new THREE.Vector3;
        return b.addVectors(this.min, this.max).multiplyScalar(.5)
    },
    size: function(a) {
        var b = a || new THREE.Vector3;
        return b.subVectors(this.max, this.min)
    },
    expandByPoint: function(a) {
        return this.min.min(a),
        this.max.max(a),
        this
    },
    expandByVector: function(a) {
        return this.min.sub(a),
        this.max.add(a),
        this
    },
    expandByScalar: function(a) {
        return this.min.addScalar(-a),
        this.max.addScalar(a),
        this
    },
    containsPoint: function(a) {
        return a.x < this.min.x || a.x > this.max.x || a.y < this.min.y || a.y > this.max.y || a.z < this.min.z || a.z > this.max.z ? !1 : !0
    },
    containsBox: function(a) {
        return this.min.x <= a.min.x && a.max.x <= this.max.x && this.min.y <= a.min.y && a.max.y <= this.max.y && this.min.z <= a.min.z && a.max.z <= this.max.z ? !0 : !1
    },
    getParameter: function(a, b) {
        var c = b || new THREE.Vector3;
        return c.set((a.x - this.min.x) / (this.max.x - this.min.x), (a.y - this.min.y) / (this.max.y - this.min.y), (a.z - this.min.z) / (this.max.z - this.min.z))
    },
    isIntersectionBox: function(a) {
        return a.max.x < this.min.x || a.min.x > this.max.x || a.max.y < this.min.y || a.min.y > this.max.y || a.max.z < this.min.z || a.min.z > this.max.z ? !1 : !0
    },
    clampPoint: function(a, b) {
        var c = b || new THREE.Vector3;
        return c.copy(a).clamp(this.min, this.max)
    },
    distanceToPoint: function() {
        var a = new THREE.Vector3;
        return function(b) {
            var c = a.copy(b).clamp(this.min, this.max);
            return c.sub(b).length()
        }
    }(),
    getBoundingSphere: function() {
        var a = new THREE.Vector3;
        return function(b) {
            var c = b || new THREE.Sphere;
            return c.center = this.center(),
            c.radius = .5 * this.size(a).length(),
            c
        }
    }(),
    intersect: function(a) {
        return this.min.max(a.min),
        this.max.min(a.max),
        this
    },
    union: function(a) {
        return this.min.min(a.min),
        this.max.max(a.max),
        this
    },
    applyMatrix4: function() {
        var a = [new THREE.Vector3, new THREE.Vector3, new THREE.Vector3, new THREE.Vector3, new THREE.Vector3, new THREE.Vector3, new THREE.Vector3, new THREE.Vector3];
        return function(b) {
            return a[0].set(this.min.x, this.min.y, this.min.z).applyMatrix4(b),
            a[1].set(this.min.x, this.min.y, this.max.z).applyMatrix4(b),
            a[2].set(this.min.x, this.max.y, this.min.z).applyMatrix4(b),
            a[3].set(this.min.x, this.max.y, this.max.z).applyMatrix4(b),
            a[4].set(this.max.x, this.min.y, this.min.z).applyMatrix4(b),
            a[5].set(this.max.x, this.min.y, this.max.z).applyMatrix4(b),
            a[6].set(this.max.x, this.max.y, this.min.z).applyMatrix4(b),
            a[7].set(this.max.x, this.max.y, this.max.z).applyMatrix4(b),
            this.makeEmpty(),
            this.setFromPoints(a),
            this
        }
    }(),
    translate: function(a) {
        return this.min.add(a),
        this.max.add(a),
        this
    },
    equals: function(a) {
        return a.min.equals(this.min) && a.max.equals(this.max)
    },
    clone: function() {
        return (new THREE.Box3).copy(this)
    }
},
THREE.Matrix3 = function(a, b, c, d, e, f, g, h, i) {
    this.elements = new Float32Array(9),
    this.set(void 0 !== a ? a : 1, b || 0, c || 0, d || 0, void 0 !== e ? e : 1, f || 0, g || 0, h || 0, void 0 !== i ? i : 1)
}
,
THREE.Matrix3.prototype = {
    constructor: THREE.Matrix3,
    set: function(a, b, c, d, e, f, g, h, i) {
        var j = this.elements;
        return j[0] = a,
        j[3] = b,
        j[6] = c,
        j[1] = d,
        j[4] = e,
        j[7] = f,
        j[2] = g,
        j[5] = h,
        j[8] = i,
        this
    },
    identity: function() {
        return this.set(1, 0, 0, 0, 1, 0, 0, 0, 1),
        this
    },
    copy: function(a) {
        var b = a.elements;
        return this.set(b[0], b[3], b[6], b[1], b[4], b[7], b[2], b[5], b[8]),
        this
    },
    multiplyVector3: function(a) {
        return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),
        a.applyMatrix3(this)
    },
    multiplyVector3Array: function() {
        var a = new THREE.Vector3;
        return function(b) {
            for (var c = 0, d = b.length; d > c; c += 3)
                a.x = b[c],
                a.y = b[c + 1],
                a.z = b[c + 2],
                a.applyMatrix3(this),
                b[c] = a.x,
                b[c + 1] = a.y,
                b[c + 2] = a.z;
            return b
        }
    }(),
    multiplyScalar: function(a) {
        var b = this.elements;
        return b[0] *= a,
        b[3] *= a,
        b[6] *= a,
        b[1] *= a,
        b[4] *= a,
        b[7] *= a,
        b[2] *= a,
        b[5] *= a,
        b[8] *= a,
        this
    },
    determinant: function() {
        var a = this.elements
          , b = a[0]
          , c = a[1]
          , d = a[2]
          , e = a[3]
          , f = a[4]
          , g = a[5]
          , h = a[6]
          , i = a[7]
          , j = a[8];
        return b * f * j - b * g * i - c * e * j + c * g * h + d * e * i - d * f * h
    },
    getInverse: function(a, b) {
        var c = a.elements
          , d = this.elements;
        d[0] = c[10] * c[5] - c[6] * c[9],
        d[1] = -c[10] * c[1] + c[2] * c[9],
        d[2] = c[6] * c[1] - c[2] * c[5],
        d[3] = -c[10] * c[4] + c[6] * c[8],
        d[4] = c[10] * c[0] - c[2] * c[8],
        d[5] = -c[6] * c[0] + c[2] * c[4],
        d[6] = c[9] * c[4] - c[5] * c[8],
        d[7] = -c[9] * c[0] + c[1] * c[8],
        d[8] = c[5] * c[0] - c[1] * c[4];
        var e = c[0] * d[0] + c[1] * d[3] + c[2] * d[6];
        if (0 === e) {
            var f = "Matrix3.getInverse(): can't invert matrix, determinant is 0";
            if (b)
                throw new Error(f);
            return console.warn(f),
            this.identity(),
            this
        }
        return this.multiplyScalar(1 / e),
        this
    },
    transpose: function() {
        var a, b = this.elements;
        return a = b[1],
        b[1] = b[3],
        b[3] = a,
        a = b[2],
        b[2] = b[6],
        b[6] = a,
        a = b[5],
        b[5] = b[7],
        b[7] = a,
        this
    },
    getNormalMatrix: function(a) {
        return this.getInverse(a).transpose(),
        this
    },
    transposeIntoArray: function(a) {
        var b = this.elements;
        return a[0] = b[0],
        a[1] = b[3],
        a[2] = b[6],
        a[3] = b[1],
        a[4] = b[4],
        a[5] = b[7],
        a[6] = b[2],
        a[7] = b[5],
        a[8] = b[8],
        this
    },
    fromArray: function(a) {
        return this.elements.set(a),
        this
    },
    toArray: function() {
        var a = this.elements;
        return [a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8]]
    },
    clone: function() {
        var a = this.elements;
        return new THREE.Matrix3(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])
    }
},
THREE.Matrix4 = function(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p) {
    this.elements = new Float32Array(16);
    var q = this.elements;
    q[0] = void 0 !== a ? a : 1,
    q[4] = b || 0,
    q[8] = c || 0,
    q[12] = d || 0,
    q[1] = e || 0,
    q[5] = void 0 !== f ? f : 1,
    q[9] = g || 0,
    q[13] = h || 0,
    q[2] = i || 0,
    q[6] = j || 0,
    q[10] = void 0 !== k ? k : 1,
    q[14] = l || 0,
    q[3] = m || 0,
    q[7] = n || 0,
    q[11] = o || 0,
    q[15] = void 0 !== p ? p : 1
}
,
THREE.Matrix4.prototype = {
    constructor: THREE.Matrix4,
    set: function(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p) {
        var q = this.elements;
        return q[0] = a,
        q[4] = b,
        q[8] = c,
        q[12] = d,
        q[1] = e,
        q[5] = f,
        q[9] = g,
        q[13] = h,
        q[2] = i,
        q[6] = j,
        q[10] = k,
        q[14] = l,
        q[3] = m,
        q[7] = n,
        q[11] = o,
        q[15] = p,
        this
    },
    identity: function() {
        return this.set(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1),
        this
    },
    copy: function(a) {
        return this.elements.set(a.elements),
        this
    },
    extractPosition: function(a) {
        return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),
        this.copyPosition(a)
    },
    copyPosition: function(a) {
        var b = this.elements
          , c = a.elements;
        return b[12] = c[12],
        b[13] = c[13],
        b[14] = c[14],
        this
    },
    extractRotation: function() {
        var a = new THREE.Vector3;
        return function(b) {
            var c = this.elements
              , d = b.elements
              , e = 1 / a.set(d[0], d[1], d[2]).length()
              , f = 1 / a.set(d[4], d[5], d[6]).length()
              , g = 1 / a.set(d[8], d[9], d[10]).length();
            return c[0] = d[0] * e,
            c[1] = d[1] * e,
            c[2] = d[2] * e,
            c[4] = d[4] * f,
            c[5] = d[5] * f,
            c[6] = d[6] * f,
            c[8] = d[8] * g,
            c[9] = d[9] * g,
            c[10] = d[10] * g,
            this
        }
    }(),
    makeRotationFromEuler: function(a) {
        a instanceof THREE.Euler == !1 && console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");
        var b = this.elements
          , c = a.x
          , d = a.y
          , e = a.z
          , f = Math.cos(c)
          , g = Math.sin(c)
          , h = Math.cos(d)
          , i = Math.sin(d)
          , j = Math.cos(e)
          , k = Math.sin(e);
        if ("XYZ" === a.order) {
            var l = f * j
              , m = f * k
              , n = g * j
              , o = g * k;
            b[0] = h * j,
            b[4] = -h * k,
            b[8] = i,
            b[1] = m + n * i,
            b[5] = l - o * i,
            b[9] = -g * h,
            b[2] = o - l * i,
            b[6] = n + m * i,
            b[10] = f * h
        } else if ("YXZ" === a.order) {
            var p = h * j
              , q = h * k
              , r = i * j
              , s = i * k;
            b[0] = p + s * g,
            b[4] = r * g - q,
            b[8] = f * i,
            b[1] = f * k,
            b[5] = f * j,
            b[9] = -g,
            b[2] = q * g - r,
            b[6] = s + p * g,
            b[10] = f * h
        } else if ("ZXY" === a.order) {
            var p = h * j
              , q = h * k
              , r = i * j
              , s = i * k;
            b[0] = p - s * g,
            b[4] = -f * k,
            b[8] = r + q * g,
            b[1] = q + r * g,
            b[5] = f * j,
            b[9] = s - p * g,
            b[2] = -f * i,
            b[6] = g,
            b[10] = f * h
        } else if ("ZYX" === a.order) {
            var l = f * j
              , m = f * k
              , n = g * j
              , o = g * k;
            b[0] = h * j,
            b[4] = n * i - m,
            b[8] = l * i + o,
            b[1] = h * k,
            b[5] = o * i + l,
            b[9] = m * i - n,
            b[2] = -i,
            b[6] = g * h,
            b[10] = f * h
        } else if ("YZX" === a.order) {
            var t = f * h
              , u = f * i
              , v = g * h
              , w = g * i;
            b[0] = h * j,
            b[4] = w - t * k,
            b[8] = v * k + u,
            b[1] = k,
            b[5] = f * j,
            b[9] = -g * j,
            b[2] = -i * j,
            b[6] = u * k + v,
            b[10] = t - w * k
        } else if ("XZY" === a.order) {
            var t = f * h
              , u = f * i
              , v = g * h
              , w = g * i;
            b[0] = h * j,
            b[4] = -k,
            b[8] = i * j,
            b[1] = t * k + w,
            b[5] = f * j,
            b[9] = u * k - v,
            b[2] = v * k - u,
            b[6] = g * j,
            b[10] = w * k + t
        }
        return b[3] = 0,
        b[7] = 0,
        b[11] = 0,
        b[12] = 0,
        b[13] = 0,
        b[14] = 0,
        b[15] = 1,
        this
    },
    setRotationFromQuaternion: function(a) {
        return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),
        this.makeRotationFromQuaternion(a)
    },
    makeRotationFromQuaternion: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , e = a.z
          , f = a.w
          , g = c + c
          , h = d + d
          , i = e + e
          , j = c * g
          , k = c * h
          , l = c * i
          , m = d * h
          , n = d * i
          , o = e * i
          , p = f * g
          , q = f * h
          , r = f * i;
        return b[0] = 1 - (m + o),
        b[4] = k - r,
        b[8] = l + q,
        b[1] = k + r,
        b[5] = 1 - (j + o),
        b[9] = n - p,
        b[2] = l - q,
        b[6] = n + p,
        b[10] = 1 - (j + m),
        b[3] = 0,
        b[7] = 0,
        b[11] = 0,
        b[12] = 0,
        b[13] = 0,
        b[14] = 0,
        b[15] = 1,
        this
    },
    lookAt: function() {
        var a = new THREE.Vector3
          , b = new THREE.Vector3
          , c = new THREE.Vector3;
        return function(d, e, f) {
            var g = this.elements;
            return c.subVectors(d, e).normalize(),
            0 === c.length() && (c.z = 1),
            a.crossVectors(f, c).normalize(),
            0 === a.length() && (c.x += 1e-4,
            a.crossVectors(f, c).normalize()),
            b.crossVectors(c, a),
            g[0] = a.x,
            g[4] = b.x,
            g[8] = c.x,
            g[1] = a.y,
            g[5] = b.y,
            g[9] = c.y,
            g[2] = a.z,
            g[6] = b.z,
            g[10] = c.z,
            this
        }
    }(),
    multiply: function(a, b) {
        return void 0 !== b ? (console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),
        this.multiplyMatrices(a, b)) : this.multiplyMatrices(this, a)
    },
    multiplyMatrices: function(a, b) {
        var c = a.elements
          , d = b.elements
          , e = this.elements
          , f = c[0]
          , g = c[4]
          , h = c[8]
          , i = c[12]
          , j = c[1]
          , k = c[5]
          , l = c[9]
          , m = c[13]
          , n = c[2]
          , o = c[6]
          , p = c[10]
          , q = c[14]
          , r = c[3]
          , s = c[7]
          , t = c[11]
          , u = c[15]
          , v = d[0]
          , w = d[4]
          , x = d[8]
          , y = d[12]
          , z = d[1]
          , A = d[5]
          , B = d[9]
          , C = d[13]
          , D = d[2]
          , E = d[6]
          , F = d[10]
          , G = d[14]
          , H = d[3]
          , I = d[7]
          , J = d[11]
          , K = d[15];
        return e[0] = f * v + g * z + h * D + i * H,
        e[4] = f * w + g * A + h * E + i * I,
        e[8] = f * x + g * B + h * F + i * J,
        e[12] = f * y + g * C + h * G + i * K,
        e[1] = j * v + k * z + l * D + m * H,
        e[5] = j * w + k * A + l * E + m * I,
        e[9] = j * x + k * B + l * F + m * J,
        e[13] = j * y + k * C + l * G + m * K,
        e[2] = n * v + o * z + p * D + q * H,
        e[6] = n * w + o * A + p * E + q * I,
        e[10] = n * x + o * B + p * F + q * J,
        e[14] = n * y + o * C + p * G + q * K,
        e[3] = r * v + s * z + t * D + u * H,
        e[7] = r * w + s * A + t * E + u * I,
        e[11] = r * x + s * B + t * F + u * J,
        e[15] = r * y + s * C + t * G + u * K,
        this
    },
    multiplyToArray: function(a, b, c) {
        var d = this.elements;
        return this.multiplyMatrices(a, b),
        c[0] = d[0],
        c[1] = d[1],
        c[2] = d[2],
        c[3] = d[3],
        c[4] = d[4],
        c[5] = d[5],
        c[6] = d[6],
        c[7] = d[7],
        c[8] = d[8],
        c[9] = d[9],
        c[10] = d[10],
        c[11] = d[11],
        c[12] = d[12],
        c[13] = d[13],
        c[14] = d[14],
        c[15] = d[15],
        this
    },
    multiplyScalar: function(a) {
        var b = this.elements;
        return b[0] *= a,
        b[4] *= a,
        b[8] *= a,
        b[12] *= a,
        b[1] *= a,
        b[5] *= a,
        b[9] *= a,
        b[13] *= a,
        b[2] *= a,
        b[6] *= a,
        b[10] *= a,
        b[14] *= a,
        b[3] *= a,
        b[7] *= a,
        b[11] *= a,
        b[15] *= a,
        this
    },
    multiplyVector3: function(a) {
        return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),
        a.applyProjection(this)
    },
    multiplyVector4: function(a) {
        return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),
        a.applyMatrix4(this)
    },
    multiplyVector3Array: function() {
        var a = new THREE.Vector3;
        return function(b) {
            for (var c = 0, d = b.length; d > c; c += 3)
                a.x = b[c],
                a.y = b[c + 1],
                a.z = b[c + 2],
                a.applyProjection(this),
                b[c] = a.x,
                b[c + 1] = a.y,
                b[c + 2] = a.z;
            return b
        }
    }(),
    rotateAxis: function(a) {
        console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),
        a.transformDirection(this)
    },
    crossVector: function(a) {
        return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),
        a.applyMatrix4(this)
    },
    determinant: function() {
        var a = this.elements
          , b = a[0]
          , c = a[4]
          , d = a[8]
          , e = a[12]
          , f = a[1]
          , g = a[5]
          , h = a[9]
          , i = a[13]
          , j = a[2]
          , k = a[6]
          , l = a[10]
          , m = a[14]
          , n = a[3]
          , o = a[7]
          , p = a[11]
          , q = a[15];
        return n * (+e * h * k - d * i * k - e * g * l + c * i * l + d * g * m - c * h * m) + o * (+b * h * m - b * i * l + e * f * l - d * f * m + d * i * j - e * h * j) + p * (+b * i * k - b * g * m - e * f * k + c * f * m + e * g * j - c * i * j) + q * (-d * g * j - b * h * k + b * g * l + d * f * k - c * f * l + c * h * j)
    },
    transpose: function() {
        var a, b = this.elements;
        return a = b[1],
        b[1] = b[4],
        b[4] = a,
        a = b[2],
        b[2] = b[8],
        b[8] = a,
        a = b[6],
        b[6] = b[9],
        b[9] = a,
        a = b[3],
        b[3] = b[12],
        b[12] = a,
        a = b[7],
        b[7] = b[13],
        b[13] = a,
        a = b[11],
        b[11] = b[14],
        b[14] = a,
        this
    },
    flattenToArray: function(a) {
        var b = this.elements;
        return a[0] = b[0],
        a[1] = b[1],
        a[2] = b[2],
        a[3] = b[3],
        a[4] = b[4],
        a[5] = b[5],
        a[6] = b[6],
        a[7] = b[7],
        a[8] = b[8],
        a[9] = b[9],
        a[10] = b[10],
        a[11] = b[11],
        a[12] = b[12],
        a[13] = b[13],
        a[14] = b[14],
        a[15] = b[15],
        a
    },
    flattenToArrayOffset: function(a, b) {
        var c = this.elements;
        return a[b] = c[0],
        a[b + 1] = c[1],
        a[b + 2] = c[2],
        a[b + 3] = c[3],
        a[b + 4] = c[4],
        a[b + 5] = c[5],
        a[b + 6] = c[6],
        a[b + 7] = c[7],
        a[b + 8] = c[8],
        a[b + 9] = c[9],
        a[b + 10] = c[10],
        a[b + 11] = c[11],
        a[b + 12] = c[12],
        a[b + 13] = c[13],
        a[b + 14] = c[14],
        a[b + 15] = c[15],
        a
    },
    getPosition: function() {
        var a = new THREE.Vector3;
        return function() {
            console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");
            var b = this.elements;
            return a.set(b[12], b[13], b[14])
        }
    }(),
    setPosition: function(a) {
        var b = this.elements;
        return b[12] = a.x,
        b[13] = a.y,
        b[14] = a.z,
        this
    },
    getInverse: function(a, b) {
        var c = this.elements
          , d = a.elements
          , e = d[0]
          , f = d[4]
          , g = d[8]
          , h = d[12]
          , i = d[1]
          , j = d[5]
          , k = d[9]
          , l = d[13]
          , m = d[2]
          , n = d[6]
          , o = d[10]
          , p = d[14]
          , q = d[3]
          , r = d[7]
          , s = d[11]
          , t = d[15];
        c[0] = k * p * r - l * o * r + l * n * s - j * p * s - k * n * t + j * o * t,
        c[4] = h * o * r - g * p * r - h * n * s + f * p * s + g * n * t - f * o * t,
        c[8] = g * l * r - h * k * r + h * j * s - f * l * s - g * j * t + f * k * t,
        c[12] = h * k * n - g * l * n - h * j * o + f * l * o + g * j * p - f * k * p,
        c[1] = l * o * q - k * p * q - l * m * s + i * p * s + k * m * t - i * o * t,
        c[5] = g * p * q - h * o * q + h * m * s - e * p * s - g * m * t + e * o * t,
        c[9] = h * k * q - g * l * q - h * i * s + e * l * s + g * i * t - e * k * t,
        c[13] = g * l * m - h * k * m + h * i * o - e * l * o - g * i * p + e * k * p,
        c[2] = j * p * q - l * n * q + l * m * r - i * p * r - j * m * t + i * n * t,
        c[6] = h * n * q - f * p * q - h * m * r + e * p * r + f * m * t - e * n * t,
        c[10] = f * l * q - h * j * q + h * i * r - e * l * r - f * i * t + e * j * t,
        c[14] = h * j * m - f * l * m - h * i * n + e * l * n + f * i * p - e * j * p,
        c[3] = k * n * q - j * o * q - k * m * r + i * o * r + j * m * s - i * n * s,
        c[7] = f * o * q - g * n * q + g * m * r - e * o * r - f * m * s + e * n * s,
        c[11] = g * j * q - f * k * q - g * i * r + e * k * r + f * i * s - e * j * s,
        c[15] = f * k * m - g * j * m + g * i * n - e * k * n - f * i * o + e * j * o;
        var u = e * c[0] + i * c[4] + m * c[8] + q * c[12];
        if (0 == u) {
            var v = "Matrix4.getInverse(): can't invert matrix, determinant is 0";
            if (b)
                throw new Error(v);
            return console.warn(v),
            this.identity(),
            this
        }
        return this.multiplyScalar(1 / u),
        this
    },
    translate: function() {
        console.warn("DEPRECATED: Matrix4's .translate() has been removed.")
    },
    rotateX: function() {
        console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")
    },
    rotateY: function() {
        console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")
    },
    rotateZ: function() {
        console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")
    },
    rotateByAxis: function() {
        console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")
    },
    scale: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , e = a.z;
        return b[0] *= c,
        b[4] *= d,
        b[8] *= e,
        b[1] *= c,
        b[5] *= d,
        b[9] *= e,
        b[2] *= c,
        b[6] *= d,
        b[10] *= e,
        b[3] *= c,
        b[7] *= d,
        b[11] *= e,
        this
    },
    getMaxScaleOnAxis: function() {
        var a = this.elements
          , b = a[0] * a[0] + a[1] * a[1] + a[2] * a[2]
          , c = a[4] * a[4] + a[5] * a[5] + a[6] * a[6]
          , d = a[8] * a[8] + a[9] * a[9] + a[10] * a[10];
        return Math.sqrt(Math.max(b, Math.max(c, d)))
    },
    makeTranslation: function(a, b, c) {
        return this.set(1, 0, 0, a, 0, 1, 0, b, 0, 0, 1, c, 0, 0, 0, 1),
        this
    },
    makeRotationX: function(a) {
        var b = Math.cos(a)
          , c = Math.sin(a);
        return this.set(1, 0, 0, 0, 0, b, -c, 0, 0, c, b, 0, 0, 0, 0, 1),
        this
    },
    makeRotationY: function(a) {
        var b = Math.cos(a)
          , c = Math.sin(a);
        return this.set(b, 0, c, 0, 0, 1, 0, 0, -c, 0, b, 0, 0, 0, 0, 1),
        this
    },
    makeRotationZ: function(a) {
        var b = Math.cos(a)
          , c = Math.sin(a);
        return this.set(b, -c, 0, 0, c, b, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1),
        this
    },
    makeRotationAxis: function(a, b) {
        var c = Math.cos(b)
          , d = Math.sin(b)
          , e = 1 - c
          , f = a.x
          , g = a.y
          , h = a.z
          , i = e * f
          , j = e * g;
        return this.set(i * f + c, i * g - d * h, i * h + d * g, 0, i * g + d * h, j * g + c, j * h - d * f, 0, i * h - d * g, j * h + d * f, e * h * h + c, 0, 0, 0, 0, 1),
        this
    },
    makeScale: function(a, b, c) {
        return this.set(a, 0, 0, 0, 0, b, 0, 0, 0, 0, c, 0, 0, 0, 0, 1),
        this
    },
    compose: function(a, b, c) {
        return this.makeRotationFromQuaternion(b),
        this.scale(c),
        this.setPosition(a),
        this
    },
    decompose: function() {
        var a = new THREE.Vector3
          , b = new THREE.Matrix4;
        return function(c, d, e) {
            var f = this.elements
              , g = a.set(f[0], f[1], f[2]).length()
              , h = a.set(f[4], f[5], f[6]).length()
              , i = a.set(f[8], f[9], f[10]).length()
              , j = this.determinant();
            0 > j && (g = -g),
            c.x = f[12],
            c.y = f[13],
            c.z = f[14],
            b.elements.set(this.elements);
            var k = 1 / g
              , l = 1 / h
              , m = 1 / i;
            return b.elements[0] *= k,
            b.elements[1] *= k,
            b.elements[2] *= k,
            b.elements[4] *= l,
            b.elements[5] *= l,
            b.elements[6] *= l,
            b.elements[8] *= m,
            b.elements[9] *= m,
            b.elements[10] *= m,
            d.setFromRotationMatrix(b),
            e.x = g,
            e.y = h,
            e.z = i,
            this
        }
    }(),
    makeFrustum: function(a, b, c, d, e, f) {
        var g = this.elements
          , h = 2 * e / (b - a)
          , i = 2 * e / (d - c)
          , j = (b + a) / (b - a)
          , k = (d + c) / (d - c)
          , l = -(f + e) / (f - e)
          , m = -2 * f * e / (f - e);
        return g[0] = h,
        g[4] = 0,
        g[8] = j,
        g[12] = 0,
        g[1] = 0,
        g[5] = i,
        g[9] = k,
        g[13] = 0,
        g[2] = 0,
        g[6] = 0,
        g[10] = l,
        g[14] = m,
        g[3] = 0,
        g[7] = 0,
        g[11] = -1,
        g[15] = 0,
        this
    },
    makePerspective: function(a, b, c, d) {
        var e = c * Math.tan(THREE.Math.degToRad(.5 * a))
          , f = -e
          , g = f * b
          , h = e * b;
        return this.makeFrustum(g, h, f, e, c, d)
    },
    makeOrthographic: function(a, b, c, d, e, f) {
        var g = this.elements
          , h = b - a
          , i = c - d
          , j = f - e
          , k = (b + a) / h
          , l = (c + d) / i
          , m = (f + e) / j;
        return g[0] = 2 / h,
        g[4] = 0,
        g[8] = 0,
        g[12] = -k,
        g[1] = 0,
        g[5] = 2 / i,
        g[9] = 0,
        g[13] = -l,
        g[2] = 0,
        g[6] = 0,
        g[10] = -2 / j,
        g[14] = -m,
        g[3] = 0,
        g[7] = 0,
        g[11] = 0,
        g[15] = 1,
        this
    },
    fromArray: function(a) {
        return this.elements.set(a),
        this
    },
    toArray: function() {
        var a = this.elements;
        return [a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]]
    },
    clone: function() {
        var a = this.elements;
        return new THREE.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])
    }
},
THREE.Ray = function(a, b) {
    this.origin = void 0 !== a ? a : new THREE.Vector3,
    this.direction = void 0 !== b ? b : new THREE.Vector3
}
,
THREE.Ray.prototype = {
    constructor: THREE.Ray,
    set: function(a, b) {
        return this.origin.copy(a),
        this.direction.copy(b),
        this
    },
    copy: function(a) {
        return this.origin.copy(a.origin),
        this.direction.copy(a.direction),
        this
    },
    at: function(a, b) {
        var c = b || new THREE.Vector3;
        return c.copy(this.direction).multiplyScalar(a).add(this.origin)
    },
    recast: function() {
        var a = new THREE.Vector3;
        return function(b) {
            return this.origin.copy(this.at(b, a)),
            this
        }
    }(),
    closestPointToPoint: function(a, b) {
        var c = b || new THREE.Vector3;
        c.subVectors(a, this.origin);
        var d = c.dot(this.direction);
        return 0 > d ? c.copy(this.origin) : c.copy(this.direction).multiplyScalar(d).add(this.origin)
    },
    distanceToPoint: function() {
        var a = new THREE.Vector3;
        return function(b) {
            var c = a.subVectors(b, this.origin).dot(this.direction);
            return 0 > c ? this.origin.distanceTo(b) : (a.copy(this.direction).multiplyScalar(c).add(this.origin),
            a.distanceTo(b))
        }
    }(),
    distanceSqToSegment: function(a, b, c, d) {
        var e, f, g, h, i = a.clone().add(b).multiplyScalar(.5), j = b.clone().sub(a).normalize(), k = .5 * a.distanceTo(b), l = this.origin.clone().sub(i), m = -this.direction.dot(j), n = l.dot(this.direction), o = -l.dot(j), p = l.lengthSq(), q = Math.abs(1 - m * m);
        if (q >= 0)
            if (e = m * o - n,
            f = m * n - o,
            h = k * q,
            e >= 0)
                if (f >= -h)
                    if (h >= f) {
                        var r = 1 / q;
                        e *= r,
                        f *= r,
                        g = e * (e + m * f + 2 * n) + f * (m * e + f + 2 * o) + p
                    } else
                        f = k,
                        e = Math.max(0, -(m * f + n)),
                        g = -e * e + f * (f + 2 * o) + p;
                else
                    f = -k,
                    e = Math.max(0, -(m * f + n)),
                    g = -e * e + f * (f + 2 * o) + p;
            else
                -h >= f ? (e = Math.max(0, -(-m * k + n)),
                f = e > 0 ? -k : Math.min(Math.max(-k, -o), k),
                g = -e * e + f * (f + 2 * o) + p) : h >= f ? (e = 0,
                f = Math.min(Math.max(-k, -o), k),
                g = f * (f + 2 * o) + p) : (e = Math.max(0, -(m * k + n)),
                f = e > 0 ? k : Math.min(Math.max(-k, -o), k),
                g = -e * e + f * (f + 2 * o) + p);
        else
            f = m > 0 ? -k : k,
            e = Math.max(0, -(m * f + n)),
            g = -e * e + f * (f + 2 * o) + p;
        return c && c.copy(this.direction.clone().multiplyScalar(e).add(this.origin)),
        d && d.copy(j.clone().multiplyScalar(f).add(i)),
        g
    },
    isIntersectionSphere: function(a) {
        return this.distanceToPoint(a.center) <= a.radius
    },
    isIntersectionPlane: function(a) {
        var b = a.distanceToPoint(this.origin);
        if (0 === b)
            return !0;
        var c = a.normal.dot(this.direction);
        return 0 > c * b ? !0 : !1
    },
    distanceToPlane: function(a) {
        var b = a.normal.dot(this.direction);
        if (0 == b)
            return 0 == a.distanceToPoint(this.origin) ? 0 : null;
        var c = -(this.origin.dot(a.normal) + a.constant) / b;
        return c >= 0 ? c : null
    },
    intersectPlane: function(a, b) {
        var c = this.distanceToPlane(a);
        return null === c ? null : this.at(c, b)
    },
    isIntersectionBox: function() {
        var a = new THREE.Vector3;
        return function(b) {
            return null !== this.intersectBox(b, a)
        }
    }(),
    intersectBox: function(a, b) {
        var c, d, e, f, g, h, i = 1 / this.direction.x, j = 1 / this.direction.y, k = 1 / this.direction.z, l = this.origin;
        return i >= 0 ? (c = (a.min.x - l.x) * i,
        d = (a.max.x - l.x) * i) : (c = (a.max.x - l.x) * i,
        d = (a.min.x - l.x) * i),
        j >= 0 ? (e = (a.min.y - l.y) * j,
        f = (a.max.y - l.y) * j) : (e = (a.max.y - l.y) * j,
        f = (a.min.y - l.y) * j),
        c > f || e > d ? null : ((e > c || c !== c) && (c = e),
        (d > f || d !== d) && (d = f),
        k >= 0 ? (g = (a.min.z - l.z) * k,
        h = (a.max.z - l.z) * k) : (g = (a.max.z - l.z) * k,
        h = (a.min.z - l.z) * k),
        c > h || g > d ? null : ((g > c || c !== c) && (c = g),
        (d > h || d !== d) && (d = h),
        0 > d ? null : this.at(c >= 0 ? c : d, b)))
    },
    intersectTriangle: function() {
        var a = new THREE.Vector3
          , b = new THREE.Vector3
          , c = new THREE.Vector3
          , d = new THREE.Vector3;
        return function(e, f, g, h, i) {
            b.subVectors(f, e),
            c.subVectors(g, e),
            d.crossVectors(b, c);
            var j, k = this.direction.dot(d);
            if (k > 0) {
                if (h)
                    return null;
                j = 1
            } else {
                if (!(0 > k))
                    return null;
                j = -1,
                k = -k
            }
            a.subVectors(this.origin, e);
            var l = j * this.direction.dot(c.crossVectors(a, c));
            if (0 > l)
                return null;
            var m = j * this.direction.dot(b.cross(a));
            if (0 > m)
                return null;
            if (l + m > k)
                return null;
            var n = -j * a.dot(d);
            return 0 > n ? null : this.at(n / k, i)
        }
    }(),
    applyMatrix4: function(a) {
        return this.direction.add(this.origin).applyMatrix4(a),
        this.origin.applyMatrix4(a),
        this.direction.sub(this.origin),
        this.direction.normalize(),
        this
    },
    equals: function(a) {
        return a.origin.equals(this.origin) && a.direction.equals(this.direction)
    },
    clone: function() {
        return (new THREE.Ray).copy(this)
    }
},
THREE.Sphere = function(a, b) {
    this.center = void 0 !== a ? a : new THREE.Vector3,
    this.radius = void 0 !== b ? b : 0
}
,
THREE.Sphere.prototype = {
    constructor: THREE.Sphere,
    set: function(a, b) {
        return this.center.copy(a),
        this.radius = b,
        this
    },
    setFromPoints: function() {
        var a = new THREE.Box3;
        return function(b, c) {
            var d = this.center;
            void 0 !== c ? d.copy(c) : a.setFromPoints(b).center(d);
            for (var e = 0, f = 0, g = b.length; g > f; f++)
                e = Math.max(e, d.distanceToSquared(b[f]));
            return this.radius = Math.sqrt(e),
            this
        }
    }(),
    copy: function(a) {
        return this.center.copy(a.center),
        this.radius = a.radius,
        this
    },
    empty: function() {
        return this.radius <= 0
    },
    containsPoint: function(a) {
        return a.distanceToSquared(this.center) <= this.radius * this.radius
    },
    distanceToPoint: function(a) {
        return a.distanceTo(this.center) - this.radius
    },
    intersectsSphere: function(a) {
        var b = this.radius + a.radius;
        return a.center.distanceToSquared(this.center) <= b * b
    },
    clampPoint: function(a, b) {
        var c = this.center.distanceToSquared(a)
          , d = b || new THREE.Vector3;
        return d.copy(a),
        c > this.radius * this.radius && (d.sub(this.center).normalize(),
        d.multiplyScalar(this.radius).add(this.center)),
        d
    },
    getBoundingBox: function(a) {
        var b = a || new THREE.Box3;
        return b.set(this.center, this.center),
        b.expandByScalar(this.radius),
        b
    },
    applyMatrix4: function(a) {
        return this.center.applyMatrix4(a),
        this.radius = this.radius * a.getMaxScaleOnAxis(),
        this
    },
    translate: function(a) {
        return this.center.add(a),
        this
    },
    equals: function(a) {
        return a.center.equals(this.center) && a.radius === this.radius
    },
    clone: function() {
        return (new THREE.Sphere).copy(this)
    }
},
THREE.Frustum = function(a, b, c, d, e, f) {
    this.planes = [void 0 !== a ? a : new THREE.Plane, void 0 !== b ? b : new THREE.Plane, void 0 !== c ? c : new THREE.Plane, void 0 !== d ? d : new THREE.Plane, void 0 !== e ? e : new THREE.Plane, void 0 !== f ? f : new THREE.Plane]
}
,
THREE.Frustum.prototype = {
    constructor: THREE.Frustum,
    set: function(a, b, c, d, e, f) {
        var g = this.planes;
        return g[0].copy(a),
        g[1].copy(b),
        g[2].copy(c),
        g[3].copy(d),
        g[4].copy(e),
        g[5].copy(f),
        this
    },
    copy: function(a) {
        for (var b = this.planes, c = 0; 6 > c; c++)
            b[c].copy(a.planes[c]);
        return this
    },
    setFromMatrix: function(a) {
        var b = this.planes
          , c = a.elements
          , d = c[0]
          , e = c[1]
          , f = c[2]
          , g = c[3]
          , h = c[4]
          , i = c[5]
          , j = c[6]
          , k = c[7]
          , l = c[8]
          , m = c[9]
          , n = c[10]
          , o = c[11]
          , p = c[12]
          , q = c[13]
          , r = c[14]
          , s = c[15];
        return b[0].setComponents(g - d, k - h, o - l, s - p).normalize(),
        b[1].setComponents(g + d, k + h, o + l, s + p).normalize(),
        b[2].setComponents(g + e, k + i, o + m, s + q).normalize(),
        b[3].setComponents(g - e, k - i, o - m, s - q).normalize(),
        b[4].setComponents(g - f, k - j, o - n, s - r).normalize(),
        b[5].setComponents(g + f, k + j, o + n, s + r).normalize(),
        this
    },
    intersectsObject: function() {
        var a = new THREE.Sphere;
        return function(b) {
            var c = b.geometry;
            return null === c.boundingSphere && c.computeBoundingSphere(),
            a.copy(c.boundingSphere),
            a.applyMatrix4(b.matrixWorld),
            this.intersectsSphere(a)
        }
    }(),
    intersectsSphere: function(a) {
        for (var b = this.planes, c = a.center, d = -a.radius, e = 0; 6 > e; e++) {
            var f = b[e].distanceToPoint(c);
            if (d > f)
                return !1
        }
        return !0
    },
    intersectsBox: function() {
        var a = new THREE.Vector3
          , b = new THREE.Vector3;
        return function(c) {
            for (var d = this.planes, e = 0; 6 > e; e++) {
                var f = d[e];
                a.x = f.normal.x > 0 ? c.min.x : c.max.x,
                b.x = f.normal.x > 0 ? c.max.x : c.min.x,
                a.y = f.normal.y > 0 ? c.min.y : c.max.y,
                b.y = f.normal.y > 0 ? c.max.y : c.min.y,
                a.z = f.normal.z > 0 ? c.min.z : c.max.z,
                b.z = f.normal.z > 0 ? c.max.z : c.min.z;
                var g = f.distanceToPoint(a)
                  , h = f.distanceToPoint(b);
                if (0 > g && 0 > h)
                    return !1
            }
            return !0
        }
    }(),
    containsPoint: function(a) {
        for (var b = this.planes, c = 0; 6 > c; c++)
            if (b[c].distanceToPoint(a) < 0)
                return !1;
        return !0
    },
    clone: function() {
        return (new THREE.Frustum).copy(this)
    }
},
THREE.Plane = function(a, b) {
    this.normal = void 0 !== a ? a : new THREE.Vector3(1,0,0),
    this.constant = void 0 !== b ? b : 0
}
,
THREE.Plane.prototype = {
    constructor: THREE.Plane,
    set: function(a, b) {
        return this.normal.copy(a),
        this.constant = b,
        this
    },
    setComponents: function(a, b, c, d) {
        return this.normal.set(a, b, c),
        this.constant = d,
        this
    },
    setFromNormalAndCoplanarPoint: function(a, b) {
        return this.normal.copy(a),
        this.constant = -b.dot(this.normal),
        this
    },
    setFromCoplanarPoints: function() {
        var a = new THREE.Vector3
          , b = new THREE.Vector3;
        return function(c, d, e) {
            var f = a.subVectors(e, d).cross(b.subVectors(c, d)).normalize();
            return this.setFromNormalAndCoplanarPoint(f, c),
            this
        }
    }(),
    copy: function(a) {
        return this.normal.copy(a.normal),
        this.constant = a.constant,
        this
    },
    normalize: function() {
        var a = 1 / this.normal.length();
        return this.normal.multiplyScalar(a),
        this.constant *= a,
        this
    },
    negate: function() {
        return this.constant *= -1,
        this.normal.negate(),
        this
    },
    distanceToPoint: function(a) {
        return this.normal.dot(a) + this.constant
    },
    distanceToSphere: function(a) {
        return this.distanceToPoint(a.center) - a.radius
    },
    projectPoint: function(a, b) {
        return this.orthoPoint(a, b).sub(a).negate()
    },
    orthoPoint: function(a, b) {
        var c = this.distanceToPoint(a)
          , d = b || new THREE.Vector3;
        return d.copy(this.normal).multiplyScalar(c)
    },
    isIntersectionLine: function(a) {
        var b = this.distanceToPoint(a.start)
          , c = this.distanceToPoint(a.end);
        return 0 > b && c > 0 || 0 > c && b > 0
    },
    intersectLine: function() {
        var a = new THREE.Vector3;
        return function(b, c) {
            var d = c || new THREE.Vector3
              , e = b.delta(a)
              , f = this.normal.dot(e);
            if (0 == f)
                return 0 == this.distanceToPoint(b.start) ? d.copy(b.start) : void 0;
            var g = -(b.start.dot(this.normal) + this.constant) / f;
            return 0 > g || g > 1 ? void 0 : d.copy(e).multiplyScalar(g).add(b.start)
        }
    }(),
    coplanarPoint: function(a) {
        var b = a || new THREE.Vector3;
        return b.copy(this.normal).multiplyScalar(-this.constant)
    },
    applyMatrix4: function() {
        var a = new THREE.Vector3
          , b = new THREE.Vector3
          , c = new THREE.Matrix3;
        return function(d, e) {
            var f = e || c.getNormalMatrix(d)
              , g = a.copy(this.normal).applyMatrix3(f)
              , h = this.coplanarPoint(b);
            return h.applyMatrix4(d),
            this.setFromNormalAndCoplanarPoint(g, h),
            this
        }
    }(),
    translate: function(a) {
        return this.constant = this.constant - a.dot(this.normal),
        this
    },
    equals: function(a) {
        return a.normal.equals(this.normal) && a.constant == this.constant
    },
    clone: function() {
        return (new THREE.Plane).copy(this)
    }
},
THREE.Math = {
    PI2: 2 * Math.PI,
    generateUUID: function() {
        var a, b = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""), c = new Array(36), d = 0;
        return function() {
            for (var e = 0; 36 > e; e++)
                8 == e || 13 == e || 18 == e || 23 == e ? c[e] = "-" : 14 == e ? c[e] = "4" : (2 >= d && (d = 33554432 + 16777216 * Math.random() | 0),
                a = 15 & d,
                d >>= 4,
                c[e] = b[19 == e ? 3 & a | 8 : a]);
            return c.join("")
        }
    }(),
    clamp: function(a, b, c) {
        return b > a ? b : a > c ? c : a
    },
    clampBottom: function(a, b) {
        return b > a ? b : a
    },
    mapLinear: function(a, b, c, d, e) {
        return d + (a - b) * (e - d) / (c - b)
    },
    smoothstep: function(a, b, c) {
        return b >= a ? 0 : a >= c ? 1 : (a = (a - b) / (c - b),
        a * a * (3 - 2 * a))
    },
    smootherstep: function(a, b, c) {
        return b >= a ? 0 : a >= c ? 1 : (a = (a - b) / (c - b),
        a * a * a * (a * (6 * a - 15) + 10))
    },
    random16: function() {
        return (65280 * Math.random() + 255 * Math.random()) / 65535
    },
    randInt: function(a, b) {
        return a + Math.floor(Math.random() * (b - a + 1))
    },
    randFloat: function(a, b) {
        return a + Math.random() * (b - a)
    },
    randFloatSpread: function(a) {
        return a * (.5 - Math.random())
    },
    sign: function(a) {
        return 0 > a ? -1 : a > 0 ? 1 : 0
    },
    degToRad: function() {
        var a = Math.PI / 180;
        return function(b) {
            return b * a
        }
    }(),
    radToDeg: function() {
        var a = 180 / Math.PI;
        return function(b) {
            return b * a
        }
    }(),
    isPowerOfTwo: function(a) {
        return 0 === (a & a - 1) && 0 !== a
    }
},
THREE.Spline = function(a) {
    function b(a, b, c, d, e, f, g) {
        var h = .5 * (c - a)
          , i = .5 * (d - b);
        return (2 * (b - c) + h + i) * g + (-3 * (b - c) - 2 * h - i) * f + h * e + b
    }
    this.points = a;
    var c, d, e, f, g, h, i, j, k, l = [], m = {
        x: 0,
        y: 0,
        z: 0
    };
    this.initFromArray = function(a) {
        this.points = [];
        for (var b = 0; b < a.length; b++)
            this.points[b] = {
                x: a[b][0],
                y: a[b][1],
                z: a[b][2]
            }
    }
    ,
    this.getPoint = function(a) {
        return c = (this.points.length - 1) * a,
        d = Math.floor(c),
        e = c - d,
        l[0] = 0 === d ? d : d - 1,
        l[1] = d,
        l[2] = d > this.points.length - 2 ? this.points.length - 1 : d + 1,
        l[3] = d > this.points.length - 3 ? this.points.length - 1 : d + 2,
        h = this.points[l[0]],
        i = this.points[l[1]],
        j = this.points[l[2]],
        k = this.points[l[3]],
        f = e * e,
        g = e * f,
        m.x = b(h.x, i.x, j.x, k.x, e, f, g),
        m.y = b(h.y, i.y, j.y, k.y, e, f, g),
        m.z = b(h.z, i.z, j.z, k.z, e, f, g),
        m
    }
    ,
    this.getControlPointsArray = function() {
        var a, b, c = this.points.length, d = [];
        for (a = 0; c > a; a++)
            b = this.points[a],
            d[a] = [b.x, b.y, b.z];
        return d
    }
    ,
    this.getLength = function(a) {
        var b, c, d, e, f = 0, g = 0, h = 0, i = new THREE.Vector3, j = new THREE.Vector3, k = [], l = 0;
        for (k[0] = 0,
        a || (a = 100),
        d = this.points.length * a,
        i.copy(this.points[0]),
        b = 1; d > b; b++)
            c = b / d,
            e = this.getPoint(c),
            j.copy(e),
            l += j.distanceTo(i),
            i.copy(e),
            f = (this.points.length - 1) * c,
            g = Math.floor(f),
            g != h && (k[g] = l,
            h = g);
        return k[k.length] = l,
        {
            chunks: k,
            total: l
        }
    }
    ,
    this.reparametrizeByArcLength = function(a) {
        var b, c, d, e, f, g, h, i, j = [], k = new THREE.Vector3, l = this.getLength();
        for (j.push(k.copy(this.points[0]).clone()),
        b = 1; b < this.points.length; b++) {
            for (g = l.chunks[b] - l.chunks[b - 1],
            h = Math.ceil(a * g / l.total),
            e = (b - 1) / (this.points.length - 1),
            f = b / (this.points.length - 1),
            c = 1; h - 1 > c; c++)
                d = e + c * (1 / h) * (f - e),
                i = this.getPoint(d),
                j.push(k.copy(i).clone());
            j.push(k.copy(this.points[b]).clone())
        }
        this.points = j
    }
}
,
THREE.Triangle = function(a, b, c) {
    this.a = void 0 !== a ? a : new THREE.Vector3,
    this.b = void 0 !== b ? b : new THREE.Vector3,
    this.c = void 0 !== c ? c : new THREE.Vector3
}
,
THREE.Triangle.normal = function() {
    var a = new THREE.Vector3;
    return function(b, c, d, e) {
        var f = e || new THREE.Vector3;
        f.subVectors(d, c),
        a.subVectors(b, c),
        f.cross(a);
        var g = f.lengthSq();
        return g > 0 ? f.multiplyScalar(1 / Math.sqrt(g)) : f.set(0, 0, 0)
    }
}(),
THREE.Triangle.barycoordFromPoint = function() {
    var a = new THREE.Vector3
      , b = new THREE.Vector3
      , c = new THREE.Vector3;
    return function(d, e, f, g, h) {
        a.subVectors(g, e),
        b.subVectors(f, e),
        c.subVectors(d, e);
        var i = a.dot(a)
          , j = a.dot(b)
          , k = a.dot(c)
          , l = b.dot(b)
          , m = b.dot(c)
          , n = i * l - j * j
          , o = h || new THREE.Vector3;
        if (0 == n)
            return o.set(-2, -1, -1);
        var p = 1 / n
          , q = (l * k - j * m) * p
          , r = (i * m - j * k) * p;
        return o.set(1 - q - r, r, q)
    }
}(),
THREE.Triangle.containsPoint = function() {
    var a = new THREE.Vector3;
    return function(b, c, d, e) {
        var f = THREE.Triangle.barycoordFromPoint(b, c, d, e, a);
        return f.x >= 0 && f.y >= 0 && f.x + f.y <= 1
    }
}(),
THREE.Triangle.prototype = {
    constructor: THREE.Triangle,
    set: function(a, b, c) {
        return this.a.copy(a),
        this.b.copy(b),
        this.c.copy(c),
        this
    },
    setFromPointsAndIndices: function(a, b, c, d) {
        return this.a.copy(a[b]),
        this.b.copy(a[c]),
        this.c.copy(a[d]),
        this
    },
    copy: function(a) {
        return this.a.copy(a.a),
        this.b.copy(a.b),
        this.c.copy(a.c),
        this
    },
    area: function() {
        var a = new THREE.Vector3
          , b = new THREE.Vector3;
        return function() {
            return a.subVectors(this.c, this.b),
            b.subVectors(this.a, this.b),
            .5 * a.cross(b).length()
        }
    }(),
    midpoint: function(a) {
        var b = a || new THREE.Vector3;
        return b.addVectors(this.a, this.b).add(this.c).multiplyScalar(1 / 3)
    },
    normal: function(a) {
        return THREE.Triangle.normal(this.a, this.b, this.c, a)
    },
    plane: function(a) {
        var b = a || new THREE.Plane;
        return b.setFromCoplanarPoints(this.a, this.b, this.c)
    },
    barycoordFromPoint: function(a, b) {
        return THREE.Triangle.barycoordFromPoint(a, this.a, this.b, this.c, b)
    },
    containsPoint: function(a) {
        return THREE.Triangle.containsPoint(a, this.a, this.b, this.c)
    },
    equals: function(a) {
        return a.a.equals(this.a) && a.b.equals(this.b) && a.c.equals(this.c)
    },
    clone: function() {
        return (new THREE.Triangle).copy(this)
    }
},
THREE.Vertex = function(a) {
    return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),
    a
}
,
THREE.UV = function(a, b) {
    return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),
    new THREE.Vector2(a,b)
}
,
THREE.Clock = function(a) {
    this.autoStart = void 0 !== a ? a : !0,
    this.startTime = 0,
    this.oldTime = 0,
    this.elapsedTime = 0,
    this.running = !1
}
,
THREE.Clock.prototype = {
    constructor: THREE.Clock,
    start: function() {
        this.startTime = void 0 !== self.performance && void 0 !== self.performance.now ? self.performance.now() : Date.now(),
        this.oldTime = this.startTime,
        this.running = !0
    },
    stop: function() {
        this.getElapsedTime(),
        this.running = !1
    },
    getElapsedTime: function() {
        return this.getDelta(),
        this.elapsedTime
    },
    getDelta: function() {
        var a = 0;
        if (this.autoStart && !this.running && this.start(),
        this.running) {
            var b = void 0 !== self.performance && void 0 !== self.performance.now ? self.performance.now() : Date.now();
            a = .001 * (b - this.oldTime),
            this.oldTime = b,
            this.elapsedTime += a
        }
        return a
    }
},
THREE.EventDispatcher = function() {}
,
THREE.EventDispatcher.prototype = {
    constructor: THREE.EventDispatcher,
    apply: function(a) {
        a.addEventListener = THREE.EventDispatcher.prototype.addEventListener,
        a.hasEventListener = THREE.EventDispatcher.prototype.hasEventListener,
        a.removeEventListener = THREE.EventDispatcher.prototype.removeEventListener,
        a.dispatchEvent = THREE.EventDispatcher.prototype.dispatchEvent
    },
    addEventListener: function(a, b) {
        void 0 === this._listeners && (this._listeners = {});
        var c = this._listeners;
        void 0 === c[a] && (c[a] = []),
        -1 === c[a].indexOf(b) && c[a].push(b)
    },
    hasEventListener: function(a, b) {
        if (void 0 === this._listeners)
            return !1;
        var c = this._listeners;
        return void 0 !== c[a] && -1 !== c[a].indexOf(b) ? !0 : !1
    },
    removeEventListener: function(a, b) {
        if (void 0 !== this._listeners) {
            var c = this._listeners
              , d = c[a];
            if (void 0 !== d) {
                var e = d.indexOf(b);
                -1 !== e && d.splice(e, 1)
            }
        }
    },
    dispatchEvent: function() {
        var a = [];
        return function(b) {
            if (void 0 !== this._listeners) {
                var c = this._listeners
                  , d = c[b.type];
                if (void 0 !== d) {
                    b.target = this;
                    for (var e = d.length, f = 0; e > f; f++)
                        a[f] = d[f];
                    for (var f = 0; e > f; f++)
                        a[f].call(this, b)
                }
            }
        }
    }()
},
function(a) {
    a.Raycaster = function(b, c, d, e) {
        this.ray = new a.Ray(b,c),
        this.near = d || 0,
        this.far = e || 1 / 0
    }
    ;
    var b = new a.Sphere
      , c = new a.Ray
      , d = (new a.Plane,
    new a.Vector3,
    new a.Vector3)
      , e = new a.Matrix4
      , f = function(a, b) {
        return a.distance - b.distance
    }
      , g = new a.Vector3
      , h = new a.Vector3
      , i = new a.Vector3
      , j = function(f, k, l) {
        if (f instanceof a.Sprite) {
            d.setFromMatrixPosition(f.matrixWorld);
            var m = k.ray.distanceToPoint(d);
            if (m > f.scale.x)
                return l;
            l.push({
                distance: m,
                point: f.position,
                face: null,
                object: f
            })
        } else if (f instanceof a.LOD) {
            d.setFromMatrixPosition(f.matrixWorld);
            var m = k.ray.origin.distanceTo(d);
            j(f.getObjectForDistance(m), k, l)
        } else if (f instanceof a.Mesh) {
            var n = f.geometry;
            if (null === n.boundingSphere && n.computeBoundingSphere(),
            b.copy(n.boundingSphere),
            b.applyMatrix4(f.matrixWorld),
            k.ray.isIntersectionSphere(b) === !1)
                return l;
            if (e.getInverse(f.matrixWorld),
            c.copy(k.ray).applyMatrix4(e),
            null !== n.boundingBox && c.isIntersectionBox(n.boundingBox) === !1)
                return l;
            if (n instanceof a.BufferGeometry) {
                var o = f.material;
                if (void 0 === o)
                    return l;
                var p, q, r, s = n.attributes, t = k.precision;
                if (void 0 !== s.index)
                    for (var u = n.offsets, v = s.index.array, w = s.position.array, x = 0, y = u.length; y > x; ++x)
                        for (var z = u[x].start, A = u[x].count, B = u[x].index, C = z, D = z + A; D > C; C += 3) {
                            if (p = B + v[C],
                            q = B + v[C + 1],
                            r = B + v[C + 2],
                            g.set(w[3 * p], w[3 * p + 1], w[3 * p + 2]),
                            h.set(w[3 * q], w[3 * q + 1], w[3 * q + 2]),
                            i.set(w[3 * r], w[3 * r + 1], w[3 * r + 2]),
                            o.side === a.BackSide)
                                var E = c.intersectTriangle(i, h, g, !0);
                            else
                                var E = c.intersectTriangle(g, h, i, o.side !== a.DoubleSide);
                            if (null !== E) {
                                E.applyMatrix4(f.matrixWorld);
                                var m = k.ray.origin.distanceTo(E);
                                t > m || m < k.near || m > k.far || l.push({
                                    distance: m,
                                    point: E,
                                    indices: [p, q, r],
                                    face: null,
                                    faceIndex: null,
                                    object: f
                                })
                            }
                        }
                else
                    for (var u = n.offsets, w = s.position.array, C = 0, D = s.position.array.length; D > C; C += 3) {
                        if (p = C,
                        q = C + 1,
                        r = C + 2,
                        g.set(w[3 * p], w[3 * p + 1], w[3 * p + 2]),
                        h.set(w[3 * q], w[3 * q + 1], w[3 * q + 2]),
                        i.set(w[3 * r], w[3 * r + 1], w[3 * r + 2]),
                        o.side === a.BackSide)
                            var E = c.intersectTriangle(i, h, g, !0);
                        else
                            var E = c.intersectTriangle(g, h, i, o.side !== a.DoubleSide);
                        if (null !== E) {
                            E.applyMatrix4(f.matrixWorld);
                            var m = k.ray.origin.distanceTo(E);
                            t > m || m < k.near || m > k.far || l.push({
                                distance: m,
                                point: E,
                                indices: [p, q, r],
                                face: null,
                                faceIndex: null,
                                object: f
                            })
                        }
                    }
            } else if (n instanceof a.Geometry)
                for (var p, q, r, F = f.material instanceof a.MeshFaceMaterial, G = F === !0 ? f.material.materials : null, t = k.precision, H = n.vertices, I = 0, J = n.faces.length; J > I; I++) {
                    var K = n.faces[I]
                      , o = F === !0 ? G[K.materialIndex] : f.material;
                    if (void 0 !== o) {
                        if (p = H[K.a],
                        q = H[K.b],
                        r = H[K.c],
                        o.morphTargets === !0) {
                            var L = n.morphTargets
                              , M = f.morphTargetInfluences;
                            g.set(0, 0, 0),
                            h.set(0, 0, 0),
                            i.set(0, 0, 0);
                            for (var N = 0, O = L.length; O > N; N++) {
                                var P = M[N];
                                if (0 !== P) {
                                    var Q = L[N].vertices;
                                    g.x += (Q[K.a].x - p.x) * P,
                                    g.y += (Q[K.a].y - p.y) * P,
                                    g.z += (Q[K.a].z - p.z) * P,
                                    h.x += (Q[K.b].x - q.x) * P,
                                    h.y += (Q[K.b].y - q.y) * P,
                                    h.z += (Q[K.b].z - q.z) * P,
                                    i.x += (Q[K.c].x - r.x) * P,
                                    i.y += (Q[K.c].y - r.y) * P,
                                    i.z += (Q[K.c].z - r.z) * P
                                }
                            }
                            g.add(p),
                            h.add(q),
                            i.add(r),
                            p = g,
                            q = h,
                            r = i
                        }
                        if (o.side === a.BackSide)
                            var E = c.intersectTriangle(r, q, p, !0);
                        else
                            var E = c.intersectTriangle(p, q, r, o.side !== a.DoubleSide);
                        if (null !== E) {
                            E.applyMatrix4(f.matrixWorld);
                            var m = k.ray.origin.distanceTo(E);
                            t > m || m < k.near || m > k.far || l.push({
                                distance: m,
                                point: E,
                                face: K,
                                faceIndex: I,
                                object: f
                            })
                        }
                    }
                }
        } else if (f instanceof a.Line) {
            var t = k.linePrecision
              , R = t * t
              , n = f.geometry;
            if (null === n.boundingSphere && n.computeBoundingSphere(),
            b.copy(n.boundingSphere),
            b.applyMatrix4(f.matrixWorld),
            k.ray.isIntersectionSphere(b) === !1)
                return l;
            if (e.getInverse(f.matrixWorld),
            c.copy(k.ray).applyMatrix4(e),
            n instanceof a.Geometry)
                for (var H = n.vertices, S = H.length, T = new a.Vector3, U = new a.Vector3, V = f.type === a.LineStrip ? 1 : 2, C = 0; S - 1 > C; C += V) {
                    var W = c.distanceSqToSegment(H[C], H[C + 1], U, T);
                    if (!(W > R)) {
                        var m = c.origin.distanceTo(U);
                        m < k.near || m > k.far || l.push({
                            distance: m,
                            point: T.clone().applyMatrix4(f.matrixWorld),
                            face: null,
                            faceIndex: null,
                            object: f
                        })
                    }
                }
        }
    }
      , k = function(a, b, c) {
        for (var d = a.getDescendants(), e = 0, f = d.length; f > e; e++)
            j(d[e], b, c)
    };
    a.Raycaster.prototype.precision = 1e-4,
    a.Raycaster.prototype.linePrecision = 1,
    a.Raycaster.prototype.set = function(a, b) {
        this.ray.set(a, b)
    }
    ,
    a.Raycaster.prototype.intersectObject = function(a, b) {
        var c = [];
        return b === !0 && k(a, this, c),
        j(a, this, c),
        c.sort(f),
        c
    }
    ,
    a.Raycaster.prototype.intersectObjects = function(a, b) {
        for (var c = [], d = 0, e = a.length; e > d; d++)
            j(a[d], this, c),
            b === !0 && k(a[d], this, c);
        return c.sort(f),
        c
    }
}(THREE),
THREE.Object3D = function() {
    this.id = THREE.Object3DIdCount++,
    this.uuid = THREE.Math.generateUUID(),
    this.name = "",
    this.parent = void 0,
    this.children = [],
    this.up = new THREE.Vector3(0,1,0),
    this.position = new THREE.Vector3,
    this._rotation = new THREE.Euler,
    this._quaternion = new THREE.Quaternion,
    this.scale = new THREE.Vector3(1,1,1),
    this._rotation._quaternion = this.quaternion,
    this._quaternion._euler = this.rotation,
    this.renderDepth = null,
    this.rotationAutoUpdate = !0,
    this.matrix = new THREE.Matrix4,
    this.matrixWorld = new THREE.Matrix4,
    this.matrixAutoUpdate = !0,
    this.matrixWorldNeedsUpdate = !0,
    this.visible = !0,
    this.castShadow = !1,
    this.receiveShadow = !1,
    this.frustumCulled = !0,
    this.userData = {}
}
,
THREE.Object3D.prototype = {
    constructor: THREE.Object3D,
    get rotation() {
        return this._rotation
    },
    set rotation(a) {
        this._rotation = a,
        this._rotation._quaternion = this._quaternion,
        this._quaternion._euler = this._rotation,
        this._rotation._updateQuaternion()
    },
    get quaternion() {
        return this._quaternion
    },
    set quaternion(a) {
        this._quaternion = a,
        this._quaternion._euler = this._rotation,
        this._rotation._quaternion = this._quaternion,
        this._quaternion._updateEuler()
    },
    get eulerOrder() {
        return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),
        this.rotation.order
    },
    set eulerOrder(a) {
        console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),
        this.rotation.order = a
    },
    get useQuaternion() {
        console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")
    },
    set useQuaternion(a) {
        console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")
    },
    applyMatrix: function(a) {
        this.matrix.multiplyMatrices(a, this.matrix),
        this.matrix.decompose(this.position, this.quaternion, this.scale)
    },
    setRotationFromAxisAngle: function(a, b) {
        this.quaternion.setFromAxisAngle(a, b)
    },
    setRotationFromEuler: function(a) {
        this.quaternion.setFromEuler(a, !0)
    },
    setRotationFromMatrix: function(a) {
        this.quaternion.setFromRotationMatrix(a)
    },
    setRotationFromQuaternion: function(a) {
        this.quaternion.copy(a)
    },
    rotateOnAxis: function() {
        var a = new THREE.Quaternion;
        return function(b, c) {
            return a.setFromAxisAngle(b, c),
            this.quaternion.multiply(a),
            this
        }
    }(),
    rotateX: function() {
        var a = new THREE.Vector3(1,0,0);
        return function(b) {
            return this.rotateOnAxis(a, b)
        }
    }(),
    rotateY: function() {
        var a = new THREE.Vector3(0,1,0);
        return function(b) {
            return this.rotateOnAxis(a, b)
        }
    }(),
    rotateZ: function() {
        var a = new THREE.Vector3(0,0,1);
        return function(b) {
            return this.rotateOnAxis(a, b)
        }
    }(),
    translateOnAxis: function() {
        var a = new THREE.Vector3;
        return function(b, c) {
            return a.copy(b),
            a.applyQuaternion(this.quaternion),
            this.position.add(a.multiplyScalar(c)),
            this
        }
    }(),
    translate: function(a, b) {
        return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),
        this.translateOnAxis(b, a)
    },
    translateX: function() {
        var a = new THREE.Vector3(1,0,0);
        return function(b) {
            return this.translateOnAxis(a, b)
        }
    }(),
    translateY: function() {
        var a = new THREE.Vector3(0,1,0);
        return function(b) {
            return this.translateOnAxis(a, b)
        }
    }(),
    translateZ: function() {
        var a = new THREE.Vector3(0,0,1);
        return function(b) {
            return this.translateOnAxis(a, b)
        }
    }(),
    localToWorld: function(a) {
        return a.applyMatrix4(this.matrixWorld)
    },
    worldToLocal: function() {
        var a = new THREE.Matrix4;
        return function(b) {
            return b.applyMatrix4(a.getInverse(this.matrixWorld))
        }
    }(),
    lookAt: function() {
        var a = new THREE.Matrix4;
        return function(b) {
            a.lookAt(b, this.position, this.up),
            this.quaternion.setFromRotationMatrix(a)
        }
    }(),
    add: function(a) {
        if (a === this)
            return console.warn("THREE.Object3D.add: An object can't be added as a child of itself."),
            void 0;
        if (a instanceof THREE.Object3D) {
            void 0 !== a.parent && a.parent.remove(a),
            a.parent = this,
            a.dispatchEvent({
                type: "added"
            }),
            this.children.push(a);
            for (var b = this; void 0 !== b.parent; )
                b = b.parent;
            void 0 !== b && b instanceof THREE.Scene && b.__addObject(a)
        }
    },
    remove: function(a) {
        var b = this.children.indexOf(a);
        if (-1 !== b) {
            a.parent = void 0,
            a.dispatchEvent({
                type: "removed"
            }),
            this.children.splice(b, 1);
            for (var c = this; void 0 !== c.parent; )
                c = c.parent;
            void 0 !== c && c instanceof THREE.Scene && c.__removeObject(a)
        }
    },
    traverse: function(a) {
        a(this);
        for (var b = 0, c = this.children.length; c > b; b++)
            this.children[b].traverse(a)
    },
    getObjectById: function(a, b) {
        for (var c = 0, d = this.children.length; d > c; c++) {
            var e = this.children[c];
            if (e.id === a)
                return e;
            if (b === !0 && (e = e.getObjectById(a, b),
            void 0 !== e))
                return e
        }
        return void 0
    },
    getObjectByName: function(a, b) {
        for (var c = 0, d = this.children.length; d > c; c++) {
            var e = this.children[c];
            if (e.name === a)
                return e;
            if (b === !0 && (e = e.getObjectByName(a, b),
            void 0 !== e))
                return e
        }
        return void 0
    },
    getChildByName: function(a, b) {
        return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),
        this.getObjectByName(a, b)
    },
    getDescendants: function(a) {
        void 0 === a && (a = []),
        Array.prototype.push.apply(a, this.children);
        for (var b = 0, c = this.children.length; c > b; b++)
            this.children[b].getDescendants(a);
        return a
    },
    updateMatrix: function() {
        this.matrix.compose(this.position, this.quaternion, this.scale),
        this.matrixWorldNeedsUpdate = !0
    },
    updateMatrixWorld: function(a) {
        this.matrixAutoUpdate === !0 && this.updateMatrix(),
        (this.matrixWorldNeedsUpdate === !0 || a === !0) && (void 0 === this.parent ? this.matrixWorld.copy(this.matrix) : this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix),
        this.matrixWorldNeedsUpdate = !1,
        a = !0);
        for (var b = 0, c = this.children.length; c > b; b++)
            this.children[b].updateMatrixWorld(a)
    },
    clone: function(a, b) {
        if (void 0 === a && (a = new THREE.Object3D),
        void 0 === b && (b = !0),
        a.name = this.name,
        a.up.copy(this.up),
        a.position.copy(this.position),
        a.quaternion.copy(this.quaternion),
        a.scale.copy(this.scale),
        a.renderDepth = this.renderDepth,
        a.rotationAutoUpdate = this.rotationAutoUpdate,
        a.matrix.copy(this.matrix),
        a.matrixWorld.copy(this.matrixWorld),
        a.matrixAutoUpdate = this.matrixAutoUpdate,
        a.matrixWorldNeedsUpdate = this.matrixWorldNeedsUpdate,
        a.visible = this.visible,
        a.castShadow = this.castShadow,
        a.receiveShadow = this.receiveShadow,
        a.frustumCulled = this.frustumCulled,
        a.userData = JSON.parse(JSON.stringify(this.userData)),
        b === !0)
            for (var c = 0; c < this.children.length; c++) {
                var d = this.children[c];
                a.add(d.clone())
            }
        return a
    }
},
THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),
THREE.Object3DIdCount = 0,
THREE.Projector = function() {
    function a() {
        if (i === t) {
            var a = new THREE.RenderableObject;
            return s.push(a),
            t++,
            i++,
            a
        }
        return s[i++]
    }
    function b() {
        if (k === v) {
            var a = new THREE.RenderableVertex;
            return u.push(a),
            v++,
            k++,
            a
        }
        return u[k++]
    }
    function c() {
        if (m === x) {
            var a = new THREE.RenderableFace;
            return w.push(a),
            x++,
            m++,
            a
        }
        return w[m++]
    }
    function d() {
        if (o === z) {
            var a = new THREE.RenderableLine;
            return y.push(a),
            z++,
            o++,
            a
        }
        return y[o++]
    }
    function e() {
        if (q === B) {
            var a = new THREE.RenderableSprite;
            return A.push(a),
            B++,
            q++,
            a
        }
        return A[q++]
    }
    function f(a, b) {
        return a.z !== b.z ? b.z - a.z : a.id !== b.id ? a.id - b.id : 0
    }
    function g(a, b) {
        var c = 0
          , d = 1
          , e = a.z + a.w
          , f = b.z + b.w
          , g = -a.z + a.w
          , h = -b.z + b.w;
        return e >= 0 && f >= 0 && g >= 0 && h >= 0 ? !0 : 0 > e && 0 > f || 0 > g && 0 > h ? !1 : (0 > e ? c = Math.max(c, e / (e - f)) : 0 > f && (d = Math.min(d, e / (e - f))),
        0 > g ? c = Math.max(c, g / (g - h)) : 0 > h && (d = Math.min(d, g / (g - h))),
        c > d ? !1 : (a.lerp(b, c),
        b.lerp(a, 1 - d),
        !0))
    }
    var h, i, j, k, l, m, n, o, p, q, r, s = [], t = 0, u = [], v = 0, w = [], x = 0, y = [], z = 0, A = [], B = 0, C = {
        objects: [],
        lights: [],
        elements: []
    }, D = new THREE.Vector3, E = new THREE.Vector3, F = new THREE.Vector3, G = new THREE.Vector3, H = new THREE.Vector4, I = new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)), J = new THREE.Box3, K = new Array(3), L = (new Array(4),
    new THREE.Matrix4), M = new THREE.Matrix4, N = new THREE.Matrix4, O = new THREE.Matrix3, P = new THREE.Frustum, Q = new THREE.Vector4, R = new THREE.Vector4;
    this.projectVector = function(a, b) {
        return b.matrixWorldInverse.getInverse(b.matrixWorld),
        M.multiplyMatrices(b.projectionMatrix, b.matrixWorldInverse),
        a.applyProjection(M)
    }
    ,
    this.unprojectVector = function() {
        var a = new THREE.Matrix4;
        return function(b, c) {
            return a.getInverse(c.projectionMatrix),
            M.multiplyMatrices(c.matrixWorld, a),
            b.applyProjection(M)
        }
    }(),
    this.pickingRay = function(a, b) {
        a.z = -1;
        var c = new THREE.Vector3(a.x,a.y,1);
        return this.unprojectVector(a, b),
        this.unprojectVector(c, b),
        c.sub(a).normalize(),
        new THREE.Raycaster(a,c)
    }
    ;
    var S = function(b) {
        if (b.visible !== !1) {
            b instanceof THREE.Light ? C.lights.push(b) : (b instanceof THREE.Mesh || b instanceof THREE.Line || b instanceof THREE.Sprite) && (b.frustumCulled === !1 || P.intersectsObject(b) === !0) && (h = a(),
            h.id = b.id,
            h.object = b,
            null !== b.renderDepth ? h.z = b.renderDepth : (G.setFromMatrixPosition(b.matrixWorld),
            G.applyProjection(M),
            h.z = G.z),
            C.objects.push(h));
            for (var c = 0, d = b.children.length; d > c; c++)
                S(b.children[c])
        }
    }
      , T = function(a, b) {
        i = 0,
        C.objects.length = 0,
        C.lights.length = 0,
        S(a),
        b === !0 && C.objects.sort(f)
    }
      , U = function() {
        var a = []
          , e = null
          , f = new THREE.Matrix3
          , g = function(b) {
            e = b,
            f.getNormalMatrix(e.matrixWorld),
            a.length = 0
        }
          , h = function(a) {
            var b = a.position
              , c = a.positionWorld
              , d = a.positionScreen;
            c.copy(b).applyMatrix4(r),
            d.copy(c).applyMatrix4(M);
            var e = 1 / d.w;
            d.x *= e,
            d.y *= e,
            d.z *= e,
            a.visible = d.x >= -1 && d.x <= 1 && d.y >= -1 && d.y <= 1 && d.z >= -1 && d.z <= 1
        }
          , i = function(a, c, d) {
            j = b(),
            j.position.set(a, c, d),
            h(j)
        }
          , k = function(b, c, d) {
            a.push(b, c, d)
        }
          , m = function(a, b, c) {
            return K[0] = a.positionScreen,
            K[1] = b.positionScreen,
            K[2] = c.positionScreen,
            a.visible === !0 || b.visible === !0 || c.visible === !0 || I.isIntersectionBox(J.setFromPoints(K)) ? (c.positionScreen.x - a.positionScreen.x) * (b.positionScreen.y - a.positionScreen.y) - (c.positionScreen.y - a.positionScreen.y) * (b.positionScreen.x - a.positionScreen.x) < 0 : !1
        }
          , o = function(a, b) {
            var c = u[a]
              , f = u[b];
            n = d(),
            n.id = e.id,
            n.v1.copy(c),
            n.v2.copy(f),
            n.z = (c.positionScreen.z + f.positionScreen.z) / 2,
            n.material = e.material,
            C.elements.push(n)
        }
          , p = function(b, d, g) {
            var h = u[b]
              , i = u[d]
              , j = u[g];
            if (m(h, i, j) === !0) {
                l = c(),
                l.id = e.id,
                l.v1.copy(h),
                l.v2.copy(i),
                l.v3.copy(j),
                l.z = (h.positionScreen.z + i.positionScreen.z + j.positionScreen.z) / 3;
                for (var k = 0; 3 > k; k++) {
                    var n = 3 * arguments[k]
                      , o = l.vertexNormalsModel[k];
                    o.set(a[n + 0], a[n + 1], a[n + 2]),
                    o.applyMatrix3(f).normalize()
                }
                l.vertexNormalsLength = 3,
                l.material = e.material,
                C.elements.push(l)
            }
        };
        return {
            setObject: g,
            projectVertex: h,
            checkTriangleVisibility: m,
            pushVertex: i,
            pushNormal: k,
            pushLine: o,
            pushTriangle: p
        }
    }
      , V = new U;
    this.projectScene = function(a, h, i, j) {
        var s, t, v, w, x, y, z, A, B, G;
        m = 0,
        o = 0,
        q = 0,
        C.elements.length = 0,
        a.autoUpdate === !0 && a.updateMatrixWorld(),
        void 0 === h.parent && h.updateMatrixWorld(),
        L.copy(h.matrixWorldInverse.getInverse(h.matrixWorld)),
        M.multiplyMatrices(h.projectionMatrix, L),
        P.setFromMatrix(M),
        T(a, i);
        for (var I = 0, J = C.objects.length; J > I; I++)
            if (s = C.objects[I].object,
            t = s.geometry,
            V.setObject(s),
            r = s.matrixWorld,
            k = 0,
            s instanceof THREE.Mesh) {
                if (t instanceof THREE.BufferGeometry) {
                    var K = t.attributes
                      , S = t.offsets;
                    if (void 0 === K.position)
                        continue;
                    for (var U = K.position.array, W = 0, X = U.length; X > W; W += 3)
                        V.pushVertex(U[W], U[W + 1], U[W + 2]);
                    for (var Y = K.normal.array, W = 0, X = Y.length; X > W; W += 3)
                        V.pushNormal(Y[W], Y[W + 1], Y[W + 2]);
                    if (void 0 !== K.index) {
                        var Z = K.index.array;
                        if (S.length > 0)
                            for (var I = 0; I < S.length; I++)
                                for (var $ = S[I], _ = $.index, W = $.start, X = $.start + $.count; X > W; W += 3)
                                    V.pushTriangle(Z[W] + _, Z[W + 1] + _, Z[W + 2] + _);
                        else
                            for (var W = 0, X = Z.length; X > W; W += 3)
                                V.pushTriangle(Z[W], Z[W + 1], Z[W + 2])
                    } else
                        for (var W = 0, X = U.length / 3; X > W; W += 3)
                            V.pushTriangle(W, W + 1, W + 2)
                } else if (t instanceof THREE.Geometry) {
                    v = t.vertices,
                    w = t.faces,
                    z = t.faceVertexUvs,
                    O.getNormalMatrix(r),
                    B = s.material instanceof THREE.MeshFaceMaterial,
                    G = B === !0 ? s.material : null;
                    for (var ab = 0, bb = v.length; bb > ab; ab++) {
                        var cb = v[ab];
                        V.pushVertex(cb.x, cb.y, cb.z)
                    }
                    for (var db = 0, eb = w.length; eb > db; db++) {
                        x = w[db];
                        var fb = B === !0 ? G.materials[x.materialIndex] : s.material;
                        if (void 0 !== fb) {
                            var gb = fb.side
                              , hb = u[x.a]
                              , ib = u[x.b]
                              , jb = u[x.c];
                            if (fb.morphTargets === !0) {
                                var kb = t.morphTargets
                                  , lb = s.morphTargetInfluences
                                  , mb = hb.position
                                  , nb = ib.position
                                  , ob = jb.position;
                                D.set(0, 0, 0),
                                E.set(0, 0, 0),
                                F.set(0, 0, 0);
                                for (var pb = 0, qb = kb.length; qb > pb; pb++) {
                                    var rb = lb[pb];
                                    if (0 !== rb) {
                                        var sb = kb[pb].vertices;
                                        D.x += (sb[x.a].x - mb.x) * rb,
                                        D.y += (sb[x.a].y - mb.y) * rb,
                                        D.z += (sb[x.a].z - mb.z) * rb,
                                        E.x += (sb[x.b].x - nb.x) * rb,
                                        E.y += (sb[x.b].y - nb.y) * rb,
                                        E.z += (sb[x.b].z - nb.z) * rb,
                                        F.x += (sb[x.c].x - ob.x) * rb,
                                        F.y += (sb[x.c].y - ob.y) * rb,
                                        F.z += (sb[x.c].z - ob.z) * rb
                                    }
                                }
                                hb.position.add(D),
                                ib.position.add(E),
                                jb.position.add(F),
                                V.projectVertex(hb),
                                V.projectVertex(ib),
                                V.projectVertex(jb)
                            }
                            var tb = V.checkTriangleVisibility(hb, ib, jb);
                            if (!(tb === !1 && gb === THREE.FrontSide || tb === !0 && gb === THREE.BackSide)) {
                                l = c(),
                                l.id = s.id,
                                l.v1.copy(hb),
                                l.v2.copy(ib),
                                l.v3.copy(jb),
                                l.normalModel.copy(x.normal),
                                tb !== !1 || gb !== THREE.BackSide && gb !== THREE.DoubleSide || l.normalModel.negate(),
                                l.normalModel.applyMatrix3(O).normalize(),
                                l.centroidModel.copy(x.centroid).applyMatrix4(r),
                                y = x.vertexNormals;
                                for (var ub = 0, vb = Math.min(y.length, 3); vb > ub; ub++) {
                                    var wb = l.vertexNormalsModel[ub];
                                    wb.copy(y[ub]),
                                    tb !== !1 || gb !== THREE.BackSide && gb !== THREE.DoubleSide || wb.negate(),
                                    wb.applyMatrix3(O).normalize()
                                }
                                l.vertexNormalsLength = y.length;
                                for (var xb = 0, yb = Math.min(z.length, 3); yb > xb; xb++)
                                    if (A = z[xb][db],
                                    void 0 !== A)
                                        for (var zb = 0, Ab = A.length; Ab > zb; zb++)
                                            l.uvs[xb][zb] = A[zb];
                                l.color = x.color,
                                l.material = fb,
                                l.z = (hb.positionScreen.z + ib.positionScreen.z + jb.positionScreen.z) / 3,
                                C.elements.push(l)
                            }
                        }
                    }
                }
            } else if (s instanceof THREE.Line) {
                if (t instanceof THREE.BufferGeometry) {
                    var K = t.attributes;
                    if (void 0 !== K.position) {
                        for (var U = K.position.array, W = 0, X = U.length; X > W; W += 3)
                            V.pushVertex(U[W], U[W + 1], U[W + 2]);
                        if (void 0 !== K.index)
                            for (var Z = K.index.array, W = 0, X = Z.length; X > W; W += 2)
                                V.pushLine(Z[W], Z[W + 1]);
                        else
                            for (var W = 0, X = U.length / 3 - 1; X > W; W++)
                                V.pushLine(W, W + 1)
                    }
                } else if (t instanceof THREE.Geometry) {
                    if (N.multiplyMatrices(M, r),
                    v = s.geometry.vertices,
                    0 === v.length)
                        continue;
                    hb = b(),
                    hb.positionScreen.copy(v[0]).applyMatrix4(N);
                    for (var Bb = s.type === THREE.LinePieces ? 2 : 1, ab = 1, bb = v.length; bb > ab; ab++)
                        hb = b(),
                        hb.positionScreen.copy(v[ab]).applyMatrix4(N),
                        (ab + 1) % Bb > 0 || (ib = u[k - 2],
                        Q.copy(hb.positionScreen),
                        R.copy(ib.positionScreen),
                        g(Q, R) === !0 && (Q.multiplyScalar(1 / Q.w),
                        R.multiplyScalar(1 / R.w),
                        n = d(),
                        n.id = s.id,
                        n.v1.positionScreen.copy(Q),
                        n.v2.positionScreen.copy(R),
                        n.z = Math.max(Q.z, R.z),
                        n.material = s.material,
                        s.material.vertexColors === THREE.VertexColors && (n.vertexColors[0].copy(s.geometry.colors[ab]),
                        n.vertexColors[1].copy(s.geometry.colors[ab - 1])),
                        C.elements.push(n)))
                }
            } else if (s instanceof THREE.Sprite) {
                H.set(r.elements[12], r.elements[13], r.elements[14], 1),
                H.applyMatrix4(M);
                var Cb = 1 / H.w;
                H.z *= Cb,
                H.z >= -1 && H.z <= 1 && (p = e(),
                p.id = s.id,
                p.x = H.x * Cb,
                p.y = H.y * Cb,
                p.z = H.z,
                p.object = s,
                p.rotation = s.rotation,
                p.scale.x = s.scale.x * Math.abs(p.x - (H.x + h.projectionMatrix.elements[0]) / (H.w + h.projectionMatrix.elements[12])),
                p.scale.y = s.scale.y * Math.abs(p.y - (H.y + h.projectionMatrix.elements[5]) / (H.w + h.projectionMatrix.elements[13])),
                p.material = s.material,
                C.elements.push(p))
            }
        return j === !0 && C.elements.sort(f),
        C
    }
}
,
THREE.Face3 = function(a, b, c, d, e, f) {
    this.a = a,
    this.b = b,
    this.c = c,
    this.normal = d instanceof THREE.Vector3 ? d : new THREE.Vector3,
    this.vertexNormals = d instanceof Array ? d : [],
    this.color = e instanceof THREE.Color ? e : new THREE.Color,
    this.vertexColors = e instanceof Array ? e : [],
    this.vertexTangents = [],
    this.materialIndex = void 0 !== f ? f : 0,
    this.centroid = new THREE.Vector3
}
,
THREE.Face3.prototype = {
    constructor: THREE.Face3,
    clone: function() {
        var a = new THREE.Face3(this.a,this.b,this.c);
        a.normal.copy(this.normal),
        a.color.copy(this.color),
        a.centroid.copy(this.centroid),
        a.materialIndex = this.materialIndex;
        var b, c;
        for (b = 0,
        c = this.vertexNormals.length; c > b; b++)
            a.vertexNormals[b] = this.vertexNormals[b].clone();
        for (b = 0,
        c = this.vertexColors.length; c > b; b++)
            a.vertexColors[b] = this.vertexColors[b].clone();
        for (b = 0,
        c = this.vertexTangents.length; c > b; b++)
            a.vertexTangents[b] = this.vertexTangents[b].clone();
        return a
    }
},
THREE.Face4 = function(a, b, c, d, e, f, g) {
    return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),
    new THREE.Face3(a,b,c,e,f,g)
}
,
THREE.BufferGeometry = function() {
    this.id = THREE.GeometryIdCount++,
    this.uuid = THREE.Math.generateUUID(),
    this.name = "",
    this.attributes = {},
    this.offsets = [],
    this.boundingBox = null,
    this.boundingSphere = null
}
,
THREE.BufferGeometry.prototype = {
    constructor: THREE.BufferGeometry,
    addAttribute: function(a, b, c, d) {
        return this.attributes[a] = {
            array: new b(c * d),
            itemSize: d
        },
        this.attributes[a]
    },
    applyMatrix: function(a) {
        var b = this.attributes.position;
        void 0 !== b && (a.multiplyVector3Array(b.array),
        b.needsUpdate = !0);
        var c = this.attributes.normal;
        if (void 0 !== c) {
            var d = (new THREE.Matrix3).getNormalMatrix(a);
            d.multiplyVector3Array(c.array),
            c.needsUpdate = !0
        }
    },
    computeBoundingBox: function() {
        null === this.boundingBox && (this.boundingBox = new THREE.Box3);
        var a = this.attributes.position.array;
        if (a) {
            var b = this.boundingBox;
            a.length >= 3 && (b.min.x = b.max.x = a[0],
            b.min.y = b.max.y = a[1],
            b.min.z = b.max.z = a[2]);
            for (var c = 3, d = a.length; d > c; c += 3) {
                var e = a[c]
                  , f = a[c + 1]
                  , g = a[c + 2];
                e < b.min.x ? b.min.x = e : e > b.max.x && (b.max.x = e),
                f < b.min.y ? b.min.y = f : f > b.max.y && (b.max.y = f),
                g < b.min.z ? b.min.z = g : g > b.max.z && (b.max.z = g)
            }
        }
        (void 0 === a || 0 === a.length) && (this.boundingBox.min.set(0, 0, 0),
        this.boundingBox.max.set(0, 0, 0))
    },
    computeBoundingSphere: function() {
        var a = new THREE.Box3
          , b = new THREE.Vector3;
        return function() {
            null === this.boundingSphere && (this.boundingSphere = new THREE.Sphere);
            var c = this.attributes.position.array;
            if (c) {
                a.makeEmpty();
                for (var d = this.boundingSphere.center, e = 0, f = c.length; f > e; e += 3)
                    b.set(c[e], c[e + 1], c[e + 2]),
                    a.addPoint(b);
                a.center(d);
                for (var g = 0, e = 0, f = c.length; f > e; e += 3)
                    b.set(c[e], c[e + 1], c[e + 2]),
                    g = Math.max(g, d.distanceToSquared(b));
                this.boundingSphere.radius = Math.sqrt(g)
            }
        }
    }(),
    computeVertexNormals: function() {
        if (this.attributes.position) {
            var a, b, c, d, e = this.attributes.position.array.length;
            if (void 0 === this.attributes.normal)
                this.attributes.normal = {
                    itemSize: 3,
                    array: new Float32Array(e)
                };
            else
                for (a = 0,
                b = this.attributes.normal.array.length; b > a; a++)
                    this.attributes.normal.array[a] = 0;
            var f, g, h, i, j, k, l = this.attributes.position.array, m = this.attributes.normal.array, n = new THREE.Vector3, o = new THREE.Vector3, p = new THREE.Vector3, q = new THREE.Vector3, r = new THREE.Vector3;
            if (this.attributes.index) {
                var s = this.attributes.index.array
                  , t = this.offsets;
                for (c = 0,
                d = t.length; d > c; ++c) {
                    var u = t[c].start
                      , v = t[c].count
                      , w = t[c].index;
                    for (a = u,
                    b = u + v; b > a; a += 3)
                        f = w + s[a],
                        g = w + s[a + 1],
                        h = w + s[a + 2],
                        i = l[3 * f],
                        j = l[3 * f + 1],
                        k = l[3 * f + 2],
                        n.set(i, j, k),
                        i = l[3 * g],
                        j = l[3 * g + 1],
                        k = l[3 * g + 2],
                        o.set(i, j, k),
                        i = l[3 * h],
                        j = l[3 * h + 1],
                        k = l[3 * h + 2],
                        p.set(i, j, k),
                        q.subVectors(p, o),
                        r.subVectors(n, o),
                        q.cross(r),
                        m[3 * f] += q.x,
                        m[3 * f + 1] += q.y,
                        m[3 * f + 2] += q.z,
                        m[3 * g] += q.x,
                        m[3 * g + 1] += q.y,
                        m[3 * g + 2] += q.z,
                        m[3 * h] += q.x,
                        m[3 * h + 1] += q.y,
                        m[3 * h + 2] += q.z
                }
            } else
                for (a = 0,
                b = l.length; b > a; a += 9)
                    i = l[a],
                    j = l[a + 1],
                    k = l[a + 2],
                    n.set(i, j, k),
                    i = l[a + 3],
                    j = l[a + 4],
                    k = l[a + 5],
                    o.set(i, j, k),
                    i = l[a + 6],
                    j = l[a + 7],
                    k = l[a + 8],
                    p.set(i, j, k),
                    q.subVectors(p, o),
                    r.subVectors(n, o),
                    q.cross(r),
                    m[a] = q.x,
                    m[a + 1] = q.y,
                    m[a + 2] = q.z,
                    m[a + 3] = q.x,
                    m[a + 4] = q.y,
                    m[a + 5] = q.z,
                    m[a + 6] = q.x,
                    m[a + 7] = q.y,
                    m[a + 8] = q.z;
            this.normalizeNormals(),
            this.normalsNeedUpdate = !0
        }
    },
    normalizeNormals: function() {
        for (var a, b, c, d, e = this.attributes.normal.array, f = 0, g = e.length; g > f; f += 3)
            a = e[f],
            b = e[f + 1],
            c = e[f + 2],
            d = 1 / Math.sqrt(a * a + b * b + c * c),
            e[f] *= d,
            e[f + 1] *= d,
            e[f + 2] *= d
    },
    computeTangents: function() {
        function a(a, b, c) {
            m = d[3 * a],
            n = d[3 * a + 1],
            o = d[3 * a + 2],
            p = d[3 * b],
            q = d[3 * b + 1],
            r = d[3 * b + 2],
            s = d[3 * c],
            t = d[3 * c + 1],
            u = d[3 * c + 2],
            v = f[2 * a],
            w = f[2 * a + 1],
            x = f[2 * b],
            y = f[2 * b + 1],
            z = f[2 * c],
            A = f[2 * c + 1],
            B = p - m,
            C = s - m,
            D = q - n,
            E = t - n,
            F = r - o,
            G = u - o,
            H = x - v,
            I = z - v,
            J = y - w,
            K = A - w,
            L = 1 / (H * K - I * J),
            T.set((K * B - J * C) * L, (K * D - J * E) * L, (K * F - J * G) * L),
            U.set((H * C - I * B) * L, (H * E - I * D) * L, (H * G - I * F) * L),
            j[a].add(T),
            j[b].add(T),
            j[c].add(T),
            k[a].add(U),
            k[b].add(U),
            k[c].add(U)
        }
        function b(a) {
            cb.x = e[3 * a],
            cb.y = e[3 * a + 1],
            cb.z = e[3 * a + 2],
            db.copy(cb),
            $ = j[a],
            ab.copy($),
            ab.sub(cb.multiplyScalar(cb.dot($))).normalize(),
            bb.crossVectors(db, $),
            _ = bb.dot(k[a]),
            Z = 0 > _ ? -1 : 1,
            i[4 * a] = ab.x,
            i[4 * a + 1] = ab.y,
            i[4 * a + 2] = ab.z,
            i[4 * a + 3] = Z
        }
        if (void 0 === this.attributes.index || void 0 === this.attributes.position || void 0 === this.attributes.normal || void 0 === this.attributes.uv)
            return console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()"),
            void 0;
        var c = this.attributes.index.array
          , d = this.attributes.position.array
          , e = this.attributes.normal.array
          , f = this.attributes.uv.array
          , g = d.length / 3;
        if (void 0 === this.attributes.tangent) {
            var h = 4 * g;
            this.attributes.tangent = {
                itemSize: 4,
                array: new Float32Array(h)
            }
        }
        for (var i = this.attributes.tangent.array, j = [], k = [], l = 0; g > l; l++)
            j[l] = new THREE.Vector3,
            k[l] = new THREE.Vector3;
        var m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T = new THREE.Vector3, U = new THREE.Vector3, V = this.offsets;
        for (O = 0,
        P = V.length; P > O; ++O) {
            var W = V[O].start
              , X = V[O].count
              , Y = V[O].index;
            for (M = W,
            N = W + X; N > M; M += 3)
                Q = Y + c[M],
                R = Y + c[M + 1],
                S = Y + c[M + 2],
                a(Q, R, S)
        }
        var Z, $, _, ab = new THREE.Vector3, bb = new THREE.Vector3, cb = new THREE.Vector3, db = new THREE.Vector3;
        for (O = 0,
        P = V.length; P > O; ++O) {
            var W = V[O].start
              , X = V[O].count
              , Y = V[O].index;
            for (M = W,
            N = W + X; N > M; M += 3)
                Q = Y + c[M],
                R = Y + c[M + 1],
                S = Y + c[M + 2],
                b(Q),
                b(R),
                b(S)
        }
    },
    computeOffsets: function(a) {
        var b = a;
        void 0 === a && (b = 65535);
        for (var c = (Date.now(),
        this.attributes.index.array), d = this.attributes.position.array, e = (d.length / 3,
        c.length / 3), f = new Uint16Array(c.length), g = 0, h = 0, i = [{
            start: 0,
            count: 0,
            index: 0
        }], j = i[0], k = 0, l = 0, m = new Int32Array(6), n = new Int32Array(d.length), o = new Int32Array(d.length), p = 0; p < d.length; p++)
            n[p] = -1,
            o[p] = -1;
        for (var q = 0; e > q; q++) {
            l = 0;
            for (var r = 0; 3 > r; r++) {
                var s = c[3 * q + r];
                -1 == n[s] ? (m[2 * r] = s,
                m[2 * r + 1] = -1,
                l++) : n[s] < j.index ? (m[2 * r] = s,
                m[2 * r + 1] = -1,
                k++) : (m[2 * r] = s,
                m[2 * r + 1] = n[s])
            }
            var t = h + l;
            if (t > j.index + b) {
                var u = {
                    start: g,
                    count: 0,
                    index: h
                };
                i.push(u),
                j = u;
                for (var v = 0; 6 > v; v += 2) {
                    var w = m[v + 1];
                    w > -1 && w < j.index && (m[v + 1] = -1)
                }
            }
            for (var v = 0; 6 > v; v += 2) {
                var s = m[v]
                  , w = m[v + 1];
                -1 === w && (w = h++),
                n[s] = w,
                o[w] = s,
                f[g++] = w - j.index,
                j.count++
            }
        }
        return this.reorderBuffers(f, o, h),
        this.offsets = i,
        i
    },
    reorderBuffers: function(a, b, c) {
        var d = {}
          , e = [Int8Array, Uint8Array, Uint8ClampedArray, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array, Float64Array];
        for (var f in this.attributes)
            if ("index" != f)
                for (var g = this.attributes[f].array, h = 0, i = e.length; i > h; h++) {
                    var j = e[h];
                    if (g instanceof j) {
                        d[f] = new j(this.attributes[f].itemSize * c);
                        break
                    }
                }
        for (var k = 0; c > k; k++) {
            var l = b[k];
            for (var f in this.attributes)
                if ("index" != f)
                    for (var m = this.attributes[f].array, n = this.attributes[f].itemSize, o = d[f], p = 0; n > p; p++)
                        o[k * n + p] = m[l * n + p]
        }
        this.attributes.index.array = a;
        for (var f in this.attributes)
            "index" != f && (this.attributes[f].array = d[f],
            this.attributes[f].numItems = this.attributes[f].itemSize * c)
    },
    clone: function() {
        var a = new THREE.BufferGeometry
          , b = [Int8Array, Uint8Array, Uint8ClampedArray, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array, Float64Array];
        for (var c in this.attributes) {
            for (var d = this.attributes[c], e = d.array, f = {
                itemSize: d.itemSize,
                array: null
            }, g = 0, h = b.length; h > g; g++) {
                var i = b[g];
                if (e instanceof i) {
                    f.array = new i(e);
                    break
                }
            }
            a.attributes[c] = f
        }
        for (var g = 0, h = this.offsets.length; h > g; g++) {
            var j = this.offsets[g];
            a.offsets.push({
                start: j.start,
                index: j.index,
                count: j.count
            })
        }
        return a
    },
    dispose: function() {
        this.dispatchEvent({
            type: "dispose"
        })
    }
},
THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),
THREE.Geometry = function() {
    this.id = THREE.GeometryIdCount++,
    this.uuid = THREE.Math.generateUUID(),
    this.name = "",
    this.vertices = [],
    this.colors = [],
    this.faces = [],
    this.faceVertexUvs = [[]],
    this.morphTargets = [],
    this.morphColors = [],
    this.morphNormals = [],
    this.skinWeights = [],
    this.skinIndices = [],
    this.lineDistances = [],
    this.boundingBox = null,
    this.boundingSphere = null,
    this.hasTangents = !1,
    this.dynamic = !0,
    this.verticesNeedUpdate = !1,
    this.elementsNeedUpdate = !1,
    this.uvsNeedUpdate = !1,
    this.normalsNeedUpdate = !1,
    this.tangentsNeedUpdate = !1,
    this.colorsNeedUpdate = !1,
    this.lineDistancesNeedUpdate = !1,
    this.buffersNeedUpdate = !1
}
,
THREE.Geometry.prototype = {
    constructor: THREE.Geometry,
    applyMatrix: function(a) {
        for (var b = (new THREE.Matrix3).getNormalMatrix(a), c = 0, d = this.vertices.length; d > c; c++) {
            var e = this.vertices[c];
            e.applyMatrix4(a)
        }
        for (var c = 0, d = this.faces.length; d > c; c++) {
            var f = this.faces[c];
            f.normal.applyMatrix3(b).normalize();
            for (var g = 0, h = f.vertexNormals.length; h > g; g++)
                f.vertexNormals[g].applyMatrix3(b).normalize();
            f.centroid.applyMatrix4(a)
        }
        this.boundingBox instanceof THREE.Box3 && this.computeBoundingBox(),
        this.boundingSphere instanceof THREE.Sphere && this.computeBoundingSphere()
    },
    computeCentroids: function() {
        var a, b, c;
        for (a = 0,
        b = this.faces.length; b > a; a++)
            c = this.faces[a],
            c.centroid.set(0, 0, 0),
            c.centroid.add(this.vertices[c.a]),
            c.centroid.add(this.vertices[c.b]),
            c.centroid.add(this.vertices[c.c]),
            c.centroid.divideScalar(3)
    },
    computeFaceNormals: function() {
        for (var a = new THREE.Vector3, b = new THREE.Vector3, c = 0, d = this.faces.length; d > c; c++) {
            var e = this.faces[c]
              , f = this.vertices[e.a]
              , g = this.vertices[e.b]
              , h = this.vertices[e.c];
            a.subVectors(h, g),
            b.subVectors(f, g),
            a.cross(b),
            a.normalize(),
            e.normal.copy(a)
        }
    },
    computeVertexNormals: function(a) {
        var b, c, d, e, f, g;
        for (g = new Array(this.vertices.length),
        b = 0,
        c = this.vertices.length; c > b; b++)
            g[b] = new THREE.Vector3;
        if (a) {
            {
                var h, i, j, k = new THREE.Vector3, l = new THREE.Vector3;
                new THREE.Vector3,
                new THREE.Vector3,
                new THREE.Vector3
            }
            for (d = 0,
            e = this.faces.length; e > d; d++)
                f = this.faces[d],
                h = this.vertices[f.a],
                i = this.vertices[f.b],
                j = this.vertices[f.c],
                k.subVectors(j, i),
                l.subVectors(h, i),
                k.cross(l),
                g[f.a].add(k),
                g[f.b].add(k),
                g[f.c].add(k)
        } else
            for (d = 0,
            e = this.faces.length; e > d; d++)
                f = this.faces[d],
                g[f.a].add(f.normal),
                g[f.b].add(f.normal),
                g[f.c].add(f.normal);
        for (b = 0,
        c = this.vertices.length; c > b; b++)
            g[b].normalize();
        for (d = 0,
        e = this.faces.length; e > d; d++)
            f = this.faces[d],
            f.vertexNormals[0] = g[f.a].clone(),
            f.vertexNormals[1] = g[f.b].clone(),
            f.vertexNormals[2] = g[f.c].clone()
    },
    computeMorphNormals: function() {
        var a, b, c, d, e;
        for (c = 0,
        d = this.faces.length; d > c; c++)
            for (e = this.faces[c],
            e.__originalFaceNormal ? e.__originalFaceNormal.copy(e.normal) : e.__originalFaceNormal = e.normal.clone(),
            e.__originalVertexNormals || (e.__originalVertexNormals = []),
            a = 0,
            b = e.vertexNormals.length; b > a; a++)
                e.__originalVertexNormals[a] ? e.__originalVertexNormals[a].copy(e.vertexNormals[a]) : e.__originalVertexNormals[a] = e.vertexNormals[a].clone();
        var f = new THREE.Geometry;
        for (f.faces = this.faces,
        a = 0,
        b = this.morphTargets.length; b > a; a++) {
            if (!this.morphNormals[a]) {
                this.morphNormals[a] = {},
                this.morphNormals[a].faceNormals = [],
                this.morphNormals[a].vertexNormals = [];
                var g, h, i = this.morphNormals[a].faceNormals, j = this.morphNormals[a].vertexNormals;
                for (c = 0,
                d = this.faces.length; d > c; c++)
                    e = this.faces[c],
                    g = new THREE.Vector3,
                    h = {
                        a: new THREE.Vector3,
                        b: new THREE.Vector3,
                        c: new THREE.Vector3
                    },
                    i.push(g),
                    j.push(h)
            }
            var k = this.morphNormals[a];
            f.vertices = this.morphTargets[a].vertices,
            f.computeFaceNormals(),
            f.computeVertexNormals();
            var g, h;
            for (c = 0,
            d = this.faces.length; d > c; c++)
                e = this.faces[c],
                g = k.faceNormals[c],
                h = k.vertexNormals[c],
                g.copy(e.normal),
                h.a.copy(e.vertexNormals[0]),
                h.b.copy(e.vertexNormals[1]),
                h.c.copy(e.vertexNormals[2])
        }
        for (c = 0,
        d = this.faces.length; d > c; c++)
            e = this.faces[c],
            e.normal = e.__originalFaceNormal,
            e.vertexNormals = e.__originalVertexNormals
    },
    computeTangents: function() {
        function a(a, b, c, d, e, f, g) {
            j = a.vertices[b],
            k = a.vertices[c],
            l = a.vertices[d],
            m = i[e],
            n = i[f],
            o = i[g],
            p = k.x - j.x,
            q = l.x - j.x,
            r = k.y - j.y,
            s = l.y - j.y,
            t = k.z - j.z,
            u = l.z - j.z,
            v = n.x - m.x,
            w = o.x - m.x,
            x = n.y - m.y,
            y = o.y - m.y,
            z = 1 / (v * y - w * x),
            F.set((y * p - x * q) * z, (y * r - x * s) * z, (y * t - x * u) * z),
            G.set((v * q - w * p) * z, (v * s - w * r) * z, (v * u - w * t) * z),
            D[b].add(F),
            D[c].add(F),
            D[d].add(F),
            E[b].add(G),
            E[c].add(G),
            E[d].add(G)
        }
        var b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D = [], E = [], F = new THREE.Vector3, G = new THREE.Vector3, H = new THREE.Vector3, I = new THREE.Vector3, J = new THREE.Vector3;
        for (d = 0,
        e = this.vertices.length; e > d; d++)
            D[d] = new THREE.Vector3,
            E[d] = new THREE.Vector3;
        for (b = 0,
        c = this.faces.length; c > b; b++)
            h = this.faces[b],
            i = this.faceVertexUvs[0][b],
            a(this, h.a, h.b, h.c, 0, 1, 2);
        var K = ["a", "b", "c", "d"];
        for (b = 0,
        c = this.faces.length; c > b; b++)
            for (h = this.faces[b],
            f = 0; f < Math.min(h.vertexNormals.length, 3); f++)
                J.copy(h.vertexNormals[f]),
                g = h[K[f]],
                A = D[g],
                H.copy(A),
                H.sub(J.multiplyScalar(J.dot(A))).normalize(),
                I.crossVectors(h.vertexNormals[f], A),
                B = I.dot(E[g]),
                C = 0 > B ? -1 : 1,
                h.vertexTangents[f] = new THREE.Vector4(H.x,H.y,H.z,C);
        this.hasTangents = !0
    },
    computeLineDistances: function() {
        for (var a = 0, b = this.vertices, c = 0, d = b.length; d > c; c++)
            c > 0 && (a += b[c].distanceTo(b[c - 1])),
            this.lineDistances[c] = a
    },
    computeBoundingBox: function() {
        null === this.boundingBox && (this.boundingBox = new THREE.Box3),
        this.boundingBox.setFromPoints(this.vertices)
    },
    computeBoundingSphere: function() {
        null === this.boundingSphere && (this.boundingSphere = new THREE.Sphere),
        this.boundingSphere.setFromPoints(this.vertices)
    },
    mergeVertices: function() {
        var a, b, c, d, e, f, g, h, i = {}, j = [], k = [], l = 4, m = Math.pow(10, l);
        for (c = 0,
        d = this.vertices.length; d > c; c++)
            a = this.vertices[c],
            b = Math.round(a.x * m) + "_" + Math.round(a.y * m) + "_" + Math.round(a.z * m),
            void 0 === i[b] ? (i[b] = c,
            j.push(this.vertices[c]),
            k[c] = j.length - 1) : k[c] = k[i[b]];
        var n = [];
        for (c = 0,
        d = this.faces.length; d > c; c++) {
            e = this.faces[c],
            e.a = k[e.a],
            e.b = k[e.b],
            e.c = k[e.c],
            f = [e.a, e.b, e.c];
            for (var o = -1, p = 0; 3 > p; p++)
                if (f[p] == f[(p + 1) % 3]) {
                    o = p,
                    n.push(c);
                    break
                }
        }
        for (c = n.length - 1; c >= 0; c--) {
            var q = n[c];
            for (this.faces.splice(q, 1),
            g = 0,
            h = this.faceVertexUvs.length; h > g; g++)
                this.faceVertexUvs[g].splice(q, 1)
        }
        var r = this.vertices.length - j.length;
        return this.vertices = j,
        r
    },
    makeGroups: function() {
        var a = 0;
        return function(b) {
            var c, d, e, f, g, h = {}, i = this.morphTargets.length, j = this.morphNormals.length;
            for (this.geometryGroups = {},
            c = 0,
            d = this.faces.length; d > c; c++)
                e = this.faces[c],
                f = b ? e.materialIndex : 0,
                f in h || (h[f] = {
                    hash: f,
                    counter: 0
                }),
                g = h[f].hash + "_" + h[f].counter,
                g in this.geometryGroups || (this.geometryGroups[g] = {
                    faces3: [],
                    materialIndex: f,
                    vertices: 0,
                    numMorphTargets: i,
                    numMorphNormals: j
                }),
                this.geometryGroups[g].vertices + 3 > 65535 && (h[f].counter += 1,
                g = h[f].hash + "_" + h[f].counter,
                g in this.geometryGroups || (this.geometryGroups[g] = {
                    faces3: [],
                    materialIndex: f,
                    vertices: 0,
                    numMorphTargets: i,
                    numMorphNormals: j
                })),
                this.geometryGroups[g].faces3.push(c),
                this.geometryGroups[g].vertices += 3;
            this.geometryGroupsList = [];
            for (var k in this.geometryGroups)
                this.geometryGroups[k].id = a++,
                this.geometryGroupsList.push(this.geometryGroups[k])
        }
    }(),
    clone: function() {
        for (var a = new THREE.Geometry, b = this.vertices, c = 0, d = b.length; d > c; c++)
            a.vertices.push(b[c].clone());
        for (var e = this.faces, c = 0, d = e.length; d > c; c++)
            a.faces.push(e[c].clone());
        for (var f = this.faceVertexUvs[0], c = 0, d = f.length; d > c; c++) {
            for (var g = f[c], h = [], i = 0, j = g.length; j > i; i++)
                h.push(new THREE.Vector2(g[i].x,g[i].y));
            a.faceVertexUvs[0].push(h)
        }
        return a
    },
    dispose: function() {
        this.dispatchEvent({
            type: "dispose"
        })
    }
},
THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),
THREE.GeometryIdCount = 0,
THREE.Geometry2 = function(a) {
    THREE.BufferGeometry.call(this),
    this.vertices = this.addAttribute("position", Float32Array, a, 3).array,
    this.normals = this.addAttribute("normal", Float32Array, a, 3).array,
    this.uvs = this.addAttribute("uv", Float32Array, a, 2).array,
    this.boundingBox = null,
    this.boundingSphere = null
}
,
THREE.Geometry2.prototype = Object.create(THREE.BufferGeometry.prototype),
THREE.Camera = function() {
    THREE.Object3D.call(this),
    this.matrixWorldInverse = new THREE.Matrix4,
    this.projectionMatrix = new THREE.Matrix4
}
,
THREE.Camera.prototype = Object.create(THREE.Object3D.prototype),
THREE.Camera.prototype.lookAt = function() {
    var a = new THREE.Matrix4;
    return function(b) {
        a.lookAt(this.position, b, this.up),
        this.quaternion.setFromRotationMatrix(a)
    }
}(),
THREE.Camera.prototype.clone = function(a) {
    return void 0 === a && (a = new THREE.Camera),
    THREE.Object3D.prototype.clone.call(this, a),
    a.matrixWorldInverse.copy(this.matrixWorldInverse),
    a.projectionMatrix.copy(this.projectionMatrix),
    a
}
,
THREE.OrthographicCamera = function(a, b, c, d, e, f) {
    THREE.Camera.call(this),
    this.left = a,
    this.right = b,
    this.top = c,
    this.bottom = d,
    this.near = void 0 !== e ? e : .1,
    this.far = void 0 !== f ? f : 2e3,
    this.updateProjectionMatrix()
}
,
THREE.OrthographicCamera.prototype = Object.create(THREE.Camera.prototype),
THREE.OrthographicCamera.prototype.updateProjectionMatrix = function() {
    this.projectionMatrix.makeOrthographic(this.left, this.right, this.top, this.bottom, this.near, this.far)
}
,
THREE.OrthographicCamera.prototype.clone = function() {
    var a = new THREE.OrthographicCamera;
    return THREE.Camera.prototype.clone.call(this, a),
    a.left = this.left,
    a.right = this.right,
    a.top = this.top,
    a.bottom = this.bottom,
    a.near = this.near,
    a.far = this.far,
    a
}
,
THREE.PerspectiveCamera = function(a, b, c, d) {
    THREE.Camera.call(this),
    this.fov = void 0 !== a ? a : 50,
    this.aspect = void 0 !== b ? b : 1,
    this.near = void 0 !== c ? c : .1,
    this.far = void 0 !== d ? d : 2e3,
    this.updateProjectionMatrix()
}
,
THREE.PerspectiveCamera.prototype = Object.create(THREE.Camera.prototype),
THREE.PerspectiveCamera.prototype.setLens = function(a, b) {
    void 0 === b && (b = 24),
    this.fov = 2 * THREE.Math.radToDeg(Math.atan(b / (2 * a))),
    this.updateProjectionMatrix()
}
,
THREE.PerspectiveCamera.prototype.setViewOffset = function(a, b, c, d, e, f) {
    this.fullWidth = a,
    this.fullHeight = b,
    this.x = c,
    this.y = d,
    this.width = e,
    this.height = f,
    this.updateProjectionMatrix()
}
,
THREE.PerspectiveCamera.prototype.updateProjectionMatrix = function() {
    if (this.fullWidth) {
        var a = this.fullWidth / this.fullHeight
          , b = Math.tan(THREE.Math.degToRad(.5 * this.fov)) * this.near
          , c = -b
          , d = a * c
          , e = a * b
          , f = Math.abs(e - d)
          , g = Math.abs(b - c);
        this.projectionMatrix.makeFrustum(d + this.x * f / this.fullWidth, d + (this.x + this.width) * f / this.fullWidth, b - (this.y + this.height) * g / this.fullHeight, b - this.y * g / this.fullHeight, this.near, this.far)
    } else
        this.projectionMatrix.makePerspective(this.fov, this.aspect, this.near, this.far)
}
,
THREE.PerspectiveCamera.prototype.clone = function() {
    var a = new THREE.PerspectiveCamera;
    return THREE.Camera.prototype.clone.call(this, a),
    a.fov = this.fov,
    a.aspect = this.aspect,
    a.near = this.near,
    a.far = this.far,
    a
}
,
THREE.Light = function(a) {
    THREE.Object3D.call(this),
    this.color = new THREE.Color(a)
}
,
THREE.Light.prototype = Object.create(THREE.Object3D.prototype),
THREE.Light.prototype.clone = function(a) {
    return void 0 === a && (a = new THREE.Light),
    THREE.Object3D.prototype.clone.call(this, a),
    a.color.copy(this.color),
    a
}
,
THREE.AmbientLight = function(a) {
    THREE.Light.call(this, a)
}
,
THREE.AmbientLight.prototype = Object.create(THREE.Light.prototype),
THREE.AmbientLight.prototype.clone = function() {
    var a = new THREE.AmbientLight;
    return THREE.Light.prototype.clone.call(this, a),
    a
}
,
THREE.AreaLight = function(a, b) {
    THREE.Light.call(this, a),
    this.normal = new THREE.Vector3(0,-1,0),
    this.right = new THREE.Vector3(1,0,0),
    this.intensity = void 0 !== b ? b : 1,
    this.width = 1,
    this.height = 1,
    this.constantAttenuation = 1.5,
    this.linearAttenuation = .5,
    this.quadraticAttenuation = .1
}
,
THREE.AreaLight.prototype = Object.create(THREE.Light.prototype),
THREE.DirectionalLight = function(a, b) {
    THREE.Light.call(this, a),
    this.position.set(0, 1, 0),
    this.target = new THREE.Object3D,
    this.intensity = void 0 !== b ? b : 1,
    this.castShadow = !1,
    this.onlyShadow = !1,
    this.shadowCameraNear = 50,
    this.shadowCameraFar = 5e3,
    this.shadowCameraLeft = -500,
    this.shadowCameraRight = 500,
    this.shadowCameraTop = 500,
    this.shadowCameraBottom = -500,
    this.shadowCameraVisible = !1,
    this.shadowBias = 0,
    this.shadowDarkness = .5,
    this.shadowMapWidth = 512,
    this.shadowMapHeight = 512,
    this.shadowCascade = !1,
    this.shadowCascadeOffset = new THREE.Vector3(0,0,-1e3),
    this.shadowCascadeCount = 2,
    this.shadowCascadeBias = [0, 0, 0],
    this.shadowCascadeWidth = [512, 512, 512],
    this.shadowCascadeHeight = [512, 512, 512],
    this.shadowCascadeNearZ = [-1, .99, .998],
    this.shadowCascadeFarZ = [.99, .998, 1],
    this.shadowCascadeArray = [],
    this.shadowMap = null,
    this.shadowMapSize = null,
    this.shadowCamera = null,
    this.shadowMatrix = null
}
,
THREE.DirectionalLight.prototype = Object.create(THREE.Light.prototype),
THREE.DirectionalLight.prototype.clone = function() {
    var a = new THREE.DirectionalLight;
    return THREE.Light.prototype.clone.call(this, a),
    a.target = this.target.clone(),
    a.intensity = this.intensity,
    a.castShadow = this.castShadow,
    a.onlyShadow = this.onlyShadow,
    a
}
,
THREE.HemisphereLight = function(a, b, c) {
    THREE.Light.call(this, a),
    this.position.set(0, 100, 0),
    this.groundColor = new THREE.Color(b),
    this.intensity = void 0 !== c ? c : 1
}
,
THREE.HemisphereLight.prototype = Object.create(THREE.Light.prototype),
THREE.HemisphereLight.prototype.clone = function() {
    var a = new THREE.HemisphereLight;
    return THREE.Light.prototype.clone.call(this, a),
    a.groundColor.copy(this.groundColor),
    a.intensity = this.intensity,
    a
}
,
THREE.PointLight = function(a, b, c) {
    THREE.Light.call(this, a),
    this.intensity = void 0 !== b ? b : 1,
    this.distance = void 0 !== c ? c : 0
}
,
THREE.PointLight.prototype = Object.create(THREE.Light.prototype),
THREE.PointLight.prototype.clone = function() {
    var a = new THREE.PointLight;
    return THREE.Light.prototype.clone.call(this, a),
    a.intensity = this.intensity,
    a.distance = this.distance,
    a
}
,
THREE.SpotLight = function(a, b, c, d, e) {
    THREE.Light.call(this, a),
    this.position.set(0, 1, 0),
    this.target = new THREE.Object3D,
    this.intensity = void 0 !== b ? b : 1,
    this.distance = void 0 !== c ? c : 0,
    this.angle = void 0 !== d ? d : Math.PI / 3,
    this.exponent = void 0 !== e ? e : 10,
    this.castShadow = !1,
    this.onlyShadow = !1,
    this.shadowCameraNear = 50,
    this.shadowCameraFar = 5e3,
    this.shadowCameraFov = 50,
    this.shadowCameraVisible = !1,
    this.shadowBias = 0,
    this.shadowDarkness = .5,
    this.shadowMapWidth = 512,
    this.shadowMapHeight = 512,
    this.shadowMap = null,
    this.shadowMapSize = null,
    this.shadowCamera = null,
    this.shadowMatrix = null
}
,
THREE.SpotLight.prototype = Object.create(THREE.Light.prototype),
THREE.SpotLight.prototype.clone = function() {
    var a = new THREE.SpotLight;
    return THREE.Light.prototype.clone.call(this, a),
    a.target = this.target.clone(),
    a.intensity = this.intensity,
    a.distance = this.distance,
    a.angle = this.angle,
    a.exponent = this.exponent,
    a.castShadow = this.castShadow,
    a.onlyShadow = this.onlyShadow,
    a
}
,
THREE.Loader = function(a) {
    this.showStatus = a,
    this.statusDomElement = a ? THREE.Loader.prototype.addStatusElement() : null,
    this.onLoadStart = function() {}
    ,
    this.onLoadProgress = function() {}
    ,
    this.onLoadComplete = function() {}
}
,
THREE.Loader.prototype = {
    constructor: THREE.Loader,
    crossOrigin: void 0,
    addStatusElement: function() {
        var a = document.createElement("div");
        return a.style.position = "absolute",
        a.style.right = "0px",
        a.style.top = "0px",
        a.style.fontSize = "0.8em",
        a.style.textAlign = "left",
        a.style.background = "rgba(0,0,0,0.25)",
        a.style.color = "#fff",
        a.style.width = "120px",
        a.style.padding = "0.5em 0.5em 0.5em 0.5em",
        a.style.zIndex = 1e3,
        a.innerHTML = "Loading ...",
        a
    },
    updateProgress: function(a) {
        var b = "Loaded ";
        b += a.total ? (100 * a.loaded / a.total).toFixed(0) + "%" : (a.loaded / 1e3).toFixed(2) + " KB",
        this.statusDomElement.innerHTML = b
    },
    extractUrlBase: function(a) {
        var b = a.split("/");
        return 1 === b.length ? "./" : (b.pop(),
        b.join("/") + "/")
    },
    initMaterials: function(a, b) {
        for (var c = [], d = 0; d < a.length; ++d)
            c[d] = THREE.Loader.prototype.createMaterial(a[d], b);
        return c
    },
    needsTangents: function(a) {
        for (var b = 0, c = a.length; c > b; b++) {
            var d = a[b];
            if (d instanceof THREE.ShaderMaterial)
                return !0
        }
        return !1
    },
    createMaterial: function(a, b) {
        function c(a) {
            var b = Math.log(a) / Math.LN2;
            return Math.floor(b) == b
        }
        function d(a) {
            var b = Math.log(a) / Math.LN2;
            return Math.pow(2, Math.round(b))
        }
        function e(a, b) {
            var e = new Image;
            e.onload = function() {
                if (c(this.width) && c(this.height))
                    a.image = this;
                else {
                    var b = d(this.width)
                      , e = d(this.height);
                    a.image.width = b,
                    a.image.height = e,
                    a.image.getContext("2d").drawImage(this, 0, 0, b, e)
                }
                a.needsUpdate = !0
            }
            ,
            void 0 !== h.crossOrigin && (e.crossOrigin = h.crossOrigin),
            e.src = b
        }
        function f(a, c, d, f, g, h, i) {
            var j = /\.dds$/i.test(d)
              , k = b + d;
            if (j) {
                var l = THREE.ImageUtils.loadCompressedTexture(k);
                a[c] = l
            } else {
                var l = document.createElement("canvas");
                a[c] = new THREE.Texture(l)
            }
            if (a[c].sourceFile = d,
            f && (a[c].repeat.set(f[0], f[1]),
            1 !== f[0] && (a[c].wrapS = THREE.RepeatWrapping),
            1 !== f[1] && (a[c].wrapT = THREE.RepeatWrapping)),
            g && a[c].offset.set(g[0], g[1]),
            h) {
                var m = {
                    repeat: THREE.RepeatWrapping,
                    mirror: THREE.MirroredRepeatWrapping
                };
                void 0 !== m[h[0]] && (a[c].wrapS = m[h[0]]),
                void 0 !== m[h[1]] && (a[c].wrapT = m[h[1]])
            }
            i && (a[c].anisotropy = i),
            j || e(a[c], k)
        }
        function g(a) {
            return (255 * a[0] << 16) + (255 * a[1] << 8) + 255 * a[2]
        }
        var h = this
          , i = "MeshLambertMaterial"
          , j = {
            color: 15658734,
            opacity: 1,
            map: null,
            lightMap: null,
            normalMap: null,
            bumpMap: null,
            wireframe: !1
        };
        if (a.shading) {
            var k = a.shading.toLowerCase();
            "phong" === k ? i = "MeshPhongMaterial" : "basic" === k && (i = "MeshBasicMaterial")
        }
        if (void 0 !== a.blending && void 0 !== THREE[a.blending] && (j.blending = THREE[a.blending]),
        (void 0 !== a.transparent || a.opacity < 1) && (j.transparent = a.transparent),
        void 0 !== a.depthTest && (j.depthTest = a.depthTest),
        void 0 !== a.depthWrite && (j.depthWrite = a.depthWrite),
        void 0 !== a.visible && (j.visible = a.visible),
        void 0 !== a.flipSided && (j.side = THREE.BackSide),
        void 0 !== a.doubleSided && (j.side = THREE.DoubleSide),
        void 0 !== a.wireframe && (j.wireframe = a.wireframe),
        void 0 !== a.vertexColors && ("face" === a.vertexColors ? j.vertexColors = THREE.FaceColors : a.vertexColors && (j.vertexColors = THREE.VertexColors)),
        a.colorDiffuse ? j.color = g(a.colorDiffuse) : a.DbgColor && (j.color = a.DbgColor),
        a.colorSpecular && (j.specular = g(a.colorSpecular)),
        a.colorAmbient && (j.ambient = g(a.colorAmbient)),
        a.transparency && (j.opacity = a.transparency),
        a.specularCoef && (j.shininess = a.specularCoef),
        a.mapDiffuse && b && f(j, "map", a.mapDiffuse, a.mapDiffuseRepeat, a.mapDiffuseOffset, a.mapDiffuseWrap, a.mapDiffuseAnisotropy),
        a.mapLight && b && f(j, "lightMap", a.mapLight, a.mapLightRepeat, a.mapLightOffset, a.mapLightWrap, a.mapLightAnisotropy),
        a.mapBump && b && f(j, "bumpMap", a.mapBump, a.mapBumpRepeat, a.mapBumpOffset, a.mapBumpWrap, a.mapBumpAnisotropy),
        a.mapNormal && b && f(j, "normalMap", a.mapNormal, a.mapNormalRepeat, a.mapNormalOffset, a.mapNormalWrap, a.mapNormalAnisotropy),
        a.mapSpecular && b && f(j, "specularMap", a.mapSpecular, a.mapSpecularRepeat, a.mapSpecularOffset, a.mapSpecularWrap, a.mapSpecularAnisotropy),
        a.mapBumpScale && (j.bumpScale = a.mapBumpScale),
        a.mapNormal) {
            var l = THREE.ShaderLib.normalmap
              , m = THREE.UniformsUtils.clone(l.uniforms);
            m.tNormal.value = j.normalMap,
            a.mapNormalFactor && m.uNormalScale.value.set(a.mapNormalFactor, a.mapNormalFactor),
            j.map && (m.tDiffuse.value = j.map,
            m.enableDiffuse.value = !0),
            j.specularMap && (m.tSpecular.value = j.specularMap,
            m.enableSpecular.value = !0),
            j.lightMap && (m.tAO.value = j.lightMap,
            m.enableAO.value = !0),
            m.diffuse.value.setHex(j.color),
            m.specular.value.setHex(j.specular),
            m.ambient.value.setHex(j.ambient),
            m.shininess.value = j.shininess,
            void 0 !== j.opacity && (m.opacity.value = j.opacity);
            var n = {
                fragmentShader: l.fragmentShader,
                vertexShader: l.vertexShader,
                uniforms: m,
                lights: !0,
                fog: !0
            }
              , o = new THREE.ShaderMaterial(n);
            j.transparent && (o.transparent = !0)
        } else
            var o = new THREE[i](j);
        return void 0 !== a.DbgName && (o.name = a.DbgName),
        o
    }
},
THREE.XHRLoader = function(a) {
    this.manager = void 0 !== a ? a : THREE.DefaultLoadingManager
}
,
THREE.XHRLoader.prototype = {
    constructor: THREE.XHRLoader,
    load: function(a, b, c, d) {
        var e = this
          , f = new XMLHttpRequest;
        void 0 !== b && f.addEventListener("load", function(c) {
            b(c.target.responseText),
            e.manager.itemEnd(a)
        }, !1),
        void 0 !== c && f.addEventListener("progress", function(a) {
            c(a)
        }, !1),
        void 0 !== d && f.addEventListener("error", function(a) {
            d(a)
        }, !1),
        void 0 !== this.crossOrigin && (f.crossOrigin = this.crossOrigin),
        f.open("GET", a, !0),
        f.send(null),
        e.manager.itemStart(a)
    },
    setCrossOrigin: function(a) {
        this.crossOrigin = a
    }
},
THREE.ImageLoader = function(a) {
    this.manager = void 0 !== a ? a : THREE.DefaultLoadingManager
}
,
THREE.ImageLoader.prototype = {
    constructor: THREE.ImageLoader,
    load: function(a, b, c, d) {
        var e = this
          , f = document.createElement("img");
        return void 0 !== b && f.addEventListener("load", function() {
            e.manager.itemEnd(a),
            b(this)
        }, !1),
        void 0 !== c && f.addEventListener("progress", function(a) {
            c(a)
        }, !1),
        void 0 !== d && f.addEventListener("error", function(a) {
            d(a)
        }, !1),
        void 0 !== this.crossOrigin && (f.crossOrigin = this.crossOrigin),
        f.src = a,
        e.manager.itemStart(a),
        f
    },
    setCrossOrigin: function(a) {
        this.crossOrigin = a
    }
},
THREE.JSONLoader = function(a) {
    THREE.Loader.call(this, a),
    this.withCredentials = !1
}
,
THREE.JSONLoader.prototype = Object.create(THREE.Loader.prototype),
THREE.JSONLoader.prototype.load = function(a, b, c) {
    c = c && "string" == typeof c ? c : this.extractUrlBase(a),
    this.onLoadStart(),
    this.loadAjaxJSON(this, a, b, c)
}
,
THREE.JSONLoader.prototype.loadAjaxJSON = function(a, b, c, d, e) {
    var f = new XMLHttpRequest
      , g = 0;
    f.onreadystatechange = function() {
        if (f.readyState === f.DONE)
            if (200 === f.status || 0 === f.status) {
                if (f.responseText) {
                    var h = JSON.parse(f.responseText);
                    if ("scene" === h.metadata.type)
                        return console.error('THREE.JSONLoader: "' + b + '" seems to be a Scene. Use THREE.SceneLoader instead.'),
                        void 0;
                    var i = a.parse(h, d);
                    c(i.geometry, i.materials)
                } else
                    console.error('THREE.JSONLoader: "' + b + '" seems to be unreachable or the file is empty.');
                a.onLoadComplete()
            } else
                console.error("THREE.JSONLoader: Couldn't load \"" + b + '" (' + f.status + ")");
        else
            f.readyState === f.LOADING ? e && (0 === g && (g = f.getResponseHeader("Content-Length")),
            e({
                total: g,
                loaded: f.responseText.length
            })) : f.readyState === f.HEADERS_RECEIVED && void 0 !== e && (g = f.getResponseHeader("Content-Length"))
    }
    ,
    f.open("GET", b, !0),
    f.withCredentials = this.withCredentials,
    f.send(null)
}
,
THREE.JSONLoader.prototype.parse = function(a, b) {
    function c(b) {
        function c(a, b) {
            return a & 1 << b
        }
        var d, e, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F = a.faces, G = a.vertices, H = a.normals, I = a.colors, J = 0;
        if (void 0 !== a.uvs) {
            for (d = 0; d < a.uvs.length; d++)
                a.uvs[d].length && J++;
            for (d = 0; J > d; d++)
                f.faceVertexUvs[d] = []
        }
        for (h = 0,
        i = G.length; i > h; )
            v = new THREE.Vector3,
            v.x = G[h++] * b,
            v.y = G[h++] * b,
            v.z = G[h++] * b,
            f.vertices.push(v);
        for (h = 0,
        i = F.length; i > h; )
            if (n = F[h++],
            o = c(n, 0),
            p = c(n, 1),
            q = c(n, 3),
            r = c(n, 4),
            s = c(n, 5),
            t = c(n, 6),
            u = c(n, 7),
            o) {
                if (x = new THREE.Face3,
                x.a = F[h],
                x.b = F[h + 1],
                x.c = F[h + 3],
                y = new THREE.Face3,
                y.a = F[h + 1],
                y.b = F[h + 2],
                y.c = F[h + 3],
                h += 4,
                p && (m = F[h++],
                x.materialIndex = m,
                y.materialIndex = m),
                g = f.faces.length,
                q)
                    for (d = 0; J > d; d++)
                        for (B = a.uvs[d],
                        f.faceVertexUvs[d][g] = [],
                        f.faceVertexUvs[d][g + 1] = [],
                        e = 0; 4 > e; e++)
                            l = F[h++],
                            D = B[2 * l],
                            E = B[2 * l + 1],
                            C = new THREE.Vector2(D,E),
                            2 !== e && f.faceVertexUvs[d][g].push(C),
                            0 !== e && f.faceVertexUvs[d][g + 1].push(C);
                if (r && (k = 3 * F[h++],
                x.normal.set(H[k++], H[k++], H[k]),
                y.normal.copy(x.normal)),
                s)
                    for (d = 0; 4 > d; d++)
                        k = 3 * F[h++],
                        A = new THREE.Vector3(H[k++],H[k++],H[k]),
                        2 !== d && x.vertexNormals.push(A),
                        0 !== d && y.vertexNormals.push(A);
                if (t && (j = F[h++],
                z = I[j],
                x.color.setHex(z),
                y.color.setHex(z)),
                u)
                    for (d = 0; 4 > d; d++)
                        j = F[h++],
                        z = I[j],
                        2 !== d && x.vertexColors.push(new THREE.Color(z)),
                        0 !== d && y.vertexColors.push(new THREE.Color(z));
                f.faces.push(x),
                f.faces.push(y)
            } else {
                if (w = new THREE.Face3,
                w.a = F[h++],
                w.b = F[h++],
                w.c = F[h++],
                p && (m = F[h++],
                w.materialIndex = m),
                g = f.faces.length,
                q)
                    for (d = 0; J > d; d++)
                        for (B = a.uvs[d],
                        f.faceVertexUvs[d][g] = [],
                        e = 0; 3 > e; e++)
                            l = F[h++],
                            D = B[2 * l],
                            E = B[2 * l + 1],
                            C = new THREE.Vector2(D,E),
                            f.faceVertexUvs[d][g].push(C);
                if (r && (k = 3 * F[h++],
                w.normal.set(H[k++], H[k++], H[k])),
                s)
                    for (d = 0; 3 > d; d++)
                        k = 3 * F[h++],
                        A = new THREE.Vector3(H[k++],H[k++],H[k]),
                        w.vertexNormals.push(A);
                if (t && (j = F[h++],
                w.color.setHex(I[j])),
                u)
                    for (d = 0; 3 > d; d++)
                        j = F[h++],
                        w.vertexColors.push(new THREE.Color(I[j]));
                f.faces.push(w)
            }
    }
    function d() {
        if (a.skinWeights)
            for (var b = 0, c = a.skinWeights.length; c > b; b += 2) {
                var d = a.skinWeights[b]
                  , e = a.skinWeights[b + 1]
                  , g = 0
                  , h = 0;
                f.skinWeights.push(new THREE.Vector4(d,e,g,h))
            }
        if (a.skinIndices)
            for (var b = 0, c = a.skinIndices.length; c > b; b += 2) {
                var i = a.skinIndices[b]
                  , j = a.skinIndices[b + 1]
                  , k = 0
                  , l = 0;
                f.skinIndices.push(new THREE.Vector4(i,j,k,l))
            }
        f.bones = a.bones,
        f.bones && f.bones.length > 0 && (f.skinWeights.length !== f.skinIndices.length || f.skinIndices.length !== f.vertices.length) && console.warn("When skinning, number of vertices (" + f.vertices.length + "), skinIndices (" + f.skinIndices.length + "), and skinWeights (" + f.skinWeights.length + ") should match."),
        f.animation = a.animation,
        f.animations = a.animations
    }
    function e(b) {
        if (void 0 !== a.morphTargets) {
            var c, d, e, g, h, i;
            for (c = 0,
            d = a.morphTargets.length; d > c; c++)
                for (f.morphTargets[c] = {},
                f.morphTargets[c].name = a.morphTargets[c].name,
                f.morphTargets[c].vertices = [],
                h = f.morphTargets[c].vertices,
                i = a.morphTargets[c].vertices,
                e = 0,
                g = i.length; g > e; e += 3) {
                    var j = new THREE.Vector3;
                    j.x = i[e] * b,
                    j.y = i[e + 1] * b,
                    j.z = i[e + 2] * b,
                    h.push(j)
                }
        }
        if (void 0 !== a.morphColors) {
            var c, d, k, l, m, n, o;
            for (c = 0,
            d = a.morphColors.length; d > c; c++)
                for (f.morphColors[c] = {},
                f.morphColors[c].name = a.morphColors[c].name,
                f.morphColors[c].colors = [],
                m = f.morphColors[c].colors,
                n = a.morphColors[c].colors,
                k = 0,
                l = n.length; l > k; k += 3)
                    o = new THREE.Color(16755200),
                    o.setRGB(n[k], n[k + 1], n[k + 2]),
                    m.push(o)
        }
    }
    var f = new THREE.Geometry
      , g = void 0 !== a.scale ? 1 / a.scale : 1;
    if (c(g),
    d(),
    e(g),
    f.computeCentroids(),
    f.computeFaceNormals(),
    f.computeBoundingSphere(),
    void 0 === a.materials)
        return {
            geometry: f
        };
    var h = this.initMaterials(a.materials, b);
    return this.needsTangents(h) && f.computeTangents(),
    {
        geometry: f,
        materials: h
    }
}
,
THREE.LoadingManager = function(a, b, c) {
    var d = this
      , e = 0
      , f = 0;
    this.onLoad = a,
    this.onProgress = b,
    this.onError = c,
    this.itemStart = function() {
        f++
    }
    ,
    this.itemEnd = function(a) {
        e++,
        void 0 !== d.onProgress && d.onProgress(a, e, f),
        e === f && void 0 !== d.onLoad && d.onLoad()
    }
}
,
THREE.DefaultLoadingManager = new THREE.LoadingManager,
THREE.BufferGeometryLoader = function(a) {
    this.manager = void 0 !== a ? a : THREE.DefaultLoadingManager
}
,
THREE.BufferGeometryLoader.prototype = {
    constructor: THREE.BufferGeometryLoader,
    load: function(a, b) {
        var c = this
          , d = new THREE.XHRLoader;
        d.setCrossOrigin(this.crossOrigin),
        d.load(a, function(a) {
            b(c.parse(JSON.parse(a)))
        })
    },
    setCrossOrigin: function(a) {
        this.crossOrigin = a
    },
    parse: function(a) {
        var b = new THREE.BufferGeometry
          , c = a.attributes
          , d = a.offsets
          , e = a.boundingSphere;
        for (var f in c) {
            var g = c[f];
            b.attributes[f] = {
                itemSize: g.itemSize,
                array: new self[g.type](g.array)
            }
        }
        return void 0 !== d && (b.offsets = JSON.parse(JSON.stringify(d))),
        void 0 !== e && (b.boundingSphere = new THREE.Sphere((new THREE.Vector3).fromArray(void 0 !== e.center ? e.center : [0, 0, 0]),e.radius)),
        b
    }
},
THREE.Geometry2Loader = function(a) {
    this.manager = void 0 !== a ? a : THREE.DefaultLoadingManager
}
,
THREE.Geometry2Loader.prototype = {
    constructor: THREE.Geometry2Loader,
    load: function(a, b) {
        var c = this
          , d = new THREE.XHRLoader;
        d.setCrossOrigin(this.crossOrigin),
        d.load(a, function(a) {
            b(c.parse(JSON.parse(a)))
        })
    },
    setCrossOrigin: function(a) {
        this.crossOrigin = a
    },
    parse: function(a) {
        var b = new THREE.Geometry2(a.vertices.length / 3)
          , c = ["vertices", "normals", "uvs"]
          , d = a.boundingSphere;
        for (var e in c) {
            var f = c[e];
            b[f].set(a[f])
        }
        return void 0 !== d && (b.boundingSphere = new THREE.Sphere((new THREE.Vector3).fromArray(void 0 !== d.center ? d.center : [0, 0, 0]),d.radius)),
        b
    }
},
THREE.MaterialLoader = function(a) {
    this.manager = void 0 !== a ? a : THREE.DefaultLoadingManager
}
,
THREE.MaterialLoader.prototype = {
    constructor: THREE.MaterialLoader,
    load: function(a, b) {
        var c = this
          , d = new THREE.XHRLoader;
        d.setCrossOrigin(this.crossOrigin),
        d.load(a, function(a) {
            b(c.parse(JSON.parse(a)))
        })
    },
    setCrossOrigin: function(a) {
        this.crossOrigin = a
    },
    parse: function(a) {
        var b = new THREE[a.type];
        if (void 0 !== a.color && b.color.setHex(a.color),
        void 0 !== a.ambient && b.ambient.setHex(a.ambient),
        void 0 !== a.emissive && b.emissive.setHex(a.emissive),
        void 0 !== a.specular && b.specular.setHex(a.specular),
        void 0 !== a.shininess && (b.shininess = a.shininess),
        void 0 !== a.vertexColors && (b.vertexColors = a.vertexColors),
        void 0 !== a.blending && (b.blending = a.blending),
        void 0 !== a.side && (b.side = a.side),
        void 0 !== a.opacity && (b.opacity = a.opacity),
        void 0 !== a.transparent && (b.transparent = a.transparent),
        void 0 !== a.wireframe && (b.wireframe = a.wireframe),
        void 0 !== a.materials)
            for (var c = 0, d = a.materials.length; d > c; c++)
                b.materials.push(this.parse(a.materials[c]));
        return b
    }
},
THREE.ObjectLoader = function(a) {
    this.manager = void 0 !== a ? a : THREE.DefaultLoadingManager
}
,
THREE.ObjectLoader.prototype = {
    constructor: THREE.ObjectLoader,
    load: function(a, b) {
        var c = this
          , d = new THREE.XHRLoader(c.manager);
        d.setCrossOrigin(this.crossOrigin),
        d.load(a, function(a) {
            b(c.parse(JSON.parse(a)))
        })
    },
    setCrossOrigin: function(a) {
        this.crossOrigin = a
    },
    parse: function(a) {
        var b = this.parseGeometries(a.geometries)
          , c = this.parseMaterials(a.materials)
          , d = this.parseObject(a.object, b, c);
        return d
    },
    parseGeometries: function(a) {
        var b = {};
        if (void 0 !== a)
            for (var c = new THREE.JSONLoader, d = new THREE.Geometry2Loader, e = new THREE.BufferGeometryLoader, f = 0, g = a.length; g > f; f++) {
                var h, i = a[f];
                switch (i.type) {
                case "PlaneGeometry":
                    h = new THREE.PlaneGeometry(i.width,i.height,i.widthSegments,i.heightSegments);
                    break;
                case "BoxGeometry":
                case "CubeGeometry":
                    h = new THREE.BoxGeometry(i.width,i.height,i.depth,i.widthSegments,i.heightSegments,i.depthSegments);
                    break;
                case "CircleGeometry":
                    h = new THREE.CircleGeometry(i.radius,i.segments);
                    break;
                case "CylinderGeometry":
                    h = new THREE.CylinderGeometry(i.radiusTop,i.radiusBottom,i.height,i.radialSegments,i.heightSegments,i.openEnded);
                    break;
                case "SphereGeometry":
                    h = new THREE.SphereGeometry(i.radius,i.widthSegments,i.heightSegments,i.phiStart,i.phiLength,i.thetaStart,i.thetaLength);
                    break;
                case "IcosahedronGeometry":
                    h = new THREE.IcosahedronGeometry(i.radius,i.detail);
                    break;
                case "TorusGeometry":
                    h = new THREE.TorusGeometry(i.radius,i.tube,i.radialSegments,i.tubularSegments,i.arc);
                    break;
                case "TorusKnotGeometry":
                    h = new THREE.TorusKnotGeometry(i.radius,i.tube,i.radialSegments,i.tubularSegments,i.p,i.q,i.heightScale);
                    break;
                case "BufferGeometry":
                    h = e.parse(i.data);
                    break;
                case "Geometry2":
                    h = d.parse(i.data);
                    break;
                case "Geometry":
                    h = c.parse(i.data).geometry
                }
                h.uuid = i.uuid,
                void 0 !== i.name && (h.name = i.name),
                b[i.uuid] = h
            }
        return b
    },
    parseMaterials: function(a) {
        var b = {};
        if (void 0 !== a)
            for (var c = new THREE.MaterialLoader, d = 0, e = a.length; e > d; d++) {
                var f = a[d]
                  , g = c.parse(f);
                g.uuid = f.uuid,
                void 0 !== f.name && (g.name = f.name),
                b[f.uuid] = g
            }
        return b
    },
    parseObject: function() {
        var a = new THREE.Matrix4;
        return function(b, c, d) {
            var e;
            switch (b.type) {
            case "Scene":
                e = new THREE.Scene;
                break;
            case "PerspectiveCamera":
                e = new THREE.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);
                break;
            case "OrthographicCamera":
                e = new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);
                break;
            case "AmbientLight":
                e = new THREE.AmbientLight(b.color);
                break;
            case "DirectionalLight":
                e = new THREE.DirectionalLight(b.color,b.intensity);
                break;
            case "PointLight":
                e = new THREE.PointLight(b.color,b.intensity,b.distance);
                break;
            case "SpotLight":
                e = new THREE.SpotLight(b.color,b.intensity,b.distance,b.angle,b.exponent);
                break;
            case "HemisphereLight":
                e = new THREE.HemisphereLight(b.color,b.groundColor,b.intensity);
                break;
            case "Mesh":
                var f = c[b.geometry]
                  , g = d[b.material];
                void 0 === f && console.error("THREE.ObjectLoader: Undefined geometry " + b.geometry),
                void 0 === g && console.error("THREE.ObjectLoader: Undefined material " + b.material),
                e = new THREE.Mesh(f,g);
                break;
            case "Sprite":
                var g = d[b.material];
                void 0 === g && console.error("THREE.ObjectLoader: Undefined material " + b.material),
                e = new THREE.Sprite(g);
                break;
            default:
                e = new THREE.Object3D
            }
            if (e.uuid = b.uuid,
            void 0 !== b.name && (e.name = b.name),
            void 0 !== b.matrix ? (a.fromArray(b.matrix),
            a.decompose(e.position, e.quaternion, e.scale)) : (void 0 !== b.position && e.position.fromArray(b.position),
            void 0 !== b.rotation && e.rotation.fromArray(b.rotation),
            void 0 !== b.scale && e.scale.fromArray(b.scale)),
            void 0 !== b.visible && (e.visible = b.visible),
            void 0 !== b.userData && (e.userData = b.userData),
            void 0 !== b.children)
                for (var h in b.children)
                    e.add(this.parseObject(b.children[h], c, d));
            return e
        }
    }()
},
THREE.SceneLoader = function() {
    this.onLoadStart = function() {}
    ,
    this.onLoadProgress = function() {}
    ,
    this.onLoadComplete = function() {}
    ,
    this.callbackSync = function() {}
    ,
    this.callbackProgress = function() {}
    ,
    this.geometryHandlers = {},
    this.hierarchyHandlers = {},
    this.addGeometryHandler("ascii", THREE.JSONLoader)
}
,
THREE.SceneLoader.prototype = {
    constructor: THREE.SceneLoader,
    load: function(a, b) {
        var c = this
          , d = new THREE.XHRLoader(c.manager);
        d.setCrossOrigin(this.crossOrigin),
        d.load(a, function(d) {
            c.parse(JSON.parse(d), b, a)
        })
    },
    setCrossOrigin: function(a) {
        this.crossOrigin = a
    },
    addGeometryHandler: function(a, b) {
        this.geometryHandlers[a] = {
            loaderClass: b
        }
    },
    addHierarchyHandler: function(a, b) {
        this.hierarchyHandlers[a] = {
            loaderClass: b
        }
    },
    parse: function(a, b, c) {
        function d(a, b) {
            return "relativeToHTML" == b ? a : B + a
        }
        function e() {
            f(z.scene, D.objects)
        }
        function f(a, b) {
            var c, e, g, h, i;
            for (var k in b) {
                var l = z.objects[k]
                  , m = b[k];
                if (void 0 === l) {
                    if (m.type && m.type in A.hierarchyHandlers) {
                        if (void 0 === m.loading) {
                            var n = {
                                type: 1,
                                url: 1,
                                material: 1,
                                position: 1,
                                rotation: 1,
                                scale: 1,
                                visible: 1,
                                children: 1,
                                userData: 1,
                                skin: 1,
                                morph: 1,
                                mirroredLoop: 1,
                                duration: 1
                            }
                              , r = {};
                            for (var s in m)
                                s in n || (r[s] = m[s]);
                            p = z.materials[m.material],
                            m.loading = !0;
                            var t = A.hierarchyHandlers[m.type].loaderObject;
                            t.options ? t.load(d(m.url, D.urlBaseType), j(k, a, p, m)) : t.load(d(m.url, D.urlBaseType), j(k, a, p, m), r)
                        }
                    } else if (void 0 !== m.geometry) {
                        if (o = z.geometries[m.geometry]) {
                            var v = !1;
                            if (p = z.materials[m.material],
                            v = p instanceof THREE.ShaderMaterial,
                            e = m.position,
                            g = m.rotation,
                            h = m.scale,
                            c = m.matrix,
                            i = m.quaternion,
                            m.material || (p = new THREE.MeshFaceMaterial(z.face_materials[m.geometry])),
                            p instanceof THREE.MeshFaceMaterial && 0 === p.materials.length && (p = new THREE.MeshFaceMaterial(z.face_materials[m.geometry])),
                            p instanceof THREE.MeshFaceMaterial)
                                for (var w = 0; w < p.materials.length; w++)
                                    v = v || p.materials[w]instanceof THREE.ShaderMaterial;
                            v && o.computeTangents(),
                            m.skin ? l = new THREE.SkinnedMesh(o,p) : m.morph ? (l = new THREE.MorphAnimMesh(o,p),
                            void 0 !== m.duration && (l.duration = m.duration),
                            void 0 !== m.time && (l.time = m.time),
                            void 0 !== m.mirroredLoop && (l.mirroredLoop = m.mirroredLoop),
                            p.morphNormals && o.computeMorphNormals()) : l = new THREE.Mesh(o,p),
                            l.name = k,
                            c ? (l.matrixAutoUpdate = !1,
                            l.matrix.set(c[0], c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8], c[9], c[10], c[11], c[12], c[13], c[14], c[15])) : (l.position.fromArray(e),
                            i ? l.quaternion.fromArray(i) : l.rotation.fromArray(g),
                            l.scale.fromArray(h)),
                            l.visible = m.visible,
                            l.castShadow = m.castShadow,
                            l.receiveShadow = m.receiveShadow,
                            a.add(l),
                            z.objects[k] = l
                        }
                    } else if ("AmbientLight" === m.type || "PointLight" === m.type || "DirectionalLight" === m.type || "SpotLight" === m.type || "HemisphereLight" === m.type || "AreaLight" === m.type) {
                        var x = m.color
                          , y = m.intensity
                          , B = m.distance
                          , C = m.position
                          , E = m.rotation;
                        switch (m.type) {
                        case "AmbientLight":
                            u = new THREE.AmbientLight(x);
                            break;
                        case "PointLight":
                            u = new THREE.PointLight(x,y,B),
                            u.position.fromArray(C);
                            break;
                        case "DirectionalLight":
                            u = new THREE.DirectionalLight(x,y),
                            u.position.fromArray(m.direction);
                            break;
                        case "SpotLight":
                            u = new THREE.SpotLight(x,y,B,1),
                            u.angle = m.angle,
                            u.position.fromArray(C),
                            u.target.set(C[0], C[1] - B, C[2]),
                            u.target.applyEuler(new THREE.Euler(E[0],E[1],E[2],"XYZ"));
                            break;
                        case "HemisphereLight":
                            u = new THREE.DirectionalLight(x,y,B),
                            u.target.set(C[0], C[1] - B, C[2]),
                            u.target.applyEuler(new THREE.Euler(E[0],E[1],E[2],"XYZ"));
                            break;
                        case "AreaLight":
                            u = new THREE.AreaLight(x,y),
                            u.position.fromArray(C),
                            u.width = m.size,
                            u.height = m.size_y
                        }
                        a.add(u),
                        u.name = k,
                        z.lights[k] = u,
                        z.objects[k] = u
                    } else
                        "PerspectiveCamera" === m.type || "OrthographicCamera" === m.type ? (e = m.position,
                        g = m.rotation,
                        i = m.quaternion,
                        "PerspectiveCamera" === m.type ? q = new THREE.PerspectiveCamera(m.fov,m.aspect,m.near,m.far) : "OrthographicCamera" === m.type && (q = new THREE.OrthographicCamera(m.left,m.right,m.top,m.bottom,m.near,m.far)),
                        q.name = k,
                        q.position.fromArray(e),
                        void 0 !== i ? q.quaternion.fromArray(i) : void 0 !== g && q.rotation.fromArray(g),
                        a.add(q),
                        z.cameras[k] = q,
                        z.objects[k] = q) : (e = m.position,
                        g = m.rotation,
                        h = m.scale,
                        i = m.quaternion,
                        l = new THREE.Object3D,
                        l.name = k,
                        l.position.fromArray(e),
                        i ? l.quaternion.fromArray(i) : l.rotation.fromArray(g),
                        l.scale.fromArray(h),
                        l.visible = void 0 !== m.visible ? m.visible : !1,
                        a.add(l),
                        z.objects[k] = l,
                        z.empties[k] = l);
                    if (l) {
                        if (void 0 !== m.userData)
                            for (var F in m.userData) {
                                var G = m.userData[F];
                                l.userData[F] = G
                            }
                        if (void 0 !== m.groups)
                            for (var w = 0; w < m.groups.length; w++) {
                                var H = m.groups[w];
                                void 0 === z.groups[H] && (z.groups[H] = []),
                                z.groups[H].push(k)
                            }
                    }
                }
                void 0 !== l && void 0 !== m.children && f(l, m.children)
            }
        }
        function g(a, b, c) {
            z.geometries[c] = a,
            z.face_materials[c] = b,
            e()
        }
        function h(a, b, c, d, f) {
            var g = f.position
              , h = f.rotation
              , i = f.quaternion
              , j = f.scale;
            a.position.fromArray(g),
            i ? a.quaternion.fromArray(i) : a.rotation.fromArray(h),
            a.scale.fromArray(j),
            d && a.traverse(function(a) {
                a.material = d
            });
            var k = void 0 !== f.visible ? f.visible : !0;
            a.traverse(function(a) {
                a.visible = k
            }),
            c.add(a),
            a.name = b,
            z.objects[b] = a,
            e()
        }
        function i(a) {
            return function(b, c) {
                b.name = a,
                g(b, c, a),
                v -= 1,
                A.onLoadComplete(),
                l()
            }
        }
        function j(a, b, c, d) {
            return function(e) {
                var f;
                f = e.content ? e.content : e.dae ? e.scene : e,
                h(f, a, b, c, d),
                v -= 1,
                A.onLoadComplete(),
                l()
            }
        }
        function k(a) {
            return function(b, c) {
                b.name = a,
                z.geometries[a] = b,
                z.face_materials[a] = c
            }
        }
        function l() {
            var a = {
                totalModels: x,
                totalTextures: y,
                loadedModels: x - v,
                loadedTextures: y - w
            };
            A.callbackProgress(a, z),
            A.onLoadProgress(),
            0 === v && 0 === w && (m(),
            b(z))
        }
        function m() {
            for (var a = 0; a < C.length; a++) {
                var b = C[a]
                  , c = z.objects[b.targetName];
                c ? b.object.target = c : (b.object.target = new THREE.Object3D,
                z.scene.add(b.object.target)),
                b.object.target.userData.targetInverse = b.object
            }
        }
        function n(a, b) {
            if (b(a),
            void 0 !== a.children)
                for (var c in a.children)
                    n(a.children[c], b)
        }
        var o, p, q, r, s, t, u, v, w, x, y, z, A = this, B = THREE.Loader.prototype.extractUrlBase(c), C = [], D = a;
        for (var E in this.geometryHandlers) {
            var F = this.geometryHandlers[E].loaderClass;
            this.geometryHandlers[E].loaderObject = new F
        }
        for (var E in this.hierarchyHandlers) {
            var F = this.hierarchyHandlers[E].loaderClass;
            this.hierarchyHandlers[E].loaderObject = new F
        }
        if (v = 0,
        w = 0,
        z = {
            scene: new THREE.Scene,
            geometries: {},
            face_materials: {},
            materials: {},
            textures: {},
            objects: {},
            cameras: {},
            lights: {},
            fogs: {},
            empties: {},
            groups: {}
        },
        D.transform) {
            var G = D.transform.position
              , H = D.transform.rotation
              , I = D.transform.scale;
            G && z.scene.position.fromArray(G),
            H && z.scene.rotation.fromArray(H),
            I && z.scene.scale.fromArray(I),
            (G || H || I) && (z.scene.updateMatrix(),
            z.scene.updateMatrixWorld())
        }
        var J, K, L = function(a) {
            w -= a,
            l(),
            A.onLoadComplete()
        }, M = function(a) {
            return function() {
                L(a)
            }
        };
        for (J in D.fogs)
            K = D.fogs[J],
            "linear" === K.type ? r = new THREE.Fog(0,K.near,K.far) : "exp2" === K.type && (r = new THREE.FogExp2(0,K.density)),
            t = K.color,
            r.color.setRGB(t[0], t[1], t[2]),
            z.fogs[J] = r;
        var N, O;
        for (N in D.geometries)
            O = D.geometries[N],
            O.type in this.geometryHandlers && (v += 1,
            A.onLoadStart());
        for (var P in D.objects)
            n(D.objects[P], function(a) {
                a.type && a.type in A.hierarchyHandlers && (v += 1,
                A.onLoadStart())
            });
        x = v;
        for (N in D.geometries)
            if (O = D.geometries[N],
            "cube" === O.type)
                o = new THREE.BoxGeometry(O.width,O.height,O.depth,O.widthSegments,O.heightSegments,O.depthSegments),
                o.name = N,
                z.geometries[N] = o;
            else if ("plane" === O.type)
                o = new THREE.PlaneGeometry(O.width,O.height,O.widthSegments,O.heightSegments),
                o.name = N,
                z.geometries[N] = o;
            else if ("sphere" === O.type)
                o = new THREE.SphereGeometry(O.radius,O.widthSegments,O.heightSegments),
                o.name = N,
                z.geometries[N] = o;
            else if ("cylinder" === O.type)
                o = new THREE.CylinderGeometry(O.topRad,O.botRad,O.height,O.radSegs,O.heightSegs),
                o.name = N,
                z.geometries[N] = o;
            else if ("torus" === O.type)
                o = new THREE.TorusGeometry(O.radius,O.tube,O.segmentsR,O.segmentsT),
                o.name = N,
                z.geometries[N] = o;
            else if ("icosahedron" === O.type)
                o = new THREE.IcosahedronGeometry(O.radius,O.subdivisions),
                o.name = N,
                z.geometries[N] = o;
            else if (O.type in this.geometryHandlers) {
                var Q = {};
                for (var R in O)
                    "type" !== R && "url" !== R && (Q[R] = O[R]);
                var S = this.geometryHandlers[O.type].loaderObject;
                S.load(d(O.url, D.urlBaseType), i(N), Q)
            } else if ("embedded" === O.type) {
                var T = D.embeds[O.id]
                  , U = "";
                if (T.metadata = D.metadata,
                T) {
                    var V = this.geometryHandlers.ascii.loaderObject
                      , W = V.parse(T, U);
                    k(N)(W.geometry, W.materials)
                }
            }
        var X, Y;
        for (X in D.textures)
            if (Y = D.textures[X],
            Y.url instanceof Array) {
                w += Y.url.length;
                for (var Z = 0; Z < Y.url.length; Z++)
                    A.onLoadStart()
            } else
                w += 1,
                A.onLoadStart();
        y = w;
        for (X in D.textures) {
            if (Y = D.textures[X],
            void 0 !== Y.mapping && void 0 !== THREE[Y.mapping] && (Y.mapping = new THREE[Y.mapping]),
            Y.url instanceof Array) {
                for (var $ = Y.url.length, _ = [], ab = 0; $ > ab; ab++)
                    _[ab] = d(Y.url[ab], D.urlBaseType);
                var bb = /\.dds$/i.test(_[0]);
                s = bb ? THREE.ImageUtils.loadCompressedTextureCube(_, Y.mapping, M($)) : THREE.ImageUtils.loadTextureCube(_, Y.mapping, M($))
            } else {
                var bb = /\.dds$/i.test(Y.url)
                  , cb = d(Y.url, D.urlBaseType)
                  , db = M(1);
                if (s = bb ? THREE.ImageUtils.loadCompressedTexture(cb, Y.mapping, db) : THREE.ImageUtils.loadTexture(cb, Y.mapping, db),
                void 0 !== THREE[Y.minFilter] && (s.minFilter = THREE[Y.minFilter]),
                void 0 !== THREE[Y.magFilter] && (s.magFilter = THREE[Y.magFilter]),
                Y.anisotropy && (s.anisotropy = Y.anisotropy),
                Y.repeat && (s.repeat.set(Y.repeat[0], Y.repeat[1]),
                1 !== Y.repeat[0] && (s.wrapS = THREE.RepeatWrapping),
                1 !== Y.repeat[1] && (s.wrapT = THREE.RepeatWrapping)),
                Y.offset && s.offset.set(Y.offset[0], Y.offset[1]),
                Y.wrap) {
                    var eb = {
                        repeat: THREE.RepeatWrapping,
                        mirror: THREE.MirroredRepeatWrapping
                    };
                    void 0 !== eb[Y.wrap[0]] && (s.wrapS = eb[Y.wrap[0]]),
                    void 0 !== eb[Y.wrap[1]] && (s.wrapT = eb[Y.wrap[1]])
                }
            }
            z.textures[X] = s
        }
        var fb, gb, hb;
        for (fb in D.materials) {
            gb = D.materials[fb];
            for (hb in gb.parameters)
                if ("envMap" === hb || "map" === hb || "lightMap" === hb || "bumpMap" === hb)
                    gb.parameters[hb] = z.textures[gb.parameters[hb]];
                else if ("shading" === hb)
                    gb.parameters[hb] = "flat" === gb.parameters[hb] ? THREE.FlatShading : THREE.SmoothShading;
                else if ("side" === hb)
                    gb.parameters[hb] = "double" == gb.parameters[hb] ? THREE.DoubleSide : "back" == gb.parameters[hb] ? THREE.BackSide : THREE.FrontSide;
                else if ("blending" === hb)
                    gb.parameters[hb] = gb.parameters[hb]in THREE ? THREE[gb.parameters[hb]] : THREE.NormalBlending;
                else if ("combine" === hb)
                    gb.parameters[hb] = gb.parameters[hb]in THREE ? THREE[gb.parameters[hb]] : THREE.MultiplyOperation;
                else if ("vertexColors" === hb)
                    "face" == gb.parameters[hb] ? gb.parameters[hb] = THREE.FaceColors : gb.parameters[hb] && (gb.parameters[hb] = THREE.VertexColors);
                else if ("wrapRGB" === hb) {
                    var ib = gb.parameters[hb];
                    gb.parameters[hb] = new THREE.Vector3(ib[0],ib[1],ib[2])
                }
            if (void 0 !== gb.parameters.opacity && gb.parameters.opacity < 1 && (gb.parameters.transparent = !0),
            gb.parameters.normalMap) {
                var jb = THREE.ShaderLib.normalmap
                  , kb = THREE.UniformsUtils.clone(jb.uniforms)
                  , lb = gb.parameters.color
                  , mb = gb.parameters.specular
                  , nb = gb.parameters.ambient
                  , ob = gb.parameters.shininess;
                kb.tNormal.value = z.textures[gb.parameters.normalMap],
                gb.parameters.normalScale && kb.uNormalScale.value.set(gb.parameters.normalScale[0], gb.parameters.normalScale[1]),
                gb.parameters.map && (kb.tDiffuse.value = gb.parameters.map,
                kb.enableDiffuse.value = !0),
                gb.parameters.envMap && (kb.tCube.value = gb.parameters.envMap,
                kb.enableReflection.value = !0,
                kb.reflectivity.value = gb.parameters.reflectivity),
                gb.parameters.lightMap && (kb.tAO.value = gb.parameters.lightMap,
                kb.enableAO.value = !0),
                gb.parameters.specularMap && (kb.tSpecular.value = z.textures[gb.parameters.specularMap],
                kb.enableSpecular.value = !0),
                gb.parameters.displacementMap && (kb.tDisplacement.value = z.textures[gb.parameters.displacementMap],
                kb.enableDisplacement.value = !0,
                kb.uDisplacementBias.value = gb.parameters.displacementBias,
                kb.uDisplacementScale.value = gb.parameters.displacementScale),
                kb.diffuse.value.setHex(lb),
                kb.specular.value.setHex(mb),
                kb.ambient.value.setHex(nb),
                kb.shininess.value = ob,
                gb.parameters.opacity && (kb.opacity.value = gb.parameters.opacity);
                var pb = {
                    fragmentShader: jb.fragmentShader,
                    vertexShader: jb.vertexShader,
                    uniforms: kb,
                    lights: !0,
                    fog: !0
                };
                p = new THREE.ShaderMaterial(pb)
            } else
                p = new THREE[gb.type](gb.parameters);
            p.name = fb,
            z.materials[fb] = p
        }
        for (fb in D.materials)
            if (gb = D.materials[fb],
            gb.parameters.materials) {
                for (var qb = [], ab = 0; ab < gb.parameters.materials.length; ab++) {
                    var rb = gb.parameters.materials[ab];
                    qb.push(z.materials[rb])
                }
                z.materials[fb].materials = qb
            }
        e(),
        z.cameras && D.defaults.camera && (z.currentCamera = z.cameras[D.defaults.camera]),
        z.fogs && D.defaults.fog && (z.scene.fog = z.fogs[D.defaults.fog]),
        A.callbackSync(z),
        l()
    }
},
THREE.TextureLoader = function(a) {
    this.manager = void 0 !== a ? a : THREE.DefaultLoadingManager
}
,
THREE.TextureLoader.prototype = {
    constructor: THREE.TextureLoader,
    load: function(a, b) {
        var c = this
          , d = new THREE.ImageLoader(c.manager);
        d.setCrossOrigin(this.crossOrigin),
        d.load(a, function(a) {
            var c = new THREE.Texture(a);
            c.needsUpdate = !0,
            void 0 !== b && b(c)
        })
    },
    setCrossOrigin: function(a) {
        this.crossOrigin = a
    }
},
THREE.Material = function() {
    this.id = THREE.MaterialIdCount++,
    this.uuid = THREE.Math.generateUUID(),
    this.name = "",
    this.side = THREE.FrontSide,
    this.opacity = 1,
    this.transparent = !1,
    this.blending = THREE.NormalBlending,
    this.blendSrc = THREE.SrcAlphaFactor,
    this.blendDst = THREE.OneMinusSrcAlphaFactor,
    this.blendEquation = THREE.AddEquation,
    this.depthTest = !0,
    this.depthWrite = !0,
    this.polygonOffset = !1,
    this.polygonOffsetFactor = 0,
    this.polygonOffsetUnits = 0,
    this.alphaTest = 0,
    this.overdraw = 0,
    this.visible = !0,
    this.needsUpdate = !0
}
,
THREE.Material.prototype = {
    constructor: THREE.Material,
    setValues: function(a) {
        if (void 0 !== a)
            for (var b in a) {
                var c = a[b];
                if (void 0 !== c) {
                    if (b in this) {
                        var d = this[b];
                        d instanceof THREE.Color ? d.set(c) : d instanceof THREE.Vector3 && c instanceof THREE.Vector3 ? d.copy(c) : this[b] = "overdraw" == b ? Number(c) : c
                    }
                } else
                    console.warn("THREE.Material: '" + b + "' parameter is undefined.")
            }
    },
    clone: function(a) {
        return void 0 === a && (a = new THREE.Material),
        a.name = this.name,
        a.side = this.side,
        a.opacity = this.opacity,
        a.transparent = this.transparent,
        a.blending = this.blending,
        a.blendSrc = this.blendSrc,
        a.blendDst = this.blendDst,
        a.blendEquation = this.blendEquation,
        a.depthTest = this.depthTest,
        a.depthWrite = this.depthWrite,
        a.polygonOffset = this.polygonOffset,
        a.polygonOffsetFactor = this.polygonOffsetFactor,
        a.polygonOffsetUnits = this.polygonOffsetUnits,
        a.alphaTest = this.alphaTest,
        a.overdraw = this.overdraw,
        a.visible = this.visible,
        a
    },
    dispose: function() {
        this.dispatchEvent({
            type: "dispose"
        })
    }
},
THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),
THREE.MaterialIdCount = 0,
THREE.LineBasicMaterial = function(a) {
    THREE.Material.call(this),
    this.color = new THREE.Color(16777215),
    this.linewidth = 1,
    this.linecap = "round",
    this.linejoin = "round",
    this.vertexColors = !1,
    this.fog = !0,
    this.setValues(a)
}
,
THREE.LineBasicMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.LineBasicMaterial.prototype.clone = function() {
    var a = new THREE.LineBasicMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.color.copy(this.color),
    a.linewidth = this.linewidth,
    a.linecap = this.linecap,
    a.linejoin = this.linejoin,
    a.vertexColors = this.vertexColors,
    a.fog = this.fog,
    a
}
,
THREE.LineDashedMaterial = function(a) {
    THREE.Material.call(this),
    this.color = new THREE.Color(16777215),
    this.linewidth = 1,
    this.scale = 1,
    this.dashSize = 3,
    this.gapSize = 1,
    this.vertexColors = !1,
    this.fog = !0,
    this.setValues(a)
}
,
THREE.LineDashedMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.LineDashedMaterial.prototype.clone = function() {
    var a = new THREE.LineDashedMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.color.copy(this.color),
    a.linewidth = this.linewidth,
    a.scale = this.scale,
    a.dashSize = this.dashSize,
    a.gapSize = this.gapSize,
    a.vertexColors = this.vertexColors,
    a.fog = this.fog,
    a
}
,
THREE.MeshBasicMaterial = function(a) {
    THREE.Material.call(this),
    this.color = new THREE.Color(16777215),
    this.map = null,
    this.lightMap = null,
    this.specularMap = null,
    this.envMap = null,
    this.combine = THREE.MultiplyOperation,
    this.reflectivity = 1,
    this.refractionRatio = .98,
    this.fog = !0,
    this.shading = THREE.SmoothShading,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.wireframeLinecap = "round",
    this.wireframeLinejoin = "round",
    this.vertexColors = THREE.NoColors,
    this.skinning = !1,
    this.morphTargets = !1,
    this.setValues(a)
}
,
THREE.MeshBasicMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.MeshBasicMaterial.prototype.clone = function() {
    var a = new THREE.MeshBasicMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.color.copy(this.color),
    a.map = this.map,
    a.lightMap = this.lightMap,
    a.specularMap = this.specularMap,
    a.envMap = this.envMap,
    a.combine = this.combine,
    a.reflectivity = this.reflectivity,
    a.refractionRatio = this.refractionRatio,
    a.fog = this.fog,
    a.shading = this.shading,
    a.wireframe = this.wireframe,
    a.wireframeLinewidth = this.wireframeLinewidth,
    a.wireframeLinecap = this.wireframeLinecap,
    a.wireframeLinejoin = this.wireframeLinejoin,
    a.vertexColors = this.vertexColors,
    a.skinning = this.skinning,
    a.morphTargets = this.morphTargets,
    a
}
,
THREE.MeshLambertMaterial = function(a) {
    THREE.Material.call(this),
    this.color = new THREE.Color(16777215),
    this.ambient = new THREE.Color(16777215),
    this.emissive = new THREE.Color(0),
    this.wrapAround = !1,
    this.wrapRGB = new THREE.Vector3(1,1,1),
    this.map = null,
    this.lightMap = null,
    this.specularMap = null,
    this.envMap = null,
    this.combine = THREE.MultiplyOperation,
    this.reflectivity = 1,
    this.refractionRatio = .98,
    this.fog = !0,
    this.shading = THREE.SmoothShading,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.wireframeLinecap = "round",
    this.wireframeLinejoin = "round",
    this.vertexColors = THREE.NoColors,
    this.skinning = !1,
    this.morphTargets = !1,
    this.morphNormals = !1,
    this.setValues(a)
}
,
THREE.MeshLambertMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.MeshLambertMaterial.prototype.clone = function() {
    var a = new THREE.MeshLambertMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.color.copy(this.color),
    a.ambient.copy(this.ambient),
    a.emissive.copy(this.emissive),
    a.wrapAround = this.wrapAround,
    a.wrapRGB.copy(this.wrapRGB),
    a.map = this.map,
    a.lightMap = this.lightMap,
    a.specularMap = this.specularMap,
    a.envMap = this.envMap,
    a.combine = this.combine,
    a.reflectivity = this.reflectivity,
    a.refractionRatio = this.refractionRatio,
    a.fog = this.fog,
    a.shading = this.shading,
    a.wireframe = this.wireframe,
    a.wireframeLinewidth = this.wireframeLinewidth,
    a.wireframeLinecap = this.wireframeLinecap,
    a.wireframeLinejoin = this.wireframeLinejoin,
    a.vertexColors = this.vertexColors,
    a.skinning = this.skinning,
    a.morphTargets = this.morphTargets,
    a.morphNormals = this.morphNormals,
    a
}
,
THREE.MeshPhongMaterial = function(a) {
    THREE.Material.call(this),
    this.color = new THREE.Color(16777215),
    this.ambient = new THREE.Color(16777215),
    this.emissive = new THREE.Color(0),
    this.specular = new THREE.Color(1118481),
    this.shininess = 30,
    this.metal = !1,
    this.wrapAround = !1,
    this.wrapRGB = new THREE.Vector3(1,1,1),
    this.map = null,
    this.lightMap = null,
    this.bumpMap = null,
    this.bumpScale = 1,
    this.normalMap = null,
    this.normalScale = new THREE.Vector2(1,1),
    this.specularMap = null,
    this.envMap = null,
    this.combine = THREE.MultiplyOperation,
    this.reflectivity = 1,
    this.refractionRatio = .98,
    this.fog = !0,
    this.shading = THREE.SmoothShading,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.wireframeLinecap = "round",
    this.wireframeLinejoin = "round",
    this.vertexColors = THREE.NoColors,
    this.skinning = !1,
    this.morphTargets = !1,
    this.morphNormals = !1,
    this.setValues(a)
}
,
THREE.MeshPhongMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.MeshPhongMaterial.prototype.clone = function() {
    var a = new THREE.MeshPhongMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.color.copy(this.color),
    a.ambient.copy(this.ambient),
    a.emissive.copy(this.emissive),
    a.specular.copy(this.specular),
    a.shininess = this.shininess,
    a.metal = this.metal,
    a.wrapAround = this.wrapAround,
    a.wrapRGB.copy(this.wrapRGB),
    a.map = this.map,
    a.lightMap = this.lightMap,
    a.bumpMap = this.bumpMap,
    a.bumpScale = this.bumpScale,
    a.normalMap = this.normalMap,
    a.normalScale.copy(this.normalScale),
    a.specularMap = this.specularMap,
    a.envMap = this.envMap,
    a.combine = this.combine,
    a.reflectivity = this.reflectivity,
    a.refractionRatio = this.refractionRatio,
    a.fog = this.fog,
    a.shading = this.shading,
    a.wireframe = this.wireframe,
    a.wireframeLinewidth = this.wireframeLinewidth,
    a.wireframeLinecap = this.wireframeLinecap,
    a.wireframeLinejoin = this.wireframeLinejoin,
    a.vertexColors = this.vertexColors,
    a.skinning = this.skinning,
    a.morphTargets = this.morphTargets,
    a.morphNormals = this.morphNormals,
    a
}
,
THREE.MeshDepthMaterial = function(a) {
    THREE.Material.call(this),
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.setValues(a)
}
,
THREE.MeshDepthMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.MeshDepthMaterial.prototype.clone = function() {
    var a = new THREE.MeshDepthMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.wireframe = this.wireframe,
    a.wireframeLinewidth = this.wireframeLinewidth,
    a
}
,
THREE.MeshNormalMaterial = function(a) {
    THREE.Material.call(this, a),
    this.shading = THREE.FlatShading,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.morphTargets = !1,
    this.setValues(a)
}
,
THREE.MeshNormalMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.MeshNormalMaterial.prototype.clone = function() {
    var a = new THREE.MeshNormalMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.shading = this.shading,
    a.wireframe = this.wireframe,
    a.wireframeLinewidth = this.wireframeLinewidth,
    a
}
,
THREE.MeshFaceMaterial = function(a) {
    this.materials = a instanceof Array ? a : []
}
,
THREE.MeshFaceMaterial.prototype.clone = function() {
    for (var a = new THREE.MeshFaceMaterial, b = 0; b < this.materials.length; b++)
        a.materials.push(this.materials[b].clone());
    return a
}
,
THREE.ParticleSystemMaterial = function(a) {
    THREE.Material.call(this),
    this.color = new THREE.Color(16777215),
    this.map = null,
    this.size = 1,
    this.sizeAttenuation = !0,
    this.vertexColors = !1,
    this.fog = !0,
    this.setValues(a)
}
,
THREE.ParticleSystemMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.ParticleSystemMaterial.prototype.clone = function() {
    var a = new THREE.ParticleSystemMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.color.copy(this.color),
    a.map = this.map,
    a.size = this.size,
    a.sizeAttenuation = this.sizeAttenuation,
    a.vertexColors = this.vertexColors,
    a.fog = this.fog,
    a
}
,
THREE.ParticleBasicMaterial = THREE.ParticleSystemMaterial,
THREE.ShaderMaterial = function(a) {
    THREE.Material.call(this),
    this.fragmentShader = "void main() {}",
    this.vertexShader = "void main() {}",
    this.uniforms = {},
    this.defines = {},
    this.attributes = null,
    this.shading = THREE.SmoothShading,
    this.linewidth = 1,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.fog = !1,
    this.lights = !1,
    this.vertexColors = THREE.NoColors,
    this.skinning = !1,
    this.morphTargets = !1,
    this.morphNormals = !1,
    this.defaultAttributeValues = {
        color: [1, 1, 1],
        uv: [0, 0],
        uv2: [0, 0]
    },
    this.index0AttributeName = "position",
    this.setValues(a)
}
,
THREE.ShaderMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.ShaderMaterial.prototype.clone = function() {
    var a = new THREE.ShaderMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.fragmentShader = this.fragmentShader,
    a.vertexShader = this.vertexShader,
    a.uniforms = THREE.UniformsUtils.clone(this.uniforms),
    a.attributes = this.attributes,
    a.defines = this.defines,
    a.shading = this.shading,
    a.wireframe = this.wireframe,
    a.wireframeLinewidth = this.wireframeLinewidth,
    a.fog = this.fog,
    a.lights = this.lights,
    a.vertexColors = this.vertexColors,
    a.skinning = this.skinning,
    a.morphTargets = this.morphTargets,
    a.morphNormals = this.morphNormals,
    a
}
,
THREE.SpriteMaterial = function(a) {
    THREE.Material.call(this),
    this.color = new THREE.Color(16777215),
    this.map = null,
    this.rotation = 0,
    this.fog = !1,
    this.setValues(a)
}
,
THREE.SpriteMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.SpriteMaterial.prototype.clone = function() {
    var a = new THREE.SpriteMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.color.copy(this.color),
    a.map = this.map,
    a.rotation = this.rotation,
    a.fog = this.fog,
    a
}
,
THREE.SpriteCanvasMaterial = function(a) {
    THREE.Material.call(this),
    this.color = new THREE.Color(16777215),
    this.program = function() {}
    ,
    this.setValues(a)
}
,
THREE.SpriteCanvasMaterial.prototype = Object.create(THREE.Material.prototype),
THREE.SpriteCanvasMaterial.prototype.clone = function() {
    var a = new THREE.SpriteCanvasMaterial;
    return THREE.Material.prototype.clone.call(this, a),
    a.color.copy(this.color),
    a.program = this.program,
    a
}
,
THREE.ParticleCanvasMaterial = THREE.SpriteCanvasMaterial,
THREE.Texture = function(a, b, c, d, e, f, g, h, i) {
    this.id = THREE.TextureIdCount++,
    this.uuid = THREE.Math.generateUUID(),
    this.name = "",
    this.image = a,
    this.mipmaps = [],
    this.mapping = void 0 !== b ? b : new THREE.UVMapping,
    this.wrapS = void 0 !== c ? c : THREE.ClampToEdgeWrapping,
    this.wrapT = void 0 !== d ? d : THREE.ClampToEdgeWrapping,
    this.magFilter = void 0 !== e ? e : THREE.LinearFilter,
    this.minFilter = void 0 !== f ? f : THREE.LinearMipMapLinearFilter,
    this.anisotropy = void 0 !== i ? i : 1,
    this.format = void 0 !== g ? g : THREE.RGBAFormat,
    this.type = void 0 !== h ? h : THREE.UnsignedByteType,
    this.offset = new THREE.Vector2(0,0),
    this.repeat = new THREE.Vector2(1,1),
    this.generateMipmaps = !0,
    this.premultiplyAlpha = !1,
    this.flipY = !0,
    this.unpackAlignment = 4,
    this._needsUpdate = !1,
    this.onUpdate = null
}
,
THREE.Texture.prototype = {
    constructor: THREE.Texture,
    get needsUpdate() {
        return this._needsUpdate
    },
    set needsUpdate(a) {
        a === !0 && this.update(),
        this._needsUpdate = a
    },
    clone: function(a) {
        return void 0 === a && (a = new THREE.Texture),
        a.image = this.image,
        a.mipmaps = this.mipmaps.slice(0),
        a.mapping = this.mapping,
        a.wrapS = this.wrapS,
        a.wrapT = this.wrapT,
        a.magFilter = this.magFilter,
        a.minFilter = this.minFilter,
        a.anisotropy = this.anisotropy,
        a.format = this.format,
        a.type = this.type,
        a.offset.copy(this.offset),
        a.repeat.copy(this.repeat),
        a.generateMipmaps = this.generateMipmaps,
        a.premultiplyAlpha = this.premultiplyAlpha,
        a.flipY = this.flipY,
        a.unpackAlignment = this.unpackAlignment,
        a
    },
    update: function() {
        this.dispatchEvent({
            type: "update"
        })
    },
    dispose: function() {
        this.dispatchEvent({
            type: "dispose"
        })
    }
},
THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),
THREE.TextureIdCount = 0,
THREE.CompressedTexture = function(a, b, c, d, e, f, g, h, i, j, k) {
    THREE.Texture.call(this, null, f, g, h, i, j, d, e, k),
    this.image = {
        width: b,
        height: c
    },
    this.mipmaps = a,
    this.generateMipmaps = !1
}
,
THREE.CompressedTexture.prototype = Object.create(THREE.Texture.prototype),
THREE.CompressedTexture.prototype.clone = function() {
    var a = new THREE.CompressedTexture;
    return THREE.Texture.prototype.clone.call(this, a),
    a
}
,
THREE.DataTexture = function(a, b, c, d, e, f, g, h, i, j, k) {
    THREE.Texture.call(this, null, f, g, h, i, j, d, e, k),
    this.image = {
        data: a,
        width: b,
        height: c
    }
}
,
THREE.DataTexture.prototype = Object.create(THREE.Texture.prototype),
THREE.DataTexture.prototype.clone = function() {
    var a = new THREE.DataTexture;
    return THREE.Texture.prototype.clone.call(this, a),
    a
}
,
THREE.ParticleSystem = function(a, b) {
    THREE.Object3D.call(this),
    this.geometry = void 0 !== a ? a : new THREE.Geometry,
    this.material = void 0 !== b ? b : new THREE.ParticleSystemMaterial({
        color: 16777215 * Math.random()
    }),
    this.sortParticles = !1,
    this.frustumCulled = !1
}
,
THREE.ParticleSystem.prototype = Object.create(THREE.Object3D.prototype),
THREE.ParticleSystem.prototype.clone = function(a) {
    return void 0 === a && (a = new THREE.ParticleSystem(this.geometry,this.material)),
    a.sortParticles = this.sortParticles,
    THREE.Object3D.prototype.clone.call(this, a),
    a
}
,
THREE.Line = function(a, b, c) {
    THREE.Object3D.call(this),
    this.geometry = void 0 !== a ? a : new THREE.Geometry,
    this.material = void 0 !== b ? b : new THREE.LineBasicMaterial({
        color: 16777215 * Math.random()
    }),
    this.type = void 0 !== c ? c : THREE.LineStrip
}
,
THREE.LineStrip = 0,
THREE.LinePieces = 1,
THREE.Line.prototype = Object.create(THREE.Object3D.prototype),
THREE.Line.prototype.clone = function(a) {
    return void 0 === a && (a = new THREE.Line(this.geometry,this.material,this.type)),
    THREE.Object3D.prototype.clone.call(this, a),
    a
}
,
THREE.Mesh = function(a, b) {
    THREE.Object3D.call(this),
    this.geometry = void 0 !== a ? a : new THREE.Geometry,
    this.material = void 0 !== b ? b : new THREE.MeshBasicMaterial({
        color: 16777215 * Math.random()
    }),
    this.updateMorphTargets()
}
,
THREE.Mesh.prototype = Object.create(THREE.Object3D.prototype),
THREE.Mesh.prototype.updateMorphTargets = function() {
    if (void 0 !== this.geometry.morphTargets && this.geometry.morphTargets.length > 0) {
        this.morphTargetBase = -1,
        this.morphTargetForcedOrder = [],
        this.morphTargetInfluences = [],
        this.morphTargetDictionary = {};
        for (var a = 0, b = this.geometry.morphTargets.length; b > a; a++)
            this.morphTargetInfluences.push(0),
            this.morphTargetDictionary[this.geometry.morphTargets[a].name] = a
    }
}
,
THREE.Mesh.prototype.getMorphTargetIndexByName = function(a) {
    return void 0 !== this.morphTargetDictionary[a] ? this.morphTargetDictionary[a] : (console.log("THREE.Mesh.getMorphTargetIndexByName: morph target " + a + " does not exist. Returning 0."),
    0)
}
,
THREE.Mesh.prototype.clone = function(a) {
    return void 0 === a && (a = new THREE.Mesh(this.geometry,this.material)),
    THREE.Object3D.prototype.clone.call(this, a),
    a
}
,
THREE.Bone = function(a) {
    THREE.Object3D.call(this),
    this.skin = a,
    this.skinMatrix = new THREE.Matrix4
}
,
THREE.Bone.prototype = Object.create(THREE.Object3D.prototype),
THREE.Bone.prototype.update = function(a, b) {
    this.matrixAutoUpdate && (b |= this.updateMatrix()),
    (b || this.matrixWorldNeedsUpdate) && (a ? this.skinMatrix.multiplyMatrices(a, this.matrix) : this.skinMatrix.copy(this.matrix),
    this.matrixWorldNeedsUpdate = !1,
    b = !0);
    var c, d = this.children.length;
    for (c = 0; d > c; c++)
        this.children[c].update(this.skinMatrix, b)
}
,
THREE.SkinnedMesh = function(a, b, c) {
    THREE.Mesh.call(this, a, b),
    this.useVertexTexture = void 0 !== c ? c : !0,
    this.identityMatrix = new THREE.Matrix4,
    this.bones = [],
    this.boneMatrices = [];
    var d, e, f, g, h, i;
    if (this.geometry && void 0 !== this.geometry.bones) {
        for (d = 0; d < this.geometry.bones.length; d++)
            f = this.geometry.bones[d],
            g = f.pos,
            h = f.rotq,
            i = f.scl,
            e = this.addBone(),
            e.name = f.name,
            e.position.set(g[0], g[1], g[2]),
            e.quaternion.set(h[0], h[1], h[2], h[3]),
            void 0 !== i ? e.scale.set(i[0], i[1], i[2]) : e.scale.set(1, 1, 1);
        for (d = 0; d < this.bones.length; d++)
            f = this.geometry.bones[d],
            e = this.bones[d],
            -1 === f.parent ? this.add(e) : this.bones[f.parent].add(e);
        var j = this.bones.length;
        if (this.useVertexTexture) {
            var k;
            k = j > 256 ? 64 : j > 64 ? 32 : j > 16 ? 16 : 8,
            this.boneTextureWidth = k,
            this.boneTextureHeight = k,
            this.boneMatrices = new Float32Array(this.boneTextureWidth * this.boneTextureHeight * 4),
            this.boneTexture = new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),
            this.boneTexture.minFilter = THREE.NearestFilter,
            this.boneTexture.magFilter = THREE.NearestFilter,
            this.boneTexture.generateMipmaps = !1,
            this.boneTexture.flipY = !1
        } else
            this.boneMatrices = new Float32Array(16 * j);
        this.pose()
    }
}
,
THREE.SkinnedMesh.prototype = Object.create(THREE.Mesh.prototype),
THREE.SkinnedMesh.prototype.addBone = function(a) {
    return void 0 === a && (a = new THREE.Bone(this)),
    this.bones.push(a),
    a
}
,
THREE.SkinnedMesh.prototype.updateMatrixWorld = function() {
    var a = new THREE.Matrix4;
    return function(b) {
        this.matrixAutoUpdate && this.updateMatrix(),
        (this.matrixWorldNeedsUpdate || b) && (this.parent ? this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix) : this.matrixWorld.copy(this.matrix),
        this.matrixWorldNeedsUpdate = !1,
        b = !0);
        for (var c = 0, d = this.children.length; d > c; c++) {
            var e = this.children[c];
            e instanceof THREE.Bone ? e.update(this.identityMatrix, !1) : e.updateMatrixWorld(!0)
        }
        if (void 0 == this.boneInverses) {
            this.boneInverses = [];
            for (var f = 0, g = this.bones.length; g > f; f++) {
                var h = new THREE.Matrix4;
                h.getInverse(this.bones[f].skinMatrix),
                this.boneInverses.push(h)
            }
        }
        for (var f = 0, g = this.bones.length; g > f; f++)
            a.multiplyMatrices(this.bones[f].skinMatrix, this.boneInverses[f]),
            a.flattenToArrayOffset(this.boneMatrices, 16 * f);
        this.useVertexTexture && (this.boneTexture.needsUpdate = !0)
    }
}(),
THREE.SkinnedMesh.prototype.pose = function() {
    this.updateMatrixWorld(!0),
    this.normalizeSkinWeights()
}
,
THREE.SkinnedMesh.prototype.normalizeSkinWeights = function() {
    if (this.geometry instanceof THREE.Geometry)
        for (var a = 0; a < this.geometry.skinIndices.length; a++) {
            var b = this.geometry.skinWeights[a]
              , c = 1 / b.lengthManhattan();
            1 / 0 !== c ? b.multiplyScalar(c) : b.set(1)
        }
}
,
THREE.SkinnedMesh.prototype.clone = function(a) {
    return void 0 === a && (a = new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),
    THREE.Mesh.prototype.clone.call(this, a),
    a
}
,
THREE.MorphAnimMesh = function(a, b) {
    THREE.Mesh.call(this, a, b),
    this.duration = 1e3,
    this.mirroredLoop = !1,
    this.time = 0,
    this.lastKeyframe = 0,
    this.currentKeyframe = 0,
    this.direction = 1,
    this.directionBackwards = !1,
    this.setFrameRange(0, this.geometry.morphTargets.length - 1)
}
,
THREE.MorphAnimMesh.prototype = Object.create(THREE.Mesh.prototype),
THREE.MorphAnimMesh.prototype.setFrameRange = function(a, b) {
    this.startKeyframe = a,
    this.endKeyframe = b,
    this.length = this.endKeyframe - this.startKeyframe + 1
}
,
THREE.MorphAnimMesh.prototype.setDirectionForward = function() {
    this.direction = 1,
    this.directionBackwards = !1
}
,
THREE.MorphAnimMesh.prototype.setDirectionBackward = function() {
    this.direction = -1,
    this.directionBackwards = !0
}
,
THREE.MorphAnimMesh.prototype.parseAnimations = function() {
    var a = this.geometry;
    a.animations || (a.animations = {});
    for (var b, c = a.animations, d = /([a-z]+)(\d+)/, e = 0, f = a.morphTargets.length; f > e; e++) {
        var g = a.morphTargets[e]
          , h = g.name.match(d);
        if (h && h.length > 1) {
            {
                var i = h[1];
                h[2]
            }
            c[i] || (c[i] = {
                start: 1 / 0,
                end: -1 / 0
            });
            var j = c[i];
            e < j.start && (j.start = e),
            e > j.end && (j.end = e),
            b || (b = i)
        }
    }
    a.firstAnimation = b
}
,
THREE.MorphAnimMesh.prototype.setAnimationLabel = function(a, b, c) {
    this.geometry.animations || (this.geometry.animations = {}),
    this.geometry.animations[a] = {
        start: b,
        end: c
    }
}
,
THREE.MorphAnimMesh.prototype.playAnimation = function(a, b) {
    var c = this.geometry.animations[a];
    c ? (this.setFrameRange(c.start, c.end),
    this.duration = 1e3 * ((c.end - c.start) / b),
    this.time = 0) : console.warn("animation[" + a + "] undefined")
}
,
THREE.MorphAnimMesh.prototype.updateAnimation = function(a) {
    var b = this.duration / this.length;
    this.time += this.direction * a,
    this.mirroredLoop ? (this.time > this.duration || this.time < 0) && (this.direction *= -1,
    this.time > this.duration && (this.time = this.duration,
    this.directionBackwards = !0),
    this.time < 0 && (this.time = 0,
    this.directionBackwards = !1)) : (this.time = this.time % this.duration,
    this.time < 0 && (this.time += this.duration));
    var c = this.startKeyframe + THREE.Math.clamp(Math.floor(this.time / b), 0, this.length - 1);
    c !== this.currentKeyframe && (this.morphTargetInfluences[this.lastKeyframe] = 0,
    this.morphTargetInfluences[this.currentKeyframe] = 1,
    this.morphTargetInfluences[c] = 0,
    this.lastKeyframe = this.currentKeyframe,
    this.currentKeyframe = c);
    var d = this.time % b / b;
    this.directionBackwards && (d = 1 - d),
    this.morphTargetInfluences[this.currentKeyframe] = d,
    this.morphTargetInfluences[this.lastKeyframe] = 1 - d
}
,
THREE.MorphAnimMesh.prototype.clone = function(a) {
    return void 0 === a && (a = new THREE.MorphAnimMesh(this.geometry,this.material)),
    a.duration = this.duration,
    a.mirroredLoop = this.mirroredLoop,
    a.time = this.time,
    a.lastKeyframe = this.lastKeyframe,
    a.currentKeyframe = this.currentKeyframe,
    a.direction = this.direction,
    a.directionBackwards = this.directionBackwards,
    THREE.Mesh.prototype.clone.call(this, a),
    a
}
,
THREE.LOD = function() {
    THREE.Object3D.call(this),
    this.objects = []
}
,
THREE.LOD.prototype = Object.create(THREE.Object3D.prototype),
THREE.LOD.prototype.addLevel = function(a, b) {
    void 0 === b && (b = 0),
    b = Math.abs(b);
    for (var c = 0; c < this.objects.length && !(b < this.objects[c].distance); c++)
        ;
    this.objects.splice(c, 0, {
        distance: b,
        object: a
    }),
    this.add(a)
}
,
THREE.LOD.prototype.getObjectForDistance = function(a) {
    for (var b = 1, c = this.objects.length; c > b && !(a < this.objects[b].distance); b++)
        ;
    return this.objects[b - 1].object
}
,
THREE.LOD.prototype.update = function() {
    var a = new THREE.Vector3
      , b = new THREE.Vector3;
    return function(c) {
        if (this.objects.length > 1) {
            a.setFromMatrixPosition(c.matrixWorld),
            b.setFromMatrixPosition(this.matrixWorld);
            var d = a.distanceTo(b);
            this.objects[0].object.visible = !0;
            for (var e = 1, f = this.objects.length; f > e && d >= this.objects[e].distance; e++)
                this.objects[e - 1].object.visible = !1,
                this.objects[e].object.visible = !0;
            for (; f > e; e++)
                this.objects[e].object.visible = !1
        }
    }
}(),
THREE.LOD.prototype.clone = function(a) {
    void 0 === a && (a = new THREE.LOD),
    THREE.Object3D.prototype.clone.call(this, a);
    for (var b = 0, c = this.objects.length; c > b; b++) {
        var d = this.objects[b].object.clone();
        d.visible = 0 === b,
        a.addLevel(d, this.objects[b].distance)
    }
    return a
}
,
THREE.Sprite = function() {
    var a = new THREE.Geometry2(3);
    return a.vertices.set([-.5, -.5, 0, .5, -.5, 0, .5, .5, 0]),
    function(b) {
        THREE.Object3D.call(this),
        this.geometry = a,
        this.material = void 0 !== b ? b : new THREE.SpriteMaterial
    }
}(),
THREE.Sprite.prototype = Object.create(THREE.Object3D.prototype),
THREE.Sprite.prototype.updateMatrix = function() {
    this.matrix.compose(this.position, this.quaternion, this.scale),
    this.matrixWorldNeedsUpdate = !0
}
,
THREE.Sprite.prototype.clone = function(a) {
    return void 0 === a && (a = new THREE.Sprite(this.material)),
    THREE.Object3D.prototype.clone.call(this, a),
    a
}
,
THREE.Particle = THREE.Sprite,
THREE.Scene = function() {
    THREE.Object3D.call(this),
    this.fog = null,
    this.overrideMaterial = null,
    this.autoUpdate = !0,
    this.matrixAutoUpdate = !1,
    this.__lights = [],
    this.__objectsAdded = [],
    this.__objectsRemoved = []
}
,
THREE.Scene.prototype = Object.create(THREE.Object3D.prototype),
THREE.Scene.prototype.__addObject = function(a) {
    if (a instanceof THREE.Light)
        -1 === this.__lights.indexOf(a) && this.__lights.push(a),
        a.target && void 0 === a.target.parent && this.add(a.target);
    else if (!(a instanceof THREE.Camera || a instanceof THREE.Bone)) {
        this.__objectsAdded.push(a);
        var b = this.__objectsRemoved.indexOf(a);
        -1 !== b && this.__objectsRemoved.splice(b, 1)
    }
    this.dispatchEvent({
        type: "objectAdded",
        object: a
    }),
    a.dispatchEvent({
        type: "addedToScene",
        scene: this
    });
    for (var c = 0; c < a.children.length; c++)
        this.__addObject(a.children[c])
}
,
THREE.Scene.prototype.__removeObject = function(a) {
    if (a instanceof THREE.Light) {
        var b = this.__lights.indexOf(a);
        if (-1 !== b && this.__lights.splice(b, 1),
        a.shadowCascadeArray)
            for (var c = 0; c < a.shadowCascadeArray.length; c++)
                this.__removeObject(a.shadowCascadeArray[c])
    } else if (!(a instanceof THREE.Camera)) {
        this.__objectsRemoved.push(a);
        var b = this.__objectsAdded.indexOf(a);
        -1 !== b && this.__objectsAdded.splice(b, 1)
    }
    this.dispatchEvent({
        type: "objectRemoved",
        object: a
    }),
    a.dispatchEvent({
        type: "removedFromScene",
        scene: this
    });
    for (var d = 0; d < a.children.length; d++)
        this.__removeObject(a.children[d])
}
,
THREE.Scene.prototype.clone = function(a) {
    return void 0 === a && (a = new THREE.Scene),
    THREE.Object3D.prototype.clone.call(this, a),
    null !== this.fog && (a.fog = this.fog.clone()),
    null !== this.overrideMaterial && (a.overrideMaterial = this.overrideMaterial.clone()),
    a.autoUpdate = this.autoUpdate,
    a.matrixAutoUpdate = this.matrixAutoUpdate,
    a
}
,
THREE.Fog = function(a, b, c) {
    this.name = "",
    this.color = new THREE.Color(a),
    this.near = void 0 !== b ? b : 1,
    this.far = void 0 !== c ? c : 1e3
}
,
THREE.Fog.prototype.clone = function() {
    return new THREE.Fog(this.color.getHex(),this.near,this.far)
}
,
THREE.FogExp2 = function(a, b) {
    this.name = "",
    this.color = new THREE.Color(a),
    this.density = void 0 !== b ? b : 25e-5
}
,
THREE.FogExp2.prototype.clone = function() {
    return new THREE.FogExp2(this.color.getHex(),this.density)
}
,
THREE.CanvasRenderer = function(a) {
    function b() {
        Eb.setRGB(0, 0, 0),
        Fb.setRGB(0, 0, 0),
        Gb.setRGB(0, 0, 0);
        for (var a = 0, b = A.length; b > a; a++) {
            var c = A[a]
              , d = c.color;
            c instanceof THREE.AmbientLight ? Eb.add(d) : c instanceof THREE.DirectionalLight ? Fb.add(d) : c instanceof THREE.PointLight && Gb.add(d)
        }
    }
    function c(a, b, c) {
        for (var d = 0, e = A.length; e > d; d++) {
            var f = A[d];
            if (zb.copy(f.color),
            f instanceof THREE.DirectionalLight) {
                var g = Hb.setFromMatrixPosition(f.matrixWorld).normalize()
                  , h = b.dot(g);
                if (0 >= h)
                    continue;
                h *= f.intensity,
                c.add(zb.multiplyScalar(h))
            } else if (f instanceof THREE.PointLight) {
                var g = Hb.setFromMatrixPosition(f.matrixWorld)
                  , h = b.dot(Hb.subVectors(g, a).normalize());
                if (0 >= h)
                    continue;
                if (h *= 0 == f.distance ? 1 : 1 - Math.min(a.distanceTo(g) / f.distance, 1),
                0 == h)
                    continue;
                h *= f.intensity,
                c.add(zb.multiplyScalar(h))
            }
        }
    }
    function d(a, b, c) {
        p(c.opacity),
        q(c.blending);
        var d = b.scale.x * eb
          , e = b.scale.y * fb
          , f = .5 * Math.sqrt(d * d + e * e);
        if (Db.min.set(a.x - f, a.y - f),
        Db.max.set(a.x + f, a.y + f),
        c instanceof THREE.SpriteMaterial || c instanceof THREE.ParticleSystemMaterial) {
            var g = c.map;
            if (null !== g) {
                g.hasEventListener("update", j) === !1 && (void 0 !== g.image && g.image.width > 0 && k(g),
                g.addEventListener("update", j));
                var h = Ab[g.id];
                void 0 !== h ? v(h) : v("rgba( 0, 0, 0, 1 )");
                var i = g.image
                  , l = i.width * g.offset.x
                  , m = i.height * g.offset.y
                  , n = i.width * g.repeat.x
                  , o = i.height * g.repeat.y
                  , r = d / n
                  , s = e / o;
                gb.save(),
                gb.translate(a.x, a.y),
                0 !== c.rotation && gb.rotate(c.rotation),
                gb.translate(-d / 2, -e / 2),
                gb.scale(r, s),
                gb.translate(-l, -m),
                gb.fillRect(l, m, n, o),
                gb.restore()
            } else
                v(c.color.getStyle()),
                gb.save(),
                gb.translate(a.x, a.y),
                0 !== c.rotation && gb.rotate(c.rotation),
                gb.scale(d, -e),
                gb.fillRect(-.5, -.5, 1, 1),
                gb.restore()
        } else
            c instanceof THREE.SpriteCanvasMaterial && (u(c.color.getStyle()),
            v(c.color.getStyle()),
            gb.save(),
            gb.translate(a.x, a.y),
            0 !== c.rotation && gb.rotate(c.rotation),
            gb.scale(d, e),
            c.program(gb),
            gb.restore())
    }
    function e(a, b, c, d) {
        if (p(d.opacity),
        q(d.blending),
        gb.beginPath(),
        gb.moveTo(a.positionScreen.x, a.positionScreen.y),
        gb.lineTo(b.positionScreen.x, b.positionScreen.y),
        d instanceof THREE.LineBasicMaterial) {
            if (r(d.linewidth),
            s(d.linecap),
            t(d.linejoin),
            d.vertexColors !== THREE.VertexColors)
                u(d.color.getStyle());
            else {
                var e = c.vertexColors[0].getStyle()
                  , f = c.vertexColors[1].getStyle();
                if (e === f)
                    u(e);
                else {
                    try {
                        var g = gb.createLinearGradient(a.positionScreen.x, a.positionScreen.y, b.positionScreen.x, b.positionScreen.y);
                        g.addColorStop(0, e),
                        g.addColorStop(1, f)
                    } catch (h) {
                        g = e
                    }
                    u(g)
                }
            }
            gb.stroke(),
            Db.expandByScalar(2 * d.linewidth)
        } else
            d instanceof THREE.LineDashedMaterial && (r(d.linewidth),
            s(d.linecap),
            t(d.linejoin),
            u(d.color.getStyle()),
            w(d.dashSize, d.gapSize),
            gb.stroke(),
            Db.expandByScalar(2 * d.linewidth),
            w(null, null))
    }
    function f(a, b, d, e, f, j, k, o) {
        _.info.render.vertices += 3,
        _.info.render.faces++,
        p(o.opacity),
        q(o.blending),
        F = a.positionScreen.x,
        G = a.positionScreen.y,
        H = b.positionScreen.x,
        I = b.positionScreen.y,
        J = d.positionScreen.x,
        K = d.positionScreen.y,
        g(F, G, H, I, J, K),
        (o instanceof THREE.MeshLambertMaterial || o instanceof THREE.MeshPhongMaterial) && null === o.map ? (xb.copy(o.color),
        yb.copy(o.emissive),
        o.vertexColors === THREE.FaceColors && xb.multiply(k.color),
        o.wireframe === !1 && o.shading === THREE.SmoothShading && 3 === k.vertexNormalsLength ? (tb.copy(Eb),
        ub.copy(Eb),
        vb.copy(Eb),
        c(k.v1.positionWorld, k.vertexNormalsModel[0], tb),
        c(k.v2.positionWorld, k.vertexNormalsModel[1], ub),
        c(k.v3.positionWorld, k.vertexNormalsModel[2], vb),
        tb.multiply(xb).add(yb),
        ub.multiply(xb).add(yb),
        vb.multiply(xb).add(yb),
        wb.addColors(ub, vb).multiplyScalar(.5),
        N = n(tb, ub, vb, wb),
        m(F, G, H, I, J, K, 0, 0, 1, 0, 0, 1, N)) : (sb.copy(Eb),
        c(k.centroidModel, k.normalModel, sb),
        sb.multiply(xb).add(yb),
        o.wireframe === !0 ? h(sb, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : i(sb))) : o instanceof THREE.MeshBasicMaterial || o instanceof THREE.MeshLambertMaterial || o instanceof THREE.MeshPhongMaterial ? null !== o.map ? o.map.mapping instanceof THREE.UVMapping && (O = k.uvs[0],
        l(F, G, H, I, J, K, O[e].x, O[e].y, O[f].x, O[f].y, O[j].x, O[j].y, o.map)) : null !== o.envMap ? o.envMap.mapping instanceof THREE.SphericalReflectionMapping && (Ib.copy(k.vertexNormalsModel[e]).applyMatrix3(Jb),
        P = .5 * Ib.x + .5,
        Q = .5 * Ib.y + .5,
        Ib.copy(k.vertexNormalsModel[f]).applyMatrix3(Jb),
        R = .5 * Ib.x + .5,
        S = .5 * Ib.y + .5,
        Ib.copy(k.vertexNormalsModel[j]).applyMatrix3(Jb),
        T = .5 * Ib.x + .5,
        U = .5 * Ib.y + .5,
        l(F, G, H, I, J, K, P, Q, R, S, T, U, o.envMap)) : (sb.copy(o.color),
        o.vertexColors === THREE.FaceColors && sb.multiply(k.color),
        o.wireframe === !0 ? h(sb, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : i(sb)) : o instanceof THREE.MeshDepthMaterial ? (L = B.near,
        M = B.far,
        tb.r = tb.g = tb.b = 1 - x(a.positionScreen.z * a.positionScreen.w, L, M),
        ub.r = ub.g = ub.b = 1 - x(b.positionScreen.z * b.positionScreen.w, L, M),
        vb.r = vb.g = vb.b = 1 - x(d.positionScreen.z * d.positionScreen.w, L, M),
        wb.addColors(ub, vb).multiplyScalar(.5),
        N = n(tb, ub, vb, wb),
        m(F, G, H, I, J, K, 0, 0, 1, 0, 0, 1, N)) : o instanceof THREE.MeshNormalMaterial && (o.shading === THREE.FlatShading ? (Ib.copy(k.normalModel).applyMatrix3(Jb),
        sb.setRGB(Ib.x, Ib.y, Ib.z).multiplyScalar(.5).addScalar(.5),
        o.wireframe === !0 ? h(sb, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : i(sb)) : o.shading === THREE.SmoothShading && (Ib.copy(k.vertexNormalsModel[e]).applyMatrix3(Jb),
        tb.setRGB(Ib.x, Ib.y, Ib.z).multiplyScalar(.5).addScalar(.5),
        Ib.copy(k.vertexNormalsModel[f]).applyMatrix3(Jb),
        ub.setRGB(Ib.x, Ib.y, Ib.z).multiplyScalar(.5).addScalar(.5),
        Ib.copy(k.vertexNormalsModel[j]).applyMatrix3(Jb),
        vb.setRGB(Ib.x, Ib.y, Ib.z).multiplyScalar(.5).addScalar(.5),
        wb.addColors(ub, vb).multiplyScalar(.5),
        N = n(tb, ub, vb, wb),
        m(F, G, H, I, J, K, 0, 0, 1, 0, 0, 1, N)))
    }
    function g(a, b, c, d, e, f) {
        gb.beginPath(),
        gb.moveTo(a, b),
        gb.lineTo(c, d),
        gb.lineTo(e, f),
        gb.closePath()
    }
    function h(a, b, c, d) {
        r(b),
        s(c),
        t(d),
        u(a.getStyle()),
        gb.stroke(),
        Db.expandByScalar(2 * b)
    }
    function i(a) {
        v(a.getStyle()),
        gb.fill()
    }
    function j(a) {
        k(a.target)
    }
    function k(a) {
        var b = a.wrapS === THREE.RepeatWrapping
          , c = a.wrapT === THREE.RepeatWrapping
          , d = a.image
          , e = document.createElement("canvas");
        e.width = d.width,
        e.height = d.height;
        var f = e.getContext("2d");
        f.setTransform(1, 0, 0, -1, 0, d.height),
        f.drawImage(d, 0, 0),
        Ab[a.id] = gb.createPattern(e, b === !0 && c === !0 ? "repeat" : b === !0 && c === !1 ? "repeat-x" : b === !1 && c === !0 ? "repeat-y" : "no-repeat")
    }
    function l(a, b, c, d, e, f, g, h, i, l, m, n, o) {
        if (!(o instanceof THREE.DataTexture)) {
            o.hasEventListener("update", j) === !1 && (void 0 !== o.image && o.image.width > 0 && k(o),
            o.addEventListener("update", j));
            var p = Ab[o.id];
            if (void 0 === p)
                return v("rgba(0,0,0,1)"),
                gb.fill(),
                void 0;
            v(p);
            var q, r, s, t, u, w, x, y, z = o.offset.x / o.repeat.x, A = o.offset.y / o.repeat.y, B = o.image.width * o.repeat.x, C = o.image.height * o.repeat.y;
            g = (g + z) * B,
            h = (h + A) * C,
            i = (i + z) * B,
            l = (l + A) * C,
            m = (m + z) * B,
            n = (n + A) * C,
            c -= a,
            d -= b,
            e -= a,
            f -= b,
            i -= g,
            l -= h,
            m -= g,
            n -= h,
            x = i * n - m * l,
            0 !== x && (y = 1 / x,
            q = (n * c - l * e) * y,
            r = (n * d - l * f) * y,
            s = (i * e - m * c) * y,
            t = (i * f - m * d) * y,
            u = a - q * g - s * h,
            w = b - r * g - t * h,
            gb.save(),
            gb.transform(q, r, s, t, u, w),
            gb.fill(),
            gb.restore())
        }
    }
    function m(a, b, c, d, e, f, g, h, i, j, k, l, m) {
        var n, o, p, q, r, s, t, u, v = m.width - 1, w = m.height - 1;
        g *= v,
        h *= w,
        i *= v,
        j *= w,
        k *= v,
        l *= w,
        c -= a,
        d -= b,
        e -= a,
        f -= b,
        i -= g,
        j -= h,
        k -= g,
        l -= h,
        t = i * l - k * j,
        u = 1 / t,
        n = (l * c - j * e) * u,
        o = (l * d - j * f) * u,
        p = (i * e - k * c) * u,
        q = (i * f - k * d) * u,
        r = a - n * g - p * h,
        s = b - o * g - q * h,
        gb.save(),
        gb.transform(n, o, p, q, r, s),
        gb.clip(),
        gb.drawImage(m, 0, 0),
        gb.restore()
    }
    function n(a, b, c, d) {
        return Y[0] = 255 * a.r | 0,
        Y[1] = 255 * a.g | 0,
        Y[2] = 255 * a.b | 0,
        Y[4] = 255 * b.r | 0,
        Y[5] = 255 * b.g | 0,
        Y[6] = 255 * b.b | 0,
        Y[8] = 255 * c.r | 0,
        Y[9] = 255 * c.g | 0,
        Y[10] = 255 * c.b | 0,
        Y[12] = 255 * d.r | 0,
        Y[13] = 255 * d.g | 0,
        Y[14] = 255 * d.b | 0,
        W.putImageData(X, 0, 0),
        $.drawImage(V, 0, 0),
        Z
    }
    function o(a, b, c) {
        var d, e = b.x - a.x, f = b.y - a.y, g = e * e + f * f;
        0 !== g && (d = c / Math.sqrt(g),
        e *= d,
        f *= d,
        b.x += e,
        b.y += f,
        a.x -= e,
        a.y -= f)
    }
    function p(a) {
        jb !== a && (gb.globalAlpha = a,
        jb = a)
    }
    function q(a) {
        kb !== a && (a === THREE.NormalBlending ? gb.globalCompositeOperation = "source-over" : a === THREE.AdditiveBlending ? gb.globalCompositeOperation = "lighter" : a === THREE.SubtractiveBlending && (gb.globalCompositeOperation = "darker"),
        kb = a)
    }
    function r(a) {
        nb !== a && (gb.lineWidth = a,
        nb = a)
    }
    function s(a) {
        ob !== a && (gb.lineCap = a,
        ob = a)
    }
    function t(a) {
        pb !== a && (gb.lineJoin = a,
        pb = a)
    }
    function u(a) {
        lb !== a && (gb.strokeStyle = a,
        lb = a)
    }
    function v(a) {
        mb !== a && (gb.fillStyle = a,
        mb = a)
    }
    function w(a, b) {
        (qb !== a || rb !== b) && (gb.setLineDash([a, b]),
        qb = a,
        rb = b)
    }
    console.log("THREE.CanvasRenderer", THREE.REVISION);
    var x = THREE.Math.smoothstep;
    a = a || {};
    var y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, $, _ = this, ab = new THREE.Projector, bb = void 0 !== a.canvas ? a.canvas : document.createElement("canvas"), cb = bb.width, db = bb.height, eb = Math.floor(cb / 2), fb = Math.floor(db / 2), gb = bb.getContext("2d", {
        alpha: a.alpha === !0
    }), hb = new THREE.Color(0), ib = 0, jb = 1, kb = 0, lb = null, mb = null, nb = null, ob = null, pb = null, qb = null, rb = 0, sb = (new THREE.RenderableVertex,
    new THREE.RenderableVertex,
    new THREE.Color), tb = new THREE.Color, ub = new THREE.Color, vb = new THREE.Color, wb = new THREE.Color, xb = new THREE.Color, yb = new THREE.Color, zb = new THREE.Color, Ab = {}, Bb = new THREE.Box2, Cb = new THREE.Box2, Db = new THREE.Box2, Eb = new THREE.Color, Fb = new THREE.Color, Gb = new THREE.Color, Hb = new THREE.Vector3, Ib = new THREE.Vector3, Jb = new THREE.Matrix3, Kb = 16;
    V = document.createElement("canvas"),
    V.width = V.height = 2,
    W = V.getContext("2d"),
    W.fillStyle = "rgba(0,0,0,1)",
    W.fillRect(0, 0, 2, 2),
    X = W.getImageData(0, 0, 2, 2),
    Y = X.data,
    Z = document.createElement("canvas"),
    Z.width = Z.height = Kb,
    $ = Z.getContext("2d"),
    $.translate(-Kb / 2, -Kb / 2),
    $.scale(Kb, Kb),
    Kb--,
    void 0 === gb.setLineDash && (gb.setLineDash = void 0 !== gb.mozDash ? function(a) {
        gb.mozDash = null !== a[0] ? a : null
    }
    : function() {}
    ),
    this.domElement = bb,
    this.devicePixelRatio = void 0 !== a.devicePixelRatio ? a.devicePixelRatio : void 0 !== self.devicePixelRatio ? self.devicePixelRatio : 1,
    this.autoClear = !0,
    this.sortObjects = !0,
    this.sortElements = !0,
    this.info = {
        render: {
            vertices: 0,
            faces: 0
        }
    },
    this.supportsVertexTextures = function() {}
    ,
    this.setFaceCulling = function() {}
    ,
    this.setSize = function(a, b, c) {
        cb = a * this.devicePixelRatio,
        db = b * this.devicePixelRatio,
        eb = Math.floor(cb / 2),
        fb = Math.floor(db / 2),
        bb.width = cb,
        bb.height = db,
        1 !== this.devicePixelRatio && c !== !1 && (bb.style.width = a + "px",
        bb.style.height = b + "px"),
        Bb.min.set(-eb, -fb),
        Bb.max.set(eb, fb),
        Cb.min.set(-eb, -fb),
        Cb.max.set(eb, fb),
        jb = 1,
        kb = 0,
        lb = null,
        mb = null,
        nb = null,
        ob = null,
        pb = null
    }
    ,
    this.setClearColor = function(a, b) {
        hb.set(a),
        ib = void 0 !== b ? b : 1,
        Cb.min.set(-eb, -fb),
        Cb.max.set(eb, fb)
    }
    ,
    this.setClearColorHex = function(a, b) {
        console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),
        this.setClearColor(a, b)
    }
    ,
    this.getMaxAnisotropy = function() {
        return 0
    }
    ,
    this.clear = function() {
        gb.setTransform(1, 0, 0, -1, eb, fb),
        Cb.empty() === !1 && (Cb.intersect(Bb),
        Cb.expandByScalar(2),
        1 > ib && gb.clearRect(0 | Cb.min.x, 0 | Cb.min.y, Cb.max.x - Cb.min.x | 0, Cb.max.y - Cb.min.y | 0),
        ib > 0 && (q(THREE.NormalBlending),
        p(1),
        v("rgba(" + Math.floor(255 * hb.r) + "," + Math.floor(255 * hb.g) + "," + Math.floor(255 * hb.b) + "," + ib + ")"),
        gb.fillRect(0 | Cb.min.x, 0 | Cb.min.y, Cb.max.x - Cb.min.x | 0, Cb.max.y - Cb.min.y | 0)),
        Cb.makeEmpty())
    }
    ,
    this.clearColor = function() {}
    ,
    this.clearDepth = function() {}
    ,
    this.clearStencil = function() {}
    ,
    this.render = function(a, c) {
        if (c instanceof THREE.Camera == !1)
            return console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera."),
            void 0;
        this.autoClear === !0 && this.clear(),
        gb.setTransform(1, 0, 0, -1, eb, fb),
        _.info.render.vertices = 0,
        _.info.render.faces = 0,
        y = ab.projectScene(a, c, this.sortObjects, this.sortElements),
        z = y.elements,
        A = y.lights,
        B = c,
        Jb.getNormalMatrix(c.matrixWorldInverse),
        b();
        for (var g = 0, h = z.length; h > g; g++) {
            var i = z[g]
              , j = i.material;
            if (void 0 !== j && j.visible !== !1) {
                if (Db.makeEmpty(),
                i instanceof THREE.RenderableSprite)
                    C = i,
                    C.x *= eb,
                    C.y *= fb,
                    d(C, i, j);
                else if (i instanceof THREE.RenderableLine)
                    C = i.v1,
                    D = i.v2,
                    C.positionScreen.x *= eb,
                    C.positionScreen.y *= fb,
                    D.positionScreen.x *= eb,
                    D.positionScreen.y *= fb,
                    Db.setFromPoints([C.positionScreen, D.positionScreen]),
                    Bb.isIntersectionBox(Db) === !0 && e(C, D, i, j);
                else if (i instanceof THREE.RenderableFace) {
                    if (C = i.v1,
                    D = i.v2,
                    E = i.v3,
                    C.positionScreen.z < -1 || C.positionScreen.z > 1)
                        continue;
                    if (D.positionScreen.z < -1 || D.positionScreen.z > 1)
                        continue;
                    if (E.positionScreen.z < -1 || E.positionScreen.z > 1)
                        continue;
                    C.positionScreen.x *= eb,
                    C.positionScreen.y *= fb,
                    D.positionScreen.x *= eb,
                    D.positionScreen.y *= fb,
                    E.positionScreen.x *= eb,
                    E.positionScreen.y *= fb,
                    j.overdraw > 0 && (o(C.positionScreen, D.positionScreen, j.overdraw),
                    o(D.positionScreen, E.positionScreen, j.overdraw),
                    o(E.positionScreen, C.positionScreen, j.overdraw)),
                    Db.setFromPoints([C.positionScreen, D.positionScreen, E.positionScreen]),
                    Bb.isIntersectionBox(Db) === !0 && f(C, D, E, 0, 1, 2, i, j)
                }
                Cb.union(Db)
            }
        }
        gb.setTransform(1, 0, 0, 1, 0, 0)
    }
}
,
THREE.ShaderChunk = {
    fog_pars_fragment: ["#ifdef USE_FOG", "uniform vec3 fogColor;", "#ifdef FOG_EXP2", "uniform float fogDensity;", "#else", "uniform float fogNear;", "uniform float fogFar;", "#endif", "#endif"].join("\n"),
    fog_fragment: ["#ifdef USE_FOG", "float depth = gl_FragCoord.z / gl_FragCoord.w;", "#ifdef FOG_EXP2", "const float LOG2 = 1.442695;", "float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );", "fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );", "#else", "float fogFactor = smoothstep( fogNear, fogFar, depth );", "#endif", "gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );", "#endif"].join("\n"),
    envmap_pars_fragment: ["#ifdef USE_ENVMAP", "uniform float reflectivity;", "uniform samplerCube envMap;", "uniform float flipEnvMap;", "uniform int combine;", "#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )", "uniform bool useRefract;", "uniform float refractionRatio;", "#else", "varying vec3 vReflect;", "#endif", "#endif"].join("\n"),
    envmap_fragment: ["#ifdef USE_ENVMAP", "vec3 reflectVec;", "#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )", "vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );", "if ( useRefract ) {", "reflectVec = refract( cameraToVertex, normal, refractionRatio );", "} else { ", "reflectVec = reflect( cameraToVertex, normal );", "}", "#else", "reflectVec = vReflect;", "#endif", "#ifdef DOUBLE_SIDED", "float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );", "vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );", "#else", "vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );", "#endif", "#ifdef GAMMA_INPUT", "cubeColor.xyz *= cubeColor.xyz;", "#endif", "if ( combine == 1 ) {", "gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );", "} else if ( combine == 2 ) {", "gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;", "} else {", "gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );", "}", "#endif"].join("\n"),
    envmap_pars_vertex: ["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )", "varying vec3 vReflect;", "uniform float refractionRatio;", "uniform bool useRefract;", "#endif"].join("\n"),
    worldpos_vertex: ["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )", "#ifdef USE_SKINNING", "vec4 worldPosition = modelMatrix * skinned;", "#endif", "#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )", "vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );", "#endif", "#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )", "vec4 worldPosition = modelMatrix * vec4( position, 1.0 );", "#endif", "#endif"].join("\n"),
    envmap_vertex: ["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )", "vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;", "worldNormal = normalize( worldNormal );", "vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );", "if ( useRefract ) {", "vReflect = refract( cameraToVertex, worldNormal, refractionRatio );", "} else {", "vReflect = reflect( cameraToVertex, worldNormal );", "}", "#endif"].join("\n"),
    map_particle_pars_fragment: ["#ifdef USE_MAP", "uniform sampler2D map;", "#endif"].join("\n"),
    map_particle_fragment: ["#ifdef USE_MAP", "gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );", "#endif"].join("\n"),
    map_pars_vertex: ["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )", "varying vec2 vUv;", "uniform vec4 offsetRepeat;", "#endif"].join("\n"),
    map_pars_fragment: ["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )", "varying vec2 vUv;", "#endif", "#ifdef USE_MAP", "uniform sampler2D map;", "#endif"].join("\n"),
    map_vertex: ["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )", "vUv = uv * offsetRepeat.zw + offsetRepeat.xy;", "#endif"].join("\n"),
    map_fragment: ["#ifdef USE_MAP", "vec4 texelColor = texture2D( map, vUv );", "#ifdef GAMMA_INPUT", "texelColor.xyz *= texelColor.xyz;", "#endif", "gl_FragColor = gl_FragColor * texelColor;", "#endif"].join("\n"),
    lightmap_pars_fragment: ["#ifdef USE_LIGHTMAP", "varying vec2 vUv2;", "uniform sampler2D lightMap;", "#endif"].join("\n"),
    lightmap_pars_vertex: ["#ifdef USE_LIGHTMAP", "varying vec2 vUv2;", "#endif"].join("\n"),
    lightmap_fragment: ["#ifdef USE_LIGHTMAP", "gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );", "#endif"].join("\n"),
    lightmap_vertex: ["#ifdef USE_LIGHTMAP", "vUv2 = uv2;", "#endif"].join("\n"),
    bumpmap_pars_fragment: ["#ifdef USE_BUMPMAP", "uniform sampler2D bumpMap;", "uniform float bumpScale;", "vec2 dHdxy_fwd() {", "vec2 dSTdx = dFdx( vUv );", "vec2 dSTdy = dFdy( vUv );", "float Hll = bumpScale * texture2D( bumpMap, vUv ).x;", "float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;", "float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;", "return vec2( dBx, dBy );", "}", "vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {", "vec3 vSigmaX = dFdx( surf_pos );", "vec3 vSigmaY = dFdy( surf_pos );", "vec3 vN = surf_norm;", "vec3 R1 = cross( vSigmaY, vN );", "vec3 R2 = cross( vN, vSigmaX );", "float fDet = dot( vSigmaX, R1 );", "vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );", "return normalize( abs( fDet ) * surf_norm - vGrad );", "}", "#endif"].join("\n"),
    normalmap_pars_fragment: ["#ifdef USE_NORMALMAP", "uniform sampler2D normalMap;", "uniform vec2 normalScale;", "vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {", "vec3 q0 = dFdx( eye_pos.xyz );", "vec3 q1 = dFdy( eye_pos.xyz );", "vec2 st0 = dFdx( vUv.st );", "vec2 st1 = dFdy( vUv.st );", "vec3 S = normalize(  q0 * st1.t - q1 * st0.t );", "vec3 T = normalize( -q0 * st1.s + q1 * st0.s );", "vec3 N = normalize( surf_norm );", "vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;", "mapN.xy = normalScale * mapN.xy;", "mat3 tsn = mat3( S, T, N );", "return normalize( tsn * mapN );", "}", "#endif"].join("\n"),
    specularmap_pars_fragment: ["#ifdef USE_SPECULARMAP", "uniform sampler2D specularMap;", "#endif"].join("\n"),
    specularmap_fragment: ["float specularStrength;", "#ifdef USE_SPECULARMAP", "vec4 texelSpecular = texture2D( specularMap, vUv );", "specularStrength = texelSpecular.r;", "#else", "specularStrength = 1.0;", "#endif"].join("\n"),
    lights_lambert_pars_vertex: ["uniform vec3 ambient;", "uniform vec3 diffuse;", "uniform vec3 emissive;", "uniform vec3 ambientLightColor;", "#if MAX_DIR_LIGHTS > 0", "uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];", "uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];", "#endif", "#if MAX_HEMI_LIGHTS > 0", "uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];", "uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];", "uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];", "#endif", "#if MAX_POINT_LIGHTS > 0", "uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];", "uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];", "uniform float pointLightDistance[ MAX_POINT_LIGHTS ];", "#endif", "#if MAX_SPOT_LIGHTS > 0", "uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];", "uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];", "uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];", "uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];", "uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];", "uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];", "#endif", "#ifdef WRAP_AROUND", "uniform vec3 wrapRGB;", "#endif"].join("\n"),
    lights_lambert_vertex: ["vLightFront = vec3( 0.0 );", "#ifdef DOUBLE_SIDED", "vLightBack = vec3( 0.0 );", "#endif", "transformedNormal = normalize( transformedNormal );", "#if MAX_DIR_LIGHTS > 0", "for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {", "vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );", "vec3 dirVector = normalize( lDirection.xyz );", "float dotProduct = dot( transformedNormal, dirVector );", "vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );", "#ifdef DOUBLE_SIDED", "vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );", "#ifdef WRAP_AROUND", "vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );", "#endif", "#endif", "#ifdef WRAP_AROUND", "vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );", "directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );", "#ifdef DOUBLE_SIDED", "directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );", "#endif", "#endif", "vLightFront += directionalLightColor[ i ] * directionalLightWeighting;", "#ifdef DOUBLE_SIDED", "vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;", "#endif", "}", "#endif", "#if MAX_POINT_LIGHTS > 0", "for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {", "vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );", "vec3 lVector = lPosition.xyz - mvPosition.xyz;", "float lDistance = 1.0;", "if ( pointLightDistance[ i ] > 0.0 )", "lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );", "lVector = normalize( lVector );", "float dotProduct = dot( transformedNormal, lVector );", "vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );", "#ifdef DOUBLE_SIDED", "vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );", "#ifdef WRAP_AROUND", "vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );", "#endif", "#endif", "#ifdef WRAP_AROUND", "vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );", "pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );", "#ifdef DOUBLE_SIDED", "pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );", "#endif", "#endif", "vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;", "#ifdef DOUBLE_SIDED", "vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;", "#endif", "}", "#endif", "#if MAX_SPOT_LIGHTS > 0", "for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {", "vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );", "vec3 lVector = lPosition.xyz - mvPosition.xyz;", "float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );", "if ( spotEffect > spotLightAngleCos[ i ] ) {", "spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );", "float lDistance = 1.0;", "if ( spotLightDistance[ i ] > 0.0 )", "lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );", "lVector = normalize( lVector );", "float dotProduct = dot( transformedNormal, lVector );", "vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );", "#ifdef DOUBLE_SIDED", "vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );", "#ifdef WRAP_AROUND", "vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );", "#endif", "#endif", "#ifdef WRAP_AROUND", "vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );", "spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );", "#ifdef DOUBLE_SIDED", "spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );", "#endif", "#endif", "vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;", "#ifdef DOUBLE_SIDED", "vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;", "#endif", "}", "}", "#endif", "#if MAX_HEMI_LIGHTS > 0", "for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {", "vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );", "vec3 lVector = normalize( lDirection.xyz );", "float dotProduct = dot( transformedNormal, lVector );", "float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;", "float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;", "vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );", "#ifdef DOUBLE_SIDED", "vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );", "#endif", "}", "#endif", "vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;", "#ifdef DOUBLE_SIDED", "vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;", "#endif"].join("\n"),
    lights_phong_pars_vertex: ["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )", "varying vec3 vWorldPosition;", "#endif"].join("\n"),
    lights_phong_vertex: ["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )", "vWorldPosition = worldPosition.xyz;", "#endif"].join("\n"),
    lights_phong_pars_fragment: ["uniform vec3 ambientLightColor;", "#if MAX_DIR_LIGHTS > 0", "uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];", "uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];", "#endif", "#if MAX_HEMI_LIGHTS > 0", "uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];", "uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];", "uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];", "#endif", "#if MAX_POINT_LIGHTS > 0", "uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];", "uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];", "uniform float pointLightDistance[ MAX_POINT_LIGHTS ];", "#endif", "#if MAX_SPOT_LIGHTS > 0", "uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];", "uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];", "uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];", "uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];", "uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];", "uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];", "#endif", "#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )", "varying vec3 vWorldPosition;", "#endif", "#ifdef WRAP_AROUND", "uniform vec3 wrapRGB;", "#endif", "varying vec3 vViewPosition;", "varying vec3 vNormal;"].join("\n"),
    lights_phong_fragment: ["vec3 normal = normalize( vNormal );", "vec3 viewPosition = normalize( vViewPosition );", "#ifdef DOUBLE_SIDED", "normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );", "#endif", "#ifdef USE_NORMALMAP", "normal = perturbNormal2Arb( -vViewPosition, normal );", "#elif defined( USE_BUMPMAP )", "normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );", "#endif", "#if MAX_POINT_LIGHTS > 0", "vec3 pointDiffuse  = vec3( 0.0 );", "vec3 pointSpecular = vec3( 0.0 );", "for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {", "vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );", "vec3 lVector = lPosition.xyz + vViewPosition.xyz;", "float lDistance = 1.0;", "if ( pointLightDistance[ i ] > 0.0 )", "lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );", "lVector = normalize( lVector );", "float dotProduct = dot( normal, lVector );", "#ifdef WRAP_AROUND", "float pointDiffuseWeightFull = max( dotProduct, 0.0 );", "float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );", "vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );", "#else", "float pointDiffuseWeight = max( dotProduct, 0.0 );", "#endif", "pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;", "vec3 pointHalfVector = normalize( lVector + viewPosition );", "float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );", "float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );", "float specularNormalization = ( shininess + 2.0001 ) / 8.0;", "vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );", "pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;", "}", "#endif", "#if MAX_SPOT_LIGHTS > 0", "vec3 spotDiffuse  = vec3( 0.0 );", "vec3 spotSpecular = vec3( 0.0 );", "for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {", "vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );", "vec3 lVector = lPosition.xyz + vViewPosition.xyz;", "float lDistance = 1.0;", "if ( spotLightDistance[ i ] > 0.0 )", "lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );", "lVector = normalize( lVector );", "float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );", "if ( spotEffect > spotLightAngleCos[ i ] ) {", "spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );", "float dotProduct = dot( normal, lVector );", "#ifdef WRAP_AROUND", "float spotDiffuseWeightFull = max( dotProduct, 0.0 );", "float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );", "vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );", "#else", "float spotDiffuseWeight = max( dotProduct, 0.0 );", "#endif", "spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;", "vec3 spotHalfVector = normalize( lVector + viewPosition );", "float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );", "float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );", "float specularNormalization = ( shininess + 2.0001 ) / 8.0;", "vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );", "spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;", "}", "}", "#endif", "#if MAX_DIR_LIGHTS > 0", "vec3 dirDiffuse  = vec3( 0.0 );", "vec3 dirSpecular = vec3( 0.0 );", "for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {", "vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );", "vec3 dirVector = normalize( lDirection.xyz );", "float dotProduct = dot( normal, dirVector );", "#ifdef WRAP_AROUND", "float dirDiffuseWeightFull = max( dotProduct, 0.0 );", "float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );", "vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );", "#else", "float dirDiffuseWeight = max( dotProduct, 0.0 );", "#endif", "dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;", "vec3 dirHalfVector = normalize( dirVector + viewPosition );", "float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );", "float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );", "float specularNormalization = ( shininess + 2.0001 ) / 8.0;", "vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );", "dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;", "}", "#endif", "#if MAX_HEMI_LIGHTS > 0", "vec3 hemiDiffuse  = vec3( 0.0 );", "vec3 hemiSpecular = vec3( 0.0 );", "for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {", "vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );", "vec3 lVector = normalize( lDirection.xyz );", "float dotProduct = dot( normal, lVector );", "float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;", "vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );", "hemiDiffuse += diffuse * hemiColor;", "vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );", "float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;", "float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );", "vec3 lVectorGround = -lVector;", "vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );", "float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;", "float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );", "float dotProductGround = dot( normal, lVectorGround );", "float specularNormalization = ( shininess + 2.0001 ) / 8.0;", "vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );", "vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );", "hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );", "}", "#endif", "vec3 totalDiffuse = vec3( 0.0 );", "vec3 totalSpecular = vec3( 0.0 );", "#if MAX_DIR_LIGHTS > 0", "totalDiffuse += dirDiffuse;", "totalSpecular += dirSpecular;", "#endif", "#if MAX_HEMI_LIGHTS > 0", "totalDiffuse += hemiDiffuse;", "totalSpecular += hemiSpecular;", "#endif", "#if MAX_POINT_LIGHTS > 0", "totalDiffuse += pointDiffuse;", "totalSpecular += pointSpecular;", "#endif", "#if MAX_SPOT_LIGHTS > 0", "totalDiffuse += spotDiffuse;", "totalSpecular += spotSpecular;", "#endif", "#ifdef METAL", "gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );", "#else", "gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;", "#endif"].join("\n"),
    color_pars_fragment: ["#ifdef USE_COLOR", "varying vec3 vColor;", "#endif"].join("\n"),
    color_fragment: ["#ifdef USE_COLOR", "gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );", "#endif"].join("\n"),
    color_pars_vertex: ["#ifdef USE_COLOR", "varying vec3 vColor;", "#endif"].join("\n"),
    color_vertex: ["#ifdef USE_COLOR", "#ifdef GAMMA_INPUT", "vColor = color * color;", "#else", "vColor = color;", "#endif", "#endif"].join("\n"),
    skinning_pars_vertex: ["#ifdef USE_SKINNING", "#ifdef BONE_TEXTURE", "uniform sampler2D boneTexture;", "uniform int boneTextureWidth;", "uniform int boneTextureHeight;", "mat4 getBoneMatrix( const in float i ) {", "float j = i * 4.0;", "float x = mod( j, float( boneTextureWidth ) );", "float y = floor( j / float( boneTextureWidth ) );", "float dx = 1.0 / float( boneTextureWidth );", "float dy = 1.0 / float( boneTextureHeight );", "y = dy * ( y + 0.5 );", "vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );", "vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );", "vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );", "vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );", "mat4 bone = mat4( v1, v2, v3, v4 );", "return bone;", "}", "#else", "uniform mat4 boneGlobalMatrices[ MAX_BONES ];", "mat4 getBoneMatrix( const in float i ) {", "mat4 bone = boneGlobalMatrices[ int(i) ];", "return bone;", "}", "#endif", "#endif"].join("\n"),
    skinbase_vertex: ["#ifdef USE_SKINNING", "mat4 boneMatX = getBoneMatrix( skinIndex.x );", "mat4 boneMatY = getBoneMatrix( skinIndex.y );", "mat4 boneMatZ = getBoneMatrix( skinIndex.z );", "mat4 boneMatW = getBoneMatrix( skinIndex.w );", "#endif"].join("\n"),
    skinning_vertex: ["#ifdef USE_SKINNING", "#ifdef USE_MORPHTARGETS", "vec4 skinVertex = vec4( morphed, 1.0 );", "#else", "vec4 skinVertex = vec4( position, 1.0 );", "#endif", "vec4 skinned  = boneMatX * skinVertex * skinWeight.x;", "skinned      += boneMatY * skinVertex * skinWeight.y;", "skinned      += boneMatZ * skinVertex * skinWeight.z;", "skinned      += boneMatW * skinVertex * skinWeight.w;", "#endif"].join("\n"),
    morphtarget_pars_vertex: ["#ifdef USE_MORPHTARGETS", "#ifndef USE_MORPHNORMALS", "uniform float morphTargetInfluences[ 8 ];", "#else", "uniform float morphTargetInfluences[ 4 ];", "#endif", "#endif"].join("\n"),
    morphtarget_vertex: ["#ifdef USE_MORPHTARGETS", "vec3 morphed = vec3( 0.0 );", "morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];", "morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];", "morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];", "morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];", "#ifndef USE_MORPHNORMALS", "morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];", "morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];", "morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];", "morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];", "#endif", "morphed += position;", "#endif"].join("\n"),
    default_vertex: ["vec4 mvPosition;", "#ifdef USE_SKINNING", "mvPosition = modelViewMatrix * skinned;", "#endif", "#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )", "mvPosition = modelViewMatrix * vec4( morphed, 1.0 );", "#endif", "#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )", "mvPosition = modelViewMatrix * vec4( position, 1.0 );", "#endif", "gl_Position = projectionMatrix * mvPosition;"].join("\n"),
    morphnormal_vertex: ["#ifdef USE_MORPHNORMALS", "vec3 morphedNormal = vec3( 0.0 );", "morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];", "morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];", "morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];", "morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];", "morphedNormal += normal;", "#endif"].join("\n"),
    skinnormal_vertex: ["#ifdef USE_SKINNING", "mat4 skinMatrix = skinWeight.x * boneMatX;", "skinMatrix 	+= skinWeight.y * boneMatY;", "#ifdef USE_MORPHNORMALS", "vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );", "#else", "vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );", "#endif", "#endif"].join("\n"),
    defaultnormal_vertex: ["vec3 objectNormal;", "#ifdef USE_SKINNING", "objectNormal = skinnedNormal.xyz;", "#endif", "#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )", "objectNormal = morphedNormal;", "#endif", "#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )", "objectNormal = normal;", "#endif", "#ifdef FLIP_SIDED", "objectNormal = -objectNormal;", "#endif", "vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),
    shadowmap_pars_fragment: ["#ifdef USE_SHADOWMAP", "uniform sampler2D shadowMap[ MAX_SHADOWS ];", "uniform vec2 shadowMapSize[ MAX_SHADOWS ];", "uniform float shadowDarkness[ MAX_SHADOWS ];", "uniform float shadowBias[ MAX_SHADOWS ];", "varying vec4 vShadowCoord[ MAX_SHADOWS ];", "float unpackDepth( const in vec4 rgba_depth ) {", "const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );", "float depth = dot( rgba_depth, bit_shift );", "return depth;", "}", "#endif"].join("\n"),
    shadowmap_fragment: ["#ifdef USE_SHADOWMAP", "#ifdef SHADOWMAP_DEBUG", "vec3 frustumColors[3];", "frustumColors[0] = vec3( 1.0, 0.5, 0.0 );", "frustumColors[1] = vec3( 0.0, 1.0, 0.8 );", "frustumColors[2] = vec3( 0.0, 0.5, 1.0 );", "#endif", "#ifdef SHADOWMAP_CASCADE", "int inFrustumCount = 0;", "#endif", "float fDepth;", "vec3 shadowColor = vec3( 1.0 );", "for( int i = 0; i < MAX_SHADOWS; i ++ ) {", "vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;", "bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );", "bool inFrustum = all( inFrustumVec );", "#ifdef SHADOWMAP_CASCADE", "inFrustumCount += int( inFrustum );", "bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );", "#else", "bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );", "#endif", "bool frustumTest = all( frustumTestVec );", "if ( frustumTest ) {", "shadowCoord.z += shadowBias[ i ];", "#if defined( SHADOWMAP_TYPE_PCF )", "float shadow = 0.0;", "const float shadowDelta = 1.0 / 9.0;", "float xPixelOffset = 1.0 / shadowMapSize[ i ].x;", "float yPixelOffset = 1.0 / shadowMapSize[ i ].y;", "float dx0 = -1.25 * xPixelOffset;", "float dy0 = -1.25 * yPixelOffset;", "float dx1 = 1.25 * xPixelOffset;", "float dy1 = 1.25 * yPixelOffset;", "fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );", "if ( fDepth < shadowCoord.z ) shadow += shadowDelta;", "fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );", "if ( fDepth < shadowCoord.z ) shadow += shadowDelta;", "fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );", "if ( fDepth < shadowCoord.z ) shadow += shadowDelta;", "fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );", "if ( fDepth < shadowCoord.z ) shadow += shadowDelta;", "fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );", "if ( fDepth < shadowCoord.z ) shadow += shadowDelta;", "fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );", "if ( fDepth < shadowCoord.z ) shadow += shadowDelta;", "fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );", "if ( fDepth < shadowCoord.z ) shadow += shadowDelta;", "fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );", "if ( fDepth < shadowCoord.z ) shadow += shadowDelta;", "fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );", "if ( fDepth < shadowCoord.z ) shadow += shadowDelta;", "shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );", "#elif defined( SHADOWMAP_TYPE_PCF_SOFT )", "float shadow = 0.0;", "float xPixelOffset = 1.0 / shadowMapSize[ i ].x;", "float yPixelOffset = 1.0 / shadowMapSize[ i ].y;", "float dx0 = -1.0 * xPixelOffset;", "float dy0 = -1.0 * yPixelOffset;", "float dx1 = 1.0 * xPixelOffset;", "float dy1 = 1.0 * yPixelOffset;", "mat3 shadowKernel;", "mat3 depthKernel;", "depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );", "depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );", "depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );", "depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );", "depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );", "depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );", "depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );", "depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );", "depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );", "vec3 shadowZ = vec3( shadowCoord.z );", "shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));", "shadowKernel[0] *= vec3(0.25);", "shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));", "shadowKernel[1] *= vec3(0.25);", "shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));", "shadowKernel[2] *= vec3(0.25);", "vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );", "shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );", "shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );", "vec4 shadowValues;", "shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );", "shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );", "shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );", "shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );", "shadow = dot( shadowValues, vec4( 1.0 ) );", "shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );", "#else", "vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );", "float fDepth = unpackDepth( rgbaDepth );", "if ( fDepth < shadowCoord.z )", "shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );", "#endif", "}", "#ifdef SHADOWMAP_DEBUG", "#ifdef SHADOWMAP_CASCADE", "if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];", "#else", "if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];", "#endif", "#endif", "}", "#ifdef GAMMA_OUTPUT", "shadowColor *= shadowColor;", "#endif", "gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;", "#endif"].join("\n"),
    shadowmap_pars_vertex: ["#ifdef USE_SHADOWMAP", "varying vec4 vShadowCoord[ MAX_SHADOWS ];", "uniform mat4 shadowMatrix[ MAX_SHADOWS ];", "#endif"].join("\n"),
    shadowmap_vertex: ["#ifdef USE_SHADOWMAP", "for( int i = 0; i < MAX_SHADOWS; i ++ ) {", "vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;", "}", "#endif"].join("\n"),
    alphatest_fragment: ["#ifdef ALPHATEST", "if ( gl_FragColor.a < ALPHATEST ) discard;", "#endif"].join("\n"),
    linear_to_gamma_fragment: ["#ifdef GAMMA_OUTPUT", "gl_FragColor.xyz = sqrt( gl_FragColor.xyz );", "#endif"].join("\n")
},
THREE.UniformsUtils = {
    merge: function(a) {
        var b, c, d, e = {};
        for (b = 0; b < a.length; b++) {
            d = this.clone(a[b]);
            for (c in d)
                e[c] = d[c]
        }
        return e
    },
    clone: function(a) {
        var b, c, d, e = {};
        for (b in a) {
            e[b] = {};
            for (c in a[b])
                d = a[b][c],
                e[b][c] = d instanceof THREE.Color || d instanceof THREE.Vector2 || d instanceof THREE.Vector3 || d instanceof THREE.Vector4 || d instanceof THREE.Matrix4 || d instanceof THREE.Texture ? d.clone() : d instanceof Array ? d.slice() : d
        }
        return e
    }
},
THREE.UniformsLib = {
    common: {
        diffuse: {
            type: "c",
            value: new THREE.Color(15658734)
        },
        opacity: {
            type: "f",
            value: 1
        },
        map: {
            type: "t",
            value: null
        },
        offsetRepeat: {
            type: "v4",
            value: new THREE.Vector4(0,0,1,1)
        },
        lightMap: {
            type: "t",
            value: null
        },
        specularMap: {
            type: "t",
            value: null
        },
        envMap: {
            type: "t",
            value: null
        },
        flipEnvMap: {
            type: "f",
            value: -1
        },
        useRefract: {
            type: "i",
            value: 0
        },
        reflectivity: {
            type: "f",
            value: 1
        },
        refractionRatio: {
            type: "f",
            value: .98
        },
        combine: {
            type: "i",
            value: 0
        },
        morphTargetInfluences: {
            type: "f",
            value: 0
        }
    },
    bump: {
        bumpMap: {
            type: "t",
            value: null
        },
        bumpScale: {
            type: "f",
            value: 1
        }
    },
    normalmap: {
        normalMap: {
            type: "t",
            value: null
        },
        normalScale: {
            type: "v2",
            value: new THREE.Vector2(1,1)
        }
    },
    fog: {
        fogDensity: {
            type: "f",
            value: 25e-5
        },
        fogNear: {
            type: "f",
            value: 1
        },
        fogFar: {
            type: "f",
            value: 2e3
        },
        fogColor: {
            type: "c",
            value: new THREE.Color(16777215)
        }
    },
    lights: {
        ambientLightColor: {
            type: "fv",
            value: []
        },
        directionalLightDirection: {
            type: "fv",
            value: []
        },
        directionalLightColor: {
            type: "fv",
            value: []
        },
        hemisphereLightDirection: {
            type: "fv",
            value: []
        },
        hemisphereLightSkyColor: {
            type: "fv",
            value: []
        },
        hemisphereLightGroundColor: {
            type: "fv",
            value: []
        },
        pointLightColor: {
            type: "fv",
            value: []
        },
        pointLightPosition: {
            type: "fv",
            value: []
        },
        pointLightDistance: {
            type: "fv1",
            value: []
        },
        spotLightColor: {
            type: "fv",
            value: []
        },
        spotLightPosition: {
            type: "fv",
            value: []
        },
        spotLightDirection: {
            type: "fv",
            value: []
        },
        spotLightDistance: {
            type: "fv1",
            value: []
        },
        spotLightAngleCos: {
            type: "fv1",
            value: []
        },
        spotLightExponent: {
            type: "fv1",
            value: []
        }
    },
    particle: {
        psColor: {
            type: "c",
            value: new THREE.Color(15658734)
        },
        opacity: {
            type: "f",
            value: 1
        },
        size: {
            type: "f",
            value: 1
        },
        scale: {
            type: "f",
            value: 1
        },
        map: {
            type: "t",
            value: null
        },
        fogDensity: {
            type: "f",
            value: 25e-5
        },
        fogNear: {
            type: "f",
            value: 1
        },
        fogFar: {
            type: "f",
            value: 2e3
        },
        fogColor: {
            type: "c",
            value: new THREE.Color(16777215)
        }
    },
    shadowmap: {
        shadowMap: {
            type: "tv",
            value: []
        },
        shadowMapSize: {
            type: "v2v",
            value: []
        },
        shadowBias: {
            type: "fv1",
            value: []
        },
        shadowDarkness: {
            type: "fv1",
            value: []
        },
        shadowMatrix: {
            type: "m4v",
            value: []
        }
    }
},
THREE.ShaderLib = {
    basic: {
        uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.common, THREE.UniformsLib.fog, THREE.UniformsLib.shadowmap]),
        vertexShader: [THREE.ShaderChunk.map_pars_vertex, THREE.ShaderChunk.lightmap_pars_vertex, THREE.ShaderChunk.envmap_pars_vertex, THREE.ShaderChunk.color_pars_vertex, THREE.ShaderChunk.morphtarget_pars_vertex, THREE.ShaderChunk.skinning_pars_vertex, THREE.ShaderChunk.shadowmap_pars_vertex, "void main() {", THREE.ShaderChunk.map_vertex, THREE.ShaderChunk.lightmap_vertex, THREE.ShaderChunk.color_vertex, THREE.ShaderChunk.skinbase_vertex, "#ifdef USE_ENVMAP", THREE.ShaderChunk.morphnormal_vertex, THREE.ShaderChunk.skinnormal_vertex, THREE.ShaderChunk.defaultnormal_vertex, "#endif", THREE.ShaderChunk.morphtarget_vertex, THREE.ShaderChunk.skinning_vertex, THREE.ShaderChunk.default_vertex, THREE.ShaderChunk.worldpos_vertex, THREE.ShaderChunk.envmap_vertex, THREE.ShaderChunk.shadowmap_vertex, "}"].join("\n"),
        fragmentShader: ["uniform vec3 diffuse;", "uniform float opacity;", THREE.ShaderChunk.color_pars_fragment, THREE.ShaderChunk.map_pars_fragment, THREE.ShaderChunk.lightmap_pars_fragment, THREE.ShaderChunk.envmap_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, THREE.ShaderChunk.shadowmap_pars_fragment, THREE.ShaderChunk.specularmap_pars_fragment, "void main() {", "gl_FragColor = vec4( diffuse, opacity );", THREE.ShaderChunk.map_fragment, THREE.ShaderChunk.alphatest_fragment, THREE.ShaderChunk.specularmap_fragment, THREE.ShaderChunk.lightmap_fragment, THREE.ShaderChunk.color_fragment, THREE.ShaderChunk.envmap_fragment, THREE.ShaderChunk.shadowmap_fragment, THREE.ShaderChunk.linear_to_gamma_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n")
    },
    lambert: {
        uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.common, THREE.UniformsLib.fog, THREE.UniformsLib.lights, THREE.UniformsLib.shadowmap, {
            ambient: {
                type: "c",
                value: new THREE.Color(16777215)
            },
            emissive: {
                type: "c",
                value: new THREE.Color(0)
            },
            wrapRGB: {
                type: "v3",
                value: new THREE.Vector3(1,1,1)
            }
        }]),
        vertexShader: ["#define LAMBERT", "varying vec3 vLightFront;", "#ifdef DOUBLE_SIDED", "varying vec3 vLightBack;", "#endif", THREE.ShaderChunk.map_pars_vertex, THREE.ShaderChunk.lightmap_pars_vertex, THREE.ShaderChunk.envmap_pars_vertex, THREE.ShaderChunk.lights_lambert_pars_vertex, THREE.ShaderChunk.color_pars_vertex, THREE.ShaderChunk.morphtarget_pars_vertex, THREE.ShaderChunk.skinning_pars_vertex, THREE.ShaderChunk.shadowmap_pars_vertex, "void main() {", THREE.ShaderChunk.map_vertex, THREE.ShaderChunk.lightmap_vertex, THREE.ShaderChunk.color_vertex, THREE.ShaderChunk.morphnormal_vertex, THREE.ShaderChunk.skinbase_vertex, THREE.ShaderChunk.skinnormal_vertex, THREE.ShaderChunk.defaultnormal_vertex, THREE.ShaderChunk.morphtarget_vertex, THREE.ShaderChunk.skinning_vertex, THREE.ShaderChunk.default_vertex, THREE.ShaderChunk.worldpos_vertex, THREE.ShaderChunk.envmap_vertex, THREE.ShaderChunk.lights_lambert_vertex, THREE.ShaderChunk.shadowmap_vertex, "}"].join("\n"),
        fragmentShader: ["uniform float opacity;", "varying vec3 vLightFront;", "#ifdef DOUBLE_SIDED", "varying vec3 vLightBack;", "#endif", THREE.ShaderChunk.color_pars_fragment, THREE.ShaderChunk.map_pars_fragment, THREE.ShaderChunk.lightmap_pars_fragment, THREE.ShaderChunk.envmap_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, THREE.ShaderChunk.shadowmap_pars_fragment, THREE.ShaderChunk.specularmap_pars_fragment, "void main() {", "gl_FragColor = vec4( vec3 ( 1.0 ), opacity );", THREE.ShaderChunk.map_fragment, THREE.ShaderChunk.alphatest_fragment, THREE.ShaderChunk.specularmap_fragment, "#ifdef DOUBLE_SIDED", "if ( gl_FrontFacing )", "gl_FragColor.xyz *= vLightFront;", "else", "gl_FragColor.xyz *= vLightBack;", "#else", "gl_FragColor.xyz *= vLightFront;", "#endif", THREE.ShaderChunk.lightmap_fragment, THREE.ShaderChunk.color_fragment, THREE.ShaderChunk.envmap_fragment, THREE.ShaderChunk.shadowmap_fragment, THREE.ShaderChunk.linear_to_gamma_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n")
    },
    phong: {
        uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.common, THREE.UniformsLib.bump, THREE.UniformsLib.normalmap, THREE.UniformsLib.fog, THREE.UniformsLib.lights, THREE.UniformsLib.shadowmap, {
            ambient: {
                type: "c",
                value: new THREE.Color(16777215)
            },
            emissive: {
                type: "c",
                value: new THREE.Color(0)
            },
            specular: {
                type: "c",
                value: new THREE.Color(1118481)
            },
            shininess: {
                type: "f",
                value: 30
            },
            wrapRGB: {
                type: "v3",
                value: new THREE.Vector3(1,1,1)
            }
        }]),
        vertexShader: ["#define PHONG", "varying vec3 vViewPosition;", "varying vec3 vNormal;", THREE.ShaderChunk.map_pars_vertex, THREE.ShaderChunk.lightmap_pars_vertex, THREE.ShaderChunk.envmap_pars_vertex, THREE.ShaderChunk.lights_phong_pars_vertex, THREE.ShaderChunk.color_pars_vertex, THREE.ShaderChunk.morphtarget_pars_vertex, THREE.ShaderChunk.skinning_pars_vertex, THREE.ShaderChunk.shadowmap_pars_vertex, "void main() {", THREE.ShaderChunk.map_vertex, THREE.ShaderChunk.lightmap_vertex, THREE.ShaderChunk.color_vertex, THREE.ShaderChunk.morphnormal_vertex, THREE.ShaderChunk.skinbase_vertex, THREE.ShaderChunk.skinnormal_vertex, THREE.ShaderChunk.defaultnormal_vertex, "vNormal = normalize( transformedNormal );", THREE.ShaderChunk.morphtarget_vertex, THREE.ShaderChunk.skinning_vertex, THREE.ShaderChunk.default_vertex, "vViewPosition = -mvPosition.xyz;", THREE.ShaderChunk.worldpos_vertex, THREE.ShaderChunk.envmap_vertex, THREE.ShaderChunk.lights_phong_vertex, THREE.ShaderChunk.shadowmap_vertex, "}"].join("\n"),
        fragmentShader: ["uniform vec3 diffuse;", "uniform float opacity;", "uniform vec3 ambient;", "uniform vec3 emissive;", "uniform vec3 specular;", "uniform float shininess;", THREE.ShaderChunk.color_pars_fragment, THREE.ShaderChunk.map_pars_fragment, THREE.ShaderChunk.lightmap_pars_fragment, THREE.ShaderChunk.envmap_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, THREE.ShaderChunk.lights_phong_pars_fragment, THREE.ShaderChunk.shadowmap_pars_fragment, THREE.ShaderChunk.bumpmap_pars_fragment, THREE.ShaderChunk.normalmap_pars_fragment, THREE.ShaderChunk.specularmap_pars_fragment, "void main() {", "gl_FragColor = vec4( vec3 ( 1.0 ), opacity );", THREE.ShaderChunk.map_fragment, THREE.ShaderChunk.alphatest_fragment, THREE.ShaderChunk.specularmap_fragment, THREE.ShaderChunk.lights_phong_fragment, THREE.ShaderChunk.lightmap_fragment, THREE.ShaderChunk.color_fragment, THREE.ShaderChunk.envmap_fragment, THREE.ShaderChunk.shadowmap_fragment, THREE.ShaderChunk.linear_to_gamma_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n")
    },
    particle_basic: {
        uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.particle, THREE.UniformsLib.shadowmap]),
        vertexShader: ["uniform float size;", "uniform float scale;", THREE.ShaderChunk.color_pars_vertex, THREE.ShaderChunk.shadowmap_pars_vertex, "void main() {", THREE.ShaderChunk.color_vertex, "vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );", "#ifdef USE_SIZEATTENUATION", "gl_PointSize = size * ( scale / length( mvPosition.xyz ) );", "#else", "gl_PointSize = size;", "#endif", "gl_Position = projectionMatrix * mvPosition;", THREE.ShaderChunk.worldpos_vertex, THREE.ShaderChunk.shadowmap_vertex, "}"].join("\n"),
        fragmentShader: ["uniform vec3 psColor;", "uniform float opacity;", THREE.ShaderChunk.color_pars_fragment, THREE.ShaderChunk.map_particle_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, THREE.ShaderChunk.shadowmap_pars_fragment, "void main() {", "gl_FragColor = vec4( psColor, opacity );", THREE.ShaderChunk.map_particle_fragment, THREE.ShaderChunk.alphatest_fragment, THREE.ShaderChunk.color_fragment, THREE.ShaderChunk.shadowmap_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n")
    },
    dashed: {
        uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.common, THREE.UniformsLib.fog, {
            scale: {
                type: "f",
                value: 1
            },
            dashSize: {
                type: "f",
                value: 1
            },
            totalSize: {
                type: "f",
                value: 2
            }
        }]),
        vertexShader: ["uniform float scale;", "attribute float lineDistance;", "varying float vLineDistance;", THREE.ShaderChunk.color_pars_vertex, "void main() {", THREE.ShaderChunk.color_vertex, "vLineDistance = scale * lineDistance;", "vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );", "gl_Position = projectionMatrix * mvPosition;", "}"].join("\n"),
        fragmentShader: ["uniform vec3 diffuse;", "uniform float opacity;", "uniform float dashSize;", "uniform float totalSize;", "varying float vLineDistance;", THREE.ShaderChunk.color_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, "void main() {", "if ( mod( vLineDistance, totalSize ) > dashSize ) {", "discard;", "}", "gl_FragColor = vec4( diffuse, opacity );", THREE.ShaderChunk.color_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n")
    },
    depth: {
        uniforms: {
            mNear: {
                type: "f",
                value: 1
            },
            mFar: {
                type: "f",
                value: 2e3
            },
            opacity: {
                type: "f",
                value: 1
            }
        },
        vertexShader: ["void main() {", "gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );", "}"].join("\n"),
        fragmentShader: ["uniform float mNear;", "uniform float mFar;", "uniform float opacity;", "void main() {", "float depth = gl_FragCoord.z / gl_FragCoord.w;", "float color = 1.0 - smoothstep( mNear, mFar, depth );", "gl_FragColor = vec4( vec3( color ), opacity );", "}"].join("\n")
    },
    normal: {
        uniforms: {
            opacity: {
                type: "f",
                value: 1
            }
        },
        vertexShader: ["varying vec3 vNormal;", THREE.ShaderChunk.morphtarget_pars_vertex, "void main() {", "vNormal = normalize( normalMatrix * normal );", THREE.ShaderChunk.morphtarget_vertex, THREE.ShaderChunk.default_vertex, "}"].join("\n"),
        fragmentShader: ["uniform float opacity;", "varying vec3 vNormal;", "void main() {", "gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );", "}"].join("\n")
    },
    normalmap: {
        uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.fog, THREE.UniformsLib.lights, THREE.UniformsLib.shadowmap, {
            enableAO: {
                type: "i",
                value: 0
            },
            enableDiffuse: {
                type: "i",
                value: 0
            },
            enableSpecular: {
                type: "i",
                value: 0
            },
            enableReflection: {
                type: "i",
                value: 0
            },
            enableDisplacement: {
                type: "i",
                value: 0
            },
            tDisplacement: {
                type: "t",
                value: null
            },
            tDiffuse: {
                type: "t",
                value: null
            },
            tCube: {
                type: "t",
                value: null
            },
            tNormal: {
                type: "t",
                value: null
            },
            tSpecular: {
                type: "t",
                value: null
            },
            tAO: {
                type: "t",
                value: null
            },
            uNormalScale: {
                type: "v2",
                value: new THREE.Vector2(1,1)
            },
            uDisplacementBias: {
                type: "f",
                value: 0
            },
            uDisplacementScale: {
                type: "f",
                value: 1
            },
            diffuse: {
                type: "c",
                value: new THREE.Color(16777215)
            },
            specular: {
                type: "c",
                value: new THREE.Color(1118481)
            },
            ambient: {
                type: "c",
                value: new THREE.Color(16777215)
            },
            shininess: {
                type: "f",
                value: 30
            },
            opacity: {
                type: "f",
                value: 1
            },
            useRefract: {
                type: "i",
                value: 0
            },
            refractionRatio: {
                type: "f",
                value: .98
            },
            reflectivity: {
                type: "f",
                value: .5
            },
            uOffset: {
                type: "v2",
                value: new THREE.Vector2(0,0)
            },
            uRepeat: {
                type: "v2",
                value: new THREE.Vector2(1,1)
            },
            wrapRGB: {
                type: "v3",
                value: new THREE.Vector3(1,1,1)
            }
        }]),
        fragmentShader: ["uniform vec3 ambient;", "uniform vec3 diffuse;", "uniform vec3 specular;", "uniform float shininess;", "uniform float opacity;", "uniform bool enableDiffuse;", "uniform bool enableSpecular;", "uniform bool enableAO;", "uniform bool enableReflection;", "uniform sampler2D tDiffuse;", "uniform sampler2D tNormal;", "uniform sampler2D tSpecular;", "uniform sampler2D tAO;", "uniform samplerCube tCube;", "uniform vec2 uNormalScale;", "uniform bool useRefract;", "uniform float refractionRatio;", "uniform float reflectivity;", "varying vec3 vTangent;", "varying vec3 vBinormal;", "varying vec3 vNormal;", "varying vec2 vUv;", "uniform vec3 ambientLightColor;", "#if MAX_DIR_LIGHTS > 0", "uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];", "uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];", "#endif", "#if MAX_HEMI_LIGHTS > 0", "uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];", "uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];", "uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];", "#endif", "#if MAX_POINT_LIGHTS > 0", "uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];", "uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];", "uniform float pointLightDistance[ MAX_POINT_LIGHTS ];", "#endif", "#if MAX_SPOT_LIGHTS > 0", "uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];", "uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];", "uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];", "uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];", "uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];", "uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];", "#endif", "#ifdef WRAP_AROUND", "uniform vec3 wrapRGB;", "#endif", "varying vec3 vWorldPosition;", "varying vec3 vViewPosition;", THREE.ShaderChunk.shadowmap_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, "void main() {", "gl_FragColor = vec4( vec3( 1.0 ), opacity );", "vec3 specularTex = vec3( 1.0 );", "vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;", "normalTex.xy *= uNormalScale;", "normalTex = normalize( normalTex );", "if( enableDiffuse ) {", "#ifdef GAMMA_INPUT", "vec4 texelColor = texture2D( tDiffuse, vUv );", "texelColor.xyz *= texelColor.xyz;", "gl_FragColor = gl_FragColor * texelColor;", "#else", "gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );", "#endif", "}", "if( enableAO ) {", "#ifdef GAMMA_INPUT", "vec4 aoColor = texture2D( tAO, vUv );", "aoColor.xyz *= aoColor.xyz;", "gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;", "#else", "gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;", "#endif", "}", "if( enableSpecular )", "specularTex = texture2D( tSpecular, vUv ).xyz;", "mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );", "vec3 finalNormal = tsb * normalTex;", "#ifdef FLIP_SIDED", "finalNormal = -finalNormal;", "#endif", "vec3 normal = normalize( finalNormal );", "vec3 viewPosition = normalize( vViewPosition );", "#if MAX_POINT_LIGHTS > 0", "vec3 pointDiffuse = vec3( 0.0 );", "vec3 pointSpecular = vec3( 0.0 );", "for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {", "vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );", "vec3 pointVector = lPosition.xyz + vViewPosition.xyz;", "float pointDistance = 1.0;", "if ( pointLightDistance[ i ] > 0.0 )", "pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );", "pointVector = normalize( pointVector );", "#ifdef WRAP_AROUND", "float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );", "float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );", "vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );", "#else", "float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );", "#endif", "pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;", "vec3 pointHalfVector = normalize( pointVector + viewPosition );", "float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );", "float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );", "float specularNormalization = ( shininess + 2.0001 ) / 8.0;", "vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );", "pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;", "}", "#endif", "#if MAX_SPOT_LIGHTS > 0", "vec3 spotDiffuse = vec3( 0.0 );", "vec3 spotSpecular = vec3( 0.0 );", "for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {", "vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );", "vec3 spotVector = lPosition.xyz + vViewPosition.xyz;", "float spotDistance = 1.0;", "if ( spotLightDistance[ i ] > 0.0 )", "spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );", "spotVector = normalize( spotVector );", "float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );", "if ( spotEffect > spotLightAngleCos[ i ] ) {", "spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );", "#ifdef WRAP_AROUND", "float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );", "float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );", "vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );", "#else", "float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );", "#endif", "spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;", "vec3 spotHalfVector = normalize( spotVector + viewPosition );", "float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );", "float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );", "float specularNormalization = ( shininess + 2.0001 ) / 8.0;", "vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );", "spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;", "}", "}", "#endif", "#if MAX_DIR_LIGHTS > 0", "vec3 dirDiffuse = vec3( 0.0 );", "vec3 dirSpecular = vec3( 0.0 );", "for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {", "vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );", "vec3 dirVector = normalize( lDirection.xyz );", "#ifdef WRAP_AROUND", "float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );", "float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );", "vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );", "#else", "float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );", "#endif", "dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;", "vec3 dirHalfVector = normalize( dirVector + viewPosition );", "float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );", "float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );", "float specularNormalization = ( shininess + 2.0001 ) / 8.0;", "vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );", "dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;", "}", "#endif", "#if MAX_HEMI_LIGHTS > 0", "vec3 hemiDiffuse  = vec3( 0.0 );", "vec3 hemiSpecular = vec3( 0.0 );", "for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {", "vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );", "vec3 lVector = normalize( lDirection.xyz );", "float dotProduct = dot( normal, lVector );", "float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;", "vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );", "hemiDiffuse += diffuse * hemiColor;", "vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );", "float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;", "float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );", "vec3 lVectorGround = -lVector;", "vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );", "float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;", "float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );", "float dotProductGround = dot( normal, lVectorGround );", "float specularNormalization = ( shininess + 2.0001 ) / 8.0;", "vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );", "vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );", "hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );", "}", "#endif", "vec3 totalDiffuse = vec3( 0.0 );", "vec3 totalSpecular = vec3( 0.0 );", "#if MAX_DIR_LIGHTS > 0", "totalDiffuse += dirDiffuse;", "totalSpecular += dirSpecular;", "#endif", "#if MAX_HEMI_LIGHTS > 0", "totalDiffuse += hemiDiffuse;", "totalSpecular += hemiSpecular;", "#endif", "#if MAX_POINT_LIGHTS > 0", "totalDiffuse += pointDiffuse;", "totalSpecular += pointSpecular;", "#endif", "#if MAX_SPOT_LIGHTS > 0", "totalDiffuse += spotDiffuse;", "totalSpecular += spotSpecular;", "#endif", "#ifdef METAL", "gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );", "#else", "gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;", "#endif", "if ( enableReflection ) {", "vec3 vReflect;", "vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );", "if ( useRefract ) {", "vReflect = refract( cameraToVertex, normal, refractionRatio );", "} else {", "vReflect = reflect( cameraToVertex, normal );", "}", "vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );", "#ifdef GAMMA_INPUT", "cubeColor.xyz *= cubeColor.xyz;", "#endif", "gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );", "}", THREE.ShaderChunk.shadowmap_fragment, THREE.ShaderChunk.linear_to_gamma_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n"),
        vertexShader: ["attribute vec4 tangent;", "uniform vec2 uOffset;", "uniform vec2 uRepeat;", "uniform bool enableDisplacement;", "#ifdef VERTEX_TEXTURES", "uniform sampler2D tDisplacement;", "uniform float uDisplacementScale;", "uniform float uDisplacementBias;", "#endif", "varying vec3 vTangent;", "varying vec3 vBinormal;", "varying vec3 vNormal;", "varying vec2 vUv;", "varying vec3 vWorldPosition;", "varying vec3 vViewPosition;", THREE.ShaderChunk.skinning_pars_vertex, THREE.ShaderChunk.shadowmap_pars_vertex, "void main() {", THREE.ShaderChunk.skinbase_vertex, THREE.ShaderChunk.skinnormal_vertex, "#ifdef USE_SKINNING", "vNormal = normalize( normalMatrix * skinnedNormal.xyz );", "vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );", "vTangent = normalize( normalMatrix * skinnedTangent.xyz );", "#else", "vNormal = normalize( normalMatrix * normal );", "vTangent = normalize( normalMatrix * tangent.xyz );", "#endif", "vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );", "vUv = uv * uRepeat + uOffset;", "vec3 displacedPosition;", "#ifdef VERTEX_TEXTURES", "if ( enableDisplacement ) {", "vec3 dv = texture2D( tDisplacement, uv ).xyz;", "float df = uDisplacementScale * dv.x + uDisplacementBias;", "displacedPosition = position + normalize( normal ) * df;", "} else {", "#ifdef USE_SKINNING", "vec4 skinVertex = vec4( position, 1.0 );", "vec4 skinned  = boneMatX * skinVertex * skinWeight.x;", "skinned 	  += boneMatY * skinVertex * skinWeight.y;", "displacedPosition  = skinned.xyz;", "#else", "displacedPosition = position;", "#endif", "}", "#else", "#ifdef USE_SKINNING", "vec4 skinVertex = vec4( position, 1.0 );", "vec4 skinned  = boneMatX * skinVertex * skinWeight.x;", "skinned 	  += boneMatY * skinVertex * skinWeight.y;", "displacedPosition  = skinned.xyz;", "#else", "displacedPosition = position;", "#endif", "#endif", "vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );", "vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );", "gl_Position = projectionMatrix * mvPosition;", "vWorldPosition = worldPosition.xyz;", "vViewPosition = -mvPosition.xyz;", "#ifdef USE_SHADOWMAP", "for( int i = 0; i < MAX_SHADOWS; i ++ ) {", "vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;", "}", "#endif", "}"].join("\n")
    },
    cube: {
        uniforms: {
            tCube: {
                type: "t",
                value: null
            },
            tFlip: {
                type: "f",
                value: -1
            }
        },
        vertexShader: ["varying vec3 vWorldPosition;", "void main() {", "vec4 worldPosition = modelMatrix * vec4( position, 1.0 );", "vWorldPosition = worldPosition.xyz;", "gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );", "}"].join("\n"),
        fragmentShader: ["uniform samplerCube tCube;", "uniform float tFlip;", "varying vec3 vWorldPosition;", "void main() {", "gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );", "}"].join("\n")
    },
    depthRGBA: {
        uniforms: {},
        vertexShader: [THREE.ShaderChunk.morphtarget_pars_vertex, THREE.ShaderChunk.skinning_pars_vertex, "void main() {", THREE.ShaderChunk.skinbase_vertex, THREE.ShaderChunk.morphtarget_vertex, THREE.ShaderChunk.skinning_vertex, THREE.ShaderChunk.default_vertex, "}"].join("\n"),
        fragmentShader: ["vec4 pack_depth( const in float depth ) {", "const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );", "const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );", "vec4 res = fract( depth * bit_shift );", "res -= res.xxyz * bit_mask;", "return res;", "}", "void main() {", "gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );", "}"].join("\n")
    }
},
THREE.WebGLRenderer = function(a) {
    function b(a) {
        a.__webglVertexBuffer = Ib.createBuffer(),
        a.__webglColorBuffer = Ib.createBuffer(),
        Ob.info.memory.geometries++
    }
    function c(a) {
        a.__webglVertexBuffer = Ib.createBuffer(),
        a.__webglColorBuffer = Ib.createBuffer(),
        a.__webglLineDistanceBuffer = Ib.createBuffer(),
        Ob.info.memory.geometries++
    }
    function d(a) {
        a.__webglVertexBuffer = Ib.createBuffer(),
        a.__webglNormalBuffer = Ib.createBuffer(),
        a.__webglTangentBuffer = Ib.createBuffer(),
        a.__webglColorBuffer = Ib.createBuffer(),
        a.__webglUVBuffer = Ib.createBuffer(),
        a.__webglUV2Buffer = Ib.createBuffer(),
        a.__webglSkinIndicesBuffer = Ib.createBuffer(),
        a.__webglSkinWeightsBuffer = Ib.createBuffer(),
        a.__webglFaceBuffer = Ib.createBuffer(),
        a.__webglLineBuffer = Ib.createBuffer();
        var b, c;
        if (a.numMorphTargets)
            for (a.__webglMorphTargetsBuffers = [],
            b = 0,
            c = a.numMorphTargets; c > b; b++)
                a.__webglMorphTargetsBuffers.push(Ib.createBuffer());
        if (a.numMorphNormals)
            for (a.__webglMorphNormalsBuffers = [],
            b = 0,
            c = a.numMorphNormals; c > b; b++)
                a.__webglMorphNormalsBuffers.push(Ib.createBuffer());
        Ob.info.memory.geometries++
    }
    function e(a, b) {
        var c = a.vertices.length
          , d = b.material;
        if (d.attributes) {
            void 0 === a.__webglCustomAttributesList && (a.__webglCustomAttributesList = []);
            for (var e in d.attributes) {
                var f = d.attributes[e];
                if (!f.__webglInitialized || f.createUniqueBuffers) {
                    f.__webglInitialized = !0;
                    var g = 1;
                    "v2" === f.type ? g = 2 : "v3" === f.type ? g = 3 : "v4" === f.type ? g = 4 : "c" === f.type && (g = 3),
                    f.size = g,
                    f.array = new Float32Array(c * g),
                    f.buffer = Ib.createBuffer(),
                    f.buffer.belongsToAttribute = e,
                    f.needsUpdate = !0
                }
                a.__webglCustomAttributesList.push(f)
            }
        }
    }
    function f(a, b) {
        var c = a.vertices.length;
        a.__vertexArray = new Float32Array(3 * c),
        a.__colorArray = new Float32Array(3 * c),
        a.__sortArray = [],
        a.__webglParticleCount = c,
        e(a, b)
    }
    function g(a, b) {
        var c = a.vertices.length;
        a.__vertexArray = new Float32Array(3 * c),
        a.__colorArray = new Float32Array(3 * c),
        a.__lineDistanceArray = new Float32Array(1 * c),
        a.__webglLineCount = c,
        e(a, b)
    }
    function h(a, b) {
        var c = b.geometry
          , d = a.faces3
          , e = 3 * d.length
          , f = 1 * d.length
          , g = 3 * d.length
          , h = i(b, a)
          , j = m(h)
          , n = k(h)
          , o = l(h);
        a.__vertexArray = new Float32Array(3 * e),
        n && (a.__normalArray = new Float32Array(3 * e)),
        c.hasTangents && (a.__tangentArray = new Float32Array(4 * e)),
        o && (a.__colorArray = new Float32Array(3 * e)),
        j && (c.faceVertexUvs.length > 0 && (a.__uvArray = new Float32Array(2 * e)),
        c.faceVertexUvs.length > 1 && (a.__uv2Array = new Float32Array(2 * e))),
        b.geometry.skinWeights.length && b.geometry.skinIndices.length && (a.__skinIndexArray = new Float32Array(4 * e),
        a.__skinWeightArray = new Float32Array(4 * e)),
        a.__faceArray = new Uint16Array(3 * f),
        a.__lineArray = new Uint16Array(2 * g);
        var p, q;
        if (a.numMorphTargets)
            for (a.__morphTargetsArrays = [],
            p = 0,
            q = a.numMorphTargets; q > p; p++)
                a.__morphTargetsArrays.push(new Float32Array(3 * e));
        if (a.numMorphNormals)
            for (a.__morphNormalsArrays = [],
            p = 0,
            q = a.numMorphNormals; q > p; p++)
                a.__morphNormalsArrays.push(new Float32Array(3 * e));
        if (a.__webglFaceCount = 3 * f,
        a.__webglLineCount = 2 * g,
        h.attributes) {
            void 0 === a.__webglCustomAttributesList && (a.__webglCustomAttributesList = []);
            for (var r in h.attributes) {
                var s = h.attributes[r]
                  , t = {};
                for (var u in s)
                    t[u] = s[u];
                if (!t.__webglInitialized || t.createUniqueBuffers) {
                    t.__webglInitialized = !0;
                    var v = 1;
                    "v2" === t.type ? v = 2 : "v3" === t.type ? v = 3 : "v4" === t.type ? v = 4 : "c" === t.type && (v = 3),
                    t.size = v,
                    t.array = new Float32Array(e * v),
                    t.buffer = Ib.createBuffer(),
                    t.buffer.belongsToAttribute = r,
                    s.needsUpdate = !0,
                    t.__original = s
                }
                a.__webglCustomAttributesList.push(t)
            }
        }
        a.__inittedArrays = !0
    }
    function i(a, b) {
        return a.material instanceof THREE.MeshFaceMaterial ? a.material.materials[b.materialIndex] : a.material
    }
    function j(a) {
        return a && void 0 !== a.shading && a.shading === THREE.SmoothShading
    }
    function k(a) {
        return a instanceof THREE.MeshBasicMaterial && !a.envMap || a instanceof THREE.MeshDepthMaterial ? !1 : j(a) ? THREE.SmoothShading : THREE.FlatShading
    }
    function l(a) {
        return a.vertexColors ? a.vertexColors : !1
    }
    function m(a) {
        return a.map || a.lightMap || a.bumpMap || a.normalMap || a.specularMap || a instanceof THREE.ShaderMaterial ? !0 : !1
    }
    function n(a) {
        var b, c, d;
        for (b in a.attributes)
            d = "index" === b ? Ib.ELEMENT_ARRAY_BUFFER : Ib.ARRAY_BUFFER,
            c = a.attributes[b],
            c.buffer = Ib.createBuffer(),
            Ib.bindBuffer(d, c.buffer),
            Ib.bufferData(d, c.array, Ib.STATIC_DRAW)
    }
    function o(a, b, c) {
        var d, e, f, g, h, i, j, k, l, m, n, o, p = a.vertices, q = p.length, r = a.colors, s = r.length, t = a.__vertexArray, u = a.__colorArray, v = a.__sortArray, w = a.verticesNeedUpdate, y = (a.elementsNeedUpdate,
        a.colorsNeedUpdate), z = a.__webglCustomAttributesList;
        if (c.sortParticles) {
            for (qc.copy(pc),
            qc.multiply(c.matrixWorld),
            d = 0; q > d; d++)
                f = p[d],
                rc.copy(f),
                rc.applyProjection(qc),
                v[d] = [rc.z, d];
            for (v.sort(x),
            d = 0; q > d; d++)
                f = p[v[d][1]],
                g = 3 * d,
                t[g] = f.x,
                t[g + 1] = f.y,
                t[g + 2] = f.z;
            for (e = 0; s > e; e++)
                g = 3 * e,
                i = r[v[e][1]],
                u[g] = i.r,
                u[g + 1] = i.g,
                u[g + 2] = i.b;
            if (z)
                for (j = 0,
                k = z.length; k > j; j++)
                    if (o = z[j],
                    void 0 === o.boundTo || "vertices" === o.boundTo)
                        if (g = 0,
                        m = o.value.length,
                        1 === o.size)
                            for (l = 0; m > l; l++)
                                h = v[l][1],
                                o.array[l] = o.value[h];
                        else if (2 === o.size)
                            for (l = 0; m > l; l++)
                                h = v[l][1],
                                n = o.value[h],
                                o.array[g] = n.x,
                                o.array[g + 1] = n.y,
                                g += 2;
                        else if (3 === o.size)
                            if ("c" === o.type)
                                for (l = 0; m > l; l++)
                                    h = v[l][1],
                                    n = o.value[h],
                                    o.array[g] = n.r,
                                    o.array[g + 1] = n.g,
                                    o.array[g + 2] = n.b,
                                    g += 3;
                            else
                                for (l = 0; m > l; l++)
                                    h = v[l][1],
                                    n = o.value[h],
                                    o.array[g] = n.x,
                                    o.array[g + 1] = n.y,
                                    o.array[g + 2] = n.z,
                                    g += 3;
                        else if (4 === o.size)
                            for (l = 0; m > l; l++)
                                h = v[l][1],
                                n = o.value[h],
                                o.array[g] = n.x,
                                o.array[g + 1] = n.y,
                                o.array[g + 2] = n.z,
                                o.array[g + 3] = n.w,
                                g += 4
        } else {
            if (w)
                for (d = 0; q > d; d++)
                    f = p[d],
                    g = 3 * d,
                    t[g] = f.x,
                    t[g + 1] = f.y,
                    t[g + 2] = f.z;
            if (y)
                for (e = 0; s > e; e++)
                    i = r[e],
                    g = 3 * e,
                    u[g] = i.r,
                    u[g + 1] = i.g,
                    u[g + 2] = i.b;
            if (z)
                for (j = 0,
                k = z.length; k > j; j++)
                    if (o = z[j],
                    o.needsUpdate && (void 0 === o.boundTo || "vertices" === o.boundTo))
                        if (m = o.value.length,
                        g = 0,
                        1 === o.size)
                            for (l = 0; m > l; l++)
                                o.array[l] = o.value[l];
                        else if (2 === o.size)
                            for (l = 0; m > l; l++)
                                n = o.value[l],
                                o.array[g] = n.x,
                                o.array[g + 1] = n.y,
                                g += 2;
                        else if (3 === o.size)
                            if ("c" === o.type)
                                for (l = 0; m > l; l++)
                                    n = o.value[l],
                                    o.array[g] = n.r,
                                    o.array[g + 1] = n.g,
                                    o.array[g + 2] = n.b,
                                    g += 3;
                            else
                                for (l = 0; m > l; l++)
                                    n = o.value[l],
                                    o.array[g] = n.x,
                                    o.array[g + 1] = n.y,
                                    o.array[g + 2] = n.z,
                                    g += 3;
                        else if (4 === o.size)
                            for (l = 0; m > l; l++)
                                n = o.value[l],
                                o.array[g] = n.x,
                                o.array[g + 1] = n.y,
                                o.array[g + 2] = n.z,
                                o.array[g + 3] = n.w,
                                g += 4
        }
        if ((w || c.sortParticles) && (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglVertexBuffer),
        Ib.bufferData(Ib.ARRAY_BUFFER, t, b)),
        (y || c.sortParticles) && (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglColorBuffer),
        Ib.bufferData(Ib.ARRAY_BUFFER, u, b)),
        z)
            for (j = 0,
            k = z.length; k > j; j++)
                o = z[j],
                (o.needsUpdate || c.sortParticles) && (Ib.bindBuffer(Ib.ARRAY_BUFFER, o.buffer),
                Ib.bufferData(Ib.ARRAY_BUFFER, o.array, b))
    }
    function p(a, b) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o = a.vertices, p = a.colors, q = a.lineDistances, r = o.length, s = p.length, t = q.length, u = a.__vertexArray, v = a.__colorArray, w = a.__lineDistanceArray, x = a.verticesNeedUpdate, y = a.colorsNeedUpdate, z = a.lineDistancesNeedUpdate, A = a.__webglCustomAttributesList;
        if (x) {
            for (c = 0; r > c; c++)
                f = o[c],
                g = 3 * c,
                u[g] = f.x,
                u[g + 1] = f.y,
                u[g + 2] = f.z;
            Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglVertexBuffer),
            Ib.bufferData(Ib.ARRAY_BUFFER, u, b)
        }
        if (y) {
            for (d = 0; s > d; d++)
                h = p[d],
                g = 3 * d,
                v[g] = h.r,
                v[g + 1] = h.g,
                v[g + 2] = h.b;
            Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglColorBuffer),
            Ib.bufferData(Ib.ARRAY_BUFFER, v, b)
        }
        if (z) {
            for (e = 0; t > e; e++)
                w[e] = q[e];
            Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglLineDistanceBuffer),
            Ib.bufferData(Ib.ARRAY_BUFFER, w, b)
        }
        if (A)
            for (i = 0,
            j = A.length; j > i; i++)
                if (n = A[i],
                n.needsUpdate && (void 0 === n.boundTo || "vertices" === n.boundTo)) {
                    if (g = 0,
                    l = n.value.length,
                    1 === n.size)
                        for (k = 0; l > k; k++)
                            n.array[k] = n.value[k];
                    else if (2 === n.size)
                        for (k = 0; l > k; k++)
                            m = n.value[k],
                            n.array[g] = m.x,
                            n.array[g + 1] = m.y,
                            g += 2;
                    else if (3 === n.size)
                        if ("c" === n.type)
                            for (k = 0; l > k; k++)
                                m = n.value[k],
                                n.array[g] = m.r,
                                n.array[g + 1] = m.g,
                                n.array[g + 2] = m.b,
                                g += 3;
                        else
                            for (k = 0; l > k; k++)
                                m = n.value[k],
                                n.array[g] = m.x,
                                n.array[g + 1] = m.y,
                                n.array[g + 2] = m.z,
                                g += 3;
                    else if (4 === n.size)
                        for (k = 0; l > k; k++)
                            m = n.value[k],
                            n.array[g] = m.x,
                            n.array[g + 1] = m.y,
                            n.array[g + 2] = m.z,
                            n.array[g + 3] = m.w,
                            g += 4;
                    Ib.bindBuffer(Ib.ARRAY_BUFFER, n.buffer),
                    Ib.bufferData(Ib.ARRAY_BUFFER, n.array, b)
                }
    }
    function q(a, b, c, d, e) {
        if (a.__inittedArrays) {
            var f, g, h, i, j, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y = k(e), Z = l(e), $ = m(e), _ = Y === THREE.SmoothShading, ab = 0, bb = 0, cb = 0, db = 0, eb = 0, fb = 0, gb = 0, hb = 0, ib = 0, jb = 0, kb = 0, lb = 0, mb = 0, nb = a.__vertexArray, ob = a.__uvArray, pb = a.__uv2Array, qb = a.__normalArray, rb = a.__tangentArray, sb = a.__colorArray, tb = a.__skinIndexArray, ub = a.__skinWeightArray, vb = a.__morphTargetsArrays, wb = a.__morphNormalsArrays, xb = a.__webglCustomAttributesList, yb = a.__faceArray, zb = a.__lineArray, Ab = b.geometry, Bb = Ab.verticesNeedUpdate, Cb = Ab.elementsNeedUpdate, Db = Ab.uvsNeedUpdate, Eb = Ab.normalsNeedUpdate, Fb = Ab.tangentsNeedUpdate, Gb = Ab.colorsNeedUpdate, Hb = Ab.morphTargetsNeedUpdate, Jb = Ab.vertices, Kb = a.faces3, Lb = Ab.faces, Mb = Ab.faceVertexUvs[0], Nb = Ab.faceVertexUvs[1], Ob = (Ab.colors,
            Ab.skinIndices), Pb = Ab.skinWeights, Qb = Ab.morphTargets, Rb = Ab.morphNormals;
            if (Bb) {
                for (f = 0,
                g = Kb.length; g > f; f++)
                    i = Lb[Kb[f]],
                    t = Jb[i.a],
                    u = Jb[i.b],
                    v = Jb[i.c],
                    nb[bb] = t.x,
                    nb[bb + 1] = t.y,
                    nb[bb + 2] = t.z,
                    nb[bb + 3] = u.x,
                    nb[bb + 4] = u.y,
                    nb[bb + 5] = u.z,
                    nb[bb + 6] = v.x,
                    nb[bb + 7] = v.y,
                    nb[bb + 8] = v.z,
                    bb += 9;
                Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglVertexBuffer),
                Ib.bufferData(Ib.ARRAY_BUFFER, nb, c)
            }
            if (Hb)
                for (Q = 0,
                R = Qb.length; R > Q; Q++) {
                    for (kb = 0,
                    f = 0,
                    g = Kb.length; g > f; f++)
                        U = Kb[f],
                        i = Lb[U],
                        t = Qb[Q].vertices[i.a],
                        u = Qb[Q].vertices[i.b],
                        v = Qb[Q].vertices[i.c],
                        S = vb[Q],
                        S[kb] = t.x,
                        S[kb + 1] = t.y,
                        S[kb + 2] = t.z,
                        S[kb + 3] = u.x,
                        S[kb + 4] = u.y,
                        S[kb + 5] = u.z,
                        S[kb + 6] = v.x,
                        S[kb + 7] = v.y,
                        S[kb + 8] = v.z,
                        e.morphNormals && (_ ? (V = Rb[Q].vertexNormals[U],
                        z = V.a,
                        A = V.b,
                        B = V.c) : (z = Rb[Q].faceNormals[U],
                        A = z,
                        B = z),
                        T = wb[Q],
                        T[kb] = z.x,
                        T[kb + 1] = z.y,
                        T[kb + 2] = z.z,
                        T[kb + 3] = A.x,
                        T[kb + 4] = A.y,
                        T[kb + 5] = A.z,
                        T[kb + 6] = B.x,
                        T[kb + 7] = B.y,
                        T[kb + 8] = B.z),
                        kb += 9;
                    Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglMorphTargetsBuffers[Q]),
                    Ib.bufferData(Ib.ARRAY_BUFFER, vb[Q], c),
                    e.morphNormals && (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglMorphNormalsBuffers[Q]),
                    Ib.bufferData(Ib.ARRAY_BUFFER, wb[Q], c))
                }
            if (Pb.length) {
                for (f = 0,
                g = Kb.length; g > f; f++)
                    i = Lb[Kb[f]],
                    F = Pb[i.a],
                    G = Pb[i.b],
                    H = Pb[i.c],
                    ub[jb] = F.x,
                    ub[jb + 1] = F.y,
                    ub[jb + 2] = F.z,
                    ub[jb + 3] = F.w,
                    ub[jb + 4] = G.x,
                    ub[jb + 5] = G.y,
                    ub[jb + 6] = G.z,
                    ub[jb + 7] = G.w,
                    ub[jb + 8] = H.x,
                    ub[jb + 9] = H.y,
                    ub[jb + 10] = H.z,
                    ub[jb + 11] = H.w,
                    I = Ob[i.a],
                    J = Ob[i.b],
                    K = Ob[i.c],
                    tb[jb] = I.x,
                    tb[jb + 1] = I.y,
                    tb[jb + 2] = I.z,
                    tb[jb + 3] = I.w,
                    tb[jb + 4] = J.x,
                    tb[jb + 5] = J.y,
                    tb[jb + 6] = J.z,
                    tb[jb + 7] = J.w,
                    tb[jb + 8] = K.x,
                    tb[jb + 9] = K.y,
                    tb[jb + 10] = K.z,
                    tb[jb + 11] = K.w,
                    jb += 12;
                jb > 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglSkinIndicesBuffer),
                Ib.bufferData(Ib.ARRAY_BUFFER, tb, c),
                Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglSkinWeightsBuffer),
                Ib.bufferData(Ib.ARRAY_BUFFER, ub, c))
            }
            if (Gb && Z) {
                for (f = 0,
                g = Kb.length; g > f; f++)
                    i = Lb[Kb[f]],
                    o = i.vertexColors,
                    p = i.color,
                    3 === o.length && Z === THREE.VertexColors ? (C = o[0],
                    D = o[1],
                    E = o[2]) : (C = p,
                    D = p,
                    E = p),
                    sb[ib] = C.r,
                    sb[ib + 1] = C.g,
                    sb[ib + 2] = C.b,
                    sb[ib + 3] = D.r,
                    sb[ib + 4] = D.g,
                    sb[ib + 5] = D.b,
                    sb[ib + 6] = E.r,
                    sb[ib + 7] = E.g,
                    sb[ib + 8] = E.b,
                    ib += 9;
                ib > 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglColorBuffer),
                Ib.bufferData(Ib.ARRAY_BUFFER, sb, c))
            }
            if (Fb && Ab.hasTangents) {
                for (f = 0,
                g = Kb.length; g > f; f++)
                    i = Lb[Kb[f]],
                    q = i.vertexTangents,
                    w = q[0],
                    x = q[1],
                    y = q[2],
                    rb[gb] = w.x,
                    rb[gb + 1] = w.y,
                    rb[gb + 2] = w.z,
                    rb[gb + 3] = w.w,
                    rb[gb + 4] = x.x,
                    rb[gb + 5] = x.y,
                    rb[gb + 6] = x.z,
                    rb[gb + 7] = x.w,
                    rb[gb + 8] = y.x,
                    rb[gb + 9] = y.y,
                    rb[gb + 10] = y.z,
                    rb[gb + 11] = y.w,
                    gb += 12;
                Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglTangentBuffer),
                Ib.bufferData(Ib.ARRAY_BUFFER, rb, c)
            }
            if (Eb && Y) {
                for (f = 0,
                g = Kb.length; g > f; f++)
                    if (i = Lb[Kb[f]],
                    j = i.vertexNormals,
                    n = i.normal,
                    3 === j.length && _)
                        for (L = 0; 3 > L; L++)
                            N = j[L],
                            qb[fb] = N.x,
                            qb[fb + 1] = N.y,
                            qb[fb + 2] = N.z,
                            fb += 3;
                    else
                        for (L = 0; 3 > L; L++)
                            qb[fb] = n.x,
                            qb[fb + 1] = n.y,
                            qb[fb + 2] = n.z,
                            fb += 3;
                Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglNormalBuffer),
                Ib.bufferData(Ib.ARRAY_BUFFER, qb, c)
            }
            if (Db && Mb && $) {
                for (f = 0,
                g = Kb.length; g > f; f++)
                    if (h = Kb[f],
                    r = Mb[h],
                    void 0 !== r)
                        for (L = 0; 3 > L; L++)
                            O = r[L],
                            ob[cb] = O.x,
                            ob[cb + 1] = O.y,
                            cb += 2;
                cb > 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglUVBuffer),
                Ib.bufferData(Ib.ARRAY_BUFFER, ob, c))
            }
            if (Db && Nb && $) {
                for (f = 0,
                g = Kb.length; g > f; f++)
                    if (h = Kb[f],
                    s = Nb[h],
                    void 0 !== s)
                        for (L = 0; 3 > L; L++)
                            P = s[L],
                            pb[db] = P.x,
                            pb[db + 1] = P.y,
                            db += 2;
                db > 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglUV2Buffer),
                Ib.bufferData(Ib.ARRAY_BUFFER, pb, c))
            }
            if (Cb) {
                for (f = 0,
                g = Kb.length; g > f; f++)
                    yb[eb] = ab,
                    yb[eb + 1] = ab + 1,
                    yb[eb + 2] = ab + 2,
                    eb += 3,
                    zb[hb] = ab,
                    zb[hb + 1] = ab + 1,
                    zb[hb + 2] = ab,
                    zb[hb + 3] = ab + 2,
                    zb[hb + 4] = ab + 1,
                    zb[hb + 5] = ab + 2,
                    hb += 6,
                    ab += 3;
                Ib.bindBuffer(Ib.ELEMENT_ARRAY_BUFFER, a.__webglFaceBuffer),
                Ib.bufferData(Ib.ELEMENT_ARRAY_BUFFER, yb, c),
                Ib.bindBuffer(Ib.ELEMENT_ARRAY_BUFFER, a.__webglLineBuffer),
                Ib.bufferData(Ib.ELEMENT_ARRAY_BUFFER, zb, c)
            }
            if (xb)
                for (L = 0,
                M = xb.length; M > L; L++)
                    if (X = xb[L],
                    X.__original.needsUpdate) {
                        if (lb = 0,
                        mb = 0,
                        1 === X.size) {
                            if (void 0 === X.boundTo || "vertices" === X.boundTo)
                                for (f = 0,
                                g = Kb.length; g > f; f++)
                                    i = Lb[Kb[f]],
                                    X.array[lb] = X.value[i.a],
                                    X.array[lb + 1] = X.value[i.b],
                                    X.array[lb + 2] = X.value[i.c],
                                    lb += 3;
                            else if ("faces" === X.boundTo)
                                for (f = 0,
                                g = Kb.length; g > f; f++)
                                    W = X.value[Kb[f]],
                                    X.array[lb] = W,
                                    X.array[lb + 1] = W,
                                    X.array[lb + 2] = W,
                                    lb += 3
                        } else if (2 === X.size) {
                            if (void 0 === X.boundTo || "vertices" === X.boundTo)
                                for (f = 0,
                                g = Kb.length; g > f; f++)
                                    i = Lb[Kb[f]],
                                    t = X.value[i.a],
                                    u = X.value[i.b],
                                    v = X.value[i.c],
                                    X.array[lb] = t.x,
                                    X.array[lb + 1] = t.y,
                                    X.array[lb + 2] = u.x,
                                    X.array[lb + 3] = u.y,
                                    X.array[lb + 4] = v.x,
                                    X.array[lb + 5] = v.y,
                                    lb += 6;
                            else if ("faces" === X.boundTo)
                                for (f = 0,
                                g = Kb.length; g > f; f++)
                                    W = X.value[Kb[f]],
                                    t = W,
                                    u = W,
                                    v = W,
                                    X.array[lb] = t.x,
                                    X.array[lb + 1] = t.y,
                                    X.array[lb + 2] = u.x,
                                    X.array[lb + 3] = u.y,
                                    X.array[lb + 4] = v.x,
                                    X.array[lb + 5] = v.y,
                                    lb += 6
                        } else if (3 === X.size) {
                            var Sb;
                            if (Sb = "c" === X.type ? ["r", "g", "b"] : ["x", "y", "z"],
                            void 0 === X.boundTo || "vertices" === X.boundTo)
                                for (f = 0,
                                g = Kb.length; g > f; f++)
                                    i = Lb[Kb[f]],
                                    t = X.value[i.a],
                                    u = X.value[i.b],
                                    v = X.value[i.c],
                                    X.array[lb] = t[Sb[0]],
                                    X.array[lb + 1] = t[Sb[1]],
                                    X.array[lb + 2] = t[Sb[2]],
                                    X.array[lb + 3] = u[Sb[0]],
                                    X.array[lb + 4] = u[Sb[1]],
                                    X.array[lb + 5] = u[Sb[2]],
                                    X.array[lb + 6] = v[Sb[0]],
                                    X.array[lb + 7] = v[Sb[1]],
                                    X.array[lb + 8] = v[Sb[2]],
                                    lb += 9;
                            else if ("faces" === X.boundTo)
                                for (f = 0,
                                g = Kb.length; g > f; f++)
                                    W = X.value[Kb[f]],
                                    t = W,
                                    u = W,
                                    v = W,
                                    X.array[lb] = t[Sb[0]],
                                    X.array[lb + 1] = t[Sb[1]],
                                    X.array[lb + 2] = t[Sb[2]],
                                    X.array[lb + 3] = u[Sb[0]],
                                    X.array[lb + 4] = u[Sb[1]],
                                    X.array[lb + 5] = u[Sb[2]],
                                    X.array[lb + 6] = v[Sb[0]],
                                    X.array[lb + 7] = v[Sb[1]],
                                    X.array[lb + 8] = v[Sb[2]],
                                    lb += 9;
                            else if ("faceVertices" === X.boundTo)
                                for (f = 0,
                                g = Kb.length; g > f; f++)
                                    W = X.value[Kb[f]],
                                    t = W[0],
                                    u = W[1],
                                    v = W[2],
                                    X.array[lb] = t[Sb[0]],
                                    X.array[lb + 1] = t[Sb[1]],
                                    X.array[lb + 2] = t[Sb[2]],
                                    X.array[lb + 3] = u[Sb[0]],
                                    X.array[lb + 4] = u[Sb[1]],
                                    X.array[lb + 5] = u[Sb[2]],
                                    X.array[lb + 6] = v[Sb[0]],
                                    X.array[lb + 7] = v[Sb[1]],
                                    X.array[lb + 8] = v[Sb[2]],
                                    lb += 9
                        } else if (4 === X.size)
                            if (void 0 === X.boundTo || "vertices" === X.boundTo)
                                for (f = 0,
                                g = Kb.length; g > f; f++)
                                    i = Lb[Kb[f]],
                                    t = X.value[i.a],
                                    u = X.value[i.b],
                                    v = X.value[i.c],
                                    X.array[lb] = t.x,
                                    X.array[lb + 1] = t.y,
                                    X.array[lb + 2] = t.z,
                                    X.array[lb + 3] = t.w,
                                    X.array[lb + 4] = u.x,
                                    X.array[lb + 5] = u.y,
                                    X.array[lb + 6] = u.z,
                                    X.array[lb + 7] = u.w,
                                    X.array[lb + 8] = v.x,
                                    X.array[lb + 9] = v.y,
                                    X.array[lb + 10] = v.z,
                                    X.array[lb + 11] = v.w,
                                    lb += 12;
                            else if ("faces" === X.boundTo)
                                for (f = 0,
                                g = Kb.length; g > f; f++)
                                    W = X.value[Kb[f]],
                                    t = W,
                                    u = W,
                                    v = W,
                                    X.array[lb] = t.x,
                                    X.array[lb + 1] = t.y,
                                    X.array[lb + 2] = t.z,
                                    X.array[lb + 3] = t.w,
                                    X.array[lb + 4] = u.x,
                                    X.array[lb + 5] = u.y,
                                    X.array[lb + 6] = u.z,
                                    X.array[lb + 7] = u.w,
                                    X.array[lb + 8] = v.x,
                                    X.array[lb + 9] = v.y,
                                    X.array[lb + 10] = v.z,
                                    X.array[lb + 11] = v.w,
                                    lb += 12;
                            else if ("faceVertices" === X.boundTo)
                                for (f = 0,
                                g = Kb.length; g > f; f++)
                                    W = X.value[Kb[f]],
                                    t = W[0],
                                    u = W[1],
                                    v = W[2],
                                    X.array[lb] = t.x,
                                    X.array[lb + 1] = t.y,
                                    X.array[lb + 2] = t.z,
                                    X.array[lb + 3] = t.w,
                                    X.array[lb + 4] = u.x,
                                    X.array[lb + 5] = u.y,
                                    X.array[lb + 6] = u.z,
                                    X.array[lb + 7] = u.w,
                                    X.array[lb + 8] = v.x,
                                    X.array[lb + 9] = v.y,
                                    X.array[lb + 10] = v.z,
                                    X.array[lb + 11] = v.w,
                                    lb += 12;
                        Ib.bindBuffer(Ib.ARRAY_BUFFER, X.buffer),
                        Ib.bufferData(Ib.ARRAY_BUFFER, X.array, c)
                    }
            d && (delete a.__inittedArrays,
            delete a.__colorArray,
            delete a.__normalArray,
            delete a.__tangentArray,
            delete a.__uvArray,
            delete a.__uv2Array,
            delete a.__faceArray,
            delete a.__vertexArray,
            delete a.__lineArray,
            delete a.__skinIndexArray,
            delete a.__skinWeightArray)
        }
    }
    function r(a, b, c, d) {
        var e, f, g, h;
        for (f in b)
            g = b[f],
            e = c[f],
            g >= 0 && (e ? (h = e.itemSize,
            Ib.bindBuffer(Ib.ARRAY_BUFFER, e.buffer),
            t(g),
            Ib.vertexAttribPointer(g, h, Ib.FLOAT, !1, 0, d * h * 4)) : a.defaultAttributeValues && (2 === a.defaultAttributeValues[f].length ? Ib.vertexAttrib2fv(g, a.defaultAttributeValues[f]) : 3 === a.defaultAttributeValues[f].length && Ib.vertexAttrib3fv(g, a.defaultAttributeValues[f])))
    }
    function s(a, b) {
        var c, d, e = a.attributes;
        for (c in e)
            d = e[c],
            d.needsUpdate && ("index" === c ? (Ib.bindBuffer(Ib.ELEMENT_ARRAY_BUFFER, d.buffer),
            Ib.bufferData(Ib.ELEMENT_ARRAY_BUFFER, d.array, b)) : (Ib.bindBuffer(Ib.ARRAY_BUFFER, d.buffer),
            Ib.bufferData(Ib.ARRAY_BUFFER, d.array, b)),
            d.needsUpdate = !1)
    }
    function t(a) {
        0 === nc[a] && (Ib.enableVertexAttribArray(a),
        nc[a] = 1)
    }
    function u() {
        for (var a in nc)
            1 === nc[a] && (Ib.disableVertexAttribArray(a),
            nc[a] = 0)
    }
    function v(a, b, c) {
        var d = a.program.attributes;
        if (-1 !== c.morphTargetBase && d.position >= 0 ? (Ib.bindBuffer(Ib.ARRAY_BUFFER, b.__webglMorphTargetsBuffers[c.morphTargetBase]),
        t(d.position),
        Ib.vertexAttribPointer(d.position, 3, Ib.FLOAT, !1, 0, 0)) : d.position >= 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, b.__webglVertexBuffer),
        t(d.position),
        Ib.vertexAttribPointer(d.position, 3, Ib.FLOAT, !1, 0, 0)),
        c.morphTargetForcedOrder.length)
            for (var e = 0, f = c.morphTargetForcedOrder, g = c.morphTargetInfluences; e < a.numSupportedMorphTargets && e < f.length; )
                d["morphTarget" + e] >= 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, b.__webglMorphTargetsBuffers[f[e]]),
                t(d["morphTarget" + e]),
                Ib.vertexAttribPointer(d["morphTarget" + e], 3, Ib.FLOAT, !1, 0, 0)),
                d["morphNormal" + e] >= 0 && a.morphNormals && (Ib.bindBuffer(Ib.ARRAY_BUFFER, b.__webglMorphNormalsBuffers[f[e]]),
                t(d["morphNormal" + e]),
                Ib.vertexAttribPointer(d["morphNormal" + e], 3, Ib.FLOAT, !1, 0, 0)),
                c.__webglMorphTargetInfluences[e] = g[f[e]],
                e++;
        else {
            var h, i, j = [], g = c.morphTargetInfluences, k = g.length;
            for (i = 0; k > i; i++)
                h = g[i],
                h > 0 && j.push([h, i]);
            j.length > a.numSupportedMorphTargets ? (j.sort(x),
            j.length = a.numSupportedMorphTargets) : j.length > a.numSupportedMorphNormals ? j.sort(x) : 0 === j.length && j.push([0, 0]);
            for (var l, e = 0; e < a.numSupportedMorphTargets; )
                j[e] ? (l = j[e][1],
                d["morphTarget" + e] >= 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, b.__webglMorphTargetsBuffers[l]),
                t(d["morphTarget" + e]),
                Ib.vertexAttribPointer(d["morphTarget" + e], 3, Ib.FLOAT, !1, 0, 0)),
                d["morphNormal" + e] >= 0 && a.morphNormals && (Ib.bindBuffer(Ib.ARRAY_BUFFER, b.__webglMorphNormalsBuffers[l]),
                t(d["morphNormal" + e]),
                Ib.vertexAttribPointer(d["morphNormal" + e], 3, Ib.FLOAT, !1, 0, 0)),
                c.__webglMorphTargetInfluences[e] = g[l]) : c.__webglMorphTargetInfluences[e] = 0,
                e++
        }
        null !== a.program.uniforms.morphTargetInfluences && Ib.uniform1fv(a.program.uniforms.morphTargetInfluences, c.__webglMorphTargetInfluences)
    }
    function w(a, b) {
        return a.z !== b.z ? b.z - a.z : a.id - b.id
    }
    function x(a, b) {
        return b[0] - a[0]
    }
    function y(a, b, c) {
        if (a.length)
            for (var d = 0, e = a.length; e > d; d++)
                Rb = null,
                Vb = null,
                Zb = -1,
                bc = -1,
                cc = -1,
                Xb = -1,
                Yb = -1,
                Ub = -1,
                Tb = -1,
                tc = !0,
                a[d].render(b, c, lc, mc),
                Rb = null,
                Vb = null,
                Zb = -1,
                bc = -1,
                cc = -1,
                Xb = -1,
                Yb = -1,
                Ub = -1,
                Tb = -1,
                tc = !0
    }
    function z(a, b, c, d, e, f, g, h) {
        var i, j, k, l, m, n, o;
        b ? (m = a.length - 1,
        n = -1,
        o = -1) : (m = 0,
        n = a.length,
        o = 1);
        for (var p = m; p !== n; p += o)
            if (i = a[p],
            i.render) {
                if (j = i.object,
                k = i.buffer,
                h)
                    l = h;
                else {
                    if (l = i[c],
                    !l)
                        continue;
                    g && Ob.setBlending(l.blending, l.blendEquation, l.blendSrc, l.blendDst),
                    Ob.setDepthTest(l.depthTest),
                    Ob.setDepthWrite(l.depthWrite),
                    db(l.polygonOffset, l.polygonOffsetFactor, l.polygonOffsetUnits)
                }
                Ob.setMaterialFaces(l),
                k instanceof THREE.BufferGeometry ? Ob.renderBufferDirect(d, e, f, l, k, j) : Ob.renderBuffer(d, e, f, l, k, j)
            }
    }
    function A(a, b, c, d, e, f, g) {
        for (var h, i, j, k = 0, l = a.length; l > k; k++)
            if (h = a[k],
            i = h.object,
            i.visible) {
                if (g)
                    j = g;
                else {
                    if (j = h[b],
                    !j)
                        continue;
                    f && Ob.setBlending(j.blending, j.blendEquation, j.blendSrc, j.blendDst),
                    Ob.setDepthTest(j.depthTest),
                    Ob.setDepthWrite(j.depthWrite),
                    db(j.polygonOffset, j.polygonOffsetFactor, j.polygonOffsetUnits)
                }
                Ob.renderImmediateObject(c, d, e, j, i)
            }
    }
    function B(a) {
        var b = a.object
          , c = b.material;
        c.transparent ? (a.transparent = c,
        a.opaque = null) : (a.opaque = c,
        a.transparent = null)
    }
    function C(a) {
        var b = a.object
          , c = a.buffer
          , d = b.geometry
          , e = b.material;
        if (e instanceof THREE.MeshFaceMaterial) {
            var f = d instanceof THREE.BufferGeometry ? 0 : c.materialIndex;
            e = e.materials[f],
            e.transparent ? (a.transparent = e,
            a.opaque = null) : (a.opaque = e,
            a.transparent = null)
        } else
            e && (e.transparent ? (a.transparent = e,
            a.opaque = null) : (a.opaque = e,
            a.transparent = null))
    }
    function D(a, e) {
        var i, j, k, l;
        if (void 0 === a.__webglInit)
            if (a.__webglInit = !0,
            a._modelViewMatrix = new THREE.Matrix4,
            a._normalMatrix = new THREE.Matrix3,
            void 0 !== a.geometry && void 0 === a.geometry.__webglInit && (a.geometry.__webglInit = !0,
            a.geometry.addEventListener("dispose", Hc)),
            j = a.geometry,
            void 0 === j)
                ;
            else if (j instanceof THREE.BufferGeometry)
                n(j);
            else if (a instanceof THREE.Mesh) {
                k = a.material,
                void 0 === j.geometryGroups && j.makeGroups(k instanceof THREE.MeshFaceMaterial);
                for (i in j.geometryGroups)
                    l = j.geometryGroups[i],
                    l.__webglVertexBuffer || (d(l),
                    h(l, a),
                    j.verticesNeedUpdate = !0,
                    j.morphTargetsNeedUpdate = !0,
                    j.elementsNeedUpdate = !0,
                    j.uvsNeedUpdate = !0,
                    j.normalsNeedUpdate = !0,
                    j.tangentsNeedUpdate = !0,
                    j.colorsNeedUpdate = !0)
            } else
                a instanceof THREE.Line ? j.__webglVertexBuffer || (c(j),
                g(j, a),
                j.verticesNeedUpdate = !0,
                j.colorsNeedUpdate = !0,
                j.lineDistancesNeedUpdate = !0) : a instanceof THREE.ParticleSystem && (j.__webglVertexBuffer || (b(j),
                f(j, a),
                j.verticesNeedUpdate = !0,
                j.colorsNeedUpdate = !0));
        if (void 0 === a.__webglActive) {
            if (a instanceof THREE.Mesh) {
                if (j = a.geometry,
                j instanceof THREE.BufferGeometry)
                    E(e.__webglObjects, j, a);
                else if (j instanceof THREE.Geometry)
                    for (i in j.geometryGroups)
                        l = j.geometryGroups[i],
                        E(e.__webglObjects, l, a)
            } else
                a instanceof THREE.Line || a instanceof THREE.ParticleSystem ? (j = a.geometry,
                E(e.__webglObjects, j, a)) : a instanceof THREE.ImmediateRenderObject || a.immediateRenderCallback ? F(e.__webglObjectsImmediate, a) : a instanceof THREE.Sprite ? e.__webglSprites.push(a) : a instanceof THREE.LensFlare && e.__webglFlares.push(a);
            a.__webglActive = !0
        }
    }
    function E(a, b, c) {
        a.push({
            id: null,
            buffer: b,
            object: c,
            opaque: null,
            transparent: null,
            z: 0
        })
    }
    function F(a, b) {
        a.push({
            id: null,
            object: b,
            opaque: null,
            transparent: null,
            z: 0
        })
    }
    function G(a) {
        var b, c, d, e = a.geometry;
        if (e instanceof THREE.BufferGeometry)
            s(e, Ib.DYNAMIC_DRAW);
        else if (a instanceof THREE.Mesh) {
            for (var f = 0, g = e.geometryGroupsList.length; g > f; f++)
                b = e.geometryGroupsList[f],
                d = i(a, b),
                e.buffersNeedUpdate && h(b, a),
                c = d.attributes && H(d),
                (e.verticesNeedUpdate || e.morphTargetsNeedUpdate || e.elementsNeedUpdate || e.uvsNeedUpdate || e.normalsNeedUpdate || e.colorsNeedUpdate || e.tangentsNeedUpdate || c) && q(b, a, Ib.DYNAMIC_DRAW, !e.dynamic, d);
            e.verticesNeedUpdate = !1,
            e.morphTargetsNeedUpdate = !1,
            e.elementsNeedUpdate = !1,
            e.uvsNeedUpdate = !1,
            e.normalsNeedUpdate = !1,
            e.colorsNeedUpdate = !1,
            e.tangentsNeedUpdate = !1,
            e.buffersNeedUpdate = !1,
            d.attributes && I(d)
        } else
            a instanceof THREE.Line ? (d = i(a, e),
            c = d.attributes && H(d),
            (e.verticesNeedUpdate || e.colorsNeedUpdate || e.lineDistancesNeedUpdate || c) && p(e, Ib.DYNAMIC_DRAW),
            e.verticesNeedUpdate = !1,
            e.colorsNeedUpdate = !1,
            e.lineDistancesNeedUpdate = !1,
            d.attributes && I(d)) : a instanceof THREE.ParticleSystem && (d = i(a, e),
            c = d.attributes && H(d),
            (e.verticesNeedUpdate || e.colorsNeedUpdate || a.sortParticles || c) && o(e, Ib.DYNAMIC_DRAW, a),
            e.verticesNeedUpdate = !1,
            e.colorsNeedUpdate = !1,
            d.attributes && I(d))
    }
    function H(a) {
        for (var b in a.attributes)
            if (a.attributes[b].needsUpdate)
                return !0;
        return !1
    }
    function I(a) {
        for (var b in a.attributes)
            a.attributes[b].needsUpdate = !1
    }
    function J(a, b) {
        a instanceof THREE.Mesh || a instanceof THREE.ParticleSystem || a instanceof THREE.Line ? K(b.__webglObjects, a) : a instanceof THREE.Sprite ? L(b.__webglSprites, a) : a instanceof THREE.LensFlare ? L(b.__webglFlares, a) : (a instanceof THREE.ImmediateRenderObject || a.immediateRenderCallback) && K(b.__webglObjectsImmediate, a),
        delete a.__webglActive
    }
    function K(a, b) {
        for (var c = a.length - 1; c >= 0; c--)
            a[c].object === b && a.splice(c, 1)
    }
    function L(a, b) {
        for (var c = a.length - 1; c >= 0; c--)
            a[c] === b && a.splice(c, 1)
    }
    function M(a, b) {
        a.uniforms = THREE.UniformsUtils.clone(b.uniforms),
        a.vertexShader = b.vertexShader,
        a.fragmentShader = b.fragmentShader
    }
    function N(a, b, c, d, e) {
        Wb = 0,
        d.needsUpdate && (d.program && Pc(d),
        Ob.initMaterial(d, b, c, e),
        d.needsUpdate = !1),
        d.morphTargets && (e.__webglMorphTargetInfluences || (e.__webglMorphTargetInfluences = new Float32Array(Ob.maxMorphTargets)));
        var f = !1
          , g = d.program
          , h = g.uniforms
          , i = d.uniforms;
        if (g !== Rb && (Ib.useProgram(g),
        Rb = g,
        f = !0),
        d.id !== Tb && (Tb = d.id,
        f = !0),
        (f || a !== Vb) && (Ib.uniformMatrix4fv(h.projectionMatrix, !1, a.projectionMatrix.elements),
        a !== Vb && (Vb = a)),
        d.skinning)
            if (Ac && e.useVertexTexture) {
                if (null !== h.boneTexture) {
                    var j = Y();
                    Ib.uniform1i(h.boneTexture, j),
                    Ob.setTexture(e.boneTexture, j)
                }
                null !== h.boneTextureWidth && Ib.uniform1i(h.boneTextureWidth, e.boneTextureWidth),
                null !== h.boneTextureHeight && Ib.uniform1i(h.boneTextureHeight, e.boneTextureHeight)
            } else
                null !== h.boneGlobalMatrices && Ib.uniformMatrix4fv(h.boneGlobalMatrices, !1, e.boneMatrices);
        return f && (c && d.fog && S(i, c),
        (d instanceof THREE.MeshPhongMaterial || d instanceof THREE.MeshLambertMaterial || d.lights) && (tc && (bb(g, b),
        tc = !1),
        V(i, uc)),
        (d instanceof THREE.MeshBasicMaterial || d instanceof THREE.MeshLambertMaterial || d instanceof THREE.MeshPhongMaterial) && O(i, d),
        d instanceof THREE.LineBasicMaterial ? P(i, d) : d instanceof THREE.LineDashedMaterial ? (P(i, d),
        Q(i, d)) : d instanceof THREE.ParticleSystemMaterial ? R(i, d) : d instanceof THREE.MeshPhongMaterial ? T(i, d) : d instanceof THREE.MeshLambertMaterial ? U(i, d) : d instanceof THREE.MeshDepthMaterial ? (i.mNear.value = a.near,
        i.mFar.value = a.far,
        i.opacity.value = d.opacity) : d instanceof THREE.MeshNormalMaterial && (i.opacity.value = d.opacity),
        e.receiveShadow && !d._shadowPass && W(i, b),
        Z(g, d.uniformsList),
        (d instanceof THREE.ShaderMaterial || d instanceof THREE.MeshPhongMaterial || d.envMap) && null !== h.cameraPosition && (rc.setFromMatrixPosition(a.matrixWorld),
        Ib.uniform3f(h.cameraPosition, rc.x, rc.y, rc.z)),
        (d instanceof THREE.MeshPhongMaterial || d instanceof THREE.MeshLambertMaterial || d instanceof THREE.ShaderMaterial || d.skinning) && null !== h.viewMatrix && Ib.uniformMatrix4fv(h.viewMatrix, !1, a.matrixWorldInverse.elements)),
        X(h, e),
        null !== h.modelMatrix && Ib.uniformMatrix4fv(h.modelMatrix, !1, e.matrixWorld.elements),
        g
    }
    function O(a, b) {
        a.opacity.value = b.opacity,
        Ob.gammaInput ? a.diffuse.value.copyGammaToLinear(b.color) : a.diffuse.value = b.color,
        a.map.value = b.map,
        a.lightMap.value = b.lightMap,
        a.specularMap.value = b.specularMap,
        b.bumpMap && (a.bumpMap.value = b.bumpMap,
        a.bumpScale.value = b.bumpScale),
        b.normalMap && (a.normalMap.value = b.normalMap,
        a.normalScale.value.copy(b.normalScale));
        var c;
        if (b.map ? c = b.map : b.specularMap ? c = b.specularMap : b.normalMap ? c = b.normalMap : b.bumpMap && (c = b.bumpMap),
        void 0 !== c) {
            var d = c.offset
              , e = c.repeat;
            a.offsetRepeat.value.set(d.x, d.y, e.x, e.y)
        }
        a.envMap.value = b.envMap,
        a.flipEnvMap.value = b.envMap instanceof THREE.WebGLRenderTargetCube ? 1 : -1,
        a.reflectivity.value = Ob.gammaInput ? b.reflectivity : b.reflectivity,
        a.refractionRatio.value = b.refractionRatio,
        a.combine.value = b.combine,
        a.useRefract.value = b.envMap && b.envMap.mapping instanceof THREE.CubeRefractionMapping
    }
    function P(a, b) {
        a.diffuse.value = b.color,
        a.opacity.value = b.opacity
    }
    function Q(a, b) {
        a.dashSize.value = b.dashSize,
        a.totalSize.value = b.dashSize + b.gapSize,
        a.scale.value = b.scale
    }
    function R(a, b) {
        a.psColor.value = b.color,
        a.opacity.value = b.opacity,
        a.size.value = b.size,
        a.scale.value = yb.height / 2,
        a.map.value = b.map
    }
    function S(a, b) {
        a.fogColor.value = b.color,
        b instanceof THREE.Fog ? (a.fogNear.value = b.near,
        a.fogFar.value = b.far) : b instanceof THREE.FogExp2 && (a.fogDensity.value = b.density)
    }
    function T(a, b) {
        a.shininess.value = b.shininess,
        Ob.gammaInput ? (a.ambient.value.copyGammaToLinear(b.ambient),
        a.emissive.value.copyGammaToLinear(b.emissive),
        a.specular.value.copyGammaToLinear(b.specular)) : (a.ambient.value = b.ambient,
        a.emissive.value = b.emissive,
        a.specular.value = b.specular),
        b.wrapAround && a.wrapRGB.value.copy(b.wrapRGB)
    }
    function U(a, b) {
        Ob.gammaInput ? (a.ambient.value.copyGammaToLinear(b.ambient),
        a.emissive.value.copyGammaToLinear(b.emissive)) : (a.ambient.value = b.ambient,
        a.emissive.value = b.emissive),
        b.wrapAround && a.wrapRGB.value.copy(b.wrapRGB)
    }
    function V(a, b) {
        a.ambientLightColor.value = b.ambient,
        a.directionalLightColor.value = b.directional.colors,
        a.directionalLightDirection.value = b.directional.positions,
        a.pointLightColor.value = b.point.colors,
        a.pointLightPosition.value = b.point.positions,
        a.pointLightDistance.value = b.point.distances,
        a.spotLightColor.value = b.spot.colors,
        a.spotLightPosition.value = b.spot.positions,
        a.spotLightDistance.value = b.spot.distances,
        a.spotLightDirection.value = b.spot.directions,
        a.spotLightAngleCos.value = b.spot.anglesCos,
        a.spotLightExponent.value = b.spot.exponents,
        a.hemisphereLightSkyColor.value = b.hemi.skyColors,
        a.hemisphereLightGroundColor.value = b.hemi.groundColors,
        a.hemisphereLightDirection.value = b.hemi.positions
    }
    function W(a, b) {
        if (a.shadowMatrix)
            for (var c = 0, d = 0, e = b.length; e > d; d++) {
                var f = b[d];
                f.castShadow && (f instanceof THREE.SpotLight || f instanceof THREE.DirectionalLight && !f.shadowCascade) && (a.shadowMap.value[c] = f.shadowMap,
                a.shadowMapSize.value[c] = f.shadowMapSize,
                a.shadowMatrix.value[c] = f.shadowMatrix,
                a.shadowDarkness.value[c] = f.shadowDarkness,
                a.shadowBias.value[c] = f.shadowBias,
                c++)
            }
    }
    function X(a, b) {
        Ib.uniformMatrix4fv(a.modelViewMatrix, !1, b._modelViewMatrix.elements),
        a.normalMatrix && Ib.uniformMatrix3fv(a.normalMatrix, !1, b._normalMatrix.elements)
    }
    function Y() {
        var a = Wb;
        return a >= vc && console.warn("WebGLRenderer: trying to use " + a + " texture units while this GPU supports only " + vc),
        Wb += 1,
        a
    }
    function Z(a, b) {
        var c, d, e, f, g, h, i, j, k, l, m;
        for (k = 0,
        l = b.length; l > k; k++)
            if (f = a.uniforms[b[k][1]])
                if (c = b[k][0],
                e = c.type,
                d = c.value,
                "i" === e)
                    Ib.uniform1i(f, d);
                else if ("f" === e)
                    Ib.uniform1f(f, d);
                else if ("v2" === e)
                    Ib.uniform2f(f, d.x, d.y);
                else if ("v3" === e)
                    Ib.uniform3f(f, d.x, d.y, d.z);
                else if ("v4" === e)
                    Ib.uniform4f(f, d.x, d.y, d.z, d.w);
                else if ("c" === e)
                    Ib.uniform3f(f, d.r, d.g, d.b);
                else if ("iv1" === e)
                    Ib.uniform1iv(f, d);
                else if ("iv" === e)
                    Ib.uniform3iv(f, d);
                else if ("fv1" === e)
                    Ib.uniform1fv(f, d);
                else if ("fv" === e)
                    Ib.uniform3fv(f, d);
                else if ("v2v" === e) {
                    for (void 0 === c._array && (c._array = new Float32Array(2 * d.length)),
                    i = 0,
                    j = d.length; j > i; i++)
                        m = 2 * i,
                        c._array[m] = d[i].x,
                        c._array[m + 1] = d[i].y;
                    Ib.uniform2fv(f, c._array)
                } else if ("v3v" === e) {
                    for (void 0 === c._array && (c._array = new Float32Array(3 * d.length)),
                    i = 0,
                    j = d.length; j > i; i++)
                        m = 3 * i,
                        c._array[m] = d[i].x,
                        c._array[m + 1] = d[i].y,
                        c._array[m + 2] = d[i].z;
                    Ib.uniform3fv(f, c._array)
                } else if ("v4v" === e) {
                    for (void 0 === c._array && (c._array = new Float32Array(4 * d.length)),
                    i = 0,
                    j = d.length; j > i; i++)
                        m = 4 * i,
                        c._array[m] = d[i].x,
                        c._array[m + 1] = d[i].y,
                        c._array[m + 2] = d[i].z,
                        c._array[m + 3] = d[i].w;
                    Ib.uniform4fv(f, c._array)
                } else if ("m4" === e)
                    void 0 === c._array && (c._array = new Float32Array(16)),
                    d.flattenToArray(c._array),
                    Ib.uniformMatrix4fv(f, !1, c._array);
                else if ("m4v" === e) {
                    for (void 0 === c._array && (c._array = new Float32Array(16 * d.length)),
                    i = 0,
                    j = d.length; j > i; i++)
                        d[i].flattenToArrayOffset(c._array, 16 * i);
                    Ib.uniformMatrix4fv(f, !1, c._array)
                } else if ("t" === e) {
                    if (g = d,
                    h = Y(),
                    Ib.uniform1i(f, h),
                    !g)
                        continue;
                    g.image instanceof Array && 6 === g.image.length ? mb(g, h) : g instanceof THREE.WebGLRenderTargetCube ? nb(g, h) : Ob.setTexture(g, h)
                } else if ("tv" === e) {
                    for (void 0 === c._array && (c._array = []),
                    i = 0,
                    j = c.value.length; j > i; i++)
                        c._array[i] = Y();
                    for (Ib.uniform1iv(f, c._array),
                    i = 0,
                    j = c.value.length; j > i; i++)
                        g = c.value[i],
                        h = c._array[i],
                        g && Ob.setTexture(g, h)
                } else
                    console.warn("THREE.WebGLRenderer: Unknown uniform type: " + e)
    }
    function $(a, b) {
        a._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse, a.matrixWorld),
        a._normalMatrix.getNormalMatrix(a._modelViewMatrix)
    }
    function _(a, b, c, d) {
        a[b] = c.r * c.r * d,
        a[b + 1] = c.g * c.g * d,
        a[b + 2] = c.b * c.b * d
    }
    function ab(a, b, c, d) {
        a[b] = c.r * d,
        a[b + 1] = c.g * d,
        a[b + 2] = c.b * d
    }
    function bb(a, b) {
        var c, d, e, f, g, h, i, j, k, l = 0, m = 0, n = 0, o = uc, p = o.directional.colors, q = o.directional.positions, r = o.point.colors, s = o.point.positions, t = o.point.distances, u = o.spot.colors, v = o.spot.positions, w = o.spot.distances, x = o.spot.directions, y = o.spot.anglesCos, z = o.spot.exponents, A = o.hemi.skyColors, B = o.hemi.groundColors, C = o.hemi.positions, D = 0, E = 0, F = 0, G = 0, H = 0, I = 0, J = 0, K = 0, L = 0, M = 0, N = 0, O = 0;
        for (c = 0,
        d = b.length; d > c; c++)
            if (e = b[c],
            !e.onlyShadow)
                if (f = e.color,
                i = e.intensity,
                k = e.distance,
                e instanceof THREE.AmbientLight) {
                    if (!e.visible)
                        continue;
                    Ob.gammaInput ? (l += f.r * f.r,
                    m += f.g * f.g,
                    n += f.b * f.b) : (l += f.r,
                    m += f.g,
                    n += f.b)
                } else if (e instanceof THREE.DirectionalLight) {
                    if (H += 1,
                    !e.visible)
                        continue;
                    if (sc.setFromMatrixPosition(e.matrixWorld),
                    rc.setFromMatrixPosition(e.target.matrixWorld),
                    sc.sub(rc),
                    sc.normalize(),
                    0 === sc.x && 0 === sc.y && 0 === sc.z)
                        continue;
                    L = 3 * D,
                    q[L] = sc.x,
                    q[L + 1] = sc.y,
                    q[L + 2] = sc.z,
                    Ob.gammaInput ? _(p, L, f, i * i) : ab(p, L, f, i),
                    D += 1
                } else if (e instanceof THREE.PointLight) {
                    if (I += 1,
                    !e.visible)
                        continue;
                    M = 3 * E,
                    Ob.gammaInput ? _(r, M, f, i * i) : ab(r, M, f, i),
                    rc.setFromMatrixPosition(e.matrixWorld),
                    s[M] = rc.x,
                    s[M + 1] = rc.y,
                    s[M + 2] = rc.z,
                    t[E] = k,
                    E += 1
                } else if (e instanceof THREE.SpotLight) {
                    if (J += 1,
                    !e.visible)
                        continue;
                    N = 3 * F,
                    Ob.gammaInput ? _(u, N, f, i * i) : ab(u, N, f, i),
                    rc.setFromMatrixPosition(e.matrixWorld),
                    v[N] = rc.x,
                    v[N + 1] = rc.y,
                    v[N + 2] = rc.z,
                    w[F] = k,
                    sc.copy(rc),
                    rc.setFromMatrixPosition(e.target.matrixWorld),
                    sc.sub(rc),
                    sc.normalize(),
                    x[N] = sc.x,
                    x[N + 1] = sc.y,
                    x[N + 2] = sc.z,
                    y[F] = Math.cos(e.angle),
                    z[F] = e.exponent,
                    F += 1
                } else if (e instanceof THREE.HemisphereLight) {
                    if (K += 1,
                    !e.visible)
                        continue;
                    if (sc.setFromMatrixPosition(e.matrixWorld),
                    sc.normalize(),
                    0 === sc.x && 0 === sc.y && 0 === sc.z)
                        continue;
                    O = 3 * G,
                    C[O] = sc.x,
                    C[O + 1] = sc.y,
                    C[O + 2] = sc.z,
                    g = e.color,
                    h = e.groundColor,
                    Ob.gammaInput ? (j = i * i,
                    _(A, O, g, j),
                    _(B, O, h, j)) : (ab(A, O, g, i),
                    ab(B, O, h, i)),
                    G += 1
                }
        for (c = 3 * D,
        d = Math.max(p.length, 3 * H); d > c; c++)
            p[c] = 0;
        for (c = 3 * E,
        d = Math.max(r.length, 3 * I); d > c; c++)
            r[c] = 0;
        for (c = 3 * F,
        d = Math.max(u.length, 3 * J); d > c; c++)
            u[c] = 0;
        for (c = 3 * G,
        d = Math.max(A.length, 3 * K); d > c; c++)
            A[c] = 0;
        for (c = 3 * G,
        d = Math.max(B.length, 3 * K); d > c; c++)
            B[c] = 0;
        o.directional.length = D,
        o.point.length = E,
        o.spot.length = F,
        o.hemi.length = G,
        o.ambient[0] = l,
        o.ambient[1] = m,
        o.ambient[2] = n
    }
    function cb(a) {
        a !== gc && (Ib.lineWidth(a),
        gc = a)
    }
    function db(a, b, c) {
        dc !== a && (a ? Ib.enable(Ib.POLYGON_OFFSET_FILL) : Ib.disable(Ib.POLYGON_OFFSET_FILL),
        dc = a),
        !a || ec === b && fc === c || (Ib.polygonOffset(b, c),
        ec = b,
        fc = c)
    }
    function eb(a) {
        var b, c, d = [];
        for (var e in a)
            b = a[e],
            b !== !1 && (c = "#define " + e + " " + b,
            d.push(c));
        return d.join("\n")
    }
    function fb(a, b, c, d, e, f, g, h) {
        var i, j, k, l, m, n = [];
        a ? n.push(a) : (n.push(b),
        n.push(c));
        for (k in f)
            n.push(k),
            n.push(f[k]);
        for (i in g)
            n.push(i),
            n.push(g[i]);
        for (m = n.join(),
        i = 0,
        j = Pb.length; j > i; i++) {
            var o = Pb[i];
            if (o.code === m)
                return o.usedTimes++,
                o.program
        }
        var p = "SHADOWMAP_TYPE_BASIC";
        g.shadowMapType === THREE.PCFShadowMap ? p = "SHADOWMAP_TYPE_PCF" : g.shadowMapType === THREE.PCFSoftShadowMap && (p = "SHADOWMAP_TYPE_PCF_SOFT");
        var q = eb(f);
        l = Ib.createProgram();
        var r = ["precision " + Ab + " float;", "precision " + Ab + " int;", q, zc ? "#define VERTEX_TEXTURES" : "", Ob.gammaInput ? "#define GAMMA_INPUT" : "", Ob.gammaOutput ? "#define GAMMA_OUTPUT" : "", "#define MAX_DIR_LIGHTS " + g.maxDirLights, "#define MAX_POINT_LIGHTS " + g.maxPointLights, "#define MAX_SPOT_LIGHTS " + g.maxSpotLights, "#define MAX_HEMI_LIGHTS " + g.maxHemiLights, "#define MAX_SHADOWS " + g.maxShadows, "#define MAX_BONES " + g.maxBones, g.map ? "#define USE_MAP" : "", g.envMap ? "#define USE_ENVMAP" : "", g.lightMap ? "#define USE_LIGHTMAP" : "", g.bumpMap ? "#define USE_BUMPMAP" : "", g.normalMap ? "#define USE_NORMALMAP" : "", g.specularMap ? "#define USE_SPECULARMAP" : "", g.vertexColors ? "#define USE_COLOR" : "", g.skinning ? "#define USE_SKINNING" : "", g.useVertexTexture ? "#define BONE_TEXTURE" : "", g.morphTargets ? "#define USE_MORPHTARGETS" : "", g.morphNormals ? "#define USE_MORPHNORMALS" : "", g.wrapAround ? "#define WRAP_AROUND" : "", g.doubleSided ? "#define DOUBLE_SIDED" : "", g.flipSided ? "#define FLIP_SIDED" : "", g.shadowMapEnabled ? "#define USE_SHADOWMAP" : "", g.shadowMapEnabled ? "#define " + p : "", g.shadowMapDebug ? "#define SHADOWMAP_DEBUG" : "", g.shadowMapCascade ? "#define SHADOWMAP_CASCADE" : "", g.sizeAttenuation ? "#define USE_SIZEATTENUATION" : "", "uniform mat4 modelMatrix;", "uniform mat4 modelViewMatrix;", "uniform mat4 projectionMatrix;", "uniform mat4 viewMatrix;", "uniform mat3 normalMatrix;", "uniform vec3 cameraPosition;", "attribute vec3 position;", "attribute vec3 normal;", "attribute vec2 uv;", "attribute vec2 uv2;", "#ifdef USE_COLOR", "attribute vec3 color;", "#endif", "#ifdef USE_MORPHTARGETS", "attribute vec3 morphTarget0;", "attribute vec3 morphTarget1;", "attribute vec3 morphTarget2;", "attribute vec3 morphTarget3;", "#ifdef USE_MORPHNORMALS", "attribute vec3 morphNormal0;", "attribute vec3 morphNormal1;", "attribute vec3 morphNormal2;", "attribute vec3 morphNormal3;", "#else", "attribute vec3 morphTarget4;", "attribute vec3 morphTarget5;", "attribute vec3 morphTarget6;", "attribute vec3 morphTarget7;", "#endif", "#endif", "#ifdef USE_SKINNING", "attribute vec4 skinIndex;", "attribute vec4 skinWeight;", "#endif", ""].join("\n")
          , s = ["precision " + Ab + " float;", "precision " + Ab + " int;", g.bumpMap || g.normalMap ? "#extension GL_OES_standard_derivatives : enable" : "", q, "#define MAX_DIR_LIGHTS " + g.maxDirLights, "#define MAX_POINT_LIGHTS " + g.maxPointLights, "#define MAX_SPOT_LIGHTS " + g.maxSpotLights, "#define MAX_HEMI_LIGHTS " + g.maxHemiLights, "#define MAX_SHADOWS " + g.maxShadows, g.alphaTest ? "#define ALPHATEST " + g.alphaTest : "", Ob.gammaInput ? "#define GAMMA_INPUT" : "", Ob.gammaOutput ? "#define GAMMA_OUTPUT" : "", g.useFog && g.fog ? "#define USE_FOG" : "", g.useFog && g.fogExp ? "#define FOG_EXP2" : "", g.map ? "#define USE_MAP" : "", g.envMap ? "#define USE_ENVMAP" : "", g.lightMap ? "#define USE_LIGHTMAP" : "", g.bumpMap ? "#define USE_BUMPMAP" : "", g.normalMap ? "#define USE_NORMALMAP" : "", g.specularMap ? "#define USE_SPECULARMAP" : "", g.vertexColors ? "#define USE_COLOR" : "", g.metal ? "#define METAL" : "", g.wrapAround ? "#define WRAP_AROUND" : "", g.doubleSided ? "#define DOUBLE_SIDED" : "", g.flipSided ? "#define FLIP_SIDED" : "", g.shadowMapEnabled ? "#define USE_SHADOWMAP" : "", g.shadowMapEnabled ? "#define " + p : "", g.shadowMapDebug ? "#define SHADOWMAP_DEBUG" : "", g.shadowMapCascade ? "#define SHADOWMAP_CASCADE" : "", "uniform mat4 viewMatrix;", "uniform vec3 cameraPosition;", ""].join("\n")
          , t = jb("vertex", r + c)
          , u = jb("fragment", s + b);
        Ib.attachShader(l, t),
        Ib.attachShader(l, u),
        void 0 !== h && Ib.bindAttribLocation(l, 0, h),
        Ib.linkProgram(l),
        Ib.getProgramParameter(l, Ib.LINK_STATUS) === !1 && (console.error("Could not initialise shader"),
        console.error("gl.VALIDATE_STATUS", Ib.getProgramParameter(l, Ib.VALIDATE_STATUS)),
        console.error("gl.getError()", Ib.getError())),
        "" !== Ib.getProgramInfoLog(l) && console.error("gl.getProgramInfoLog()", Ib.getProgramInfoLog(l)),
        Ib.deleteShader(u),
        Ib.deleteShader(t),
        l.uniforms = {},
        l.attributes = {};
        var v, w, x, y;
        v = ["viewMatrix", "modelViewMatrix", "projectionMatrix", "normalMatrix", "modelMatrix", "cameraPosition", "morphTargetInfluences"],
        g.useVertexTexture ? (v.push("boneTexture"),
        v.push("boneTextureWidth"),
        v.push("boneTextureHeight")) : v.push("boneGlobalMatrices");
        for (w in d)
            v.push(w);
        for (gb(l, v),
        v = ["position", "normal", "uv", "uv2", "tangent", "color", "skinIndex", "skinWeight", "lineDistance"],
        y = 0; y < g.maxMorphTargets; y++)
            v.push("morphTarget" + y);
        for (y = 0; y < g.maxMorphNormals; y++)
            v.push("morphNormal" + y);
        for (x in e)
            v.push(x);
        return hb(l, v),
        l.id = Qb++,
        Pb.push({
            program: l,
            code: m,
            usedTimes: 1
        }),
        Ob.info.memory.programs = Pb.length,
        l
    }
    function gb(a, b) {
        var c, d, e;
        for (c = 0,
        d = b.length; d > c; c++)
            e = b[c],
            a.uniforms[e] = Ib.getUniformLocation(a, e)
    }
    function hb(a, b) {
        var c, d, e;
        for (c = 0,
        d = b.length; d > c; c++)
            e = b[c],
            a.attributes[e] = Ib.getAttribLocation(a, e)
    }
    function ib(a) {
        for (var b = a.split("\n"), c = 0, d = b.length; d > c; c++)
            b[c] = c + 1 + ": " + b[c];
        return b.join("\n")
    }
    function jb(a, b) {
        var c;
        return "fragment" === a ? c = Ib.createShader(Ib.FRAGMENT_SHADER) : "vertex" === a && (c = Ib.createShader(Ib.VERTEX_SHADER)),
        Ib.shaderSource(c, b),
        Ib.compileShader(c),
        Ib.getShaderParameter(c, Ib.COMPILE_STATUS) ? c : (console.error(Ib.getShaderInfoLog(c)),
        console.error(ib(b)),
        null)
    }
    function kb(a, b, c) {
        c ? (Ib.texParameteri(a, Ib.TEXTURE_WRAP_S, sb(b.wrapS)),
        Ib.texParameteri(a, Ib.TEXTURE_WRAP_T, sb(b.wrapT)),
        Ib.texParameteri(a, Ib.TEXTURE_MAG_FILTER, sb(b.magFilter)),
        Ib.texParameteri(a, Ib.TEXTURE_MIN_FILTER, sb(b.minFilter))) : (Ib.texParameteri(a, Ib.TEXTURE_WRAP_S, Ib.CLAMP_TO_EDGE),
        Ib.texParameteri(a, Ib.TEXTURE_WRAP_T, Ib.CLAMP_TO_EDGE),
        Ib.texParameteri(a, Ib.TEXTURE_MAG_FILTER, rb(b.magFilter)),
        Ib.texParameteri(a, Ib.TEXTURE_MIN_FILTER, rb(b.minFilter))),
        Mb && b.type !== THREE.FloatType && (b.anisotropy > 1 || b.__oldAnisotropy) && (Ib.texParameterf(a, Mb.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(b.anisotropy, yc)),
        b.__oldAnisotropy = b.anisotropy)
    }
    function lb(a, b) {
        if (a.width <= b && a.height <= b)
            return a;
        var c = Math.max(a.width, a.height)
          , d = Math.floor(a.width * b / c)
          , e = Math.floor(a.height * b / c)
          , f = document.createElement("canvas");
        f.width = d,
        f.height = e;
        var g = f.getContext("2d");
        return g.drawImage(a, 0, 0, a.width, a.height, 0, 0, d, e),
        f
    }
    function mb(a, b) {
        if (6 === a.image.length)
            if (a.needsUpdate) {
                a.image.__webglTextureCube || (a.addEventListener("dispose", Ic),
                a.image.__webglTextureCube = Ib.createTexture(),
                Ob.info.memory.textures++),
                Ib.activeTexture(Ib.TEXTURE0 + b),
                Ib.bindTexture(Ib.TEXTURE_CUBE_MAP, a.image.__webglTextureCube),
                Ib.pixelStorei(Ib.UNPACK_FLIP_Y_WEBGL, a.flipY);
                for (var c = a instanceof THREE.CompressedTexture, d = [], e = 0; 6 > e; e++)
                    d[e] = Ob.autoScaleCubemaps && !c ? lb(a.image[e], xc) : a.image[e];
                var f = d[0]
                  , g = THREE.Math.isPowerOfTwo(f.width) && THREE.Math.isPowerOfTwo(f.height)
                  , h = sb(a.format)
                  , i = sb(a.type);
                kb(Ib.TEXTURE_CUBE_MAP, a, g);
                for (var e = 0; 6 > e; e++)
                    if (c)
                        for (var j, k = d[e].mipmaps, l = 0, m = k.length; m > l; l++)
                            j = k[l],
                            a.format !== THREE.RGBAFormat ? Ib.compressedTexImage2D(Ib.TEXTURE_CUBE_MAP_POSITIVE_X + e, l, h, j.width, j.height, 0, j.data) : Ib.texImage2D(Ib.TEXTURE_CUBE_MAP_POSITIVE_X + e, l, h, j.width, j.height, 0, h, i, j.data);
                    else
                        Ib.texImage2D(Ib.TEXTURE_CUBE_MAP_POSITIVE_X + e, 0, h, h, i, d[e]);
                a.generateMipmaps && g && Ib.generateMipmap(Ib.TEXTURE_CUBE_MAP),
                a.needsUpdate = !1,
                a.onUpdate && a.onUpdate()
            } else
                Ib.activeTexture(Ib.TEXTURE0 + b),
                Ib.bindTexture(Ib.TEXTURE_CUBE_MAP, a.image.__webglTextureCube)
    }
    function nb(a, b) {
        Ib.activeTexture(Ib.TEXTURE0 + b),
        Ib.bindTexture(Ib.TEXTURE_CUBE_MAP, a.__webglTexture)
    }
    function ob(a, b, c) {
        Ib.bindFramebuffer(Ib.FRAMEBUFFER, a),
        Ib.framebufferTexture2D(Ib.FRAMEBUFFER, Ib.COLOR_ATTACHMENT0, c, b.__webglTexture, 0)
    }
    function pb(a, b) {
        Ib.bindRenderbuffer(Ib.RENDERBUFFER, a),
        b.depthBuffer && !b.stencilBuffer ? (Ib.renderbufferStorage(Ib.RENDERBUFFER, Ib.DEPTH_COMPONENT16, b.width, b.height),
        Ib.framebufferRenderbuffer(Ib.FRAMEBUFFER, Ib.DEPTH_ATTACHMENT, Ib.RENDERBUFFER, a)) : b.depthBuffer && b.stencilBuffer ? (Ib.renderbufferStorage(Ib.RENDERBUFFER, Ib.DEPTH_STENCIL, b.width, b.height),
        Ib.framebufferRenderbuffer(Ib.FRAMEBUFFER, Ib.DEPTH_STENCIL_ATTACHMENT, Ib.RENDERBUFFER, a)) : Ib.renderbufferStorage(Ib.RENDERBUFFER, Ib.RGBA4, b.width, b.height)
    }
    function qb(a) {
        a instanceof THREE.WebGLRenderTargetCube ? (Ib.bindTexture(Ib.TEXTURE_CUBE_MAP, a.__webglTexture),
        Ib.generateMipmap(Ib.TEXTURE_CUBE_MAP),
        Ib.bindTexture(Ib.TEXTURE_CUBE_MAP, null)) : (Ib.bindTexture(Ib.TEXTURE_2D, a.__webglTexture),
        Ib.generateMipmap(Ib.TEXTURE_2D),
        Ib.bindTexture(Ib.TEXTURE_2D, null))
    }
    function rb(a) {
        return a === THREE.NearestFilter || a === THREE.NearestMipMapNearestFilter || a === THREE.NearestMipMapLinearFilter ? Ib.NEAREST : Ib.LINEAR
    }
    function sb(a) {
        if (a === THREE.RepeatWrapping)
            return Ib.REPEAT;
        if (a === THREE.ClampToEdgeWrapping)
            return Ib.CLAMP_TO_EDGE;
        if (a === THREE.MirroredRepeatWrapping)
            return Ib.MIRRORED_REPEAT;
        if (a === THREE.NearestFilter)
            return Ib.NEAREST;
        if (a === THREE.NearestMipMapNearestFilter)
            return Ib.NEAREST_MIPMAP_NEAREST;
        if (a === THREE.NearestMipMapLinearFilter)
            return Ib.NEAREST_MIPMAP_LINEAR;
        if (a === THREE.LinearFilter)
            return Ib.LINEAR;
        if (a === THREE.LinearMipMapNearestFilter)
            return Ib.LINEAR_MIPMAP_NEAREST;
        if (a === THREE.LinearMipMapLinearFilter)
            return Ib.LINEAR_MIPMAP_LINEAR;
        if (a === THREE.UnsignedByteType)
            return Ib.UNSIGNED_BYTE;
        if (a === THREE.UnsignedShort4444Type)
            return Ib.UNSIGNED_SHORT_4_4_4_4;
        if (a === THREE.UnsignedShort5551Type)
            return Ib.UNSIGNED_SHORT_5_5_5_1;
        if (a === THREE.UnsignedShort565Type)
            return Ib.UNSIGNED_SHORT_5_6_5;
        if (a === THREE.ByteType)
            return Ib.BYTE;
        if (a === THREE.ShortType)
            return Ib.SHORT;
        if (a === THREE.UnsignedShortType)
            return Ib.UNSIGNED_SHORT;
        if (a === THREE.IntType)
            return Ib.INT;
        if (a === THREE.UnsignedIntType)
            return Ib.UNSIGNED_INT;
        if (a === THREE.FloatType)
            return Ib.FLOAT;
        if (a === THREE.AlphaFormat)
            return Ib.ALPHA;
        if (a === THREE.RGBFormat)
            return Ib.RGB;
        if (a === THREE.RGBAFormat)
            return Ib.RGBA;
        if (a === THREE.LuminanceFormat)
            return Ib.LUMINANCE;
        if (a === THREE.LuminanceAlphaFormat)
            return Ib.LUMINANCE_ALPHA;
        if (a === THREE.AddEquation)
            return Ib.FUNC_ADD;
        if (a === THREE.SubtractEquation)
            return Ib.FUNC_SUBTRACT;
        if (a === THREE.ReverseSubtractEquation)
            return Ib.FUNC_REVERSE_SUBTRACT;
        if (a === THREE.ZeroFactor)
            return Ib.ZERO;
        if (a === THREE.OneFactor)
            return Ib.ONE;
        if (a === THREE.SrcColorFactor)
            return Ib.SRC_COLOR;
        if (a === THREE.OneMinusSrcColorFactor)
            return Ib.ONE_MINUS_SRC_COLOR;
        if (a === THREE.SrcAlphaFactor)
            return Ib.SRC_ALPHA;
        if (a === THREE.OneMinusSrcAlphaFactor)
            return Ib.ONE_MINUS_SRC_ALPHA;
        if (a === THREE.DstAlphaFactor)
            return Ib.DST_ALPHA;
        if (a === THREE.OneMinusDstAlphaFactor)
            return Ib.ONE_MINUS_DST_ALPHA;
        if (a === THREE.DstColorFactor)
            return Ib.DST_COLOR;
        if (a === THREE.OneMinusDstColorFactor)
            return Ib.ONE_MINUS_DST_COLOR;
        if (a === THREE.SrcAlphaSaturateFactor)
            return Ib.SRC_ALPHA_SATURATE;
        if (void 0 !== Nb) {
            if (a === THREE.RGB_S3TC_DXT1_Format)
                return Nb.COMPRESSED_RGB_S3TC_DXT1_EXT;
            if (a === THREE.RGBA_S3TC_DXT1_Format)
                return Nb.COMPRESSED_RGBA_S3TC_DXT1_EXT;
            if (a === THREE.RGBA_S3TC_DXT3_Format)
                return Nb.COMPRESSED_RGBA_S3TC_DXT3_EXT;
            if (a === THREE.RGBA_S3TC_DXT5_Format)
                return Nb.COMPRESSED_RGBA_S3TC_DXT5_EXT
        }
        return 0
    }
    function tb(a) {
        if (Ac && a && a.useVertexTexture)
            return 1024;
        var b = Ib.getParameter(Ib.MAX_VERTEX_UNIFORM_VECTORS)
          , c = Math.floor((b - 20) / 4)
          , d = c;
        return void 0 !== a && a instanceof THREE.SkinnedMesh && (d = Math.min(a.bones.length, d),
        d < a.bones.length && console.warn("WebGLRenderer: too many bones - " + a.bones.length + ", this GPU supports just " + d + " (try OpenGL instead of ANGLE)")),
        d
    }
    function ub(a) {
        for (var b = 0, c = 0, d = 0, e = 0, f = 0, g = a.length; g > f; f++) {
            var h = a[f];
            h.onlyShadow || h.visible === !1 || (h instanceof THREE.DirectionalLight && b++,
            h instanceof THREE.PointLight && c++,
            h instanceof THREE.SpotLight && d++,
            h instanceof THREE.HemisphereLight && e++)
        }
        return {
            directional: b,
            point: c,
            spot: d,
            hemi: e
        }
    }
    function vb(a) {
        for (var b = 0, c = 0, d = a.length; d > c; c++) {
            var e = a[c];
            e.castShadow && (e instanceof THREE.SpotLight && b++,
            e instanceof THREE.DirectionalLight && !e.shadowCascade && b++)
        }
        return b
    }
    function wb() {
        try {
            var a = {
                alpha: Bb,
                premultipliedAlpha: Cb,
                antialias: Db,
                stencil: Eb,
                preserveDrawingBuffer: Fb
            };
            if (Ib = zb || yb.getContext("webgl", a) || yb.getContext("experimental-webgl", a),
            null === Ib)
                throw "Error creating WebGL context."
        } catch (b) {
            console.error(b)
        }
        Jb = Ib.getExtension("OES_texture_float"),
        Kb = Ib.getExtension("OES_texture_float_linear"),
        Lb = Ib.getExtension("OES_standard_derivatives"),
        Mb = Ib.getExtension("EXT_texture_filter_anisotropic") || Ib.getExtension("MOZ_EXT_texture_filter_anisotropic") || Ib.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),
        Nb = Ib.getExtension("WEBGL_compressed_texture_s3tc") || Ib.getExtension("MOZ_WEBGL_compressed_texture_s3tc") || Ib.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),
        Jb || console.log("THREE.WebGLRenderer: Float textures not supported."),
        Lb || console.log("THREE.WebGLRenderer: Standard derivatives not supported."),
        Mb || console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),
        Nb || console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),
        void 0 === Ib.getShaderPrecisionFormat && (Ib.getShaderPrecisionFormat = function() {
            return {
                rangeMin: 1,
                rangeMax: 1,
                precision: 1
            }
        }
        )
    }
    function xb() {
        Ib.clearColor(0, 0, 0, 1),
        Ib.clearDepth(1),
        Ib.clearStencil(0),
        Ib.enable(Ib.DEPTH_TEST),
        Ib.depthFunc(Ib.LEQUAL),
        Ib.frontFace(Ib.CCW),
        Ib.cullFace(Ib.BACK),
        Ib.enable(Ib.CULL_FACE),
        Ib.enable(Ib.BLEND),
        Ib.blendEquation(Ib.FUNC_ADD),
        Ib.blendFunc(Ib.SRC_ALPHA, Ib.ONE_MINUS_SRC_ALPHA),
        Ib.viewport(hc, ic, jc, kc),
        Ib.clearColor(Gb.r, Gb.g, Gb.b, Hb)
    }
    console.log("THREE.WebGLRenderer", THREE.REVISION),
    a = a || {};
    var yb = void 0 !== a.canvas ? a.canvas : document.createElement("canvas")
      , zb = void 0 !== a.context ? a.context : null
      , Ab = void 0 !== a.precision ? a.precision : "highp"
      , Bb = void 0 !== a.alpha ? a.alpha : !1
      , Cb = void 0 !== a.premultipliedAlpha ? a.premultipliedAlpha : !0
      , Db = void 0 !== a.antialias ? a.antialias : !1
      , Eb = void 0 !== a.stencil ? a.stencil : !0
      , Fb = void 0 !== a.preserveDrawingBuffer ? a.preserveDrawingBuffer : !1
      , Gb = new THREE.Color(0)
      , Hb = 0;
    this.domElement = yb,
    this.context = null,
    this.devicePixelRatio = void 0 !== a.devicePixelRatio ? a.devicePixelRatio : void 0 !== self.devicePixelRatio ? self.devicePixelRatio : 1,
    this.autoClear = !0,
    this.autoClearColor = !0,
    this.autoClearDepth = !0,
    this.autoClearStencil = !0,
    this.sortObjects = !0,
    this.autoUpdateObjects = !0,
    this.gammaInput = !1,
    this.gammaOutput = !1,
    this.shadowMapEnabled = !1,
    this.shadowMapAutoUpdate = !0,
    this.shadowMapType = THREE.PCFShadowMap,
    this.shadowMapCullFace = THREE.CullFaceFront,
    this.shadowMapDebug = !1,
    this.shadowMapCascade = !1,
    this.maxMorphTargets = 8,
    this.maxMorphNormals = 4,
    this.autoScaleCubemaps = !0,
    this.renderPluginsPre = [],
    this.renderPluginsPost = [],
    this.info = {
        memory: {
            programs: 0,
            geometries: 0,
            textures: 0
        },
        render: {
            calls: 0,
            vertices: 0,
            faces: 0,
            points: 0
        }
    };
    var Ib, Jb, Kb, Lb, Mb, Nb, Ob = this, Pb = [], Qb = 0, Rb = null, Sb = null, Tb = -1, Ub = null, Vb = null, Wb = 0, Xb = -1, Yb = -1, Zb = -1, $b = -1, _b = -1, ac = -1, bc = -1, cc = -1, dc = null, ec = null, fc = null, gc = null, hc = 0, ic = 0, jc = yb.width, kc = yb.height, lc = 0, mc = 0, nc = new Uint8Array(16), oc = new THREE.Frustum, pc = new THREE.Matrix4, qc = new THREE.Matrix4, rc = new THREE.Vector3, sc = new THREE.Vector3, tc = !0, uc = {
        ambient: [0, 0, 0],
        directional: {
            length: 0,
            colors: new Array,
            positions: new Array
        },
        point: {
            length: 0,
            colors: new Array,
            positions: new Array,
            distances: new Array
        },
        spot: {
            length: 0,
            colors: new Array,
            positions: new Array,
            distances: new Array,
            directions: new Array,
            anglesCos: new Array,
            exponents: new Array
        },
        hemi: {
            length: 0,
            skyColors: new Array,
            groundColors: new Array,
            positions: new Array
        }
    };
    wb(),
    xb(),
    this.context = Ib;
    var vc = Ib.getParameter(Ib.MAX_TEXTURE_IMAGE_UNITS)
      , wc = Ib.getParameter(Ib.MAX_VERTEX_TEXTURE_IMAGE_UNITS)
      , xc = (Ib.getParameter(Ib.MAX_TEXTURE_SIZE),
    Ib.getParameter(Ib.MAX_CUBE_MAP_TEXTURE_SIZE))
      , yc = Mb ? Ib.getParameter(Mb.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0
      , zc = wc > 0
      , Ac = zc && Jb
      , Bc = (Nb ? Ib.getParameter(Ib.COMPRESSED_TEXTURE_FORMATS) : [],
    Ib.getShaderPrecisionFormat(Ib.VERTEX_SHADER, Ib.HIGH_FLOAT))
      , Cc = Ib.getShaderPrecisionFormat(Ib.VERTEX_SHADER, Ib.MEDIUM_FLOAT)
      , Dc = (Ib.getShaderPrecisionFormat(Ib.VERTEX_SHADER, Ib.LOW_FLOAT),
    Ib.getShaderPrecisionFormat(Ib.FRAGMENT_SHADER, Ib.HIGH_FLOAT))
      , Ec = Ib.getShaderPrecisionFormat(Ib.FRAGMENT_SHADER, Ib.MEDIUM_FLOAT)
      , Fc = (Ib.getShaderPrecisionFormat(Ib.FRAGMENT_SHADER, Ib.LOW_FLOAT),
    Ib.getShaderPrecisionFormat(Ib.VERTEX_SHADER, Ib.HIGH_INT),
    Ib.getShaderPrecisionFormat(Ib.VERTEX_SHADER, Ib.MEDIUM_INT),
    Ib.getShaderPrecisionFormat(Ib.VERTEX_SHADER, Ib.LOW_INT),
    Ib.getShaderPrecisionFormat(Ib.FRAGMENT_SHADER, Ib.HIGH_INT),
    Ib.getShaderPrecisionFormat(Ib.FRAGMENT_SHADER, Ib.MEDIUM_INT),
    Ib.getShaderPrecisionFormat(Ib.FRAGMENT_SHADER, Ib.LOW_INT),
    Bc.precision > 0 && Dc.precision > 0)
      , Gc = Cc.precision > 0 && Ec.precision > 0;
    "highp" !== Ab || Fc || (Gc ? (Ab = "mediump",
    console.warn("WebGLRenderer: highp not supported, using mediump")) : (Ab = "lowp",
    console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),
    "mediump" !== Ab || Gc || (Ab = "lowp",
    console.warn("WebGLRenderer: mediump not supported, using lowp")),
    this.getContext = function() {
        return Ib
    }
    ,
    this.supportsVertexTextures = function() {
        return zc
    }
    ,
    this.supportsFloatTextures = function() {
        return Jb
    }
    ,
    this.supportsStandardDerivatives = function() {
        return Lb
    }
    ,
    this.supportsCompressedTextureS3TC = function() {
        return Nb
    }
    ,
    this.getMaxAnisotropy = function() {
        return yc
    }
    ,
    this.getPrecision = function() {
        return Ab
    }
    ,
    this.setSize = function(a, b, c) {
        yb.width = a * this.devicePixelRatio,
        yb.height = b * this.devicePixelRatio,
        1 !== this.devicePixelRatio && c !== !1 && (yb.style.width = a + "px",
        yb.style.height = b + "px"),
        this.setViewport(0, 0, a, b)
    }
    ,
    this.setViewport = function(a, b, c, d) {
        hc = a * this.devicePixelRatio,
        ic = b * this.devicePixelRatio,
        jc = c * this.devicePixelRatio,
        kc = d * this.devicePixelRatio,
        Ib.viewport(hc, ic, jc, kc)
    }
    ,
    this.setScissor = function(a, b, c, d) {
        Ib.scissor(a * this.devicePixelRatio, b * this.devicePixelRatio, c * this.devicePixelRatio, d * this.devicePixelRatio)
    }
    ,
    this.enableScissorTest = function(a) {
        a ? Ib.enable(Ib.SCISSOR_TEST) : Ib.disable(Ib.SCISSOR_TEST)
    }
    ,
    this.setClearColor = function(a, b) {
        Gb.set(a),
        Hb = void 0 !== b ? b : 1,
        Ib.clearColor(Gb.r, Gb.g, Gb.b, Hb)
    }
    ,
    this.setClearColorHex = function(a, b) {
        console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),
        this.setClearColor(a, b)
    }
    ,
    this.getClearColor = function() {
        return Gb
    }
    ,
    this.getClearAlpha = function() {
        return Hb
    }
    ,
    this.clear = function(a, b, c) {
        var d = 0;
        (void 0 === a || a) && (d |= Ib.COLOR_BUFFER_BIT),
        (void 0 === b || b) && (d |= Ib.DEPTH_BUFFER_BIT),
        (void 0 === c || c) && (d |= Ib.STENCIL_BUFFER_BIT),
        Ib.clear(d)
    }
    ,
    this.clearColor = function() {
        Ib.clear(Ib.COLOR_BUFFER_BIT)
    }
    ,
    this.clearDepth = function() {
        Ib.clear(Ib.DEPTH_BUFFER_BIT)
    }
    ,
    this.clearStencil = function() {
        Ib.clear(Ib.STENCIL_BUFFER_BIT)
    }
    ,
    this.clearTarget = function(a, b, c, d) {
        this.setRenderTarget(a),
        this.clear(b, c, d)
    }
    ,
    this.addPostPlugin = function(a) {
        a.init(this),
        this.renderPluginsPost.push(a)
    }
    ,
    this.addPrePlugin = function(a) {
        a.init(this),
        this.renderPluginsPre.push(a)
    }
    ,
    this.updateShadowMap = function(a, b) {
        Rb = null,
        Zb = -1,
        bc = -1,
        cc = -1,
        Ub = -1,
        Tb = -1,
        tc = !0,
        Xb = -1,
        Yb = -1,
        this.shadowMapPlugin.update(a, b)
    }
    ;
    var Hc = function(a) {
        var b = a.target;
        b.removeEventListener("dispose", Hc),
        Mc(b)
    }
      , Ic = function(a) {
        var b = a.target;
        b.removeEventListener("dispose", Ic),
        Nc(b),
        Ob.info.memory.textures--
    }
      , Jc = function(a) {
        var b = a.target;
        b.removeEventListener("dispose", Jc),
        Oc(b),
        Ob.info.memory.textures--
    }
      , Kc = function(a) {
        var b = a.target;
        b.removeEventListener("dispose", Kc),
        Pc(b)
    }
      , Lc = function(a) {
        if (void 0 !== a.__webglVertexBuffer && Ib.deleteBuffer(a.__webglVertexBuffer),
        void 0 !== a.__webglNormalBuffer && Ib.deleteBuffer(a.__webglNormalBuffer),
        void 0 !== a.__webglTangentBuffer && Ib.deleteBuffer(a.__webglTangentBuffer),
        void 0 !== a.__webglColorBuffer && Ib.deleteBuffer(a.__webglColorBuffer),
        void 0 !== a.__webglUVBuffer && Ib.deleteBuffer(a.__webglUVBuffer),
        void 0 !== a.__webglUV2Buffer && Ib.deleteBuffer(a.__webglUV2Buffer),
        void 0 !== a.__webglSkinIndicesBuffer && Ib.deleteBuffer(a.__webglSkinIndicesBuffer),
        void 0 !== a.__webglSkinWeightsBuffer && Ib.deleteBuffer(a.__webglSkinWeightsBuffer),
        void 0 !== a.__webglFaceBuffer && Ib.deleteBuffer(a.__webglFaceBuffer),
        void 0 !== a.__webglLineBuffer && Ib.deleteBuffer(a.__webglLineBuffer),
        void 0 !== a.__webglLineDistanceBuffer && Ib.deleteBuffer(a.__webglLineDistanceBuffer),
        void 0 !== a.__webglCustomAttributesList)
            for (var b in a.__webglCustomAttributesList)
                Ib.deleteBuffer(a.__webglCustomAttributesList[b].buffer);
        Ob.info.memory.geometries--
    }
      , Mc = function(a) {
        if (a.__webglInit = void 0,
        a instanceof THREE.BufferGeometry) {
            var b = a.attributes;
            for (var c in b)
                void 0 !== b[c].buffer && Ib.deleteBuffer(b[c].buffer);
            Ob.info.memory.geometries--
        } else if (void 0 !== a.geometryGroups)
            for (var d in a.geometryGroups) {
                var e = a.geometryGroups[d];
                if (void 0 !== e.numMorphTargets)
                    for (var f = 0, g = e.numMorphTargets; g > f; f++)
                        Ib.deleteBuffer(e.__webglMorphTargetsBuffers[f]);
                if (void 0 !== e.numMorphNormals)
                    for (var f = 0, g = e.numMorphNormals; g > f; f++)
                        Ib.deleteBuffer(e.__webglMorphNormalsBuffers[f]);
                Lc(e)
            }
        else
            Lc(a)
    }
      , Nc = function(a) {
        if (a.image && a.image.__webglTextureCube)
            Ib.deleteTexture(a.image.__webglTextureCube);
        else {
            if (!a.__webglInit)
                return;
            a.__webglInit = !1,
            Ib.deleteTexture(a.__webglTexture)
        }
    }
      , Oc = function(a) {
        if (a && a.__webglTexture)
            if (Ib.deleteTexture(a.__webglTexture),
            a instanceof THREE.WebGLRenderTargetCube)
                for (var b = 0; 6 > b; b++)
                    Ib.deleteFramebuffer(a.__webglFramebuffer[b]),
                    Ib.deleteRenderbuffer(a.__webglRenderbuffer[b]);
            else
                Ib.deleteFramebuffer(a.__webglFramebuffer),
                Ib.deleteRenderbuffer(a.__webglRenderbuffer)
    }
      , Pc = function(a) {
        var b = a.program;
        if (void 0 !== b) {
            a.program = void 0;
            var c, d, e, f = !1;
            for (c = 0,
            d = Pb.length; d > c; c++)
                if (e = Pb[c],
                e.program === b) {
                    e.usedTimes--,
                    0 === e.usedTimes && (f = !0);
                    break
                }
            if (f === !0) {
                var g = [];
                for (c = 0,
                d = Pb.length; d > c; c++)
                    e = Pb[c],
                    e.program !== b && g.push(e);
                Pb = g,
                Ib.deleteProgram(b),
                Ob.info.memory.programs--
            }
        }
    };
    this.renderBufferImmediate = function(a, b, c) {
        if (a.hasPositions && !a.__webglVertexBuffer && (a.__webglVertexBuffer = Ib.createBuffer()),
        a.hasNormals && !a.__webglNormalBuffer && (a.__webglNormalBuffer = Ib.createBuffer()),
        a.hasUvs && !a.__webglUvBuffer && (a.__webglUvBuffer = Ib.createBuffer()),
        a.hasColors && !a.__webglColorBuffer && (a.__webglColorBuffer = Ib.createBuffer()),
        a.hasPositions && (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglVertexBuffer),
        Ib.bufferData(Ib.ARRAY_BUFFER, a.positionArray, Ib.DYNAMIC_DRAW),
        Ib.enableVertexAttribArray(b.attributes.position),
        Ib.vertexAttribPointer(b.attributes.position, 3, Ib.FLOAT, !1, 0, 0)),
        a.hasNormals) {
            if (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglNormalBuffer),
            c.shading === THREE.FlatShading) {
                var d, e, f, g, h, i, j, k, l, m, n, o, p, q, r = 3 * a.count;
                for (q = 0; r > q; q += 9)
                    p = a.normalArray,
                    g = p[q],
                    j = p[q + 1],
                    m = p[q + 2],
                    h = p[q + 3],
                    k = p[q + 4],
                    n = p[q + 5],
                    i = p[q + 6],
                    l = p[q + 7],
                    o = p[q + 8],
                    d = (g + h + i) / 3,
                    e = (j + k + l) / 3,
                    f = (m + n + o) / 3,
                    p[q] = d,
                    p[q + 1] = e,
                    p[q + 2] = f,
                    p[q + 3] = d,
                    p[q + 4] = e,
                    p[q + 5] = f,
                    p[q + 6] = d,
                    p[q + 7] = e,
                    p[q + 8] = f
            }
            Ib.bufferData(Ib.ARRAY_BUFFER, a.normalArray, Ib.DYNAMIC_DRAW),
            Ib.enableVertexAttribArray(b.attributes.normal),
            Ib.vertexAttribPointer(b.attributes.normal, 3, Ib.FLOAT, !1, 0, 0)
        }
        a.hasUvs && c.map && (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglUvBuffer),
        Ib.bufferData(Ib.ARRAY_BUFFER, a.uvArray, Ib.DYNAMIC_DRAW),
        Ib.enableVertexAttribArray(b.attributes.uv),
        Ib.vertexAttribPointer(b.attributes.uv, 2, Ib.FLOAT, !1, 0, 0)),
        a.hasColors && c.vertexColors !== THREE.NoColors && (Ib.bindBuffer(Ib.ARRAY_BUFFER, a.__webglColorBuffer),
        Ib.bufferData(Ib.ARRAY_BUFFER, a.colorArray, Ib.DYNAMIC_DRAW),
        Ib.enableVertexAttribArray(b.attributes.color),
        Ib.vertexAttribPointer(b.attributes.color, 3, Ib.FLOAT, !1, 0, 0)),
        Ib.drawArrays(Ib.TRIANGLES, 0, a.count),
        a.count = 0
    }
    ,
    this.renderBufferDirect = function(a, b, c, d, e, f) {
        if (d.visible !== !1) {
            var g, h, i, j, k = N(a, b, c, d, f), l = k.attributes, m = e.attributes, n = !1, o = d.wireframe ? 1 : 0, p = 16777215 * e.id + 2 * k.id + o;
            if (p !== Ub && (Ub = p,
            n = !0),
            n && u(),
            f instanceof THREE.Mesh) {
                var q = m.index;
                if (q) {
                    var s = e.offsets;
                    s.length > 1 && (n = !0);
                    for (var v = 0, w = s.length; w > v; v++) {
                        var x = s[v].index;
                        if (n) {
                            for (h in l)
                                i = l[h],
                                g = m[h],
                                i >= 0 && (g ? (j = g.itemSize,
                                Ib.bindBuffer(Ib.ARRAY_BUFFER, g.buffer),
                                t(i),
                                Ib.vertexAttribPointer(i, j, Ib.FLOAT, !1, 0, x * j * 4)) : d.defaultAttributeValues && (2 === d.defaultAttributeValues[h].length ? Ib.vertexAttrib2fv(i, d.defaultAttributeValues[h]) : 3 === d.defaultAttributeValues[h].length && Ib.vertexAttrib3fv(i, d.defaultAttributeValues[h])));
                            Ib.bindBuffer(Ib.ELEMENT_ARRAY_BUFFER, q.buffer)
                        }
                        Ib.drawElements(Ib.TRIANGLES, s[v].count, Ib.UNSIGNED_SHORT, 2 * s[v].start),
                        Ob.info.render.calls++,
                        Ob.info.render.vertices += s[v].count,
                        Ob.info.render.faces += s[v].count / 3
                    }
                } else {
                    if (n)
                        for (h in l)
                            "index" !== h && (i = l[h],
                            g = m[h],
                            i >= 0 && (g ? (j = g.itemSize,
                            Ib.bindBuffer(Ib.ARRAY_BUFFER, g.buffer),
                            t(i),
                            Ib.vertexAttribPointer(i, j, Ib.FLOAT, !1, 0, 0)) : d.defaultAttributeValues && d.defaultAttributeValues[h] && (2 === d.defaultAttributeValues[h].length ? Ib.vertexAttrib2fv(i, d.defaultAttributeValues[h]) : 3 === d.defaultAttributeValues[h].length && Ib.vertexAttrib3fv(i, d.defaultAttributeValues[h]))));
                    var y = e.attributes.position;
                    Ib.drawArrays(Ib.TRIANGLES, 0, y.array.length / 3),
                    Ob.info.render.calls++,
                    Ob.info.render.vertices += y.array.length / 3,
                    Ob.info.render.faces += y.array.length / 3 / 3
                }
            } else if (f instanceof THREE.ParticleSystem) {
                if (n)
                    for (h in l)
                        i = l[h],
                        g = m[h],
                        i >= 0 && (g ? (j = g.itemSize,
                        Ib.bindBuffer(Ib.ARRAY_BUFFER, g.buffer),
                        t(i),
                        Ib.vertexAttribPointer(i, j, Ib.FLOAT, !1, 0, 0)) : d.defaultAttributeValues && d.defaultAttributeValues[h] && (2 === d.defaultAttributeValues[h].length ? Ib.vertexAttrib2fv(i, d.defaultAttributeValues[h]) : 3 === d.defaultAttributeValues[h].length && Ib.vertexAttrib3fv(i, d.defaultAttributeValues[h])));
                var y = m.position;
                Ib.drawArrays(Ib.POINTS, 0, y.array.length / 3),
                Ob.info.render.calls++,
                Ob.info.render.points += y.array.length / 3
            } else if (f instanceof THREE.Line) {
                var z = f.type === THREE.LineStrip ? Ib.LINE_STRIP : Ib.LINES;
                cb(d.linewidth);
                var q = m.index;
                if (q) {
                    var s = e.offsets;
                    s.length > 1 && (n = !0);
                    for (var v = 0, w = s.length; w > v; v++) {
                        var x = s[v].index;
                        n && (r(d, l, m, x),
                        Ib.bindBuffer(Ib.ELEMENT_ARRAY_BUFFER, q.buffer)),
                        Ib.drawElements(Ib.LINES, s[v].count, Ib.UNSIGNED_SHORT, 2 * s[v].start),
                        Ob.info.render.calls++,
                        Ob.info.render.vertices += s[v].count
                    }
                } else {
                    n && r(d, l, m, 0);
                    var y = m.position;
                    Ib.drawArrays(z, 0, y.array.length / 3),
                    Ob.info.render.calls++,
                    Ob.info.render.points += y.array.length
                }
            }
        }
    }
    ,
    this.renderBuffer = function(a, b, c, d, e, f) {
        if (d.visible !== !1) {
            var g, h, i, j = N(a, b, c, d, f), k = j.attributes, l = !1, m = d.wireframe ? 1 : 0, n = 16777215 * e.id + 2 * j.id + m;
            if (n !== Ub && (Ub = n,
            l = !0),
            l && u(),
            !d.morphTargets && k.position >= 0 ? l && (Ib.bindBuffer(Ib.ARRAY_BUFFER, e.__webglVertexBuffer),
            t(k.position),
            Ib.vertexAttribPointer(k.position, 3, Ib.FLOAT, !1, 0, 0)) : f.morphTargetBase && v(d, e, f),
            l) {
                if (e.__webglCustomAttributesList)
                    for (h = 0,
                    i = e.__webglCustomAttributesList.length; i > h; h++)
                        g = e.__webglCustomAttributesList[h],
                        k[g.buffer.belongsToAttribute] >= 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, g.buffer),
                        t(k[g.buffer.belongsToAttribute]),
                        Ib.vertexAttribPointer(k[g.buffer.belongsToAttribute], g.size, Ib.FLOAT, !1, 0, 0));
                k.color >= 0 && (f.geometry.colors.length > 0 || f.geometry.faces.length > 0 ? (Ib.bindBuffer(Ib.ARRAY_BUFFER, e.__webglColorBuffer),
                t(k.color),
                Ib.vertexAttribPointer(k.color, 3, Ib.FLOAT, !1, 0, 0)) : d.defaultAttributeValues && Ib.vertexAttrib3fv(k.color, d.defaultAttributeValues.color)),
                k.normal >= 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, e.__webglNormalBuffer),
                t(k.normal),
                Ib.vertexAttribPointer(k.normal, 3, Ib.FLOAT, !1, 0, 0)),
                k.tangent >= 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, e.__webglTangentBuffer),
                t(k.tangent),
                Ib.vertexAttribPointer(k.tangent, 4, Ib.FLOAT, !1, 0, 0)),
                k.uv >= 0 && (f.geometry.faceVertexUvs[0] ? (Ib.bindBuffer(Ib.ARRAY_BUFFER, e.__webglUVBuffer),
                t(k.uv),
                Ib.vertexAttribPointer(k.uv, 2, Ib.FLOAT, !1, 0, 0)) : d.defaultAttributeValues && Ib.vertexAttrib2fv(k.uv, d.defaultAttributeValues.uv)),
                k.uv2 >= 0 && (f.geometry.faceVertexUvs[1] ? (Ib.bindBuffer(Ib.ARRAY_BUFFER, e.__webglUV2Buffer),
                t(k.uv2),
                Ib.vertexAttribPointer(k.uv2, 2, Ib.FLOAT, !1, 0, 0)) : d.defaultAttributeValues && Ib.vertexAttrib2fv(k.uv2, d.defaultAttributeValues.uv2)),
                d.skinning && k.skinIndex >= 0 && k.skinWeight >= 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, e.__webglSkinIndicesBuffer),
                t(k.skinIndex),
                Ib.vertexAttribPointer(k.skinIndex, 4, Ib.FLOAT, !1, 0, 0),
                Ib.bindBuffer(Ib.ARRAY_BUFFER, e.__webglSkinWeightsBuffer),
                t(k.skinWeight),
                Ib.vertexAttribPointer(k.skinWeight, 4, Ib.FLOAT, !1, 0, 0)),
                k.lineDistance >= 0 && (Ib.bindBuffer(Ib.ARRAY_BUFFER, e.__webglLineDistanceBuffer),
                t(k.lineDistance),
                Ib.vertexAttribPointer(k.lineDistance, 1, Ib.FLOAT, !1, 0, 0))
            }
            if (f instanceof THREE.Mesh)
                d.wireframe ? (cb(d.wireframeLinewidth),
                l && Ib.bindBuffer(Ib.ELEMENT_ARRAY_BUFFER, e.__webglLineBuffer),
                Ib.drawElements(Ib.LINES, e.__webglLineCount, Ib.UNSIGNED_SHORT, 0)) : (l && Ib.bindBuffer(Ib.ELEMENT_ARRAY_BUFFER, e.__webglFaceBuffer),
                Ib.drawElements(Ib.TRIANGLES, e.__webglFaceCount, Ib.UNSIGNED_SHORT, 0)),
                Ob.info.render.calls++,
                Ob.info.render.vertices += e.__webglFaceCount,
                Ob.info.render.faces += e.__webglFaceCount / 3;
            else if (f instanceof THREE.Line) {
                var o = f.type === THREE.LineStrip ? Ib.LINE_STRIP : Ib.LINES;
                cb(d.linewidth),
                Ib.drawArrays(o, 0, e.__webglLineCount),
                Ob.info.render.calls++
            } else
                f instanceof THREE.ParticleSystem && (Ib.drawArrays(Ib.POINTS, 0, e.__webglParticleCount),
                Ob.info.render.calls++,
                Ob.info.render.points += e.__webglParticleCount)
        }
    }
    ,
    this.render = function(a, b, c, d) {
        if (b instanceof THREE.Camera == !1)
            return console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera."),
            void 0;
        var e, f, g, h, i, j = a.__lights, k = a.fog;
        for (Tb = -1,
        tc = !0,
        a.autoUpdate === !0 && a.updateMatrixWorld(),
        void 0 === b.parent && b.updateMatrixWorld(),
        b.matrixWorldInverse.getInverse(b.matrixWorld),
        pc.multiplyMatrices(b.projectionMatrix, b.matrixWorldInverse),
        oc.setFromMatrix(pc),
        this.autoUpdateObjects && this.initWebGLObjects(a),
        y(this.renderPluginsPre, a, b),
        Ob.info.render.calls = 0,
        Ob.info.render.vertices = 0,
        Ob.info.render.faces = 0,
        Ob.info.render.points = 0,
        this.setRenderTarget(c),
        (this.autoClear || d) && this.clear(this.autoClearColor, this.autoClearDepth, this.autoClearStencil),
        i = a.__webglObjects,
        e = 0,
        f = i.length; f > e; e++)
            g = i[e],
            h = g.object,
            g.id = e,
            g.render = !1,
            h.visible && ((h instanceof THREE.Mesh || h instanceof THREE.ParticleSystem) && h.frustumCulled && !oc.intersectsObject(h) || ($(h, b),
            C(g),
            g.render = !0,
            this.sortObjects === !0 && (null !== h.renderDepth ? g.z = h.renderDepth : (rc.setFromMatrixPosition(h.matrixWorld),
            rc.applyProjection(pc),
            g.z = rc.z))));
        for (this.sortObjects && i.sort(w),
        i = a.__webglObjectsImmediate,
        e = 0,
        f = i.length; f > e; e++)
            g = i[e],
            h = g.object,
            h.visible && ($(h, b),
            B(g));
        if (a.overrideMaterial) {
            var l = a.overrideMaterial;
            this.setBlending(l.blending, l.blendEquation, l.blendSrc, l.blendDst),
            this.setDepthTest(l.depthTest),
            this.setDepthWrite(l.depthWrite),
            db(l.polygonOffset, l.polygonOffsetFactor, l.polygonOffsetUnits),
            z(a.__webglObjects, !1, "", b, j, k, !0, l),
            A(a.__webglObjectsImmediate, "", b, j, k, !1, l)
        } else {
            var l = null;
            this.setBlending(THREE.NoBlending),
            z(a.__webglObjects, !0, "opaque", b, j, k, !1, l),
            A(a.__webglObjectsImmediate, "opaque", b, j, k, !1, l),
            z(a.__webglObjects, !1, "transparent", b, j, k, !0, l),
            A(a.__webglObjectsImmediate, "transparent", b, j, k, !0, l)
        }
        y(this.renderPluginsPost, a, b),
        c && c.generateMipmaps && c.minFilter !== THREE.NearestFilter && c.minFilter !== THREE.LinearFilter && qb(c),
        this.setDepthTest(!0),
        this.setDepthWrite(!0)
    }
    ,
    this.renderImmediateObject = function(a, b, c, d, e) {
        var f = N(a, b, c, d, e);
        Ub = -1,
        Ob.setMaterialFaces(d),
        e.immediateRenderCallback ? e.immediateRenderCallback(f, Ib, oc) : e.render(function(a) {
            Ob.renderBufferImmediate(a, f, d)
        })
    }
    ,
    this.initWebGLObjects = function(a) {
        for (a.__webglObjects || (a.__webglObjects = [],
        a.__webglObjectsImmediate = [],
        a.__webglSprites = [],
        a.__webglFlares = []); a.__objectsAdded.length; )
            D(a.__objectsAdded[0], a),
            a.__objectsAdded.splice(0, 1);
        for (; a.__objectsRemoved.length; )
            J(a.__objectsRemoved[0], a),
            a.__objectsRemoved.splice(0, 1);
        for (var b = 0, c = a.__webglObjects.length; c > b; b++) {
            var d = a.__webglObjects[b].object;
            void 0 === d.__webglInit && (void 0 !== d.__webglActive && J(d, a),
            D(d, a)),
            G(d)
        }
    }
    ,
    this.initMaterial = function(a, b, c, d) {
        a.addEventListener("dispose", Kc);
        var e, f, g, h, i, j, k;
        a instanceof THREE.MeshDepthMaterial ? k = "depth" : a instanceof THREE.MeshNormalMaterial ? k = "normal" : a instanceof THREE.MeshBasicMaterial ? k = "basic" : a instanceof THREE.MeshLambertMaterial ? k = "lambert" : a instanceof THREE.MeshPhongMaterial ? k = "phong" : a instanceof THREE.LineBasicMaterial ? k = "basic" : a instanceof THREE.LineDashedMaterial ? k = "dashed" : a instanceof THREE.ParticleSystemMaterial && (k = "particle_basic"),
        k && M(a, THREE.ShaderLib[k]),
        h = ub(b),
        j = vb(b),
        i = tb(d),
        g = {
            map: !!a.map,
            envMap: !!a.envMap,
            lightMap: !!a.lightMap,
            bumpMap: !!a.bumpMap,
            normalMap: !!a.normalMap,
            specularMap: !!a.specularMap,
            vertexColors: a.vertexColors,
            fog: c,
            useFog: a.fog,
            fogExp: c instanceof THREE.FogExp2,
            sizeAttenuation: a.sizeAttenuation,
            skinning: a.skinning,
            maxBones: i,
            useVertexTexture: Ac && d && d.useVertexTexture,
            morphTargets: a.morphTargets,
            morphNormals: a.morphNormals,
            maxMorphTargets: this.maxMorphTargets,
            maxMorphNormals: this.maxMorphNormals,
            maxDirLights: h.directional,
            maxPointLights: h.point,
            maxSpotLights: h.spot,
            maxHemiLights: h.hemi,
            maxShadows: j,
            shadowMapEnabled: this.shadowMapEnabled && d.receiveShadow && j > 0,
            shadowMapType: this.shadowMapType,
            shadowMapDebug: this.shadowMapDebug,
            shadowMapCascade: this.shadowMapCascade,
            alphaTest: a.alphaTest,
            metal: a.metal,
            wrapAround: a.wrapAround,
            doubleSided: a.side === THREE.DoubleSide,
            flipSided: a.side === THREE.BackSide
        },
        a.program = fb(k, a.fragmentShader, a.vertexShader, a.uniforms, a.attributes, a.defines, g, a.index0AttributeName);
        var l = a.program.attributes;
        if (a.morphTargets) {
            a.numSupportedMorphTargets = 0;
            var m, n = "morphTarget";
            for (f = 0; f < this.maxMorphTargets; f++)
                m = n + f,
                l[m] >= 0 && a.numSupportedMorphTargets++
        }
        if (a.morphNormals) {
            a.numSupportedMorphNormals = 0;
            var m, n = "morphNormal";
            for (f = 0; f < this.maxMorphNormals; f++)
                m = n + f,
                l[m] >= 0 && a.numSupportedMorphNormals++
        }
        a.uniformsList = [];
        for (e in a.uniforms)
            a.uniformsList.push([a.uniforms[e], e])
    }
    ,
    this.setFaceCulling = function(a, b) {
        a === THREE.CullFaceNone ? Ib.disable(Ib.CULL_FACE) : (b === THREE.FrontFaceDirectionCW ? Ib.frontFace(Ib.CW) : Ib.frontFace(Ib.CCW),
        a === THREE.CullFaceBack ? Ib.cullFace(Ib.BACK) : a === THREE.CullFaceFront ? Ib.cullFace(Ib.FRONT) : Ib.cullFace(Ib.FRONT_AND_BACK),
        Ib.enable(Ib.CULL_FACE))
    }
    ,
    this.setMaterialFaces = function(a) {
        var b = a.side === THREE.DoubleSide
          , c = a.side === THREE.BackSide;
        Xb !== b && (b ? Ib.disable(Ib.CULL_FACE) : Ib.enable(Ib.CULL_FACE),
        Xb = b),
        Yb !== c && (c ? Ib.frontFace(Ib.CW) : Ib.frontFace(Ib.CCW),
        Yb = c)
    }
    ,
    this.setDepthTest = function(a) {
        bc !== a && (a ? Ib.enable(Ib.DEPTH_TEST) : Ib.disable(Ib.DEPTH_TEST),
        bc = a)
    }
    ,
    this.setDepthWrite = function(a) {
        cc !== a && (Ib.depthMask(a),
        cc = a)
    }
    ,
    this.setBlending = function(a, b, c, d) {
        a !== Zb && (a === THREE.NoBlending ? Ib.disable(Ib.BLEND) : a === THREE.AdditiveBlending ? (Ib.enable(Ib.BLEND),
        Ib.blendEquation(Ib.FUNC_ADD),
        Ib.blendFunc(Ib.SRC_ALPHA, Ib.ONE)) : a === THREE.SubtractiveBlending ? (Ib.enable(Ib.BLEND),
        Ib.blendEquation(Ib.FUNC_ADD),
        Ib.blendFunc(Ib.ZERO, Ib.ONE_MINUS_SRC_COLOR)) : a === THREE.MultiplyBlending ? (Ib.enable(Ib.BLEND),
        Ib.blendEquation(Ib.FUNC_ADD),
        Ib.blendFunc(Ib.ZERO, Ib.SRC_COLOR)) : a === THREE.CustomBlending ? Ib.enable(Ib.BLEND) : (Ib.enable(Ib.BLEND),
        Ib.blendEquationSeparate(Ib.FUNC_ADD, Ib.FUNC_ADD),
        Ib.blendFuncSeparate(Ib.SRC_ALPHA, Ib.ONE_MINUS_SRC_ALPHA, Ib.ONE, Ib.ONE_MINUS_SRC_ALPHA)),
        Zb = a),
        a === THREE.CustomBlending ? (b !== $b && (Ib.blendEquation(sb(b)),
        $b = b),
        (c !== _b || d !== ac) && (Ib.blendFunc(sb(c), sb(d)),
        _b = c,
        ac = d)) : ($b = null,
        _b = null,
        ac = null)
    }
    ,
    this.setTexture = function(a, b) {
        if (a.needsUpdate) {
            a.__webglInit || (a.__webglInit = !0,
            a.addEventListener("dispose", Ic),
            a.__webglTexture = Ib.createTexture(),
            Ob.info.memory.textures++),
            Ib.activeTexture(Ib.TEXTURE0 + b),
            Ib.bindTexture(Ib.TEXTURE_2D, a.__webglTexture),
            Ib.pixelStorei(Ib.UNPACK_FLIP_Y_WEBGL, a.flipY),
            Ib.pixelStorei(Ib.UNPACK_PREMULTIPLY_ALPHA_WEBGL, a.premultiplyAlpha),
            Ib.pixelStorei(Ib.UNPACK_ALIGNMENT, a.unpackAlignment);
            var c = a.image
              , d = THREE.Math.isPowerOfTwo(c.width) && THREE.Math.isPowerOfTwo(c.height)
              , e = sb(a.format)
              , f = sb(a.type);
            kb(Ib.TEXTURE_2D, a, d);
            var g, h = a.mipmaps;
            if (a instanceof THREE.DataTexture)
                if (h.length > 0 && d) {
                    for (var i = 0, j = h.length; j > i; i++)
                        g = h[i],
                        Ib.texImage2D(Ib.TEXTURE_2D, i, e, g.width, g.height, 0, e, f, g.data);
                    a.generateMipmaps = !1
                } else
                    Ib.texImage2D(Ib.TEXTURE_2D, 0, e, c.width, c.height, 0, e, f, c.data);
            else if (a instanceof THREE.CompressedTexture)
                for (var i = 0, j = h.length; j > i; i++)
                    g = h[i],
                    a.format !== THREE.RGBAFormat ? Ib.compressedTexImage2D(Ib.TEXTURE_2D, i, e, g.width, g.height, 0, g.data) : Ib.texImage2D(Ib.TEXTURE_2D, i, e, g.width, g.height, 0, e, f, g.data);
            else if (h.length > 0 && d) {
                for (var i = 0, j = h.length; j > i; i++)
                    g = h[i],
                    Ib.texImage2D(Ib.TEXTURE_2D, i, e, e, f, g);
                a.generateMipmaps = !1
            } else
                Ib.texImage2D(Ib.TEXTURE_2D, 0, e, e, f, a.image);
            a.generateMipmaps && d && Ib.generateMipmap(Ib.TEXTURE_2D),
            a.needsUpdate = !1,
            a.onUpdate && a.onUpdate()
        } else
            Ib.activeTexture(Ib.TEXTURE0 + b),
            Ib.bindTexture(Ib.TEXTURE_2D, a.__webglTexture)
    }
    ,
    this.setRenderTarget = function(a) {
        var b = a instanceof THREE.WebGLRenderTargetCube;
        if (a && !a.__webglFramebuffer) {
            void 0 === a.depthBuffer && (a.depthBuffer = !0),
            void 0 === a.stencilBuffer && (a.stencilBuffer = !0),
            a.addEventListener("dispose", Jc),
            a.__webglTexture = Ib.createTexture(),
            Ob.info.memory.textures++;
            var c = THREE.Math.isPowerOfTwo(a.width) && THREE.Math.isPowerOfTwo(a.height)
              , d = sb(a.format)
              , e = sb(a.type);
            if (b) {
                a.__webglFramebuffer = [],
                a.__webglRenderbuffer = [],
                Ib.bindTexture(Ib.TEXTURE_CUBE_MAP, a.__webglTexture),
                kb(Ib.TEXTURE_CUBE_MAP, a, c);
                for (var f = 0; 6 > f; f++)
                    a.__webglFramebuffer[f] = Ib.createFramebuffer(),
                    a.__webglRenderbuffer[f] = Ib.createRenderbuffer(),
                    Ib.texImage2D(Ib.TEXTURE_CUBE_MAP_POSITIVE_X + f, 0, d, a.width, a.height, 0, d, e, null),
                    ob(a.__webglFramebuffer[f], a, Ib.TEXTURE_CUBE_MAP_POSITIVE_X + f),
                    pb(a.__webglRenderbuffer[f], a);
                c && Ib.generateMipmap(Ib.TEXTURE_CUBE_MAP)
            } else
                a.__webglFramebuffer = Ib.createFramebuffer(),
                a.__webglRenderbuffer = a.shareDepthFrom ? a.shareDepthFrom.__webglRenderbuffer : Ib.createRenderbuffer(),
                Ib.bindTexture(Ib.TEXTURE_2D, a.__webglTexture),
                kb(Ib.TEXTURE_2D, a, c),
                Ib.texImage2D(Ib.TEXTURE_2D, 0, d, a.width, a.height, 0, d, e, null),
                ob(a.__webglFramebuffer, a, Ib.TEXTURE_2D),
                a.shareDepthFrom ? a.depthBuffer && !a.stencilBuffer ? Ib.framebufferRenderbuffer(Ib.FRAMEBUFFER, Ib.DEPTH_ATTACHMENT, Ib.RENDERBUFFER, a.__webglRenderbuffer) : a.depthBuffer && a.stencilBuffer && Ib.framebufferRenderbuffer(Ib.FRAMEBUFFER, Ib.DEPTH_STENCIL_ATTACHMENT, Ib.RENDERBUFFER, a.__webglRenderbuffer) : pb(a.__webglRenderbuffer, a),
                c && Ib.generateMipmap(Ib.TEXTURE_2D);
            b ? Ib.bindTexture(Ib.TEXTURE_CUBE_MAP, null) : Ib.bindTexture(Ib.TEXTURE_2D, null),
            Ib.bindRenderbuffer(Ib.RENDERBUFFER, null),
            Ib.bindFramebuffer(Ib.FRAMEBUFFER, null)
        }
        var g, h, i, j, k;
        a ? (g = b ? a.__webglFramebuffer[a.activeCubeFace] : a.__webglFramebuffer,
        h = a.width,
        i = a.height,
        j = 0,
        k = 0) : (g = null,
        h = jc,
        i = kc,
        j = hc,
        k = ic),
        g !== Sb && (Ib.bindFramebuffer(Ib.FRAMEBUFFER, g),
        Ib.viewport(j, k, h, i),
        Sb = g),
        lc = h,
        mc = i
    }
    ,
    this.shadowMapPlugin = new THREE.ShadowMapPlugin,
    this.addPrePlugin(this.shadowMapPlugin),
    this.addPostPlugin(new THREE.SpritePlugin),
    this.addPostPlugin(new THREE.LensFlarePlugin)
}
,
THREE.WebGLRenderTarget = function(a, b, c) {
    this.width = a,
    this.height = b,
    c = c || {},
    this.wrapS = void 0 !== c.wrapS ? c.wrapS : THREE.ClampToEdgeWrapping,
    this.wrapT = void 0 !== c.wrapT ? c.wrapT : THREE.ClampToEdgeWrapping,
    this.magFilter = void 0 !== c.magFilter ? c.magFilter : THREE.LinearFilter,
    this.minFilter = void 0 !== c.minFilter ? c.minFilter : THREE.LinearMipMapLinearFilter,
    this.anisotropy = void 0 !== c.anisotropy ? c.anisotropy : 1,
    this.offset = new THREE.Vector2(0,0),
    this.repeat = new THREE.Vector2(1,1),
    this.format = void 0 !== c.format ? c.format : THREE.RGBAFormat,
    this.type = void 0 !== c.type ? c.type : THREE.UnsignedByteType,
    this.depthBuffer = void 0 !== c.depthBuffer ? c.depthBuffer : !0,
    this.stencilBuffer = void 0 !== c.stencilBuffer ? c.stencilBuffer : !0,
    this.generateMipmaps = !0,
    this.shareDepthFrom = null
}
,
THREE.WebGLRenderTarget.prototype = {
    constructor: THREE.WebGLRenderTarget,
    clone: function() {
        var a = new THREE.WebGLRenderTarget(this.width,this.height);
        return a.wrapS = this.wrapS,
        a.wrapT = this.wrapT,
        a.magFilter = this.magFilter,
        a.minFilter = this.minFilter,
        a.anisotropy = this.anisotropy,
        a.offset.copy(this.offset),
        a.repeat.copy(this.repeat),
        a.format = this.format,
        a.type = this.type,
        a.depthBuffer = this.depthBuffer,
        a.stencilBuffer = this.stencilBuffer,
        a.generateMipmaps = this.generateMipmaps,
        a.shareDepthFrom = this.shareDepthFrom,
        a
    },
    dispose: function() {
        this.dispatchEvent({
            type: "dispose"
        })
    }
},
THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),
THREE.WebGLRenderTargetCube = function(a, b, c) {
    THREE.WebGLRenderTarget.call(this, a, b, c),
    this.activeCubeFace = 0
}
,
THREE.WebGLRenderTargetCube.prototype = Object.create(THREE.WebGLRenderTarget.prototype),
THREE.RenderableVertex = function() {
    this.position = new THREE.Vector3,
    this.positionWorld = new THREE.Vector3,
    this.positionScreen = new THREE.Vector4,
    this.visible = !0
}
,
THREE.RenderableVertex.prototype.copy = function(a) {
    this.positionWorld.copy(a.positionWorld),
    this.positionScreen.copy(a.positionScreen)
}
,
THREE.RenderableFace = function() {
    this.id = 0,
    this.v1 = new THREE.RenderableVertex,
    this.v2 = new THREE.RenderableVertex,
    this.v3 = new THREE.RenderableVertex,
    this.centroidModel = new THREE.Vector3,
    this.normalModel = new THREE.Vector3,
    this.vertexNormalsModel = [new THREE.Vector3, new THREE.Vector3, new THREE.Vector3],
    this.vertexNormalsLength = 0,
    this.color = null,
    this.material = null,
    this.uvs = [[]],
    this.z = 0
}
,
THREE.RenderableObject = function() {
    this.id = 0,
    this.object = null,
    this.z = 0
}
,
THREE.RenderableSprite = function() {
    this.id = 0,
    this.object = null,
    this.x = 0,
    this.y = 0,
    this.z = 0,
    this.rotation = 0,
    this.scale = new THREE.Vector2,
    this.material = null
}
,
THREE.RenderableLine = function() {
    this.id = 0,
    this.v1 = new THREE.RenderableVertex,
    this.v2 = new THREE.RenderableVertex,
    this.vertexColors = [new THREE.Color, new THREE.Color],
    this.material = null,
    this.z = 0
}
,
THREE.GeometryUtils = {
    merge: function(a, b, c) {
        var d, e, f = a.vertices.length, g = (a.faceVertexUvs[0].length,
        b instanceof THREE.Mesh ? b.geometry : b), h = a.vertices, i = g.vertices, j = a.faces, k = g.faces, l = a.faceVertexUvs[0], m = g.faceVertexUvs[0];
        void 0 === c && (c = 0),
        b instanceof THREE.Mesh && (b.matrixAutoUpdate && b.updateMatrix(),
        d = b.matrix,
        e = (new THREE.Matrix3).getNormalMatrix(d));
        for (var n = 0, o = i.length; o > n; n++) {
            var p = i[n]
              , q = p.clone();
            d && q.applyMatrix4(d),
            h.push(q)
        }
        for (n = 0,
        o = k.length; o > n; n++) {
            var r, s, t, u = k[n], v = u.vertexNormals, w = u.vertexColors;
            r = new THREE.Face3(u.a + f,u.b + f,u.c + f),
            r.normal.copy(u.normal),
            e && r.normal.applyMatrix3(e).normalize();
            for (var x = 0, y = v.length; y > x; x++)
                s = v[x].clone(),
                e && s.applyMatrix3(e).normalize(),
                r.vertexNormals.push(s);
            r.color.copy(u.color);
            for (var x = 0, y = w.length; y > x; x++)
                t = w[x],
                r.vertexColors.push(t.clone());
            r.materialIndex = u.materialIndex + c,
            r.centroid.copy(u.centroid),
            d && r.centroid.applyMatrix4(d),
            j.push(r)
        }
        for (n = 0,
        o = m.length; o > n; n++) {
            for (var z = m[n], A = [], x = 0, y = z.length; y > x; x++)
                A.push(new THREE.Vector2(z[x].x,z[x].y));
            l.push(A)
        }
    },
    randomPointInTriangle: function() {
        var a = new THREE.Vector3;
        return function(b, c, d) {
            var e = new THREE.Vector3
              , f = THREE.Math.random16()
              , g = THREE.Math.random16();
            f + g > 1 && (f = 1 - f,
            g = 1 - g);
            var h = 1 - f - g;
            return e.copy(b),
            e.multiplyScalar(f),
            a.copy(c),
            a.multiplyScalar(g),
            e.add(a),
            a.copy(d),
            a.multiplyScalar(h),
            e.add(a),
            e
        }
    }(),
    randomPointInFace: function(a, b) {
        var c, d, e;
        return c = b.vertices[a.a],
        d = b.vertices[a.b],
        e = b.vertices[a.c],
        THREE.GeometryUtils.randomPointInTriangle(c, d, e)
    },
    randomPointsInGeometry: function(a, b) {
        function c(a) {
            function b(c, d) {
                if (c > d)
                    return c;
                var e = c + Math.floor((d - c) / 2);
                return m[e] > a ? b(c, e - 1) : m[e] < a ? b(e + 1, d) : e
            }
            var c = b(0, m.length - 1);
            return c
        }
        var d, e, f, g, h, i = a.faces, j = a.vertices, k = i.length, l = 0, m = [];
        for (e = 0; k > e; e++)
            d = i[e],
            f = j[d.a],
            g = j[d.b],
            h = j[d.c],
            d._area = THREE.GeometryUtils.triangleArea(f, g, h),
            l += d._area,
            m[e] = l;
        var n, o, p = [], q = {};
        for (e = 0; b > e; e++)
            n = THREE.Math.random16() * l,
            o = c(n),
            p[e] = THREE.GeometryUtils.randomPointInFace(i[o], a, !0),
            q[o] ? q[o] += 1 : q[o] = 1;
        return p
    },
    triangleArea: function() {
        var a = new THREE.Vector3
          , b = new THREE.Vector3;
        return function(c, d, e) {
            return a.subVectors(d, c),
            b.subVectors(e, c),
            a.cross(b),
            .5 * a.length()
        }
    }(),
    center: function(a) {
        a.computeBoundingBox();
        var b = a.boundingBox
          , c = new THREE.Vector3;
        return c.addVectors(b.min, b.max),
        c.multiplyScalar(-.5),
        a.applyMatrix((new THREE.Matrix4).makeTranslation(c.x, c.y, c.z)),
        a.computeBoundingBox(),
        c
    },
    triangulateQuads: function(a) {
        var b, c, d, e, f = [], g = [];
        for (b = 0,
        c = a.faceVertexUvs.length; c > b; b++)
            g[b] = [];
        for (b = 0,
        c = a.faces.length; c > b; b++) {
            var h = a.faces[b];
            for (f.push(h),
            d = 0,
            e = a.faceVertexUvs.length; e > d; d++)
                g[d].push(a.faceVertexUvs[d][b])
        }
        a.faces = f,
        a.faceVertexUvs = g,
        a.computeCentroids(),
        a.computeFaceNormals(),
        a.computeVertexNormals(),
        a.hasTangents && a.computeTangents()
    }
},
THREE.ImageUtils = {
    crossOrigin: void 0,
    loadTexture: function(a, b, c) {
        var d = new THREE.ImageLoader;
        d.crossOrigin = this.crossOrigin;
        var e = new THREE.Texture(void 0,b)
          , f = d.load(a, function() {
            e.needsUpdate = !0,
            c && c(e)
        });
        return e.image = f,
        e.sourceFile = a,
        e
    },
    loadCompressedTexture: function(a, b, c, d) {
        var e = new THREE.CompressedTexture;
        e.mapping = b;
        var f = new XMLHttpRequest;
        return f.onload = function() {
            var a = f.response
              , b = THREE.ImageUtils.parseDDS(a, !0);
            e.format = b.format,
            e.mipmaps = b.mipmaps,
            e.image.width = b.width,
            e.image.height = b.height,
            e.generateMipmaps = !1,
            e.needsUpdate = !0,
            c && c(e)
        }
        ,
        f.onerror = d,
        f.open("GET", a, !0),
        f.responseType = "arraybuffer",
        f.send(null),
        e
    },
    loadTextureCube: function(a, b, c, d) {
        var e = [];
        e.loadCount = 0;
        var f = new THREE.Texture;
        f.image = e,
        void 0 !== b && (f.mapping = b),
        f.flipY = !1;
        for (var g = 0, h = a.length; h > g; ++g) {
            var i = new Image;
            e[g] = i,
            i.onload = function() {
                e.loadCount += 1,
                6 === e.loadCount && (f.needsUpdate = !0,
                c && c(f))
            }
            ,
            i.onerror = d,
            i.crossOrigin = this.crossOrigin,
            i.src = a[g]
        }
        return f
    },
    loadCompressedTextureCube: function(a, b, c, d) {
        var e = [];
        e.loadCount = 0;
        var f = new THREE.CompressedTexture;
        f.image = e,
        void 0 !== b && (f.mapping = b),
        f.flipY = !1,
        f.generateMipmaps = !1;
        var g = function(a, b) {
            return function() {
                var d = a.response
                  , g = THREE.ImageUtils.parseDDS(d, !0);
                b.format = g.format,
                b.mipmaps = g.mipmaps,
                b.width = g.width,
                b.height = g.height,
                e.loadCount += 1,
                6 === e.loadCount && (f.format = g.format,
                f.needsUpdate = !0,
                c && c(f))
            }
        };
        if (a instanceof Array)
            for (var h = 0, i = a.length; i > h; ++h) {
                var j = {};
                e[h] = j;
                var k = new XMLHttpRequest;
                k.onload = g(k, j),
                k.onerror = d;
                var l = a[h];
                k.open("GET", l, !0),
                k.responseType = "arraybuffer",
                k.send(null)
            }
        else {
            var l = a
              , k = new XMLHttpRequest;
            k.onload = function() {
                var a = k.response
                  , b = THREE.ImageUtils.parseDDS(a, !0);
                if (b.isCubemap) {
                    for (var d = b.mipmaps.length / b.mipmapCount, g = 0; d > g; g++) {
                        e[g] = {
                            mipmaps: []
                        };
                        for (var h = 0; h < b.mipmapCount; h++)
                            e[g].mipmaps.push(b.mipmaps[g * b.mipmapCount + h]),
                            e[g].format = b.format,
                            e[g].width = b.width,
                            e[g].height = b.height
                    }
                    f.format = b.format,
                    f.needsUpdate = !0,
                    c && c(f)
                }
            }
            ,
            k.onerror = d,
            k.open("GET", l, !0),
            k.responseType = "arraybuffer",
            k.send(null)
        }
        return f
    },
    loadDDSTexture: function(a, b, c, d) {
        var e = [];
        e.loadCount = 0;
        var f = new THREE.CompressedTexture;
        f.image = e,
        void 0 !== b && (f.mapping = b),
        f.flipY = !1,
        f.generateMipmaps = !1;
        var g = new XMLHttpRequest;
        return g.onload = function() {
            var a = g.response
              , b = THREE.ImageUtils.parseDDS(a, !0);
            if (b.isCubemap)
                for (var d = b.mipmaps.length / b.mipmapCount, h = 0; d > h; h++) {
                    e[h] = {
                        mipmaps: []
                    };
                    for (var i = 0; i < b.mipmapCount; i++)
                        e[h].mipmaps.push(b.mipmaps[h * b.mipmapCount + i]),
                        e[h].format = b.format,
                        e[h].width = b.width,
                        e[h].height = b.height
                }
            else
                f.image.width = b.width,
                f.image.height = b.height,
                f.mipmaps = b.mipmaps;
            f.format = b.format,
            f.needsUpdate = !0,
            c && c(f)
        }
        ,
        g.onerror = d,
        g.open("GET", a, !0),
        g.responseType = "arraybuffer",
        g.send(null),
        f
    },
    parseDDS: function(a, b) {
        function c(a) {
            return a.charCodeAt(0) + (a.charCodeAt(1) << 8) + (a.charCodeAt(2) << 16) + (a.charCodeAt(3) << 24)
        }
        function d(a) {
            return String.fromCharCode(255 & a, a >> 8 & 255, a >> 16 & 255, a >> 24 & 255)
        }
        function e(a, b, c, d) {
            for (var e = c * d * 4, f = new Uint8Array(a,b,e), g = new Uint8Array(e), h = 0, i = 0, j = 0; d > j; j++)
                for (var k = 0; c > k; k++) {
                    var l = f[i];
                    i++;
                    var m = f[i];
                    i++;
                    var n = f[i];
                    i++;
                    var o = f[i];
                    i++,
                    g[h] = n,
                    h++,
                    g[h] = m,
                    h++,
                    g[h] = l,
                    h++,
                    g[h] = o,
                    h++
                }
            return g
        }
        var f = {
            mipmaps: [],
            width: 0,
            height: 0,
            format: null,
            mipmapCount: 1
        }
          , g = 542327876
          , h = 131072
          , i = 512
          , j = 4
          , k = c("DXT1")
          , l = c("DXT3")
          , m = c("DXT5")
          , n = 31
          , o = 0
          , p = 1
          , q = 2
          , r = 3
          , s = 4
          , t = 7
          , u = 20
          , v = 21
          , w = 22
          , x = 23
          , y = 24
          , z = 25
          , A = 26
          , B = 28
          , C = new Int32Array(a,0,n);
        if (C[o] !== g)
            return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),
            f;
        if (!C[u] & j)
            return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),
            f;
        var D, E = C[v], F = !1;
        switch (E) {
        case k:
            D = 8,
            f.format = THREE.RGB_S3TC_DXT1_Format;
            break;
        case l:
            D = 16,
            f.format = THREE.RGBA_S3TC_DXT3_Format;
            break;
        case m:
            D = 16,
            f.format = THREE.RGBA_S3TC_DXT5_Format;
            break;
        default:
            if (!(32 == C[w] && 16711680 & C[x] && 65280 & C[y] && 255 & C[z] && 4278190080 & C[A]))
                return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ", d(E)),
                f;
            F = !0,
            D = 64,
            f.format = THREE.RGBAFormat
        }
        f.mipmapCount = 1,
        C[q] & h && b !== !1 && (f.mipmapCount = Math.max(1, C[t])),
        f.isCubemap = C[B] & i ? !0 : !1,
        f.width = C[s],
        f.height = C[r];
        for (var G = C[p] + 4, H = f.width, I = f.height, J = f.isCubemap ? 6 : 1, K = 0; J > K; K++) {
            for (var L = 0; L < f.mipmapCount; L++) {
                if (F)
                    var M = e(a, G, H, I)
                      , N = M.length;
                else
                    var N = Math.max(4, H) / 4 * Math.max(4, I) / 4 * D
                      , M = new Uint8Array(a,G,N);
                var O = {
                    data: M,
                    width: H,
                    height: I
                };
                f.mipmaps.push(O),
                G += N,
                H = Math.max(.5 * H, 1),
                I = Math.max(.5 * I, 1)
            }
            H = f.width,
            I = f.height
        }
        return f
    },
    getNormalMap: function(a, b) {
        var c = function(a, b) {
            return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]]
        }
          , d = function(a, b) {
            return [a[0] - b[0], a[1] - b[1], a[2] - b[2]]
        }
          , e = function(a) {
            var b = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);
            return [a[0] / b, a[1] / b, a[2] / b]
        };
        b = 1 | b;
        var f = a.width
          , g = a.height
          , h = document.createElement("canvas");
        h.width = f,
        h.height = g;
        var i = h.getContext("2d");
        i.drawImage(a, 0, 0);
        for (var j = i.getImageData(0, 0, f, g).data, k = i.createImageData(f, g), l = k.data, m = 0; f > m; m++)
            for (var n = 0; g > n; n++) {
                var o = 0 > n - 1 ? 0 : n - 1
                  , p = n + 1 > g - 1 ? g - 1 : n + 1
                  , q = 0 > m - 1 ? 0 : m - 1
                  , r = m + 1 > f - 1 ? f - 1 : m + 1
                  , s = []
                  , t = [0, 0, j[4 * (n * f + m)] / 255 * b];
                s.push([-1, 0, j[4 * (n * f + q)] / 255 * b]),
                s.push([-1, -1, j[4 * (o * f + q)] / 255 * b]),
                s.push([0, -1, j[4 * (o * f + m)] / 255 * b]),
                s.push([1, -1, j[4 * (o * f + r)] / 255 * b]),
                s.push([1, 0, j[4 * (n * f + r)] / 255 * b]),
                s.push([1, 1, j[4 * (p * f + r)] / 255 * b]),
                s.push([0, 1, j[4 * (p * f + m)] / 255 * b]),
                s.push([-1, 1, j[4 * (p * f + q)] / 255 * b]);
                for (var u = [], v = s.length, w = 0; v > w; w++) {
                    var x = s[w]
                      , y = s[(w + 1) % v];
                    x = d(x, t),
                    y = d(y, t),
                    u.push(e(c(x, y)))
                }
                for (var z = [0, 0, 0], w = 0; w < u.length; w++)
                    z[0] += u[w][0],
                    z[1] += u[w][1],
                    z[2] += u[w][2];
                z[0] /= u.length,
                z[1] /= u.length,
                z[2] /= u.length;
                var A = 4 * (n * f + m);
                l[A] = (z[0] + 1) / 2 * 255 | 0,
                l[A + 1] = (z[1] + 1) / 2 * 255 | 0,
                l[A + 2] = 255 * z[2] | 0,
                l[A + 3] = 255
            }
        return i.putImageData(k, 0, 0),
        h
    },
    generateDataTexture: function(a, b, c) {
        for (var d = a * b, e = new Uint8Array(3 * d), f = Math.floor(255 * c.r), g = Math.floor(255 * c.g), h = Math.floor(255 * c.b), i = 0; d > i; i++)
            e[3 * i] = f,
            e[3 * i + 1] = g,
            e[3 * i + 2] = h;
        var j = new THREE.DataTexture(e,a,b,THREE.RGBFormat);
        return j.needsUpdate = !0,
        j
    }
},
THREE.SceneUtils = {
    createMultiMaterialObject: function(a, b) {
        for (var c = new THREE.Object3D, d = 0, e = b.length; e > d; d++)
            c.add(new THREE.Mesh(a,b[d]));
        return c
    },
    detach: function(a, b, c) {
        a.applyMatrix(b.matrixWorld),
        b.remove(a),
        c.add(a)
    },
    attach: function(a, b, c) {
        var d = new THREE.Matrix4;
        d.getInverse(c.matrixWorld),
        a.applyMatrix(d),
        b.remove(a),
        c.add(a)
    }
},
THREE.FontUtils = {
    faces: {},
    face: "helvetiker",
    weight: "normal",
    style: "normal",
    size: 150,
    divisions: 10,
    getFace: function() {
        return this.faces[this.face][this.weight][this.style]
    },
    loadFace: function(a) {
        var b = a.familyName.toLowerCase()
          , c = this;
        c.faces[b] = c.faces[b] || {},
        c.faces[b][a.cssFontWeight] = c.faces[b][a.cssFontWeight] || {},
        c.faces[b][a.cssFontWeight][a.cssFontStyle] = a;
        c.faces[b][a.cssFontWeight][a.cssFontStyle] = a;
        return a
    },
    drawText: function(a) {
        var b, c = this.getFace(), d = this.size / c.resolution, e = 0, f = String(a).split(""), g = f.length, h = [];
        for (b = 0; g > b; b++) {
            var i = new THREE.Path
              , j = this.extractGlyphPoints(f[b], c, d, e, i);
            e += j.offset,
            h.push(j.path)
        }
        var k = e / 2;
        return {
            paths: h,
            offset: k
        }
    },
    extractGlyphPoints: function(a, b, c, d, e) {
        var f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y = [], z = b.glyphs[a] || b.glyphs["?"];
        if (z) {
            if (z.o)
                for (i = z._cachedOutline || (z._cachedOutline = z.o.split(" ")),
                k = i.length,
                l = c,
                m = c,
                f = 0; k > f; )
                    switch (j = i[f++]) {
                    case "m":
                        n = i[f++] * l + d,
                        o = i[f++] * m,
                        e.moveTo(n, o);
                        break;
                    case "l":
                        n = i[f++] * l + d,
                        o = i[f++] * m,
                        e.lineTo(n, o);
                        break;
                    case "q":
                        if (p = i[f++] * l + d,
                        q = i[f++] * m,
                        t = i[f++] * l + d,
                        u = i[f++] * m,
                        e.quadraticCurveTo(t, u, p, q),
                        x = y[y.length - 1])
                            for (r = x.x,
                            s = x.y,
                            g = 1,
                            h = this.divisions; h >= g; g++) {
                                var A = g / h;
                                THREE.Shape.Utils.b2(A, r, t, p),
                                THREE.Shape.Utils.b2(A, s, u, q)
                            }
                        break;
                    case "b":
                        if (p = i[f++] * l + d,
                        q = i[f++] * m,
                        t = i[f++] * l + d,
                        u = i[f++] * -m,
                        v = i[f++] * l + d,
                        w = i[f++] * -m,
                        e.bezierCurveTo(p, q, t, u, v, w),
                        x = y[y.length - 1])
                            for (r = x.x,
                            s = x.y,
                            g = 1,
                            h = this.divisions; h >= g; g++) {
                                var A = g / h;
                                THREE.Shape.Utils.b3(A, r, t, v, p),
                                THREE.Shape.Utils.b3(A, s, u, w, q)
                            }
                    }
            return {
                offset: z.ha * c,
                path: e
            }
        }
    }
},
THREE.FontUtils.generateShapes = function(a, b) {
    b = b || {};
    var c = void 0 !== b.size ? b.size : 100
      , d = void 0 !== b.curveSegments ? b.curveSegments : 4
      , e = void 0 !== b.font ? b.font : "helvetiker"
      , f = void 0 !== b.weight ? b.weight : "normal"
      , g = void 0 !== b.style ? b.style : "normal";
    THREE.FontUtils.size = c,
    THREE.FontUtils.divisions = d,
    THREE.FontUtils.face = e,
    THREE.FontUtils.weight = f,
    THREE.FontUtils.style = g;
    for (var h = THREE.FontUtils.drawText(a), i = h.paths, j = [], k = 0, l = i.length; l > k; k++)
        Array.prototype.push.apply(j, i[k].toShapes());
    return j
}
,
function(a) {
    var b = 1e-10
      , c = function(a, b) {
        var c = a.length;
        if (3 > c)
            return null;
        var f, g, h, i = [], j = [], k = [];
        if (d(a) > 0)
            for (g = 0; c > g; g++)
                j[g] = g;
        else
            for (g = 0; c > g; g++)
                j[g] = c - 1 - g;
        var l = c
          , m = 2 * l;
        for (g = l - 1; l > 2; ) {
            if (m-- <= 0)
                return console.log("Warning, unable to triangulate polygon!"),
                b ? k : i;
            if (f = g,
            f >= l && (f = 0),
            g = f + 1,
            g >= l && (g = 0),
            h = g + 1,
            h >= l && (h = 0),
            e(a, f, g, h, l, j)) {
                var n, o, p, q, r;
                for (n = j[f],
                o = j[g],
                p = j[h],
                i.push([a[n], a[o], a[p]]),
                k.push([j[f], j[g], j[h]]),
                q = g,
                r = g + 1; l > r; q++,
                r++)
                    j[q] = j[r];
                l--,
                m = 2 * l
            }
        }
        return b ? k : i
    }
      , d = function(a) {
        for (var b = a.length, c = 0, d = b - 1, e = 0; b > e; d = e++)
            c += a[d].x * a[e].y - a[e].x * a[d].y;
        return .5 * c
    }
      , e = function(a, c, d, e, f, g) {
        var h, i, j, k, l, m, n, o, p;
        if (i = a[g[c]].x,
        j = a[g[c]].y,
        k = a[g[d]].x,
        l = a[g[d]].y,
        m = a[g[e]].x,
        n = a[g[e]].y,
        b > (k - i) * (n - j) - (l - j) * (m - i))
            return !1;
        var q, r, s, t, u, v, w, x, y, z, A, B, C, D, E;
        for (q = m - k,
        r = n - l,
        s = i - m,
        t = j - n,
        u = k - i,
        v = l - j,
        h = 0; f > h; h++)
            if (o = a[g[h]].x,
            p = a[g[h]].y,
            !(o === i && p === j || o === k && p === l || o === m && p === n) && (w = o - i,
            x = p - j,
            y = o - k,
            z = p - l,
            A = o - m,
            B = p - n,
            E = q * z - r * y,
            C = u * x - v * w,
            D = s * B - t * A,
            E >= -b && D >= -b && C >= -b))
                return !1;
        return !0
    };
    return a.Triangulate = c,
    a.Triangulate.area = d,
    a
}(THREE.FontUtils),
self._typeface_js = {
    faces: THREE.FontUtils.faces,
    loadFace: THREE.FontUtils.loadFace
},
THREE.typeface_js = self._typeface_js,
THREE.Curve = function() {}
,
THREE.Curve.prototype.getPoint = function() {
    return console.log("Warning, getPoint() not implemented!"),
    null
}
,
THREE.Curve.prototype.getPointAt = function(a) {
    var b = this.getUtoTmapping(a);
    return this.getPoint(b)
}
,
THREE.Curve.prototype.getPoints = function(a) {
    a || (a = 5);
    var b, c = [];
    for (b = 0; a >= b; b++)
        c.push(this.getPoint(b / a));
    return c
}
,
THREE.Curve.prototype.getSpacedPoints = function(a) {
    a || (a = 5);
    var b, c = [];
    for (b = 0; a >= b; b++)
        c.push(this.getPointAt(b / a));
    return c
}
,
THREE.Curve.prototype.getLength = function() {
    var a = this.getLengths();
    return a[a.length - 1]
}
,
THREE.Curve.prototype.getLengths = function(a) {
    if (a || (a = this.__arcLengthDivisions ? this.__arcLengthDivisions : 200),
    this.cacheArcLengths && this.cacheArcLengths.length == a + 1 && !this.needsUpdate)
        return this.cacheArcLengths;
    this.needsUpdate = !1;
    var b, c, d = [], e = this.getPoint(0), f = 0;
    for (d.push(0),
    c = 1; a >= c; c++)
        b = this.getPoint(c / a),
        f += b.distanceTo(e),
        d.push(f),
        e = b;
    return this.cacheArcLengths = d,
    d
}
,
THREE.Curve.prototype.updateArcLengths = function() {
    this.needsUpdate = !0,
    this.getLengths()
}
,
THREE.Curve.prototype.getUtoTmapping = function(a, b) {
    var c, d = this.getLengths(), e = 0, f = d.length;
    c = b ? b : a * d[f - 1];
    for (var g, h = 0, i = f - 1; i >= h; )
        if (e = Math.floor(h + (i - h) / 2),
        g = d[e] - c,
        0 > g)
            h = e + 1;
        else {
            if (!(g > 0)) {
                i = e;
                break
            }
            i = e - 1
        }
    if (e = i,
    d[e] == c) {
        var j = e / (f - 1);
        return j
    }
    var k = d[e]
      , l = d[e + 1]
      , m = l - k
      , n = (c - k) / m
      , j = (e + n) / (f - 1);
    return j
}
,
THREE.Curve.prototype.getTangent = function(a) {
    var b = 1e-4
      , c = a - b
      , d = a + b;
    0 > c && (c = 0),
    d > 1 && (d = 1);
    var e = this.getPoint(c)
      , f = this.getPoint(d)
      , g = f.clone().sub(e);
    return g.normalize()
}
,
THREE.Curve.prototype.getTangentAt = function(a) {
    var b = this.getUtoTmapping(a);
    return this.getTangent(b)
}
,
THREE.Curve.Utils = {
    tangentQuadraticBezier: function(a, b, c, d) {
        return 2 * (1 - a) * (c - b) + 2 * a * (d - c)
    },
    tangentCubicBezier: function(a, b, c, d, e) {
        return -3 * b * (1 - a) * (1 - a) + 3 * c * (1 - a) * (1 - a) - 6 * a * c * (1 - a) + 6 * a * d * (1 - a) - 3 * a * a * d + 3 * a * a * e
    },
    tangentSpline: function(a) {
        var b = 6 * a * a - 6 * a
          , c = 3 * a * a - 4 * a + 1
          , d = -6 * a * a + 6 * a
          , e = 3 * a * a - 2 * a;
        return b + c + d + e
    },
    interpolate: function(a, b, c, d, e) {
        var f = .5 * (c - a)
          , g = .5 * (d - b)
          , h = e * e
          , i = e * h;
        return (2 * b - 2 * c + f + g) * i + (-3 * b + 3 * c - 2 * f - g) * h + f * e + b
    }
},
THREE.Curve.create = function(a, b) {
    return a.prototype = Object.create(THREE.Curve.prototype),
    a.prototype.getPoint = b,
    a
}
,
THREE.CurvePath = function() {
    this.curves = [],
    this.bends = [],
    this.autoClose = !1
}
,
THREE.CurvePath.prototype = Object.create(THREE.Curve.prototype),
THREE.CurvePath.prototype.add = function(a) {
    this.curves.push(a)
}
,
THREE.CurvePath.prototype.checkConnection = function() {}
,
THREE.CurvePath.prototype.closePath = function() {
    var a = this.curves[0].getPoint(0)
      , b = this.curves[this.curves.length - 1].getPoint(1);
    a.equals(b) || this.curves.push(new THREE.LineCurve(b,a))
}
,
THREE.CurvePath.prototype.getPoint = function(a) {
    for (var b, c, d = a * this.getLength(), e = this.getCurveLengths(), f = 0; f < e.length; ) {
        if (e[f] >= d) {
            b = e[f] - d,
            c = this.curves[f];
            var g = 1 - b / c.getLength();
            return c.getPointAt(g)
        }
        f++
    }
    return null
}
,
THREE.CurvePath.prototype.getLength = function() {
    var a = this.getCurveLengths();
    return a[a.length - 1]
}
,
THREE.CurvePath.prototype.getCurveLengths = function() {
    if (this.cacheLengths && this.cacheLengths.length == this.curves.length)
        return this.cacheLengths;
    var a, b = [], c = 0, d = this.curves.length;
    for (a = 0; d > a; a++)
        c += this.curves[a].getLength(),
        b.push(c);
    return this.cacheLengths = b,
    b
}
,
THREE.CurvePath.prototype.getBoundingBox = function() {
    var a, b, c, d, e, f, g = this.getPoints();
    a = b = Number.NEGATIVE_INFINITY,
    d = e = Number.POSITIVE_INFINITY;
    var h, i, j, k, l = g[0]instanceof THREE.Vector3;
    for (k = l ? new THREE.Vector3 : new THREE.Vector2,
    i = 0,
    j = g.length; j > i; i++)
        h = g[i],
        h.x > a ? a = h.x : h.x < d && (d = h.x),
        h.y > b ? b = h.y : h.y < e && (e = h.y),
        l && (h.z > c ? c = h.z : h.z < f && (f = h.z)),
        k.add(h);
    var m = {
        minX: d,
        minY: e,
        maxX: a,
        maxY: b,
        centroid: k.divideScalar(j)
    };
    return l && (m.maxZ = c,
    m.minZ = f),
    m
}
,
THREE.CurvePath.prototype.createPointsGeometry = function(a) {
    var b = this.getPoints(a, !0);
    return this.createGeometry(b)
}
,
THREE.CurvePath.prototype.createSpacedPointsGeometry = function(a) {
    var b = this.getSpacedPoints(a, !0);
    return this.createGeometry(b)
}
,
THREE.CurvePath.prototype.createGeometry = function(a) {
    for (var b = new THREE.Geometry, c = 0; c < a.length; c++)
        b.vertices.push(new THREE.Vector3(a[c].x,a[c].y,a[c].z || 0));
    return b
}
,
THREE.CurvePath.prototype.addWrapPath = function(a) {
    this.bends.push(a)
}
,
THREE.CurvePath.prototype.getTransformedPoints = function(a, b) {
    var c, d, e = this.getPoints(a);
    for (b || (b = this.bends),
    c = 0,
    d = b.length; d > c; c++)
        e = this.getWrapPoints(e, b[c]);
    return e
}
,
THREE.CurvePath.prototype.getTransformedSpacedPoints = function(a, b) {
    var c, d, e = this.getSpacedPoints(a);
    for (b || (b = this.bends),
    c = 0,
    d = b.length; d > c; c++)
        e = this.getWrapPoints(e, b[c]);
    return e
}
,
THREE.CurvePath.prototype.getWrapPoints = function(a, b) {
    var c, d, e, f, g, h, i = this.getBoundingBox();
    for (c = 0,
    d = a.length; d > c; c++) {
        e = a[c],
        f = e.x,
        g = e.y,
        h = f / i.maxX,
        h = b.getUtoTmapping(h, f);
        var j = b.getPoint(h)
          , k = b.getTangent(h);
        k.set(-k.y, k.x).multiplyScalar(g),
        e.x = j.x + k.x,
        e.y = j.y + k.y
    }
    return a
}
,
THREE.Gyroscope = function() {
    THREE.Object3D.call(this)
}
,
THREE.Gyroscope.prototype = Object.create(THREE.Object3D.prototype),
THREE.Gyroscope.prototype.updateMatrixWorld = function(a) {
    this.matrixAutoUpdate && this.updateMatrix(),
    (this.matrixWorldNeedsUpdate || a) && (this.parent ? (this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix),
    this.matrixWorld.decompose(this.translationWorld, this.quaternionWorld, this.scaleWorld),
    this.matrix.decompose(this.translationObject, this.quaternionObject, this.scaleObject),
    this.matrixWorld.compose(this.translationWorld, this.quaternionObject, this.scaleWorld)) : this.matrixWorld.copy(this.matrix),
    this.matrixWorldNeedsUpdate = !1,
    a = !0);
    for (var b = 0, c = this.children.length; c > b; b++)
        this.children[b].updateMatrixWorld(a)
}
,
THREE.Gyroscope.prototype.translationWorld = new THREE.Vector3,
THREE.Gyroscope.prototype.translationObject = new THREE.Vector3,
THREE.Gyroscope.prototype.quaternionWorld = new THREE.Quaternion,
THREE.Gyroscope.prototype.quaternionObject = new THREE.Quaternion,
THREE.Gyroscope.prototype.scaleWorld = new THREE.Vector3,
THREE.Gyroscope.prototype.scaleObject = new THREE.Vector3,
THREE.Path = function(a) {
    THREE.CurvePath.call(this),
    this.actions = [],
    a && this.fromPoints(a)
}
,
THREE.Path.prototype = Object.create(THREE.CurvePath.prototype),
THREE.PathActions = {
    MOVE_TO: "moveTo",
    LINE_TO: "lineTo",
    QUADRATIC_CURVE_TO: "quadraticCurveTo",
    BEZIER_CURVE_TO: "bezierCurveTo",
    CSPLINE_THRU: "splineThru",
    ARC: "arc",
    ELLIPSE: "ellipse"
},
THREE.Path.prototype.fromPoints = function(a) {
    this.moveTo(a[0].x, a[0].y);
    for (var b = 1, c = a.length; c > b; b++)
        this.lineTo(a[b].x, a[b].y)
}
,
THREE.Path.prototype.moveTo = function() {
    var a = Array.prototype.slice.call(arguments);
    this.actions.push({
        action: THREE.PathActions.MOVE_TO,
        args: a
    })
}
,
THREE.Path.prototype.lineTo = function(a, b) {
    var c = Array.prototype.slice.call(arguments)
      , d = this.actions[this.actions.length - 1].args
      , e = d[d.length - 2]
      , f = d[d.length - 1]
      , g = new THREE.LineCurve(new THREE.Vector2(e,f),new THREE.Vector2(a,b));
    this.curves.push(g),
    this.actions.push({
        action: THREE.PathActions.LINE_TO,
        args: c
    })
}
,
THREE.Path.prototype.quadraticCurveTo = function(a, b, c, d) {
    var e = Array.prototype.slice.call(arguments)
      , f = this.actions[this.actions.length - 1].args
      , g = f[f.length - 2]
      , h = f[f.length - 1]
      , i = new THREE.QuadraticBezierCurve(new THREE.Vector2(g,h),new THREE.Vector2(a,b),new THREE.Vector2(c,d));
    this.curves.push(i),
    this.actions.push({
        action: THREE.PathActions.QUADRATIC_CURVE_TO,
        args: e
    })
}
,
THREE.Path.prototype.bezierCurveTo = function(a, b, c, d, e, f) {
    var g = Array.prototype.slice.call(arguments)
      , h = this.actions[this.actions.length - 1].args
      , i = h[h.length - 2]
      , j = h[h.length - 1]
      , k = new THREE.CubicBezierCurve(new THREE.Vector2(i,j),new THREE.Vector2(a,b),new THREE.Vector2(c,d),new THREE.Vector2(e,f));
    this.curves.push(k),
    this.actions.push({
        action: THREE.PathActions.BEZIER_CURVE_TO,
        args: g
    })
}
,
THREE.Path.prototype.splineThru = function(a) {
    var b = Array.prototype.slice.call(arguments)
      , c = this.actions[this.actions.length - 1].args
      , d = c[c.length - 2]
      , e = c[c.length - 1]
      , f = [new THREE.Vector2(d,e)];
    Array.prototype.push.apply(f, a);
    var g = new THREE.SplineCurve(f);
    this.curves.push(g),
    this.actions.push({
        action: THREE.PathActions.CSPLINE_THRU,
        args: b
    })
}
,
THREE.Path.prototype.arc = function(a, b, c, d, e, f) {
    var g = this.actions[this.actions.length - 1].args
      , h = g[g.length - 2]
      , i = g[g.length - 1];
    this.absarc(a + h, b + i, c, d, e, f)
}
,
THREE.Path.prototype.absarc = function(a, b, c, d, e, f) {
    this.absellipse(a, b, c, c, d, e, f)
}
,
THREE.Path.prototype.ellipse = function(a, b, c, d, e, f, g) {
    var h = this.actions[this.actions.length - 1].args
      , i = h[h.length - 2]
      , j = h[h.length - 1];
    this.absellipse(a + i, b + j, c, d, e, f, g)
}
,
THREE.Path.prototype.absellipse = function(a, b, c, d, e, f, g) {
    var h = Array.prototype.slice.call(arguments)
      , i = new THREE.EllipseCurve(a,b,c,d,e,f,g);
    this.curves.push(i);
    var j = i.getPoint(1);
    h.push(j.x),
    h.push(j.y),
    this.actions.push({
        action: THREE.PathActions.ELLIPSE,
        args: h
    })
}
,
THREE.Path.prototype.getSpacedPoints = function(a) {
    a || (a = 40);
    for (var b = [], c = 0; a > c; c++)
        b.push(this.getPoint(c / a));
    return b
}
,
THREE.Path.prototype.getPoints = function(a, b) {
    if (this.useSpacedPoints)
        return console.log("tata"),
        this.getSpacedPoints(a, b);
    a = a || 12;
    var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u = [];
    for (c = 0,
    d = this.actions.length; d > c; c++)
        switch (e = this.actions[c],
        f = e.action,
        g = e.args,
        f) {
        case THREE.PathActions.MOVE_TO:
            u.push(new THREE.Vector2(g[0],g[1]));
            break;
        case THREE.PathActions.LINE_TO:
            u.push(new THREE.Vector2(g[0],g[1]));
            break;
        case THREE.PathActions.QUADRATIC_CURVE_TO:
            for (h = g[2],
            i = g[3],
            l = g[0],
            m = g[1],
            u.length > 0 ? (p = u[u.length - 1],
            n = p.x,
            o = p.y) : (p = this.actions[c - 1].args,
            n = p[p.length - 2],
            o = p[p.length - 1]),
            q = 1; a >= q; q++)
                r = q / a,
                s = THREE.Shape.Utils.b2(r, n, l, h),
                t = THREE.Shape.Utils.b2(r, o, m, i),
                u.push(new THREE.Vector2(s,t));
            break;
        case THREE.PathActions.BEZIER_CURVE_TO:
            for (h = g[4],
            i = g[5],
            l = g[0],
            m = g[1],
            j = g[2],
            k = g[3],
            u.length > 0 ? (p = u[u.length - 1],
            n = p.x,
            o = p.y) : (p = this.actions[c - 1].args,
            n = p[p.length - 2],
            o = p[p.length - 1]),
            q = 1; a >= q; q++)
                r = q / a,
                s = THREE.Shape.Utils.b3(r, n, l, j, h),
                t = THREE.Shape.Utils.b3(r, o, m, k, i),
                u.push(new THREE.Vector2(s,t));
            break;
        case THREE.PathActions.CSPLINE_THRU:
            p = this.actions[c - 1].args;
            var v = new THREE.Vector2(p[p.length - 2],p[p.length - 1])
              , w = [v]
              , x = a * g[0].length;
            w = w.concat(g[0]);
            var y = new THREE.SplineCurve(w);
            for (q = 1; x >= q; q++)
                u.push(y.getPointAt(q / x));
            break;
        case THREE.PathActions.ARC:
            var z, A = g[0], B = g[1], C = g[2], D = g[3], E = g[4], F = !!g[5], G = E - D, H = 2 * a;
            for (q = 1; H >= q; q++)
                r = q / H,
                F || (r = 1 - r),
                z = D + r * G,
                s = A + C * Math.cos(z),
                t = B + C * Math.sin(z),
                u.push(new THREE.Vector2(s,t));
            break;
        case THREE.PathActions.ELLIPSE:
            var z, A = g[0], B = g[1], I = g[2], J = g[3], D = g[4], E = g[5], F = !!g[6], G = E - D, H = 2 * a;
            for (q = 1; H >= q; q++)
                r = q / H,
                F || (r = 1 - r),
                z = D + r * G,
                s = A + I * Math.cos(z),
                t = B + J * Math.sin(z),
                u.push(new THREE.Vector2(s,t))
        }
    var K = u[u.length - 1]
      , L = 1e-10;
    return Math.abs(K.x - u[0].x) < L && Math.abs(K.y - u[0].y) < L && u.splice(u.length - 1, 1),
    b && u.push(u[0]),
    u
}
,
THREE.Path.prototype.toShapes = function(a) {
    function b(a, b) {
        for (var c = 1e-10, d = b.length, e = !1, f = d - 1, g = 0; d > g; f = g++) {
            var h = b[f]
              , i = b[g]
              , j = i.x - h.x
              , k = i.y - h.y;
            if (Math.abs(k) > c) {
                if (0 > k && (h = b[g],
                j = -j,
                i = b[f],
                k = -k),
                a.y < h.y || a.y > i.y)
                    continue;
                if (a.y == h.y) {
                    if (a.x == h.x)
                        return !0
                } else {
                    var l = k * (a.x - h.x) - j * (a.y - h.y);
                    if (0 == l)
                        return !0;
                    if (0 > l)
                        continue;
                    e = !e
                }
            } else {
                if (a.y != h.y)
                    continue;
                if (i.x <= a.x && a.x <= h.x || h.x <= a.x && a.x <= i.x)
                    return !0
            }
        }
        return e
    }
    var c, d, e, f, g, h = [], i = new THREE.Path;
    for (c = 0,
    d = this.actions.length; d > c; c++)
        e = this.actions[c],
        g = e.args,
        f = e.action,
        f == THREE.PathActions.MOVE_TO && 0 != i.actions.length && (h.push(i),
        i = new THREE.Path),
        i[f].apply(i, g);
    if (0 != i.actions.length && h.push(i),
    0 == h.length)
        return [];
    var j, k, l, m = [];
    if (1 == h.length)
        return k = h[0],
        l = new THREE.Shape,
        l.actions = k.actions,
        l.curves = k.curves,
        m.push(l),
        m;
    var n = !THREE.Shape.Utils.isClockWise(h[0].getPoints());
    n = a ? !n : n;
    var o, p = [], q = [], r = [], s = 0;
    for (q[s] = void 0,
    r[s] = [],
    c = 0,
    d = h.length; d > c; c++)
        k = h[c],
        o = k.getPoints(),
        j = THREE.Shape.Utils.isClockWise(o),
        j = a ? !j : j,
        j ? (!n && q[s] && s++,
        q[s] = {
            s: new THREE.Shape,
            p: o
        },
        q[s].s.actions = k.actions,
        q[s].s.curves = k.curves,
        n && s++,
        r[s] = []) : r[s].push({
            h: k,
            p: o[0]
        });
    if (q.length > 1) {
        for (var t = !1, u = [], v = 0, w = q.length; w > v; v++)
            p[v] = [];
        for (var v = 0, w = q.length; w > v; v++)
            for (var x = (q[v],
            r[v]), y = 0; y < x.length; y++) {
                for (var z = x[y], A = !0, B = 0; B < q.length; B++)
                    b(z.p, q[B].p) && (v != B && u.push({
                        froms: v,
                        tos: B,
                        hole: y
                    }),
                    A ? (A = !1,
                    p[B].push(z)) : t = !0);
                A && p[v].push(z)
            }
        u.length > 0 && (t || (r = p))
    }
    var C, D, E;
    for (c = 0,
    d = q.length; d > c; c++)
        for (l = q[c].s,
        m.push(l),
        C = r[c],
        D = 0,
        E = C.length; E > D; D++)
            l.holes.push(C[D].h);
    return m
}
,
THREE.Shape = function() {
    THREE.Path.apply(this, arguments),
    this.holes = []
}
,
THREE.Shape.prototype = Object.create(THREE.Path.prototype),
THREE.Shape.prototype.extrude = function(a) {
    var b = new THREE.ExtrudeGeometry(this,a);
    return b
}
,
THREE.Shape.prototype.makeGeometry = function(a) {
    var b = new THREE.ShapeGeometry(this,a);
    return b
}
,
THREE.Shape.prototype.getPointsHoles = function(a) {
    var b, c = this.holes.length, d = [];
    for (b = 0; c > b; b++)
        d[b] = this.holes[b].getTransformedPoints(a, this.bends);
    return d
}
,
THREE.Shape.prototype.getSpacedPointsHoles = function(a) {
    var b, c = this.holes.length, d = [];
    for (b = 0; c > b; b++)
        d[b] = this.holes[b].getTransformedSpacedPoints(a, this.bends);
    return d
}
,
THREE.Shape.prototype.extractAllPoints = function(a) {
    return {
        shape: this.getTransformedPoints(a),
        holes: this.getPointsHoles(a)
    }
}
,
THREE.Shape.prototype.extractPoints = function(a) {
    return this.useSpacedPoints ? this.extractAllSpacedPoints(a) : this.extractAllPoints(a)
}
,
THREE.Shape.prototype.extractAllSpacedPoints = function(a) {
    return {
        shape: this.getTransformedSpacedPoints(a),
        holes: this.getSpacedPointsHoles(a)
    }
}
,
THREE.Shape.Utils = {
    triangulateShape: function(a, b) {
        function c(a, b, c) {
            return a.x != b.x ? a.x < b.x ? a.x <= c.x && c.x <= b.x : b.x <= c.x && c.x <= a.x : a.y < b.y ? a.y <= c.y && c.y <= b.y : b.y <= c.y && c.y <= a.y
        }
        function d(a, b, d, e, f) {
            var g = 1e-10
              , h = b.x - a.x
              , i = b.y - a.y
              , j = e.x - d.x
              , k = e.y - d.y
              , l = a.x - d.x
              , m = a.y - d.y
              , n = i * j - h * k
              , o = i * l - h * m;
            if (Math.abs(n) > g) {
                var p;
                if (n > 0) {
                    if (0 > o || o > n)
                        return [];
                    if (p = k * l - j * m,
                    0 > p || p > n)
                        return []
                } else {
                    if (o > 0 || n > o)
                        return [];
                    if (p = k * l - j * m,
                    p > 0 || n > p)
                        return []
                }
                if (0 == p)
                    return !f || 0 != o && o != n ? [a] : [];
                if (p == n)
                    return !f || 0 != o && o != n ? [b] : [];
                if (0 == o)
                    return [d];
                if (o == n)
                    return [e];
                var q = p / n;
                return [{
                    x: a.x + q * h,
                    y: a.y + q * i
                }]
            }
            if (0 != o || k * l != j * m)
                return [];
            var r = 0 == h && 0 == i
              , s = 0 == j && 0 == k;
            if (r && s)
                return a.x != d.x || a.y != d.y ? [] : [a];
            if (r)
                return c(d, e, a) ? [a] : [];
            if (s)
                return c(a, b, d) ? [d] : [];
            var t, u, v, w, x, y, z, A;
            return 0 != h ? (a.x < b.x ? (t = a,
            v = a.x,
            u = b,
            w = b.x) : (t = b,
            v = b.x,
            u = a,
            w = a.x),
            d.x < e.x ? (x = d,
            z = d.x,
            y = e,
            A = e.x) : (x = e,
            z = e.x,
            y = d,
            A = d.x)) : (a.y < b.y ? (t = a,
            v = a.y,
            u = b,
            w = b.y) : (t = b,
            v = b.y,
            u = a,
            w = a.y),
            d.y < e.y ? (x = d,
            z = d.y,
            y = e,
            A = e.y) : (x = e,
            z = e.y,
            y = d,
            A = d.y)),
            z >= v ? z > w ? [] : w == z ? f ? [] : [x] : A >= w ? [x, u] : [x, y] : v > A ? [] : v == A ? f ? [] : [t] : A >= w ? [t, u] : [t, y]
        }
        function e(a, b, c, d) {
            var e = 1e-10
              , f = b.x - a.x
              , g = b.y - a.y
              , h = c.x - a.x
              , i = c.y - a.y
              , j = d.x - a.x
              , k = d.y - a.y
              , l = f * i - g * h
              , m = f * k - g * j;
            if (Math.abs(l) > e) {
                var n = j * i - k * h;
                return l > 0 ? m >= 0 && n >= 0 : m >= 0 || n >= 0
            }
            return m > 0
        }
        function f(a, b) {
            function c(a, b) {
                var c = s.length - 1
                  , d = a - 1;
                0 > d && (d = c);
                var f = a + 1;
                f > c && (f = 0);
                var g = e(s[a], s[d], s[f], h[b]);
                if (!g)
                    return !1;
                var i = h.length - 1
                  , j = b - 1;
                0 > j && (j = i);
                var k = b + 1;
                return k > i && (k = 0),
                g = e(h[b], h[j], h[k], s[a]),
                g ? !0 : !1
            }
            function f(a, b) {
                var c, e, f;
                for (c = 0; c < s.length; c++)
                    if (e = c + 1,
                    e %= s.length,
                    f = d(a, b, s[c], s[e], !0),
                    f.length > 0)
                        return !0;
                return !1
            }
            function g(a, c) {
                var e, f, g, h, i;
                for (e = 0; e < t.length; e++)
                    for (f = b[t[e]],
                    g = 0; g < f.length; g++)
                        if (h = g + 1,
                        h %= f.length,
                        i = d(a, c, f[g], f[h], !0),
                        i.length > 0)
                            return !0;
                return !1
            }
            for (var h, i, j, k, l, m, n, o, p, q, r, s = a.concat(), t = [], u = [], v = 0, w = b.length; w > v; v++)
                t.push(v);
            for (var x = 2 * t.length; t.length > 0; ) {
                if (x--,
                0 > x) {
                    console.log("Infinite Loop! Holes left:" + t.length + ", Probably Hole outside Shape!");
                    break
                }
                for (j = 0; j < s.length; j++) {
                    k = s[j],
                    i = -1;
                    for (var v = 0; v < t.length; v++)
                        if (m = t[v],
                        n = k.x + ":" + k.y + ":" + m,
                        void 0 === u[n]) {
                            h = b[m];
                            for (var y = 0; y < h.length; y++)
                                if (l = h[y],
                                c(j, y) && !f(k, l) && !g(k, l)) {
                                    i = y,
                                    t.splice(v, 1),
                                    o = s.slice(0, j + 1),
                                    p = s.slice(j),
                                    q = h.slice(i),
                                    r = h.slice(0, i + 1),
                                    s = o.concat(q).concat(r).concat(p);
                                    break
                                }
                            if (i >= 0)
                                break;
                            u[n] = !0
                        }
                    if (i >= 0)
                        break
                }
            }
            return s
        }
        for (var g, h, i, j, k, l, m = {}, n = a.concat(), o = 0, p = b.length; p > o; o++)
            Array.prototype.push.apply(n, b[o]);
        for (g = 0,
        h = n.length; h > g; g++)
            k = n[g].x + ":" + n[g].y,
            void 0 !== m[k] && console.log("Duplicate point", k),
            m[k] = g;
        var q = f(a, b)
          , r = THREE.FontUtils.Triangulate(q, !1);
        for (g = 0,
        h = r.length; h > g; g++)
            for (j = r[g],
            i = 0; 3 > i; i++)
                k = j[i].x + ":" + j[i].y,
                l = m[k],
                void 0 !== l && (j[i] = l);
        return r.concat()
    },
    isClockWise: function(a) {
        return THREE.FontUtils.Triangulate.area(a) < 0
    },
    b2p0: function(a, b) {
        var c = 1 - a;
        return c * c * b
    },
    b2p1: function(a, b) {
        return 2 * (1 - a) * a * b
    },
    b2p2: function(a, b) {
        return a * a * b
    },
    b2: function(a, b, c, d) {
        return this.b2p0(a, b) + this.b2p1(a, c) + this.b2p2(a, d)
    },
    b3p0: function(a, b) {
        var c = 1 - a;
        return c * c * c * b
    },
    b3p1: function(a, b) {
        var c = 1 - a;
        return 3 * c * c * a * b
    },
    b3p2: function(a, b) {
        var c = 1 - a;
        return 3 * c * a * a * b
    },
    b3p3: function(a, b) {
        return a * a * a * b
    },
    b3: function(a, b, c, d, e) {
        return this.b3p0(a, b) + this.b3p1(a, c) + this.b3p2(a, d) + this.b3p3(a, e)
    }
},
THREE.LineCurve = function(a, b) {
    this.v1 = a,
    this.v2 = b
}
,
THREE.LineCurve.prototype = Object.create(THREE.Curve.prototype),
THREE.LineCurve.prototype.getPoint = function(a) {
    var b = this.v2.clone().sub(this.v1);
    return b.multiplyScalar(a).add(this.v1),
    b
}
,
THREE.LineCurve.prototype.getPointAt = function(a) {
    return this.getPoint(a)
}
,
THREE.LineCurve.prototype.getTangent = function() {
    var a = this.v2.clone().sub(this.v1);
    return a.normalize()
}
,
THREE.QuadraticBezierCurve = function(a, b, c) {
    this.v0 = a,
    this.v1 = b,
    this.v2 = c
}
,
THREE.QuadraticBezierCurve.prototype = Object.create(THREE.Curve.prototype),
THREE.QuadraticBezierCurve.prototype.getPoint = function(a) {
    var b, c;
    return b = THREE.Shape.Utils.b2(a, this.v0.x, this.v1.x, this.v2.x),
    c = THREE.Shape.Utils.b2(a, this.v0.y, this.v1.y, this.v2.y),
    new THREE.Vector2(b,c)
}
,
THREE.QuadraticBezierCurve.prototype.getTangent = function(a) {
    var b, c;
    b = THREE.Curve.Utils.tangentQuadraticBezier(a, this.v0.x, this.v1.x, this.v2.x),
    c = THREE.Curve.Utils.tangentQuadraticBezier(a, this.v0.y, this.v1.y, this.v2.y);
    var d = new THREE.Vector2(b,c);
    return d.normalize(),
    d
}
,
THREE.CubicBezierCurve = function(a, b, c, d) {
    this.v0 = a,
    this.v1 = b,
    this.v2 = c,
    this.v3 = d
}
,
THREE.CubicBezierCurve.prototype = Object.create(THREE.Curve.prototype),
THREE.CubicBezierCurve.prototype.getPoint = function(a) {
    var b, c;
    return b = THREE.Shape.Utils.b3(a, this.v0.x, this.v1.x, this.v2.x, this.v3.x),
    c = THREE.Shape.Utils.b3(a, this.v0.y, this.v1.y, this.v2.y, this.v3.y),
    new THREE.Vector2(b,c)
}
,
THREE.CubicBezierCurve.prototype.getTangent = function(a) {
    var b, c;
    b = THREE.Curve.Utils.tangentCubicBezier(a, this.v0.x, this.v1.x, this.v2.x, this.v3.x),
    c = THREE.Curve.Utils.tangentCubicBezier(a, this.v0.y, this.v1.y, this.v2.y, this.v3.y);
    var d = new THREE.Vector2(b,c);
    return d.normalize(),
    d
}
,
THREE.SplineCurve = function(a) {
    this.points = void 0 == a ? [] : a
}
,
THREE.SplineCurve.prototype = Object.create(THREE.Curve.prototype),
THREE.SplineCurve.prototype.getPoint = function(a) {
    var b, c, d, e = new THREE.Vector2, f = [], g = this.points;
    return b = (g.length - 1) * a,
    c = Math.floor(b),
    d = b - c,
    f[0] = 0 == c ? c : c - 1,
    f[1] = c,
    f[2] = c > g.length - 2 ? g.length - 1 : c + 1,
    f[3] = c > g.length - 3 ? g.length - 1 : c + 2,
    e.x = THREE.Curve.Utils.interpolate(g[f[0]].x, g[f[1]].x, g[f[2]].x, g[f[3]].x, d),
    e.y = THREE.Curve.Utils.interpolate(g[f[0]].y, g[f[1]].y, g[f[2]].y, g[f[3]].y, d),
    e
}
,
THREE.EllipseCurve = function(a, b, c, d, e, f, g) {
    this.aX = a,
    this.aY = b,
    this.xRadius = c,
    this.yRadius = d,
    this.aStartAngle = e,
    this.aEndAngle = f,
    this.aClockwise = g
}
,
THREE.EllipseCurve.prototype = Object.create(THREE.Curve.prototype),
THREE.EllipseCurve.prototype.getPoint = function(a) {
    var b, c = this.aEndAngle - this.aStartAngle;
    0 > c && (c += 2 * Math.PI),
    c > 2 * Math.PI && (c -= 2 * Math.PI),
    b = this.aClockwise === !0 ? this.aEndAngle + (1 - a) * (2 * Math.PI - c) : this.aStartAngle + a * c;
    var d = this.aX + this.xRadius * Math.cos(b)
      , e = this.aY + this.yRadius * Math.sin(b);
    return new THREE.Vector2(d,e)
}
,
THREE.ArcCurve = function(a, b, c, d, e, f) {
    THREE.EllipseCurve.call(this, a, b, c, c, d, e, f)
}
,
THREE.ArcCurve.prototype = Object.create(THREE.EllipseCurve.prototype),
THREE.LineCurve3 = THREE.Curve.create(function(a, b) {
    this.v1 = a,
    this.v2 = b
}, function(a) {
    var b = new THREE.Vector3;
    return b.subVectors(this.v2, this.v1),
    b.multiplyScalar(a),
    b.add(this.v1),
    b
}),
THREE.QuadraticBezierCurve3 = THREE.Curve.create(function(a, b, c) {
    this.v0 = a,
    this.v1 = b,
    this.v2 = c
}, function(a) {
    var b, c, d;
    return b = THREE.Shape.Utils.b2(a, this.v0.x, this.v1.x, this.v2.x),
    c = THREE.Shape.Utils.b2(a, this.v0.y, this.v1.y, this.v2.y),
    d = THREE.Shape.Utils.b2(a, this.v0.z, this.v1.z, this.v2.z),
    new THREE.Vector3(b,c,d)
}),
THREE.CubicBezierCurve3 = THREE.Curve.create(function(a, b, c, d) {
    this.v0 = a,
    this.v1 = b,
    this.v2 = c,
    this.v3 = d
}, function(a) {
    var b, c, d;
    return b = THREE.Shape.Utils.b3(a, this.v0.x, this.v1.x, this.v2.x, this.v3.x),
    c = THREE.Shape.Utils.b3(a, this.v0.y, this.v1.y, this.v2.y, this.v3.y),
    d = THREE.Shape.Utils.b3(a, this.v0.z, this.v1.z, this.v2.z, this.v3.z),
    new THREE.Vector3(b,c,d)
}),
THREE.SplineCurve3 = THREE.Curve.create(function(a) {
    this.points = void 0 == a ? [] : a
}, function(a) {
    var b, c, d, e = new THREE.Vector3, f = [], g = this.points;
    b = (g.length - 1) * a,
    c = Math.floor(b),
    d = b - c,
    f[0] = 0 == c ? c : c - 1,
    f[1] = c,
    f[2] = c > g.length - 2 ? g.length - 1 : c + 1,
    f[3] = c > g.length - 3 ? g.length - 1 : c + 2;
    var h = g[f[0]]
      , i = g[f[1]]
      , j = g[f[2]]
      , k = g[f[3]];
    return e.x = THREE.Curve.Utils.interpolate(h.x, i.x, j.x, k.x, d),
    e.y = THREE.Curve.Utils.interpolate(h.y, i.y, j.y, k.y, d),
    e.z = THREE.Curve.Utils.interpolate(h.z, i.z, j.z, k.z, d),
    e
}),
THREE.ClosedSplineCurve3 = THREE.Curve.create(function(a) {
    this.points = void 0 == a ? [] : a
}, function(a) {
    var b, c, d, e = new THREE.Vector3, f = [], g = this.points;
    return b = (g.length - 0) * a,
    c = Math.floor(b),
    d = b - c,
    c += c > 0 ? 0 : (Math.floor(Math.abs(c) / g.length) + 1) * g.length,
    f[0] = (c - 1) % g.length,
    f[1] = c % g.length,
    f[2] = (c + 1) % g.length,
    f[3] = (c + 2) % g.length,
    e.x = THREE.Curve.Utils.interpolate(g[f[0]].x, g[f[1]].x, g[f[2]].x, g[f[3]].x, d),
    e.y = THREE.Curve.Utils.interpolate(g[f[0]].y, g[f[1]].y, g[f[2]].y, g[f[3]].y, d),
    e.z = THREE.Curve.Utils.interpolate(g[f[0]].z, g[f[1]].z, g[f[2]].z, g[f[3]].z, d),
    e
}),
THREE.AnimationHandler = function() {
    var a = []
      , b = {}
      , c = {};
    c.update = function(b) {
        for (var c = 0; c < a.length; c++)
            a[c].update(b)
    }
    ,
    c.addToUpdate = function(b) {
        -1 === a.indexOf(b) && a.push(b)
    }
    ,
    c.removeFromUpdate = function(b) {
        var c = a.indexOf(b);
        -1 !== c && a.splice(c, 1)
    }
    ,
    c.add = function(a) {
        void 0 !== b[a.name] && console.log("THREE.AnimationHandler.add: Warning! " + a.name + " already exists in library. Overwriting."),
        b[a.name] = a,
        e(a)
    }
    ,
    c.get = function(a) {
        return "string" == typeof a ? b[a] ? b[a] : (console.log("THREE.AnimationHandler.get: Couldn't find animation " + a),
        null) : void 0
    }
    ,
    c.parse = function(a) {
        var b = [];
        if (a instanceof THREE.SkinnedMesh)
            for (var c = 0; c < a.bones.length; c++)
                b.push(a.bones[c]);
        else
            d(a, b);
        return b
    }
    ;
    var d = function(a, b) {
        b.push(a);
        for (var c = 0; c < a.children.length; c++)
            d(a.children[c], b)
    }
      , e = function(a) {
        if (a.initialized !== !0) {
            for (var b = 0; b < a.hierarchy.length; b++) {
                for (var c = 0; c < a.hierarchy[b].keys.length; c++)
                    if (a.hierarchy[b].keys[c].time < 0 && (a.hierarchy[b].keys[c].time = 0),
                    void 0 !== a.hierarchy[b].keys[c].rot && !(a.hierarchy[b].keys[c].rot instanceof THREE.Quaternion)) {
                        var d = a.hierarchy[b].keys[c].rot;
                        a.hierarchy[b].keys[c].rot = new THREE.Quaternion(d[0],d[1],d[2],d[3])
                    }
                if (a.hierarchy[b].keys.length && void 0 !== a.hierarchy[b].keys[0].morphTargets) {
                    for (var e = {}, c = 0; c < a.hierarchy[b].keys.length; c++)
                        for (var f = 0; f < a.hierarchy[b].keys[c].morphTargets.length; f++) {
                            var g = a.hierarchy[b].keys[c].morphTargets[f];
                            e[g] = -1
                        }
                    a.hierarchy[b].usedMorphTargets = e;
                    for (var c = 0; c < a.hierarchy[b].keys.length; c++) {
                        var h = {};
                        for (var g in e) {
                            for (var f = 0; f < a.hierarchy[b].keys[c].morphTargets.length; f++)
                                if (a.hierarchy[b].keys[c].morphTargets[f] === g) {
                                    h[g] = a.hierarchy[b].keys[c].morphTargetsInfluences[f];
                                    break
                                }
                            f === a.hierarchy[b].keys[c].morphTargets.length && (h[g] = 0)
                        }
                        a.hierarchy[b].keys[c].morphTargetsInfluences = h
                    }
                }
                for (var c = 1; c < a.hierarchy[b].keys.length; c++)
                    a.hierarchy[b].keys[c].time === a.hierarchy[b].keys[c - 1].time && (a.hierarchy[b].keys.splice(c, 1),
                    c--);
                for (var c = 0; c < a.hierarchy[b].keys.length; c++)
                    a.hierarchy[b].keys[c].index = c
            }
            a.initialized = !0
        }
    };
    return c.LINEAR = 0,
    c.CATMULLROM = 1,
    c.CATMULLROM_FORWARD = 2,
    c
}(),
THREE.Animation = function(a, b) {
    this.root = a,
    this.data = THREE.AnimationHandler.get(b),
    this.hierarchy = THREE.AnimationHandler.parse(a),
    this.currentTime = 0,
    this.timeScale = 1,
    this.isPlaying = !1,
    this.isPaused = !0,
    this.loop = !0,
    this.interpolationType = THREE.AnimationHandler.LINEAR
}
,
THREE.Animation.prototype.play = function(a) {
    this.currentTime = void 0 !== a ? a : 0,
    this.isPlaying === !1 && (this.isPlaying = !0,
    this.reset(),
    this.update(0)),
    this.isPaused = !1,
    THREE.AnimationHandler.addToUpdate(this)
}
,
THREE.Animation.prototype.pause = function() {
    this.isPaused === !0 ? THREE.AnimationHandler.addToUpdate(this) : THREE.AnimationHandler.removeFromUpdate(this),
    this.isPaused = !this.isPaused
}
,
THREE.Animation.prototype.stop = function() {
    this.isPlaying = !1,
    this.isPaused = !1,
    THREE.AnimationHandler.removeFromUpdate(this)
}
,
THREE.Animation.prototype.reset = function() {
    for (var a = 0, b = this.hierarchy.length; b > a; a++) {
        var c = this.hierarchy[a];
        c.matrixAutoUpdate = !0,
        void 0 === c.animationCache && (c.animationCache = {},
        c.animationCache.prevKey = {
            pos: 0,
            rot: 0,
            scl: 0
        },
        c.animationCache.nextKey = {
            pos: 0,
            rot: 0,
            scl: 0
        },
        c.animationCache.originalMatrix = c instanceof THREE.Bone ? c.skinMatrix : c.matrix);
        var d = c.animationCache.prevKey
          , e = c.animationCache.nextKey;
        d.pos = this.data.hierarchy[a].keys[0],
        d.rot = this.data.hierarchy[a].keys[0],
        d.scl = this.data.hierarchy[a].keys[0],
        e.pos = this.getNextKeyWith("pos", a, 1),
        e.rot = this.getNextKeyWith("rot", a, 1),
        e.scl = this.getNextKeyWith("scl", a, 1)
    }
}
,
THREE.Animation.prototype.update = function() {
    var a = []
      , b = new THREE.Vector3
      , c = function(a, b) {
        var c, e, f, g, h, i, j, k, l, m = [], n = [];
        return c = (a.length - 1) * b,
        e = Math.floor(c),
        f = c - e,
        m[0] = 0 === e ? e : e - 1,
        m[1] = e,
        m[2] = e > a.length - 2 ? e : e + 1,
        m[3] = e > a.length - 3 ? e : e + 2,
        i = a[m[0]],
        j = a[m[1]],
        k = a[m[2]],
        l = a[m[3]],
        g = f * f,
        h = f * g,
        n[0] = d(i[0], j[0], k[0], l[0], f, g, h),
        n[1] = d(i[1], j[1], k[1], l[1], f, g, h),
        n[2] = d(i[2], j[2], k[2], l[2], f, g, h),
        n
    }
      , d = function(a, b, c, d, e, f, g) {
        var h = .5 * (c - a)
          , i = .5 * (d - b);
        return (2 * (b - c) + h + i) * g + (-3 * (b - c) - 2 * h - i) * f + h * e + b
    };
    return function(d) {
        if (this.isPlaying !== !1) {
            this.currentTime += d * this.timeScale;
            var e, f = ["pos", "rot", "scl"], g = this.data.length;
            if (this.loop === !0 && this.currentTime > g)
                this.currentTime %= g,
                this.reset();
            else if (this.loop === !1 && this.currentTime > g)
                return this.stop(),
                void 0;
            this.currentTime = Math.min(this.currentTime, g);
            for (var h = 0, i = this.hierarchy.length; i > h; h++)
                for (var j = this.hierarchy[h], k = j.animationCache, l = 0; 3 > l; l++) {
                    var m = f[l]
                      , n = k.prevKey[m]
                      , o = k.nextKey[m];
                    if (o.time <= this.currentTime) {
                        for (n = this.data.hierarchy[h].keys[0],
                        o = this.getNextKeyWith(m, h, 1); o.time < this.currentTime && o.index > n.index; )
                            n = o,
                            o = this.getNextKeyWith(m, h, o.index + 1);
                        k.prevKey[m] = n,
                        k.nextKey[m] = o
                    }
                    j.matrixAutoUpdate = !0,
                    j.matrixWorldNeedsUpdate = !0;
                    var p = (this.currentTime - n.time) / (o.time - n.time)
                      , q = n[m]
                      , r = o[m];
                    if (0 > p && (p = 0),
                    p > 1 && (p = 1),
                    "pos" === m) {
                        if (e = j.position,
                        this.interpolationType === THREE.AnimationHandler.LINEAR)
                            e.x = q[0] + (r[0] - q[0]) * p,
                            e.y = q[1] + (r[1] - q[1]) * p,
                            e.z = q[2] + (r[2] - q[2]) * p;
                        else if (this.interpolationType === THREE.AnimationHandler.CATMULLROM || this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {
                            a[0] = this.getPrevKeyWith("pos", h, n.index - 1).pos,
                            a[1] = q,
                            a[2] = r,
                            a[3] = this.getNextKeyWith("pos", h, o.index + 1).pos,
                            p = .33 * p + .33;
                            var s = c(a, p);
                            if (e.x = s[0],
                            e.y = s[1],
                            e.z = s[2],
                            this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {
                                var t = c(a, 1.01 * p);
                                b.set(t[0], t[1], t[2]),
                                b.sub(e),
                                b.y = 0,
                                b.normalize();
                                var u = Math.atan2(b.x, b.z);
                                j.rotation.set(0, u, 0)
                            }
                        }
                    } else
                        "rot" === m ? THREE.Quaternion.slerp(q, r, j.quaternion, p) : "scl" === m && (e = j.scale,
                        e.x = q[0] + (r[0] - q[0]) * p,
                        e.y = q[1] + (r[1] - q[1]) * p,
                        e.z = q[2] + (r[2] - q[2]) * p)
                }
        }
    }
}(),
THREE.Animation.prototype.getNextKeyWith = function(a, b, c) {
    var d = this.data.hierarchy[b].keys;
    for (this.interpolationType === THREE.AnimationHandler.CATMULLROM || this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ? c = c < d.length - 1 ? c : d.length - 1 : c %= d.length; c < d.length; c++)
        if (void 0 !== d[c][a])
            return d[c];
    return this.data.hierarchy[b].keys[0]
}
,
THREE.Animation.prototype.getPrevKeyWith = function(a, b, c) {
    var d = this.data.hierarchy[b].keys;
    for (c = this.interpolationType === THREE.AnimationHandler.CATMULLROM || this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ? c > 0 ? c : 0 : c >= 0 ? c : c + d.length; c >= 0; c--)
        if (void 0 !== d[c][a])
            return d[c];
    return this.data.hierarchy[b].keys[d.length - 1]
}
,
THREE.KeyFrameAnimation = function(a, b) {
    this.root = a,
    this.data = THREE.AnimationHandler.get(b),
    this.hierarchy = THREE.AnimationHandler.parse(a),
    this.currentTime = 0,
    this.timeScale = .001,
    this.isPlaying = !1,
    this.isPaused = !0,
    this.loop = !0;
    for (var c = 0, d = this.hierarchy.length; d > c; c++) {
        var e = this.data.hierarchy[c].keys
          , f = this.data.hierarchy[c].sids
          , g = this.hierarchy[c];
        if (e.length && f) {
            for (var h = 0; h < f.length; h++) {
                var i = f[h]
                  , j = this.getNextKeyWith(i, c, 0);
                j && j.apply(i)
            }
            g.matrixAutoUpdate = !1,
            this.data.hierarchy[c].node.updateMatrix(),
            g.matrixWorldNeedsUpdate = !0
        }
    }
}
,
THREE.KeyFrameAnimation.prototype.play = function(a) {
    if (this.currentTime = void 0 !== a ? a : 0,
    this.isPlaying === !1) {
        this.isPlaying = !0;
        var b, c, d, e = this.hierarchy.length;
        for (b = 0; e > b; b++) {
            c = this.hierarchy[b],
            d = this.data.hierarchy[b],
            void 0 === d.animationCache && (d.animationCache = {},
            d.animationCache.prevKey = null,
            d.animationCache.nextKey = null,
            d.animationCache.originalMatrix = c instanceof THREE.Bone ? c.skinMatrix : c.matrix);
            var f = this.data.hierarchy[b].keys;
            f.length && (d.animationCache.prevKey = f[0],
            d.animationCache.nextKey = f[1],
            this.startTime = Math.min(f[0].time, this.startTime),
            this.endTime = Math.max(f[f.length - 1].time, this.endTime))
        }
        this.update(0)
    }
    this.isPaused = !1,
    THREE.AnimationHandler.addToUpdate(this)
}
,
THREE.KeyFrameAnimation.prototype.pause = function() {
    this.isPaused ? THREE.AnimationHandler.addToUpdate(this) : THREE.AnimationHandler.removeFromUpdate(this),
    this.isPaused = !this.isPaused
}
,
THREE.KeyFrameAnimation.prototype.stop = function() {
    this.isPlaying = !1,
    this.isPaused = !1,
    THREE.AnimationHandler.removeFromUpdate(this);
    for (var a = 0; a < this.data.hierarchy.length; a++) {
        var b = this.hierarchy[a]
          , c = this.data.hierarchy[a];
        if (void 0 !== c.animationCache) {
            var d = c.animationCache.originalMatrix;
            b instanceof THREE.Bone ? (d.copy(b.skinMatrix),
            b.skinMatrix = d) : (d.copy(b.matrix),
            b.matrix = d),
            delete c.animationCache
        }
    }
}
,
THREE.KeyFrameAnimation.prototype.update = function(a) {
    if (this.isPlaying !== !1) {
        this.currentTime += a * this.timeScale;
        var b = this.data.length;
        this.loop === !0 && this.currentTime > b && (this.currentTime %= b),
        this.currentTime = Math.min(this.currentTime, b);
        for (var c = 0, d = this.hierarchy.length; d > c; c++) {
            var e = this.hierarchy[c]
              , f = this.data.hierarchy[c]
              , g = f.keys
              , h = f.animationCache;
            if (g.length) {
                var i = h.prevKey
                  , j = h.nextKey;
                if (j.time <= this.currentTime) {
                    for (; j.time < this.currentTime && j.index > i.index; )
                        i = j,
                        j = g[i.index + 1];
                    h.prevKey = i,
                    h.nextKey = j
                }
                j.time >= this.currentTime ? i.interpolate(j, this.currentTime) : i.interpolate(j, j.time),
                this.data.hierarchy[c].node.updateMatrix(),
                e.matrixWorldNeedsUpdate = !0
            }
        }
    }
}
,
THREE.KeyFrameAnimation.prototype.getNextKeyWith = function(a, b, c) {
    var d = this.data.hierarchy[b].keys;
    for (c %= d.length; c < d.length; c++)
        if (d[c].hasTarget(a))
            return d[c];
    return d[0]
}
,
THREE.KeyFrameAnimation.prototype.getPrevKeyWith = function(a, b, c) {
    var d = this.data.hierarchy[b].keys;
    for (c = c >= 0 ? c : c + d.length; c >= 0; c--)
        if (d[c].hasTarget(a))
            return d[c];
    return d[d.length - 1]
}
,
THREE.MorphAnimation = function(a) {
    this.mesh = a,
    this.frames = a.morphTargetInfluences.length,
    this.currentTime = 0,
    this.duration = 1e3,
    this.loop = !0,
    this.isPlaying = !1
}
,
THREE.MorphAnimation.prototype = {
    play: function() {
        this.isPlaying = !0
    },
    pause: function() {
        this.isPlaying = !1
    },
    update: function() {
        var a = 0
          , b = 0;
        return function(c) {
            if (this.isPlaying !== !1) {
                this.currentTime += c,
                this.loop === !0 && this.currentTime > this.duration && (this.currentTime %= this.duration),
                this.currentTime = Math.min(this.currentTime, this.duration);
                var d = this.duration / this.frames
                  , e = Math.floor(this.currentTime / d);
                e != b && (this.mesh.morphTargetInfluences[a] = 0,
                this.mesh.morphTargetInfluences[b] = 1,
                this.mesh.morphTargetInfluences[e] = 0,
                a = b,
                b = e),
                this.mesh.morphTargetInfluences[e] = this.currentTime % d / d,
                this.mesh.morphTargetInfluences[a] = 1 - this.mesh.morphTargetInfluences[e]
            }
        }
    }()
},
THREE.CubeCamera = function(a, b, c) {
    THREE.Object3D.call(this);
    var d = 90
      , e = 1
      , f = new THREE.PerspectiveCamera(d,e,a,b);
    f.up.set(0, -1, 0),
    f.lookAt(new THREE.Vector3(1,0,0)),
    this.add(f);
    var g = new THREE.PerspectiveCamera(d,e,a,b);
    g.up.set(0, -1, 0),
    g.lookAt(new THREE.Vector3(-1,0,0)),
    this.add(g);
    var h = new THREE.PerspectiveCamera(d,e,a,b);
    h.up.set(0, 0, 1),
    h.lookAt(new THREE.Vector3(0,1,0)),
    this.add(h);
    var i = new THREE.PerspectiveCamera(d,e,a,b);
    i.up.set(0, 0, -1),
    i.lookAt(new THREE.Vector3(0,-1,0)),
    this.add(i);
    var j = new THREE.PerspectiveCamera(d,e,a,b);
    j.up.set(0, -1, 0),
    j.lookAt(new THREE.Vector3(0,0,1)),
    this.add(j);
    var k = new THREE.PerspectiveCamera(d,e,a,b);
    k.up.set(0, -1, 0),
    k.lookAt(new THREE.Vector3(0,0,-1)),
    this.add(k),
    this.renderTarget = new THREE.WebGLRenderTargetCube(c,c,{
        format: THREE.RGBFormat,
        magFilter: THREE.LinearFilter,
        minFilter: THREE.LinearFilter
    }),
    this.updateCubeMap = function(a, b) {
        var c = this.renderTarget
          , d = c.generateMipmaps;
        c.generateMipmaps = !1,
        c.activeCubeFace = 0,
        a.render(b, f, c),
        c.activeCubeFace = 1,
        a.render(b, g, c),
        c.activeCubeFace = 2,
        a.render(b, h, c),
        c.activeCubeFace = 3,
        a.render(b, i, c),
        c.activeCubeFace = 4,
        a.render(b, j, c),
        c.generateMipmaps = d,
        c.activeCubeFace = 5,
        a.render(b, k, c)
    }
}
,
THREE.CubeCamera.prototype = Object.create(THREE.Object3D.prototype),
THREE.CombinedCamera = function(a, b, c, d, e, f, g) {
    THREE.Camera.call(this),
    this.fov = c,
    this.left = -a / 2,
    this.right = a / 2,
    this.top = b / 2,
    this.bottom = -b / 2,
    this.cameraO = new THREE.OrthographicCamera(a / -2,a / 2,b / 2,b / -2,f,g),
    this.cameraP = new THREE.PerspectiveCamera(c,a / b,d,e),
    this.zoom = 1,
    this.toPerspective()
}
,
THREE.CombinedCamera.prototype = Object.create(THREE.Camera.prototype),
THREE.CombinedCamera.prototype.toPerspective = function() {
    this.near = this.cameraP.near,
    this.far = this.cameraP.far,
    this.cameraP.fov = this.fov / this.zoom,
    this.cameraP.updateProjectionMatrix(),
    this.projectionMatrix = this.cameraP.projectionMatrix,
    this.inPerspectiveMode = !0,
    this.inOrthographicMode = !1
}
,
THREE.CombinedCamera.prototype.toOrthographic = function() {
    var a = this.fov
      , b = this.cameraP.aspect
      , c = this.cameraP.near
      , d = this.cameraP.far
      , e = (c + d) / 2
      , f = Math.tan(a / 2) * e
      , g = 2 * f
      , h = g * b
      , i = h / 2;
    f /= this.zoom,
    i /= this.zoom,
    this.cameraO.left = -i,
    this.cameraO.right = i,
    this.cameraO.top = f,
    this.cameraO.bottom = -f,
    this.cameraO.updateProjectionMatrix(),
    this.near = this.cameraO.near,
    this.far = this.cameraO.far,
    this.projectionMatrix = this.cameraO.projectionMatrix,
    this.inPerspectiveMode = !1,
    this.inOrthographicMode = !0
}
,
THREE.CombinedCamera.prototype.setSize = function(a, b) {
    this.cameraP.aspect = a / b,
    this.left = -a / 2,
    this.right = a / 2,
    this.top = b / 2,
    this.bottom = -b / 2
}
,
THREE.CombinedCamera.prototype.setFov = function(a) {
    this.fov = a,
    this.inPerspectiveMode ? this.toPerspective() : this.toOrthographic()
}
,
THREE.CombinedCamera.prototype.updateProjectionMatrix = function() {
    this.inPerspectiveMode ? this.toPerspective() : (this.toPerspective(),
    this.toOrthographic())
}
,
THREE.CombinedCamera.prototype.setLens = function(a, b) {
    void 0 === b && (b = 24);
    var c = 2 * THREE.Math.radToDeg(Math.atan(b / (2 * a)));
    return this.setFov(c),
    c
}
,
THREE.CombinedCamera.prototype.setZoom = function(a) {
    this.zoom = a,
    this.inPerspectiveMode ? this.toPerspective() : this.toOrthographic()
}
,
THREE.CombinedCamera.prototype.toFrontView = function() {
    this.rotation.x = 0,
    this.rotation.y = 0,
    this.rotation.z = 0,
    this.rotationAutoUpdate = !1
}
,
THREE.CombinedCamera.prototype.toBackView = function() {
    this.rotation.x = 0,
    this.rotation.y = Math.PI,
    this.rotation.z = 0,
    this.rotationAutoUpdate = !1
}
,
THREE.CombinedCamera.prototype.toLeftView = function() {
    this.rotation.x = 0,
    this.rotation.y = -Math.PI / 2,
    this.rotation.z = 0,
    this.rotationAutoUpdate = !1
}
,
THREE.CombinedCamera.prototype.toRightView = function() {
    this.rotation.x = 0,
    this.rotation.y = Math.PI / 2,
    this.rotation.z = 0,
    this.rotationAutoUpdate = !1
}
,
THREE.CombinedCamera.prototype.toTopView = function() {
    this.rotation.x = -Math.PI / 2,
    this.rotation.y = 0,
    this.rotation.z = 0,
    this.rotationAutoUpdate = !1
}
,
THREE.CombinedCamera.prototype.toBottomView = function() {
    this.rotation.x = Math.PI / 2,
    this.rotation.y = 0,
    this.rotation.z = 0,
    this.rotationAutoUpdate = !1
}
,
THREE.BoxGeometry = function(a, b, c, d, e, f) {
    function g(a, b, c, d, e, f, g, i) {
        var j, k, l, m = h.widthSegments, n = h.heightSegments, o = e / 2, p = f / 2, q = h.vertices.length;
        "x" === a && "y" === b || "y" === a && "x" === b ? j = "z" : "x" === a && "z" === b || "z" === a && "x" === b ? (j = "y",
        n = h.depthSegments) : ("z" === a && "y" === b || "y" === a && "z" === b) && (j = "x",
        m = h.depthSegments);
        var r = m + 1
          , s = n + 1
          , t = e / m
          , u = f / n
          , v = new THREE.Vector3;
        for (v[j] = g > 0 ? 1 : -1,
        l = 0; s > l; l++)
            for (k = 0; r > k; k++) {
                var w = new THREE.Vector3;
                w[a] = (k * t - o) * c,
                w[b] = (l * u - p) * d,
                w[j] = g,
                h.vertices.push(w)
            }
        for (l = 0; n > l; l++)
            for (k = 0; m > k; k++) {
                var x = k + r * l
                  , y = k + r * (l + 1)
                  , z = k + 1 + r * (l + 1)
                  , A = k + 1 + r * l
                  , B = new THREE.Vector2(k / m,1 - l / n)
                  , C = new THREE.Vector2(k / m,1 - (l + 1) / n)
                  , D = new THREE.Vector2((k + 1) / m,1 - (l + 1) / n)
                  , E = new THREE.Vector2((k + 1) / m,1 - l / n)
                  , F = new THREE.Face3(x + q,y + q,A + q);
                F.normal.copy(v),
                F.vertexNormals.push(v.clone(), v.clone(), v.clone()),
                F.materialIndex = i,
                h.faces.push(F),
                h.faceVertexUvs[0].push([B, C, E]),
                F = new THREE.Face3(y + q,z + q,A + q),
                F.normal.copy(v),
                F.vertexNormals.push(v.clone(), v.clone(), v.clone()),
                F.materialIndex = i,
                h.faces.push(F),
                h.faceVertexUvs[0].push([C.clone(), D, E.clone()])
            }
    }
    THREE.Geometry.call(this);
    var h = this;
    this.width = a,
    this.height = b,
    this.depth = c,
    this.widthSegments = d || 1,
    this.heightSegments = e || 1,
    this.depthSegments = f || 1;
    var i = this.width / 2
      , j = this.height / 2
      , k = this.depth / 2;
    g("z", "y", -1, -1, this.depth, this.height, i, 0),
    g("z", "y", 1, -1, this.depth, this.height, -i, 1),
    g("x", "z", 1, 1, this.width, this.depth, j, 2),
    g("x", "z", 1, -1, this.width, this.depth, -j, 3),
    g("x", "y", 1, -1, this.width, this.height, k, 4),
    g("x", "y", -1, -1, this.width, this.height, -k, 5),
    this.computeCentroids(),
    this.mergeVertices()
}
,
THREE.BoxGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.CircleGeometry = function(a, b, c, d) {
    THREE.Geometry.call(this),
    this.radius = a = a || 50,
    this.segments = b = void 0 !== b ? Math.max(3, b) : 8,
    this.thetaStart = c = void 0 !== c ? c : 0,
    this.thetaLength = d = void 0 !== d ? d : 2 * Math.PI;
    var e, f = [], g = new THREE.Vector3, h = new THREE.Vector2(.5,.5);
    for (this.vertices.push(g),
    f.push(h),
    e = 0; b >= e; e++) {
        var i = new THREE.Vector3
          , j = c + e / b * d;
        i.x = a * Math.cos(j),
        i.y = a * Math.sin(j),
        this.vertices.push(i),
        f.push(new THREE.Vector2((i.x / a + 1) / 2,(i.y / a + 1) / 2))
    }
    var k = new THREE.Vector3(0,0,1);
    for (e = 1; b >= e; e++) {
        var l = e
          , m = e + 1
          , n = 0;
        this.faces.push(new THREE.Face3(l,m,n,[k.clone(), k.clone(), k.clone()])),
        this.faceVertexUvs[0].push([f[e].clone(), f[e + 1].clone(), h.clone()])
    }
    this.computeCentroids(),
    this.computeFaceNormals(),
    this.boundingSphere = new THREE.Sphere(new THREE.Vector3,a)
}
,
THREE.CircleGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.CubeGeometry = THREE.BoxGeometry,
THREE.CylinderGeometry = function(a, b, c, d, e, f) {
    THREE.Geometry.call(this),
    this.radiusTop = a = void 0 !== a ? a : 20,
    this.radiusBottom = b = void 0 !== b ? b : 20,
    this.height = c = void 0 !== c ? c : 100,
    this.radialSegments = d = d || 8,
    this.heightSegments = e = e || 1,
    this.openEnded = f = void 0 !== f ? f : !1;
    var g, h, i = c / 2, j = [], k = [];
    for (h = 0; e >= h; h++) {
        var l = []
          , m = []
          , n = h / e
          , o = n * (b - a) + a;
        for (g = 0; d >= g; g++) {
            var p = g / d
              , q = new THREE.Vector3;
            q.x = o * Math.sin(p * Math.PI * 2),
            q.y = -n * c + i,
            q.z = o * Math.cos(p * Math.PI * 2),
            this.vertices.push(q),
            l.push(this.vertices.length - 1),
            m.push(new THREE.Vector2(p,1 - n))
        }
        j.push(l),
        k.push(m)
    }
    var r, s, t = (b - a) / c;
    for (g = 0; d > g; g++)
        for (0 !== a ? (r = this.vertices[j[0][g]].clone(),
        s = this.vertices[j[0][g + 1]].clone()) : (r = this.vertices[j[1][g]].clone(),
        s = this.vertices[j[1][g + 1]].clone()),
        r.setY(Math.sqrt(r.x * r.x + r.z * r.z) * t).normalize(),
        s.setY(Math.sqrt(s.x * s.x + s.z * s.z) * t).normalize(),
        h = 0; e > h; h++) {
            var u = j[h][g]
              , v = j[h + 1][g]
              , w = j[h + 1][g + 1]
              , x = j[h][g + 1]
              , y = r.clone()
              , z = r.clone()
              , A = s.clone()
              , B = s.clone()
              , C = k[h][g].clone()
              , D = k[h + 1][g].clone()
              , E = k[h + 1][g + 1].clone()
              , F = k[h][g + 1].clone();
            this.faces.push(new THREE.Face3(u,v,x,[y, z, B])),
            this.faceVertexUvs[0].push([C, D, F]),
            this.faces.push(new THREE.Face3(v,w,x,[z.clone(), A, B.clone()])),
            this.faceVertexUvs[0].push([D.clone(), E, F.clone()])
        }
    if (f === !1 && a > 0)
        for (this.vertices.push(new THREE.Vector3(0,i,0)),
        g = 0; d > g; g++) {
            var u = j[0][g]
              , v = j[0][g + 1]
              , w = this.vertices.length - 1
              , y = new THREE.Vector3(0,1,0)
              , z = new THREE.Vector3(0,1,0)
              , A = new THREE.Vector3(0,1,0)
              , C = k[0][g].clone()
              , D = k[0][g + 1].clone()
              , E = new THREE.Vector2(D.x,0);
            this.faces.push(new THREE.Face3(u,v,w,[y, z, A])),
            this.faceVertexUvs[0].push([C, D, E])
        }
    if (f === !1 && b > 0)
        for (this.vertices.push(new THREE.Vector3(0,-i,0)),
        g = 0; d > g; g++) {
            var u = j[h][g + 1]
              , v = j[h][g]
              , w = this.vertices.length - 1
              , y = new THREE.Vector3(0,-1,0)
              , z = new THREE.Vector3(0,-1,0)
              , A = new THREE.Vector3(0,-1,0)
              , C = k[h][g + 1].clone()
              , D = k[h][g].clone()
              , E = new THREE.Vector2(D.x,1);
            this.faces.push(new THREE.Face3(u,v,w,[y, z, A])),
            this.faceVertexUvs[0].push([C, D, E])
        }
    this.computeCentroids(),
    this.computeFaceNormals()
}
,
THREE.CylinderGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.ExtrudeGeometry = function(a, b) {
    return "undefined" == typeof a ? (a = [],
    void 0) : (THREE.Geometry.call(this),
    a = a instanceof Array ? a : [a],
    this.shapebb = a[a.length - 1].getBoundingBox(),
    this.addShapeList(a, b),
    this.computeCentroids(),
    this.computeFaceNormals(),
    void 0)
}
,
THREE.ExtrudeGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.ExtrudeGeometry.prototype.addShapeList = function(a, b) {
    for (var c = a.length, d = 0; c > d; d++) {
        var e = a[d];
        this.addShape(e, b)
    }
}
,
THREE.ExtrudeGeometry.prototype.addShape = function(a, b) {
    function c(a, b, c) {
        return b || console.log("die"),
        b.clone().multiplyScalar(c).add(a)
    }
    function d(a, b, c) {
        var d, e, f = 1e-10, g = THREE.Math.sign, h = 1, i = a.x - b.x, j = a.y - b.y, k = c.x - a.x, l = c.y - a.y, m = i * i + j * j, n = i * l - j * k;
        if (Math.abs(n) > f) {
            var o = Math.sqrt(m)
              , p = Math.sqrt(k * k + l * l)
              , q = b.x - j / o
              , r = b.y + i / o
              , s = c.x - l / p
              , t = c.y + k / p
              , u = ((s - q) * l - (t - r) * k) / (i * l - j * k);
            d = q + i * u - a.x,
            e = r + j * u - a.y;
            var v = d * d + e * e;
            if (2 >= v)
                return new THREE.Vector2(d,e);
            h = Math.sqrt(v / 2)
        } else {
            var w = !1;
            i > f ? k > f && (w = !0) : -f > i ? -f > k && (w = !0) : g(j) == g(l) && (w = !0),
            w ? (d = -j,
            e = i,
            h = Math.sqrt(m)) : (d = i,
            e = j,
            h = Math.sqrt(m / 2))
        }
        return new THREE.Vector2(d / h,e / h)
    }
    function e() {
        if (t) {
            var a = 0
              , b = S * a;
            for (V = 0; T > V; V++)
                R = K[V],
                i(R[2] + b, R[1] + b, R[0] + b, !0);
            for (a = v + 2 * s,
            b = S * a,
            V = 0; T > V; V++)
                R = K[V],
                i(R[0] + b, R[1] + b, R[2] + b, !1)
        } else {
            for (V = 0; T > V; V++)
                R = K[V],
                i(R[2], R[1], R[0], !0);
            for (V = 0; T > V; V++)
                R = K[V],
                i(R[0] + S * v, R[1] + S * v, R[2] + S * v, !1)
        }
    }
    function f() {
        var a = 0;
        for (g(L, a),
        a += L.length,
        C = 0,
        D = I.length; D > C; C++)
            B = I[C],
            g(B, a),
            a += B.length
    }
    function g(a, b) {
        var c, d;
        for (V = a.length; --V >= 0; ) {
            c = V,
            d = V - 1,
            0 > d && (d = a.length - 1);
            var e = 0
              , f = v + 2 * s;
            for (e = 0; f > e; e++) {
                var g = S * e
                  , h = S * (e + 1)
                  , i = b + c + g
                  , k = b + d + g
                  , l = b + d + h
                  , m = b + c + h;
                j(i, k, l, m, a, e, f, c, d)
            }
        }
    }
    function h(a, b, c) {
        E.vertices.push(new THREE.Vector3(a,b,c))
    }
    function i(c, d, e, f) {
        c += F,
        d += F,
        e += F,
        E.faces.push(new THREE.Face3(c,d,e,null,null,y));
        var g = f ? A.generateBottomUV(E, a, b, c, d, e) : A.generateTopUV(E, a, b, c, d, e);
        E.faceVertexUvs[0].push(g)
    }
    function j(c, d, e, f, g, h, i, j, k) {
        c += F,
        d += F,
        e += F,
        f += F,
        E.faces.push(new THREE.Face3(c,d,f,null,null,z)),
        E.faces.push(new THREE.Face3(d,e,f,null,null,z));
        var l = A.generateSideWallUV(E, a, g, b, c, d, e, f, h, i, j, k);
        E.faceVertexUvs[0].push([l[0], l[1], l[3]]),
        E.faceVertexUvs[0].push([l[1], l[2], l[3]])
    }
    {
        var k, l, m, n, o, p = void 0 !== b.amount ? b.amount : 100, q = void 0 !== b.bevelThickness ? b.bevelThickness : 6, r = void 0 !== b.bevelSize ? b.bevelSize : q - 2, s = void 0 !== b.bevelSegments ? b.bevelSegments : 3, t = void 0 !== b.bevelEnabled ? b.bevelEnabled : !0, u = void 0 !== b.curveSegments ? b.curveSegments : 12, v = void 0 !== b.steps ? b.steps : 1, w = b.extrudePath, x = !1, y = b.material, z = b.extrudeMaterial, A = void 0 !== b.UVGenerator ? b.UVGenerator : THREE.ExtrudeGeometry.WorldUVGenerator;
        this.shapebb
    }
    w && (k = w.getSpacedPoints(v),
    x = !0,
    t = !1,
    l = void 0 !== b.frames ? b.frames : new THREE.TubeGeometry.FrenetFrames(w,v,!1),
    m = new THREE.Vector3,
    n = new THREE.Vector3,
    o = new THREE.Vector3),
    t || (s = 0,
    q = 0,
    r = 0);
    var B, C, D, E = this, F = this.vertices.length, G = a.extractPoints(u), H = G.shape, I = G.holes, J = !THREE.Shape.Utils.isClockWise(H);
    if (J) {
        for (H = H.reverse(),
        C = 0,
        D = I.length; D > C; C++)
            B = I[C],
            THREE.Shape.Utils.isClockWise(B) && (I[C] = B.reverse());
        J = !1
    }
    var K = THREE.Shape.Utils.triangulateShape(H, I)
      , L = H;
    for (C = 0,
    D = I.length; D > C; C++)
        B = I[C],
        H = H.concat(B);
    for (var M, N, O, P, Q, R, S = H.length, T = K.length, U = (L.length,
    180 / Math.PI,
    []), V = 0, W = L.length, X = W - 1, Y = V + 1; W > V; V++,
    X++,
    Y++) {
        X === W && (X = 0),
        Y === W && (Y = 0);
        {
            L[V],
            L[X],
            L[Y]
        }
        U[V] = d(L[V], L[X], L[Y])
    }
    var Z, $ = [], _ = U.concat();
    for (C = 0,
    D = I.length; D > C; C++) {
        for (B = I[C],
        Z = [],
        V = 0,
        W = B.length,
        X = W - 1,
        Y = V + 1; W > V; V++,
        X++,
        Y++)
            X === W && (X = 0),
            Y === W && (Y = 0),
            Z[V] = d(B[V], B[X], B[Y]);
        $.push(Z),
        _ = _.concat(Z)
    }
    for (M = 0; s > M; M++) {
        for (O = M / s,
        P = q * (1 - O),
        N = r * Math.sin(O * Math.PI / 2),
        V = 0,
        W = L.length; W > V; V++)
            Q = c(L[V], U[V], N),
            h(Q.x, Q.y, -P);
        for (C = 0,
        D = I.length; D > C; C++)
            for (B = I[C],
            Z = $[C],
            V = 0,
            W = B.length; W > V; V++)
                Q = c(B[V], Z[V], N),
                h(Q.x, Q.y, -P)
    }
    for (N = r,
    V = 0; S > V; V++)
        Q = t ? c(H[V], _[V], N) : H[V],
        x ? (n.copy(l.normals[0]).multiplyScalar(Q.x),
        m.copy(l.binormals[0]).multiplyScalar(Q.y),
        o.copy(k[0]).add(n).add(m),
        h(o.x, o.y, o.z)) : h(Q.x, Q.y, 0);
    var ab;
    for (ab = 1; v >= ab; ab++)
        for (V = 0; S > V; V++)
            Q = t ? c(H[V], _[V], N) : H[V],
            x ? (n.copy(l.normals[ab]).multiplyScalar(Q.x),
            m.copy(l.binormals[ab]).multiplyScalar(Q.y),
            o.copy(k[ab]).add(n).add(m),
            h(o.x, o.y, o.z)) : h(Q.x, Q.y, p / v * ab);
    for (M = s - 1; M >= 0; M--) {
        for (O = M / s,
        P = q * (1 - O),
        N = r * Math.sin(O * Math.PI / 2),
        V = 0,
        W = L.length; W > V; V++)
            Q = c(L[V], U[V], N),
            h(Q.x, Q.y, p + P);
        for (C = 0,
        D = I.length; D > C; C++)
            for (B = I[C],
            Z = $[C],
            V = 0,
            W = B.length; W > V; V++)
                Q = c(B[V], Z[V], N),
                x ? h(Q.x, Q.y + k[v - 1].y, k[v - 1].x + P) : h(Q.x, Q.y, p + P)
    }
    e(),
    f()
}
,
THREE.ExtrudeGeometry.WorldUVGenerator = {
    generateTopUV: function(a, b, c, d, e, f) {
        var g = a.vertices[d].x
          , h = a.vertices[d].y
          , i = a.vertices[e].x
          , j = a.vertices[e].y
          , k = a.vertices[f].x
          , l = a.vertices[f].y;
        return [new THREE.Vector2(g,h), new THREE.Vector2(i,j), new THREE.Vector2(k,l)]
    },
    generateBottomUV: function(a, b, c, d, e, f) {
        return this.generateTopUV(a, b, c, d, e, f)
    },
    generateSideWallUV: function(a, b, c, d, e, f, g, h) {
        var i = a.vertices[e].x
          , j = a.vertices[e].y
          , k = a.vertices[e].z
          , l = a.vertices[f].x
          , m = a.vertices[f].y
          , n = a.vertices[f].z
          , o = a.vertices[g].x
          , p = a.vertices[g].y
          , q = a.vertices[g].z
          , r = a.vertices[h].x
          , s = a.vertices[h].y
          , t = a.vertices[h].z;
        return Math.abs(j - m) < .01 ? [new THREE.Vector2(i,1 - k), new THREE.Vector2(l,1 - n), new THREE.Vector2(o,1 - q), new THREE.Vector2(r,1 - t)] : [new THREE.Vector2(j,1 - k), new THREE.Vector2(m,1 - n), new THREE.Vector2(p,1 - q), new THREE.Vector2(s,1 - t)]
    }
},
THREE.ExtrudeGeometry.__v1 = new THREE.Vector2,
THREE.ExtrudeGeometry.__v2 = new THREE.Vector2,
THREE.ExtrudeGeometry.__v3 = new THREE.Vector2,
THREE.ExtrudeGeometry.__v4 = new THREE.Vector2,
THREE.ExtrudeGeometry.__v5 = new THREE.Vector2,
THREE.ExtrudeGeometry.__v6 = new THREE.Vector2,
THREE.ShapeGeometry = function(a, b) {
    THREE.Geometry.call(this),
    a instanceof Array == !1 && (a = [a]),
    this.shapebb = a[a.length - 1].getBoundingBox(),
    this.addShapeList(a, b),
    this.computeCentroids(),
    this.computeFaceNormals()
}
,
THREE.ShapeGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.ShapeGeometry.prototype.addShapeList = function(a, b) {
    for (var c = 0, d = a.length; d > c; c++)
        this.addShape(a[c], b);
    return this
}
,
THREE.ShapeGeometry.prototype.addShape = function(a, b) {
    void 0 === b && (b = {});
    var c, d, e, f = void 0 !== b.curveSegments ? b.curveSegments : 12, g = b.material, h = void 0 === b.UVGenerator ? THREE.ExtrudeGeometry.WorldUVGenerator : b.UVGenerator, i = (this.shapebb,
    this.vertices.length), j = a.extractPoints(f), k = j.shape, l = j.holes, m = !THREE.Shape.Utils.isClockWise(k);
    if (m) {
        for (k = k.reverse(),
        c = 0,
        d = l.length; d > c; c++)
            e = l[c],
            THREE.Shape.Utils.isClockWise(e) && (l[c] = e.reverse());
        m = !1
    }
    var n = THREE.Shape.Utils.triangulateShape(k, l)
      , o = k;
    for (c = 0,
    d = l.length; d > c; c++)
        e = l[c],
        k = k.concat(e);
    {
        var p, q, r = k.length, s = n.length;
        o.length
    }
    for (c = 0; r > c; c++)
        p = k[c],
        this.vertices.push(new THREE.Vector3(p.x,p.y,0));
    for (c = 0; s > c; c++) {
        q = n[c];
        var t = q[0] + i
          , u = q[1] + i
          , v = q[2] + i;
        this.faces.push(new THREE.Face3(t,u,v,null,null,g)),
        this.faceVertexUvs[0].push(h.generateBottomUV(this, a, b, t, u, v))
    }
}
,
THREE.LatheGeometry = function(a, b, c, d) {
    THREE.Geometry.call(this),
    b = b || 12,
    c = c || 0,
    d = d || 2 * Math.PI;
    for (var e = 1 / (a.length - 1), f = 1 / b, g = 0, h = b; h >= g; g++)
        for (var i = c + g * f * d, j = Math.cos(i), k = Math.sin(i), l = 0, m = a.length; m > l; l++) {
            var n = a[l]
              , o = new THREE.Vector3;
            o.x = j * n.x - k * n.y,
            o.y = k * n.x + j * n.y,
            o.z = n.z,
            this.vertices.push(o)
        }
    for (var p = a.length, g = 0, h = b; h > g; g++)
        for (var l = 0, m = a.length - 1; m > l; l++) {
            var q = l + p * g
              , r = q
              , s = q + p
              , j = q + 1 + p
              , t = q + 1
              , u = g * f
              , v = l * e
              , w = u + f
              , x = v + e;
            this.faces.push(new THREE.Face3(r,s,t)),
            this.faceVertexUvs[0].push([new THREE.Vector2(u,v), new THREE.Vector2(w,v), new THREE.Vector2(u,x)]),
            this.faces.push(new THREE.Face3(s,j,t)),
            this.faceVertexUvs[0].push([new THREE.Vector2(w,v), new THREE.Vector2(w,x), new THREE.Vector2(u,x)])
        }
    this.mergeVertices(),
    this.computeCentroids(),
    this.computeFaceNormals(),
    this.computeVertexNormals()
}
,
THREE.LatheGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.PlaneGeometry = function(a, b, c, d) {
    THREE.Geometry.call(this),
    this.width = a,
    this.height = b,
    this.widthSegments = c || 1,
    this.heightSegments = d || 1;
    var e, f, g = a / 2, h = b / 2, i = this.widthSegments, j = this.heightSegments, k = i + 1, l = j + 1, m = this.width / i, n = this.height / j, o = new THREE.Vector3(0,0,1);
    for (f = 0; l > f; f++)
        for (e = 0; k > e; e++) {
            var p = e * m - g
              , q = f * n - h;
            this.vertices.push(new THREE.Vector3(p,-q,0))
        }
    for (f = 0; j > f; f++)
        for (e = 0; i > e; e++) {
            var r = e + k * f
              , s = e + k * (f + 1)
              , t = e + 1 + k * (f + 1)
              , u = e + 1 + k * f
              , v = new THREE.Vector2(e / i,1 - f / j)
              , w = new THREE.Vector2(e / i,1 - (f + 1) / j)
              , x = new THREE.Vector2((e + 1) / i,1 - (f + 1) / j)
              , y = new THREE.Vector2((e + 1) / i,1 - f / j)
              , z = new THREE.Face3(r,s,u);
            z.normal.copy(o),
            z.vertexNormals.push(o.clone(), o.clone(), o.clone()),
            this.faces.push(z),
            this.faceVertexUvs[0].push([v, w, y]),
            z = new THREE.Face3(s,t,u),
            z.normal.copy(o),
            z.vertexNormals.push(o.clone(), o.clone(), o.clone()),
            this.faces.push(z),
            this.faceVertexUvs[0].push([w.clone(), x, y.clone()])
        }
    this.computeCentroids()
}
,
THREE.PlaneGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.RingGeometry = function(a, b, c, d, e, f) {
    THREE.Geometry.call(this),
    a = a || 0,
    b = b || 50,
    e = void 0 !== e ? e : 0,
    f = void 0 !== f ? f : 2 * Math.PI,
    c = void 0 !== c ? Math.max(3, c) : 8,
    d = void 0 !== d ? Math.max(3, d) : 8;
    var g, h, i = [], j = a, k = (b - a) / d;
    for (g = 0; d >= g; g++) {
        for (h = 0; c >= h; h++) {
            var l = new THREE.Vector3
              , m = e + h / c * f;
            l.x = j * Math.cos(m),
            l.y = j * Math.sin(m),
            this.vertices.push(l),
            i.push(new THREE.Vector2((l.x / b + 1) / 2,(l.y / b + 1) / 2))
        }
        j += k
    }
    var n = new THREE.Vector3(0,0,1);
    for (g = 0; d > g; g++) {
        var o = g * c;
        for (h = 0; c >= h; h++) {
            var m = h + o
              , p = m + g
              , q = m + c + g
              , r = m + c + 1 + g;
            this.faces.push(new THREE.Face3(p,q,r,[n.clone(), n.clone(), n.clone()])),
            this.faceVertexUvs[0].push([i[p].clone(), i[q].clone(), i[r].clone()]),
            p = m + g,
            q = m + c + 1 + g,
            r = m + 1 + g,
            this.faces.push(new THREE.Face3(p,q,r,[n.clone(), n.clone(), n.clone()])),
            this.faceVertexUvs[0].push([i[p].clone(), i[q].clone(), i[r].clone()])
        }
    }
    this.computeCentroids(),
    this.computeFaceNormals(),
    this.boundingSphere = new THREE.Sphere(new THREE.Vector3,j)
}
,
THREE.RingGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.SphereGeometry = function(a, b, c, d, e, f, g) {
    THREE.Geometry.call(this),
    this.radius = a = a || 50,
    this.widthSegments = b = Math.max(3, Math.floor(b) || 8),
    this.heightSegments = c = Math.max(2, Math.floor(c) || 6),
    this.phiStart = d = void 0 !== d ? d : 0,
    this.phiLength = e = void 0 !== e ? e : 2 * Math.PI,
    this.thetaStart = f = void 0 !== f ? f : 0,
    this.thetaLength = g = void 0 !== g ? g : Math.PI;
    var h, i, j = [], k = [];
    for (i = 0; c >= i; i++) {
        var l = []
          , m = [];
        for (h = 0; b >= h; h++) {
            var n = h / b
              , o = i / c
              , p = new THREE.Vector3;
            p.x = -a * Math.cos(d + n * e) * Math.sin(f + o * g),
            p.y = a * Math.cos(f + o * g),
            p.z = a * Math.sin(d + n * e) * Math.sin(f + o * g),
            this.vertices.push(p),
            l.push(this.vertices.length - 1),
            m.push(new THREE.Vector2(n,1 - o))
        }
        j.push(l),
        k.push(m)
    }
    for (i = 0; i < this.heightSegments; i++)
        for (h = 0; h < this.widthSegments; h++) {
            var q = j[i][h + 1]
              , r = j[i][h]
              , s = j[i + 1][h]
              , t = j[i + 1][h + 1]
              , u = this.vertices[q].clone().normalize()
              , v = this.vertices[r].clone().normalize()
              , w = this.vertices[s].clone().normalize()
              , x = this.vertices[t].clone().normalize()
              , y = k[i][h + 1].clone()
              , z = k[i][h].clone()
              , A = k[i + 1][h].clone()
              , B = k[i + 1][h + 1].clone();
            Math.abs(this.vertices[q].y) === this.radius ? (y.x = (y.x + z.x) / 2,
            this.faces.push(new THREE.Face3(q,s,t,[u, w, x])),
            this.faceVertexUvs[0].push([y, A, B])) : Math.abs(this.vertices[s].y) === this.radius ? (A.x = (A.x + B.x) / 2,
            this.faces.push(new THREE.Face3(q,r,s,[u, v, w])),
            this.faceVertexUvs[0].push([y, z, A])) : (this.faces.push(new THREE.Face3(q,r,t,[u, v, x])),
            this.faceVertexUvs[0].push([y, z, B]),
            this.faces.push(new THREE.Face3(r,s,t,[v.clone(), w, x.clone()])),
            this.faceVertexUvs[0].push([z.clone(), A, B.clone()]))
        }
    this.computeCentroids(),
    this.computeFaceNormals(),
    this.boundingSphere = new THREE.Sphere(new THREE.Vector3,a)
}
,
THREE.SphereGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.TextGeometry = function(a, b) {
    b = b || {};
    var c = THREE.FontUtils.generateShapes(a, b);
    b.amount = void 0 !== b.height ? b.height : 50,
    void 0 === b.bevelThickness && (b.bevelThickness = 10),
    void 0 === b.bevelSize && (b.bevelSize = 8),
    void 0 === b.bevelEnabled && (b.bevelEnabled = !1),
    THREE.ExtrudeGeometry.call(this, c, b)
}
,
THREE.TextGeometry.prototype = Object.create(THREE.ExtrudeGeometry.prototype),
THREE.TorusGeometry = function(a, b, c, d, e) {
    THREE.Geometry.call(this);
    this.radius = a || 100,
    this.tube = b || 40,
    this.radialSegments = c || 8,
    this.tubularSegments = d || 6,
    this.arc = e || 2 * Math.PI;
    for (var f = new THREE.Vector3, g = [], h = [], i = 0; i <= this.radialSegments; i++)
        for (var j = 0; j <= this.tubularSegments; j++) {
            var k = j / this.tubularSegments * this.arc
              , l = i / this.radialSegments * Math.PI * 2;
            f.x = this.radius * Math.cos(k),
            f.y = this.radius * Math.sin(k);
            var m = new THREE.Vector3;
            m.x = (this.radius + this.tube * Math.cos(l)) * Math.cos(k),
            m.y = (this.radius + this.tube * Math.cos(l)) * Math.sin(k),
            m.z = this.tube * Math.sin(l),
            this.vertices.push(m),
            g.push(new THREE.Vector2(j / this.tubularSegments,i / this.radialSegments)),
            h.push(m.clone().sub(f).normalize())
        }
    for (var i = 1; i <= this.radialSegments; i++)
        for (var j = 1; j <= this.tubularSegments; j++) {
            var n = (this.tubularSegments + 1) * i + j - 1
              , o = (this.tubularSegments + 1) * (i - 1) + j - 1
              , p = (this.tubularSegments + 1) * (i - 1) + j
              , q = (this.tubularSegments + 1) * i + j
              , r = new THREE.Face3(n,o,q,[h[n].clone(), h[o].clone(), h[q].clone()]);
            this.faces.push(r),
            this.faceVertexUvs[0].push([g[n].clone(), g[o].clone(), g[q].clone()]),
            r = new THREE.Face3(o,p,q,[h[o].clone(), h[p].clone(), h[q].clone()]),
            this.faces.push(r),
            this.faceVertexUvs[0].push([g[o].clone(), g[p].clone(), g[q].clone()])
        }
    this.computeCentroids(),
    this.computeFaceNormals()
}
,
THREE.TorusGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.TorusKnotGeometry = function(a, b, c, d, e, f, g) {
    function h(a, b, c, d, e) {
        var f = Math.cos(a)
          , g = Math.sin(a)
          , h = b / c * a
          , i = Math.cos(h)
          , j = d * (2 + i) * .5 * f
          , k = d * (2 + i) * g * .5
          , l = e * d * Math.sin(h) * .5;
        return new THREE.Vector3(j,k,l)
    }
    THREE.Geometry.call(this);
    var i = this;
    this.radius = a || 100,
    this.tube = b || 40,
    this.radialSegments = c || 64,
    this.tubularSegments = d || 8,
    this.p = e || 2,
    this.q = f || 3,
    this.heightScale = g || 1,
    this.grid = new Array(this.radialSegments);
    for (var j = new THREE.Vector3, k = new THREE.Vector3, l = new THREE.Vector3, m = 0; m < this.radialSegments; ++m) {
        this.grid[m] = new Array(this.tubularSegments);
        var n = m / this.radialSegments * 2 * this.p * Math.PI
          , o = h(n, this.q, this.p, this.radius, this.heightScale)
          , p = h(n + .01, this.q, this.p, this.radius, this.heightScale);
        j.subVectors(p, o),
        k.addVectors(p, o),
        l.crossVectors(j, k),
        k.crossVectors(l, j),
        l.normalize(),
        k.normalize();
        for (var q = 0; q < this.tubularSegments; ++q) {
            var r = q / this.tubularSegments * 2 * Math.PI
              , s = -this.tube * Math.cos(r)
              , t = this.tube * Math.sin(r)
              , u = new THREE.Vector3;
            u.x = o.x + s * k.x + t * l.x,
            u.y = o.y + s * k.y + t * l.y,
            u.z = o.z + s * k.z + t * l.z,
            this.grid[m][q] = i.vertices.push(u) - 1
        }
    }
    for (var m = 0; m < this.radialSegments; ++m)
        for (var q = 0; q < this.tubularSegments; ++q) {
            var v = (m + 1) % this.radialSegments
              , w = (q + 1) % this.tubularSegments
              , x = this.grid[m][q]
              , y = this.grid[v][q]
              , z = this.grid[v][w]
              , A = this.grid[m][w]
              , B = new THREE.Vector2(m / this.radialSegments,q / this.tubularSegments)
              , C = new THREE.Vector2((m + 1) / this.radialSegments,q / this.tubularSegments)
              , D = new THREE.Vector2((m + 1) / this.radialSegments,(q + 1) / this.tubularSegments)
              , E = new THREE.Vector2(m / this.radialSegments,(q + 1) / this.tubularSegments);
            this.faces.push(new THREE.Face3(x,y,A)),
            this.faceVertexUvs[0].push([B, C, E]),
            this.faces.push(new THREE.Face3(y,z,A)),
            this.faceVertexUvs[0].push([C.clone(), D, E.clone()])
        }
    this.computeCentroids(),
    this.computeFaceNormals(),
    this.computeVertexNormals()
}
,
THREE.TorusKnotGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.TubeGeometry = function(a, b, c, d, e) {
    function f(a, b, c) {
        return A.vertices.push(new THREE.Vector3(a,b,c)) - 1
    }
    THREE.Geometry.call(this),
    this.path = a,
    this.segments = b || 64,
    this.radius = c || 1,
    this.radialSegments = d || 8,
    this.closed = e || !1,
    this.grid = [];
    var g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A = this, B = this.segments + 1, C = new THREE.Vector3, D = new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed), E = D.tangents, F = D.normals, G = D.binormals;
    for (this.tangents = E,
    this.normals = F,
    this.binormals = G,
    o = 0; B > o; o++)
        for (this.grid[o] = [],
        j = o / (B - 1),
        n = a.getPointAt(j),
        g = E[o],
        h = F[o],
        i = G[o],
        p = 0; p < this.radialSegments; p++)
            k = p / this.radialSegments * 2 * Math.PI,
            l = -this.radius * Math.cos(k),
            m = this.radius * Math.sin(k),
            C.copy(n),
            C.x += l * h.x + m * i.x,
            C.y += l * h.y + m * i.y,
            C.z += l * h.z + m * i.z,
            this.grid[o][p] = f(C.x, C.y, C.z);
    for (o = 0; o < this.segments; o++)
        for (p = 0; p < this.radialSegments; p++)
            q = this.closed ? (o + 1) % this.segments : o + 1,
            r = (p + 1) % this.radialSegments,
            s = this.grid[o][p],
            t = this.grid[q][p],
            u = this.grid[q][r],
            v = this.grid[o][r],
            w = new THREE.Vector2(o / this.segments,p / this.radialSegments),
            x = new THREE.Vector2((o + 1) / this.segments,p / this.radialSegments),
            y = new THREE.Vector2((o + 1) / this.segments,(p + 1) / this.radialSegments),
            z = new THREE.Vector2(o / this.segments,(p + 1) / this.radialSegments),
            this.faces.push(new THREE.Face3(s,t,v)),
            this.faceVertexUvs[0].push([w, x, z]),
            this.faces.push(new THREE.Face3(t,u,v)),
            this.faceVertexUvs[0].push([x.clone(), y, z.clone()]);
    this.computeCentroids(),
    this.computeFaceNormals(),
    this.computeVertexNormals()
}
,
THREE.TubeGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.TubeGeometry.FrenetFrames = function(a, b, c) {
    function d() {
        n[0] = new THREE.Vector3,
        o[0] = new THREE.Vector3,
        f = Number.MAX_VALUE,
        g = Math.abs(m[0].x),
        h = Math.abs(m[0].y),
        i = Math.abs(m[0].z),
        f >= g && (f = g,
        l.set(1, 0, 0)),
        f >= h && (f = h,
        l.set(0, 1, 0)),
        f >= i && l.set(0, 0, 1),
        p.crossVectors(m[0], l).normalize(),
        n[0].crossVectors(m[0], p),
        o[0].crossVectors(m[0], n[0])
    }
    var e, f, g, h, i, j, k, l = (new THREE.Vector3,
    new THREE.Vector3), m = (new THREE.Vector3,
    []), n = [], o = [], p = new THREE.Vector3, q = new THREE.Matrix4, r = b + 1, s = 1e-4;
    for (this.tangents = m,
    this.normals = n,
    this.binormals = o,
    j = 0; r > j; j++)
        k = j / (r - 1),
        m[j] = a.getTangentAt(k),
        m[j].normalize();
    for (d(),
    j = 1; r > j; j++)
        n[j] = n[j - 1].clone(),
        o[j] = o[j - 1].clone(),
        p.crossVectors(m[j - 1], m[j]),
        p.length() > s && (p.normalize(),
        e = Math.acos(THREE.Math.clamp(m[j - 1].dot(m[j]), -1, 1)),
        n[j].applyMatrix4(q.makeRotationAxis(p, e))),
        o[j].crossVectors(m[j], n[j]);
    if (c)
        for (e = Math.acos(THREE.Math.clamp(n[0].dot(n[r - 1]), -1, 1)),
        e /= r - 1,
        m[0].dot(p.crossVectors(n[0], n[r - 1])) > 0 && (e = -e),
        j = 1; r > j; j++)
            n[j].applyMatrix4(q.makeRotationAxis(m[j], e * j)),
            o[j].crossVectors(m[j], n[j])
}
,
THREE.PolyhedronGeometry = function(a, b, c, d) {
    function e(a) {
        var b = a.normalize().clone();
        b.index = k.vertices.push(b) - 1;
        var c = h(a) / 2 / Math.PI + .5
          , d = i(a) / Math.PI + .5;
        return b.uv = new THREE.Vector2(c,1 - d),
        b
    }
    function f(a, b, c) {
        var d = new THREE.Face3(a.index,b.index,c.index,[a.clone(), b.clone(), c.clone()]);
        d.centroid.add(a).add(b).add(c).divideScalar(3),
        k.faces.push(d);
        var e = h(d.centroid);
        k.faceVertexUvs[0].push([j(a.uv, a, e), j(b.uv, b, e), j(c.uv, c, e)])
    }
    function g(a, b) {
        for (var c = Math.pow(2, b), d = (Math.pow(4, b),
        e(k.vertices[a.a])), g = e(k.vertices[a.b]), h = e(k.vertices[a.c]), i = [], j = 0; c >= j; j++) {
            i[j] = [];
            for (var l = e(d.clone().lerp(h, j / c)), m = e(g.clone().lerp(h, j / c)), n = c - j, o = 0; n >= o; o++)
                i[j][o] = 0 == o && j == c ? l : e(l.clone().lerp(m, o / n))
        }
        for (var j = 0; c > j; j++)
            for (var o = 0; 2 * (c - j) - 1 > o; o++) {
                var p = Math.floor(o / 2);
                o % 2 == 0 ? f(i[j][p + 1], i[j + 1][p], i[j][p]) : f(i[j][p + 1], i[j + 1][p + 1], i[j + 1][p])
            }
    }
    function h(a) {
        return Math.atan2(a.z, -a.x)
    }
    function i(a) {
        return Math.atan2(-a.y, Math.sqrt(a.x * a.x + a.z * a.z))
    }
    function j(a, b, c) {
        return 0 > c && 1 === a.x && (a = new THREE.Vector2(a.x - 1,a.y)),
        0 === b.x && 0 === b.z && (a = new THREE.Vector2(c / 2 / Math.PI + .5,a.y)),
        a.clone()
    }
    THREE.Geometry.call(this),
    c = c || 1,
    d = d || 0;
    for (var k = this, l = 0, m = a.length; m > l; l++)
        e(new THREE.Vector3(a[l][0],a[l][1],a[l][2]));
    for (var n = this.vertices, o = [], l = 0, m = b.length; m > l; l++) {
        var p = n[b[l][0]]
          , q = n[b[l][1]]
          , r = n[b[l][2]];
        o[l] = new THREE.Face3(p.index,q.index,r.index,[p.clone(), q.clone(), r.clone()])
    }
    for (var l = 0, m = o.length; m > l; l++)
        g(o[l], d);
    for (var l = 0, m = this.faceVertexUvs[0].length; m > l; l++) {
        var s = this.faceVertexUvs[0][l]
          , t = s[0].x
          , u = s[1].x
          , v = s[2].x
          , w = Math.max(t, Math.max(u, v))
          , x = Math.min(t, Math.min(u, v));
        w > .9 && .1 > x && (.2 > t && (s[0].x += 1),
        .2 > u && (s[1].x += 1),
        .2 > v && (s[2].x += 1))
    }
    for (var l = 0, m = this.vertices.length; m > l; l++)
        this.vertices[l].multiplyScalar(c);
    this.mergeVertices(),
    this.computeCentroids(),
    this.computeFaceNormals(),
    this.boundingSphere = new THREE.Sphere(new THREE.Vector3,c)
}
,
THREE.PolyhedronGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.IcosahedronGeometry = function(a, b) {
    this.radius = a,
    this.detail = b;
    var c = (1 + Math.sqrt(5)) / 2
      , d = [[-1, c, 0], [1, c, 0], [-1, -c, 0], [1, -c, 0], [0, -1, c], [0, 1, c], [0, -1, -c], [0, 1, -c], [c, 0, -1], [c, 0, 1], [-c, 0, -1], [-c, 0, 1]]
      , e = [[0, 11, 5], [0, 5, 1], [0, 1, 7], [0, 7, 10], [0, 10, 11], [1, 5, 9], [5, 11, 4], [11, 10, 2], [10, 7, 6], [7, 1, 8], [3, 9, 4], [3, 4, 2], [3, 2, 6], [3, 6, 8], [3, 8, 9], [4, 9, 5], [2, 4, 11], [6, 2, 10], [8, 6, 7], [9, 8, 1]];
    THREE.PolyhedronGeometry.call(this, d, e, a, b)
}
,
THREE.IcosahedronGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.OctahedronGeometry = function(a, b) {
    var c = [[1, 0, 0], [-1, 0, 0], [0, 1, 0], [0, -1, 0], [0, 0, 1], [0, 0, -1]]
      , d = [[0, 2, 4], [0, 4, 3], [0, 3, 5], [0, 5, 2], [1, 2, 5], [1, 5, 3], [1, 3, 4], [1, 4, 2]];
    THREE.PolyhedronGeometry.call(this, c, d, a, b)
}
,
THREE.OctahedronGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.TetrahedronGeometry = function(a, b) {
    var c = [[1, 1, 1], [-1, -1, 1], [-1, 1, -1], [1, -1, -1]]
      , d = [[2, 1, 0], [0, 3, 2], [1, 3, 0], [2, 3, 1]];
    THREE.PolyhedronGeometry.call(this, c, d, a, b)
}
,
THREE.TetrahedronGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.ParametricGeometry = function(a, b, c) {
    THREE.Geometry.call(this);
    var d, e, f, g, h, i = this.vertices, j = this.faces, k = this.faceVertexUvs[0], l = b + 1;
    for (d = 0; c >= d; d++)
        for (h = d / c,
        e = 0; b >= e; e++)
            g = e / b,
            f = a(g, h),
            i.push(f);
    var m, n, o, p, q, r, s, t;
    for (d = 0; c > d; d++)
        for (e = 0; b > e; e++)
            m = d * l + e,
            n = d * l + e + 1,
            o = (d + 1) * l + e + 1,
            p = (d + 1) * l + e,
            q = new THREE.Vector2(e / b,d / c),
            r = new THREE.Vector2((e + 1) / b,d / c),
            s = new THREE.Vector2((e + 1) / b,(d + 1) / c),
            t = new THREE.Vector2(e / b,(d + 1) / c),
            j.push(new THREE.Face3(m,n,p)),
            k.push([q, r, t]),
            j.push(new THREE.Face3(n,o,p)),
            k.push([r.clone(), s, t.clone()]);
    this.computeCentroids(),
    this.computeFaceNormals(),
    this.computeVertexNormals()
}
,
THREE.ParametricGeometry.prototype = Object.create(THREE.Geometry.prototype),
THREE.AxisHelper = function(a) {
    a = a || 1;
    var b = new THREE.Geometry;
    b.vertices.push(new THREE.Vector3, new THREE.Vector3(a,0,0), new THREE.Vector3, new THREE.Vector3(0,a,0), new THREE.Vector3, new THREE.Vector3(0,0,a)),
    b.colors.push(new THREE.Color(16711680), new THREE.Color(16755200), new THREE.Color(65280), new THREE.Color(11206400), new THREE.Color(255), new THREE.Color(43775));
    var c = new THREE.LineBasicMaterial({
        vertexColors: THREE.VertexColors
    });
    THREE.Line.call(this, b, c, THREE.LinePieces)
}
,
THREE.AxisHelper.prototype = Object.create(THREE.Line.prototype),
THREE.ArrowHelper = function(a, b, c, d, e, f) {
    THREE.Object3D.call(this),
    void 0 === d && (d = 16776960),
    void 0 === c && (c = 1),
    void 0 === e && (e = .2 * c),
    void 0 === f && (f = .2 * e),
    this.position = b;
    var g = new THREE.Geometry;
    g.vertices.push(new THREE.Vector3(0,0,0)),
    g.vertices.push(new THREE.Vector3(0,1,0)),
    this.line = new THREE.Line(g,new THREE.LineBasicMaterial({
        color: d
    })),
    this.line.matrixAutoUpdate = !1,
    this.add(this.line);
    var h = new THREE.CylinderGeometry(0,.5,1,5,1);
    h.applyMatrix((new THREE.Matrix4).makeTranslation(0, -.5, 0)),
    this.cone = new THREE.Mesh(h,new THREE.MeshBasicMaterial({
        color: d
    })),
    this.cone.matrixAutoUpdate = !1,
    this.add(this.cone),
    this.setDirection(a),
    this.setLength(c, e, f)
}
,
THREE.ArrowHelper.prototype = Object.create(THREE.Object3D.prototype),
THREE.ArrowHelper.prototype.setDirection = function() {
    var a, b = new THREE.Vector3;
    return function(c) {
        c.y > .99999 ? this.quaternion.set(0, 0, 0, 1) : c.y < -.99999 ? this.quaternion.set(1, 0, 0, 0) : (b.set(c.z, 0, -c.x).normalize(),
        a = Math.acos(c.y),
        this.quaternion.setFromAxisAngle(b, a))
    }
}(),
THREE.ArrowHelper.prototype.setLength = function(a, b, c) {
    void 0 === b && (b = .2 * a),
    void 0 === c && (c = .2 * b),
    this.line.scale.set(1, a, 1),
    this.line.updateMatrix(),
    this.cone.scale.set(c, b, c),
    this.cone.position.y = a,
    this.cone.updateMatrix()
}
,
THREE.ArrowHelper.prototype.setColor = function(a) {
    this.line.material.color.setHex(a),
    this.cone.material.color.setHex(a)
}
,
THREE.BoxHelper = function(a) {
    var b = [new THREE.Vector3(1,1,1), new THREE.Vector3(-1,1,1), new THREE.Vector3(-1,-1,1), new THREE.Vector3(1,-1,1), new THREE.Vector3(1,1,-1), new THREE.Vector3(-1,1,-1), new THREE.Vector3(-1,-1,-1), new THREE.Vector3(1,-1,-1)];
    this.vertices = b;
    var c = new THREE.Geometry;
    c.vertices.push(b[0], b[1], b[1], b[2], b[2], b[3], b[3], b[0], b[4], b[5], b[5], b[6], b[6], b[7], b[7], b[4], b[0], b[4], b[1], b[5], b[2], b[6], b[3], b[7]),
    THREE.Line.call(this, c, new THREE.LineBasicMaterial({
        color: 16776960
    }), THREE.LinePieces),
    void 0 !== a && this.update(a)
}
,
THREE.BoxHelper.prototype = Object.create(THREE.Line.prototype),
THREE.BoxHelper.prototype.update = function(a) {
    var b = a.geometry;
    null === b.boundingBox && b.computeBoundingBox();
    var c = b.boundingBox.min
      , d = b.boundingBox.max
      , e = this.vertices;
    e[0].set(d.x, d.y, d.z),
    e[1].set(c.x, d.y, d.z),
    e[2].set(c.x, c.y, d.z),
    e[3].set(d.x, c.y, d.z),
    e[4].set(d.x, d.y, c.z),
    e[5].set(c.x, d.y, c.z),
    e[6].set(c.x, c.y, c.z),
    e[7].set(d.x, c.y, c.z),
    this.geometry.computeBoundingSphere(),
    this.geometry.verticesNeedUpdate = !0,
    this.matrixAutoUpdate = !1,
    this.matrixWorld = a.matrixWorld
}
,
THREE.BoundingBoxHelper = function(a, b) {
    var c = void 0 !== b ? b : 8947848;
    this.object = a,
    this.box = new THREE.Box3,
    THREE.Mesh.call(this, new THREE.BoxGeometry(1,1,1), new THREE.MeshBasicMaterial({
        color: c,
        wireframe: !0
    }))
}
,
THREE.BoundingBoxHelper.prototype = Object.create(THREE.Mesh.prototype),
THREE.BoundingBoxHelper.prototype.update = function() {
    this.box.setFromObject(this.object),
    this.box.size(this.scale),
    this.box.center(this.position)
}
,
THREE.CameraHelper = function(a) {
    function b(a, b, d) {
        c(a, d),
        c(b, d)
    }
    function c(a, b) {
        d.vertices.push(new THREE.Vector3),
        d.colors.push(new THREE.Color(b)),
        void 0 === f[a] && (f[a] = []),
        f[a].push(d.vertices.length - 1)
    }
    var d = new THREE.Geometry
      , e = new THREE.LineBasicMaterial({
        color: 16777215,
        vertexColors: THREE.FaceColors
    })
      , f = {}
      , g = 16755200
      , h = 16711680
      , i = 43775
      , j = 16777215
      , k = 3355443;
    b("n1", "n2", g),
    b("n2", "n4", g),
    b("n4", "n3", g),
    b("n3", "n1", g),
    b("f1", "f2", g),
    b("f2", "f4", g),
    b("f4", "f3", g),
    b("f3", "f1", g),
    b("n1", "f1", g),
    b("n2", "f2", g),
    b("n3", "f3", g),
    b("n4", "f4", g),
    b("p", "n1", h),
    b("p", "n2", h),
    b("p", "n3", h),
    b("p", "n4", h),
    b("u1", "u2", i),
    b("u2", "u3", i),
    b("u3", "u1", i),
    b("c", "t", j),
    b("p", "c", k),
    b("cn1", "cn2", k),
    b("cn3", "cn4", k),
    b("cf1", "cf2", k),
    b("cf3", "cf4", k),
    THREE.Line.call(this, d, e, THREE.LinePieces),
    this.camera = a,
    this.matrixWorld = a.matrixWorld,
    this.matrixAutoUpdate = !1,
    this.pointMap = f,
    this.update()
}
,
THREE.CameraHelper.prototype = Object.create(THREE.Line.prototype),
THREE.CameraHelper.prototype.update = function() {
    var a = new THREE.Vector3
      , b = new THREE.Camera
      , c = new THREE.Projector;
    return function() {
        function d(d, f, g, h) {
            a.set(f, g, h),
            c.unprojectVector(a, b);
            var i = e.pointMap[d];
            if (void 0 !== i)
                for (var j = 0, k = i.length; k > j; j++)
                    e.geometry.vertices[i[j]].copy(a)
        }
        var e = this
          , f = 1
          , g = 1;
        b.projectionMatrix.copy(this.camera.projectionMatrix),
        d("c", 0, 0, -1),
        d("t", 0, 0, 1),
        d("n1", -f, -g, -1),
        d("n2", f, -g, -1),
        d("n3", -f, g, -1),
        d("n4", f, g, -1),
        d("f1", -f, -g, 1),
        d("f2", f, -g, 1),
        d("f3", -f, g, 1),
        d("f4", f, g, 1),
        d("u1", .7 * f, 1.1 * g, -1),
        d("u2", .7 * -f, 1.1 * g, -1),
        d("u3", 0, 2 * g, -1),
        d("cf1", -f, 0, 1),
        d("cf2", f, 0, 1),
        d("cf3", 0, -g, 1),
        d("cf4", 0, g, 1),
        d("cn1", -f, 0, -1),
        d("cn2", f, 0, -1),
        d("cn3", 0, -g, -1),
        d("cn4", 0, g, -1),
        this.geometry.verticesNeedUpdate = !0
    }
}(),
THREE.DirectionalLightHelper = function(a, b) {
    THREE.Object3D.call(this),
    this.light = a,
    this.light.updateMatrixWorld(),
    this.matrixWorld = a.matrixWorld,
    this.matrixAutoUpdate = !1,
    b = b || 1;
    var c = new THREE.PlaneGeometry(b,b)
      , d = new THREE.MeshBasicMaterial({
        wireframe: !0,
        fog: !1
    });
    d.color.copy(this.light.color).multiplyScalar(this.light.intensity),
    this.lightPlane = new THREE.Mesh(c,d),
    this.add(this.lightPlane),
    c = new THREE.Geometry,
    c.vertices.push(new THREE.Vector3),
    c.vertices.push(new THREE.Vector3),
    d = new THREE.LineBasicMaterial({
        fog: !1
    }),
    d.color.copy(this.light.color).multiplyScalar(this.light.intensity),
    this.targetLine = new THREE.Line(c,d),
    this.add(this.targetLine),
    this.update()
}
,
THREE.DirectionalLightHelper.prototype = Object.create(THREE.Object3D.prototype),
THREE.DirectionalLightHelper.prototype.dispose = function() {
    this.lightPlane.geometry.dispose(),
    this.lightPlane.material.dispose(),
    this.targetLine.geometry.dispose(),
    this.targetLine.material.dispose()
}
,
THREE.DirectionalLightHelper.prototype.update = function() {
    var a = new THREE.Vector3
      , b = new THREE.Vector3
      , c = new THREE.Vector3;
    return function() {
        a.setFromMatrixPosition(this.light.matrixWorld),
        b.setFromMatrixPosition(this.light.target.matrixWorld),
        c.subVectors(b, a),
        this.lightPlane.lookAt(c),
        this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),
        this.targetLine.geometry.vertices[1].copy(c),
        this.targetLine.geometry.verticesNeedUpdate = !0,
        this.targetLine.material.color.copy(this.lightPlane.material.color)
    }
}(),
THREE.EdgesHelper = function(a, b) {
    var c = void 0 !== b ? b : 16777215
      , d = [0, 0]
      , e = {}
      , f = function(a, b) {
        return a - b
    }
      , g = ["a", "b", "c"]
      , h = new THREE.BufferGeometry
      , i = a.geometry.clone();
    i.mergeVertices(),
    i.computeFaceNormals();
    for (var j = i.vertices, k = i.faces, l = 0, m = 0, n = k.length; n > m; m++)
        for (var o = k[m], p = 0; 3 > p; p++) {
            d[0] = o[g[p]],
            d[1] = o[g[(p + 1) % 3]],
            d.sort(f);
            var q = d.toString();
            void 0 === e[q] ? (e[q] = {
                vert1: d[0],
                vert2: d[1],
                face1: m,
                face2: void 0
            },
            l++) : e[q].face2 = m
        }
    h.addAttribute("position", Float32Array, 2 * l, 3);
    var r = h.attributes.position.array
      , s = 0;
    for (var q in e) {
        var t = e[q];
        if (void 0 === t.face2 || k[t.face1].normal.dot(k[t.face2].normal) < .9999) {
            var u = j[t.vert1];
            r[s++] = u.x,
            r[s++] = u.y,
            r[s++] = u.z,
            u = j[t.vert2],
            r[s++] = u.x,
            r[s++] = u.y,
            r[s++] = u.z
        }
    }
    THREE.Line.call(this, h, new THREE.LineBasicMaterial({
        color: c
    }), THREE.LinePieces),
    this.matrixAutoUpdate = !1,
    this.matrixWorld = a.matrixWorld
}
,
THREE.EdgesHelper.prototype = Object.create(THREE.Line.prototype),
THREE.FaceNormalsHelper = function(a, b, c, d) {
    this.object = a,
    this.size = void 0 !== b ? b : 1;
    for (var e = void 0 !== c ? c : 16776960, f = void 0 !== d ? d : 1, g = new THREE.Geometry, h = this.object.geometry.faces, i = 0, j = h.length; j > i; i++)
        g.vertices.push(new THREE.Vector3),
        g.vertices.push(new THREE.Vector3);
    THREE.Line.call(this, g, new THREE.LineBasicMaterial({
        color: e,
        linewidth: f
    }), THREE.LinePieces),
    this.matrixAutoUpdate = !1,
    this.normalMatrix = new THREE.Matrix3,
    this.update()
}
,
THREE.FaceNormalsHelper.prototype = Object.create(THREE.Line.prototype),
THREE.FaceNormalsHelper.prototype.update = function() {
    var a = new THREE.Vector3;
    return function() {
        this.object.updateMatrixWorld(!0),
        this.normalMatrix.getNormalMatrix(this.object.matrixWorld);
        for (var b = this.geometry.vertices, c = this.object.geometry.faces, d = this.object.matrixWorld, e = 0, f = c.length; f > e; e++) {
            var g = c[e];
            a.copy(g.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);
            var h = 2 * e;
            b[h].copy(g.centroid).applyMatrix4(d),
            b[h + 1].addVectors(b[h], a)
        }
        return this.geometry.verticesNeedUpdate = !0,
        this
    }
}(),
THREE.GridHelper = function(a, b) {
    var c = new THREE.Geometry
      , d = new THREE.LineBasicMaterial({
        vertexColors: THREE.VertexColors
    });
    this.color1 = new THREE.Color(4473924),
    this.color2 = new THREE.Color(8947848);
    for (var e = -a; a >= e; e += b) {
        c.vertices.push(new THREE.Vector3(-a,0,e), new THREE.Vector3(a,0,e), new THREE.Vector3(e,0,-a), new THREE.Vector3(e,0,a));
        var f = 0 === e ? this.color1 : this.color2;
        c.colors.push(f, f, f, f)
    }
    THREE.Line.call(this, c, d, THREE.LinePieces)
}
,
THREE.GridHelper.prototype = Object.create(THREE.Line.prototype),
THREE.GridHelper.prototype.setColors = function(a, b) {
    this.color1.set(a),
    this.color2.set(b),
    this.geometry.colorsNeedUpdate = !0
}
,
THREE.HemisphereLightHelper = function(a, b) {
    THREE.Object3D.call(this),
    this.light = a,
    this.light.updateMatrixWorld(),
    this.matrixWorld = a.matrixWorld,
    this.matrixAutoUpdate = !1,
    this.colors = [new THREE.Color, new THREE.Color];
    var c = new THREE.SphereGeometry(b,4,2);
    c.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI / 2));
    for (var d = 0, e = 8; e > d; d++)
        c.faces[d].color = this.colors[4 > d ? 0 : 1];
    var f = new THREE.MeshBasicMaterial({
        vertexColors: THREE.FaceColors,
        wireframe: !0
    });
    this.lightSphere = new THREE.Mesh(c,f),
    this.add(this.lightSphere),
    this.update()
}
,
THREE.HemisphereLightHelper.prototype = Object.create(THREE.Object3D.prototype),
THREE.HemisphereLightHelper.prototype.dispose = function() {
    this.lightSphere.geometry.dispose(),
    this.lightSphere.material.dispose()
}
,
THREE.HemisphereLightHelper.prototype.update = function() {
    var a = new THREE.Vector3;
    return function() {
        this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),
        this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),
        this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate()),
        this.lightSphere.geometry.colorsNeedUpdate = !0
    }
}(),
THREE.PointLightHelper = function(a, b) {
    this.light = a,
    this.light.updateMatrixWorld();
    var c = new THREE.SphereGeometry(b,4,2)
      , d = new THREE.MeshBasicMaterial({
        wireframe: !0,
        fog: !1
    });
    d.color.copy(this.light.color).multiplyScalar(this.light.intensity),
    THREE.Mesh.call(this, c, d),
    this.matrixWorld = this.light.matrixWorld,
    this.matrixAutoUpdate = !1
}
,
THREE.PointLightHelper.prototype = Object.create(THREE.Mesh.prototype),
THREE.PointLightHelper.prototype.dispose = function() {
    this.geometry.dispose(),
    this.material.dispose()
}
,
THREE.PointLightHelper.prototype.update = function() {
    this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)
}
,
THREE.SpotLightHelper = function(a) {
    THREE.Object3D.call(this),
    this.light = a,
    this.light.updateMatrixWorld(),
    this.matrixWorld = a.matrixWorld,
    this.matrixAutoUpdate = !1;
    var b = new THREE.CylinderGeometry(0,1,1,8,1,!0);
    b.applyMatrix((new THREE.Matrix4).makeTranslation(0, -.5, 0)),
    b.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI / 2));
    var c = new THREE.MeshBasicMaterial({
        wireframe: !0,
        fog: !1
    });
    this.cone = new THREE.Mesh(b,c),
    this.add(this.cone),
    this.update()
}
,
THREE.SpotLightHelper.prototype = Object.create(THREE.Object3D.prototype),
THREE.SpotLightHelper.prototype.dispose = function() {
    this.cone.geometry.dispose(),
    this.cone.material.dispose()
}
,
THREE.SpotLightHelper.prototype.update = function() {
    var a = new THREE.Vector3
      , b = new THREE.Vector3;
    return function() {
        var c = this.light.distance ? this.light.distance : 1e4
          , d = c * Math.tan(this.light.angle);
        this.cone.scale.set(d, d, c),
        a.setFromMatrixPosition(this.light.matrixWorld),
        b.setFromMatrixPosition(this.light.target.matrixWorld),
        this.cone.lookAt(b.sub(a)),
        this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)
    }
}(),
THREE.VertexNormalsHelper = function(a, b, c, d) {
    this.object = a,
    this.size = void 0 !== b ? b : 1;
    for (var e = void 0 !== c ? c : 16711680, f = void 0 !== d ? d : 1, g = new THREE.Geometry, h = (a.geometry.vertices,
    a.geometry.faces), i = 0, j = h.length; j > i; i++)
        for (var k = h[i], l = 0, m = k.vertexNormals.length; m > l; l++)
            g.vertices.push(new THREE.Vector3),
            g.vertices.push(new THREE.Vector3);
    THREE.Line.call(this, g, new THREE.LineBasicMaterial({
        color: e,
        linewidth: f
    }), THREE.LinePieces),
    this.matrixAutoUpdate = !1,
    this.normalMatrix = new THREE.Matrix3,
    this.update()
}
,
THREE.VertexNormalsHelper.prototype = Object.create(THREE.Line.prototype),
THREE.VertexNormalsHelper.prototype.update = function() {
    var a = new THREE.Vector3;
    return function() {
        var b = ["a", "b", "c", "d"];
        this.object.updateMatrixWorld(!0),
        this.normalMatrix.getNormalMatrix(this.object.matrixWorld);
        for (var c = this.geometry.vertices, d = this.object.geometry.vertices, e = this.object.geometry.faces, f = this.object.matrixWorld, g = 0, h = 0, i = e.length; i > h; h++)
            for (var j = e[h], k = 0, l = j.vertexNormals.length; l > k; k++) {
                var m = j[b[k]]
                  , n = d[m]
                  , o = j.vertexNormals[k];
                c[g].copy(n).applyMatrix4(f),
                a.copy(o).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),
                a.add(c[g]),
                g += 1,
                c[g].copy(a),
                g += 1
            }
        return this.geometry.verticesNeedUpdate = !0,
        this
    }
}(),
THREE.VertexTangentsHelper = function(a, b, c, d) {
    this.object = a,
    this.size = void 0 !== b ? b : 1;
    for (var e = void 0 !== c ? c : 255, f = void 0 !== d ? d : 1, g = new THREE.Geometry, h = (a.geometry.vertices,
    a.geometry.faces), i = 0, j = h.length; j > i; i++)
        for (var k = h[i], l = 0, m = k.vertexTangents.length; m > l; l++)
            g.vertices.push(new THREE.Vector3),
            g.vertices.push(new THREE.Vector3);
    THREE.Line.call(this, g, new THREE.LineBasicMaterial({
        color: e,
        linewidth: f
    }), THREE.LinePieces),
    this.matrixAutoUpdate = !1,
    this.update()
}
,
THREE.VertexTangentsHelper.prototype = Object.create(THREE.Line.prototype),
THREE.VertexTangentsHelper.prototype.update = function() {
    var a = new THREE.Vector3;
    return function() {
        var b = ["a", "b", "c", "d"];
        this.object.updateMatrixWorld(!0);
        for (var c = this.geometry.vertices, d = this.object.geometry.vertices, e = this.object.geometry.faces, f = this.object.matrixWorld, g = 0, h = 0, i = e.length; i > h; h++)
            for (var j = e[h], k = 0, l = j.vertexTangents.length; l > k; k++) {
                var m = j[b[k]]
                  , n = d[m]
                  , o = j.vertexTangents[k];
                c[g].copy(n).applyMatrix4(f),
                a.copy(o).transformDirection(f).multiplyScalar(this.size),
                a.add(c[g]),
                g += 1,
                c[g].copy(a),
                g += 1
            }
        return this.geometry.verticesNeedUpdate = !0,
        this
    }
}(),
THREE.WireframeHelper = function(a, b) {
    var c = void 0 !== b ? b : 16777215
      , d = [0, 0]
      , e = {}
      , f = function(a, b) {
        return a - b
    }
      , g = ["a", "b", "c"]
      , h = new THREE.BufferGeometry;
    if (a.geometry instanceof THREE.Geometry) {
        for (var i = a.geometry.vertices, j = a.geometry.faces, k = 0, l = new Uint32Array(6 * j.length), m = 0, n = j.length; n > m; m++)
            for (var o = j[m], p = 0; 3 > p; p++) {
                d[0] = o[g[p]],
                d[1] = o[g[(p + 1) % 3]],
                d.sort(f);
                var q = d.toString();
                void 0 === e[q] && (l[2 * k] = d[0],
                l[2 * k + 1] = d[1],
                e[q] = !0,
                k++)
            }
        h.addAttribute("position", Float32Array, 2 * k, 3);
        for (var r = h.attributes.position.array, m = 0, n = k; n > m; m++)
            for (var p = 0; 2 > p; p++) {
                var s = i[l[2 * m + p]]
                  , t = 6 * m + 3 * p;
                r[t + 0] = s.x,
                r[t + 1] = s.y,
                r[t + 2] = s.z
            }
    } else if (a.geometry instanceof THREE.BufferGeometry && void 0 !== a.geometry.attributes.index) {
        for (var i = a.geometry.attributes.position.array, u = a.geometry.attributes.index.array, v = a.geometry.offsets, k = 0, l = new Uint32Array(2 * u.length), w = 0, x = v.length; x > w; ++w)
            for (var y = v[w].start, z = v[w].count, t = v[w].index, m = y, A = y + z; A > m; m += 3)
                for (var p = 0; 3 > p; p++) {
                    d[0] = t + u[m + p],
                    d[1] = t + u[m + (p + 1) % 3],
                    d.sort(f);
                    var q = d.toString();
                    void 0 === e[q] && (l[2 * k] = d[0],
                    l[2 * k + 1] = d[1],
                    e[q] = !0,
                    k++)
                }
        h.addAttribute("position", Float32Array, 2 * k, 3);
        for (var r = h.attributes.position.array, m = 0, n = k; n > m; m++)
            for (var p = 0; 2 > p; p++) {
                var t = 6 * m + 3 * p
                  , B = 3 * l[2 * m + p];
                r[t + 0] = i[B],
                r[t + 1] = i[B + 1],
                r[t + 2] = i[B + 2]
            }
    } else if (a.geometry instanceof THREE.BufferGeometry) {
        var i = a.geometry.attributes.position.array
          , k = i.length / 3
          , C = k / 3;
        h.addAttribute("position", Float32Array, 2 * k, 3);
        for (var r = h.attributes.position.array, m = 0, n = C; n > m; m++)
            for (var p = 0; 3 > p; p++) {
                var t = 18 * m + 6 * p
                  , D = 9 * m + 3 * p;
                r[t + 0] = i[D],
                r[t + 1] = i[D + 1],
                r[t + 2] = i[D + 2];
                var B = 9 * m + 3 * ((p + 1) % 3);
                r[t + 3] = i[B],
                r[t + 4] = i[B + 1],
                r[t + 5] = i[B + 2]
            }
    }
    THREE.Line.call(this, h, new THREE.LineBasicMaterial({
        color: c
    }), THREE.LinePieces),
    this.matrixAutoUpdate = !1,
    this.matrixWorld = a.matrixWorld
}
,
THREE.WireframeHelper.prototype = Object.create(THREE.Line.prototype),
THREE.ImmediateRenderObject = function() {
    THREE.Object3D.call(this),
    this.render = function() {}
}
,
THREE.ImmediateRenderObject.prototype = Object.create(THREE.Object3D.prototype),
THREE.LensFlare = function(a, b, c, d, e) {
    THREE.Object3D.call(this),
    this.lensFlares = [],
    this.positionScreen = new THREE.Vector3,
    this.customUpdateCallback = void 0,
    void 0 !== a && this.add(a, b, c, d, e)
}
,
THREE.LensFlare.prototype = Object.create(THREE.Object3D.prototype),
THREE.LensFlare.prototype.add = function(a, b, c, d, e, f) {
    void 0 === b && (b = -1),
    void 0 === c && (c = 0),
    void 0 === f && (f = 1),
    void 0 === e && (e = new THREE.Color(16777215)),
    void 0 === d && (d = THREE.NormalBlending),
    c = Math.min(c, Math.max(0, c)),
    this.lensFlares.push({
        texture: a,
        size: b,
        distance: c,
        x: 0,
        y: 0,
        z: 0,
        scale: 1,
        rotation: 1,
        opacity: f,
        color: e,
        blending: d
    })
}
,
THREE.LensFlare.prototype.updateLensFlares = function() {
    var a, b, c = this.lensFlares.length, d = 2 * -this.positionScreen.x, e = 2 * -this.positionScreen.y;
    for (a = 0; c > a; a++)
        b = this.lensFlares[a],
        b.x = this.positionScreen.x + d * b.distance,
        b.y = this.positionScreen.y + e * b.distance,
        b.wantedRotation = b.x * Math.PI * .25,
        b.rotation += .25 * (b.wantedRotation - b.rotation)
}
,
THREE.MorphBlendMesh = function(a, b) {
    THREE.Mesh.call(this, a, b),
    this.animationsMap = {},
    this.animationsList = [];
    var c = this.geometry.morphTargets.length
      , d = "__default"
      , e = 0
      , f = c - 1
      , g = c / 1;
    this.createAnimation(d, e, f, g),
    this.setAnimationWeight(d, 1)
}
,
THREE.MorphBlendMesh.prototype = Object.create(THREE.Mesh.prototype),
THREE.MorphBlendMesh.prototype.createAnimation = function(a, b, c, d) {
    var e = {
        startFrame: b,
        endFrame: c,
        length: c - b + 1,
        fps: d,
        duration: (c - b) / d,
        lastFrame: 0,
        currentFrame: 0,
        active: !1,
        time: 0,
        direction: 1,
        weight: 1,
        directionBackwards: !1,
        mirroredLoop: !1
    };
    this.animationsMap[a] = e,
    this.animationsList.push(e)
}
,
THREE.MorphBlendMesh.prototype.autoCreateAnimations = function(a) {
    for (var b, c = /([a-z]+)(\d+)/, d = {}, e = this.geometry, f = 0, g = e.morphTargets.length; g > f; f++) {
        var h = e.morphTargets[f]
          , i = h.name.match(c);
        if (i && i.length > 1) {
            {
                var j = i[1];
                i[2]
            }
            d[j] || (d[j] = {
                start: 1 / 0,
                end: -1 / 0
            });
            var k = d[j];
            f < k.start && (k.start = f),
            f > k.end && (k.end = f),
            b || (b = j)
        }
    }
    for (var j in d) {
        var k = d[j];
        this.createAnimation(j, k.start, k.end, a)
    }
    this.firstAnimation = b
}
,
THREE.MorphBlendMesh.prototype.setAnimationDirectionForward = function(a) {
    var b = this.animationsMap[a];
    b && (b.direction = 1,
    b.directionBackwards = !1)
}
,
THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward = function(a) {
    var b = this.animationsMap[a];
    b && (b.direction = -1,
    b.directionBackwards = !0)
}
,
THREE.MorphBlendMesh.prototype.setAnimationFPS = function(a, b) {
    var c = this.animationsMap[a];
    c && (c.fps = b,
    c.duration = (c.end - c.start) / c.fps)
}
,
THREE.MorphBlendMesh.prototype.setAnimationDuration = function(a, b) {
    var c = this.animationsMap[a];
    c && (c.duration = b,
    c.fps = (c.end - c.start) / c.duration)
}
,
THREE.MorphBlendMesh.prototype.setAnimationWeight = function(a, b) {
    var c = this.animationsMap[a];
    c && (c.weight = b)
}
,
THREE.MorphBlendMesh.prototype.setAnimationTime = function(a, b) {
    var c = this.animationsMap[a];
    c && (c.time = b)
}
,
THREE.MorphBlendMesh.prototype.getAnimationTime = function(a) {
    var b = 0
      , c = this.animationsMap[a];
    return c && (b = c.time),
    b
}
,
THREE.MorphBlendMesh.prototype.getAnimationDuration = function(a) {
    var b = -1
      , c = this.animationsMap[a];
    return c && (b = c.duration),
    b
}
,
THREE.MorphBlendMesh.prototype.playAnimation = function(a) {
    var b = this.animationsMap[a];
    b ? (b.time = 0,
    b.active = !0) : console.warn("animation[" + a + "] undefined")
}
,
THREE.MorphBlendMesh.prototype.stopAnimation = function(a) {
    var b = this.animationsMap[a];
    b && (b.active = !1)
}
,
THREE.MorphBlendMesh.prototype.update = function(a) {
    for (var b = 0, c = this.animationsList.length; c > b; b++) {
        var d = this.animationsList[b];
        if (d.active) {
            var e = d.duration / d.length;
            d.time += d.direction * a,
            d.mirroredLoop ? (d.time > d.duration || d.time < 0) && (d.direction *= -1,
            d.time > d.duration && (d.time = d.duration,
            d.directionBackwards = !0),
            d.time < 0 && (d.time = 0,
            d.directionBackwards = !1)) : (d.time = d.time % d.duration,
            d.time < 0 && (d.time += d.duration));
            var f = d.startFrame + THREE.Math.clamp(Math.floor(d.time / e), 0, d.length - 1)
              , g = d.weight;
            f !== d.currentFrame && (this.morphTargetInfluences[d.lastFrame] = 0,
            this.morphTargetInfluences[d.currentFrame] = 1 * g,
            this.morphTargetInfluences[f] = 0,
            d.lastFrame = d.currentFrame,
            d.currentFrame = f);
            var h = d.time % e / e;
            d.directionBackwards && (h = 1 - h),
            this.morphTargetInfluences[d.currentFrame] = h * g,
            this.morphTargetInfluences[d.lastFrame] = (1 - h) * g
        }
    }
}
,
THREE.LensFlarePlugin = function() {
    function a(a, c) {
        var d = b.createProgram()
          , e = b.createShader(b.FRAGMENT_SHADER)
          , f = b.createShader(b.VERTEX_SHADER)
          , g = "precision " + c + " float;\n";
        return b.shaderSource(e, g + a.fragmentShader),
        b.shaderSource(f, g + a.vertexShader),
        b.compileShader(e),
        b.compileShader(f),
        b.attachShader(d, e),
        b.attachShader(d, f),
        b.linkProgram(d),
        d
    }
    var b, c, d, e = {};
    this.init = function(f) {
        b = f.context,
        c = f,
        d = f.getPrecision(),
        e.vertices = new Float32Array(16),
        e.faces = new Uint16Array(6);
        var g = 0;
        e.vertices[g++] = -1,
        e.vertices[g++] = -1,
        e.vertices[g++] = 0,
        e.vertices[g++] = 0,
        e.vertices[g++] = 1,
        e.vertices[g++] = -1,
        e.vertices[g++] = 1,
        e.vertices[g++] = 0,
        e.vertices[g++] = 1,
        e.vertices[g++] = 1,
        e.vertices[g++] = 1,
        e.vertices[g++] = 1,
        e.vertices[g++] = -1,
        e.vertices[g++] = 1,
        e.vertices[g++] = 0,
        e.vertices[g++] = 1,
        g = 0,
        e.faces[g++] = 0,
        e.faces[g++] = 1,
        e.faces[g++] = 2,
        e.faces[g++] = 0,
        e.faces[g++] = 2,
        e.faces[g++] = 3,
        e.vertexBuffer = b.createBuffer(),
        e.elementBuffer = b.createBuffer(),
        b.bindBuffer(b.ARRAY_BUFFER, e.vertexBuffer),
        b.bufferData(b.ARRAY_BUFFER, e.vertices, b.STATIC_DRAW),
        b.bindBuffer(b.ELEMENT_ARRAY_BUFFER, e.elementBuffer),
        b.bufferData(b.ELEMENT_ARRAY_BUFFER, e.faces, b.STATIC_DRAW),
        e.tempTexture = b.createTexture(),
        e.occlusionTexture = b.createTexture(),
        b.bindTexture(b.TEXTURE_2D, e.tempTexture),
        b.texImage2D(b.TEXTURE_2D, 0, b.RGB, 16, 16, 0, b.RGB, b.UNSIGNED_BYTE, null),
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_WRAP_S, b.CLAMP_TO_EDGE),
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_WRAP_T, b.CLAMP_TO_EDGE),
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MAG_FILTER, b.NEAREST),
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MIN_FILTER, b.NEAREST),
        b.bindTexture(b.TEXTURE_2D, e.occlusionTexture),
        b.texImage2D(b.TEXTURE_2D, 0, b.RGBA, 16, 16, 0, b.RGBA, b.UNSIGNED_BYTE, null),
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_WRAP_S, b.CLAMP_TO_EDGE),
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_WRAP_T, b.CLAMP_TO_EDGE),
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MAG_FILTER, b.NEAREST),
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MIN_FILTER, b.NEAREST),
        b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS) <= 0 ? (e.hasVertexTexture = !1,
        e.program = a(THREE.ShaderFlares.lensFlare, d)) : (e.hasVertexTexture = !0,
        e.program = a(THREE.ShaderFlares.lensFlareVertexTexture, d)),
        e.attributes = {},
        e.uniforms = {},
        e.attributes.vertex = b.getAttribLocation(e.program, "position"),
        e.attributes.uv = b.getAttribLocation(e.program, "uv"),
        e.uniforms.renderType = b.getUniformLocation(e.program, "renderType"),
        e.uniforms.map = b.getUniformLocation(e.program, "map"),
        e.uniforms.occlusionMap = b.getUniformLocation(e.program, "occlusionMap"),
        e.uniforms.opacity = b.getUniformLocation(e.program, "opacity"),
        e.uniforms.color = b.getUniformLocation(e.program, "color"),
        e.uniforms.scale = b.getUniformLocation(e.program, "scale"),
        e.uniforms.rotation = b.getUniformLocation(e.program, "rotation"),
        e.uniforms.screenPosition = b.getUniformLocation(e.program, "screenPosition")
    }
    ,
    this.render = function(a, d, f, g) {
        var h = a.__webglFlares
          , i = h.length;
        if (i) {
            var j = new THREE.Vector3
              , k = g / f
              , l = .5 * f
              , m = .5 * g
              , n = 16 / g
              , o = new THREE.Vector2(n * k,n)
              , p = new THREE.Vector3(1,1,0)
              , q = new THREE.Vector2(1,1)
              , r = e.uniforms
              , s = e.attributes;
            b.useProgram(e.program),
            b.enableVertexAttribArray(e.attributes.vertex),
            b.enableVertexAttribArray(e.attributes.uv),
            b.uniform1i(r.occlusionMap, 0),
            b.uniform1i(r.map, 1),
            b.bindBuffer(b.ARRAY_BUFFER, e.vertexBuffer),
            b.vertexAttribPointer(s.vertex, 2, b.FLOAT, !1, 16, 0),
            b.vertexAttribPointer(s.uv, 2, b.FLOAT, !1, 16, 8),
            b.bindBuffer(b.ELEMENT_ARRAY_BUFFER, e.elementBuffer),
            b.disable(b.CULL_FACE),
            b.depthMask(!1);
            var t, u, v, w, x;
            for (t = 0; i > t; t++)
                if (n = 16 / g,
                o.set(n * k, n),
                w = h[t],
                j.set(w.matrixWorld.elements[12], w.matrixWorld.elements[13], w.matrixWorld.elements[14]),
                j.applyMatrix4(d.matrixWorldInverse),
                j.applyProjection(d.projectionMatrix),
                p.copy(j),
                q.x = p.x * l + l,
                q.y = p.y * m + m,
                e.hasVertexTexture || q.x > 0 && q.x < f && q.y > 0 && q.y < g)
                    for (b.activeTexture(b.TEXTURE1),
                    b.bindTexture(b.TEXTURE_2D, e.tempTexture),
                    b.copyTexImage2D(b.TEXTURE_2D, 0, b.RGB, q.x - 8, q.y - 8, 16, 16, 0),
                    b.uniform1i(r.renderType, 0),
                    b.uniform2f(r.scale, o.x, o.y),
                    b.uniform3f(r.screenPosition, p.x, p.y, p.z),
                    b.disable(b.BLEND),
                    b.enable(b.DEPTH_TEST),
                    b.drawElements(b.TRIANGLES, 6, b.UNSIGNED_SHORT, 0),
                    b.activeTexture(b.TEXTURE0),
                    b.bindTexture(b.TEXTURE_2D, e.occlusionTexture),
                    b.copyTexImage2D(b.TEXTURE_2D, 0, b.RGBA, q.x - 8, q.y - 8, 16, 16, 0),
                    b.uniform1i(r.renderType, 1),
                    b.disable(b.DEPTH_TEST),
                    b.activeTexture(b.TEXTURE1),
                    b.bindTexture(b.TEXTURE_2D, e.tempTexture),
                    b.drawElements(b.TRIANGLES, 6, b.UNSIGNED_SHORT, 0),
                    w.positionScreen.copy(p),
                    w.customUpdateCallback ? w.customUpdateCallback(w) : w.updateLensFlares(),
                    b.uniform1i(r.renderType, 2),
                    b.enable(b.BLEND),
                    u = 0,
                    v = w.lensFlares.length; v > u; u++)
                        x = w.lensFlares[u],
                        x.opacity > .001 && x.scale > .001 && (p.x = x.x,
                        p.y = x.y,
                        p.z = x.z,
                        n = x.size * x.scale / g,
                        o.x = n * k,
                        o.y = n,
                        b.uniform3f(r.screenPosition, p.x, p.y, p.z),
                        b.uniform2f(r.scale, o.x, o.y),
                        b.uniform1f(r.rotation, x.rotation),
                        b.uniform1f(r.opacity, x.opacity),
                        b.uniform3f(r.color, x.color.r, x.color.g, x.color.b),
                        c.setBlending(x.blending, x.blendEquation, x.blendSrc, x.blendDst),
                        c.setTexture(x.texture, 1),
                        b.drawElements(b.TRIANGLES, 6, b.UNSIGNED_SHORT, 0));
            b.enable(b.CULL_FACE),
            b.enable(b.DEPTH_TEST),
            b.depthMask(!0)
        }
    }
}
,
THREE.ShadowMapPlugin = function() {
    function a(a, b) {
        var c = new THREE.DirectionalLight;
        c.isVirtual = !0,
        c.onlyShadow = !0,
        c.castShadow = !0,
        c.shadowCameraNear = a.shadowCameraNear,
        c.shadowCameraFar = a.shadowCameraFar,
        c.shadowCameraLeft = a.shadowCameraLeft,
        c.shadowCameraRight = a.shadowCameraRight,
        c.shadowCameraBottom = a.shadowCameraBottom,
        c.shadowCameraTop = a.shadowCameraTop,
        c.shadowCameraVisible = a.shadowCameraVisible,
        c.shadowDarkness = a.shadowDarkness,
        c.shadowBias = a.shadowCascadeBias[b],
        c.shadowMapWidth = a.shadowCascadeWidth[b],
        c.shadowMapHeight = a.shadowCascadeHeight[b],
        c.pointsWorld = [],
        c.pointsFrustum = [];
        for (var d = c.pointsWorld, e = c.pointsFrustum, f = 0; 8 > f; f++)
            d[f] = new THREE.Vector3,
            e[f] = new THREE.Vector3;
        var g = a.shadowCascadeNearZ[b]
          , h = a.shadowCascadeFarZ[b];
        return e[0].set(-1, -1, g),
        e[1].set(1, -1, g),
        e[2].set(-1, 1, g),
        e[3].set(1, 1, g),
        e[4].set(-1, -1, h),
        e[5].set(1, -1, h),
        e[6].set(-1, 1, h),
        e[7].set(1, 1, h),
        c
    }
    function b(a, b) {
        var c = a.shadowCascadeArray[b];
        c.position.copy(a.position),
        c.target.position.copy(a.target.position),
        c.lookAt(c.target),
        c.shadowCameraVisible = a.shadowCameraVisible,
        c.shadowDarkness = a.shadowDarkness,
        c.shadowBias = a.shadowCascadeBias[b];
        var d = a.shadowCascadeNearZ[b]
          , e = a.shadowCascadeFarZ[b]
          , f = c.pointsFrustum;
        f[0].z = d,
        f[1].z = d,
        f[2].z = d,
        f[3].z = d,
        f[4].z = e,
        f[5].z = e,
        f[6].z = e,
        f[7].z = e
    }
    function c(a, b) {
        var c = b.shadowCamera
          , d = b.pointsFrustum
          , e = b.pointsWorld;
        m.set(1 / 0, 1 / 0, 1 / 0),
        n.set(-1 / 0, -1 / 0, -1 / 0);
        for (var f = 0; 8 > f; f++) {
            var g = e[f];
            g.copy(d[f]),
            THREE.ShadowMapPlugin.__projector.unprojectVector(g, a),
            g.applyMatrix4(c.matrixWorldInverse),
            g.x < m.x && (m.x = g.x),
            g.x > n.x && (n.x = g.x),
            g.y < m.y && (m.y = g.y),
            g.y > n.y && (n.y = g.y),
            g.z < m.z && (m.z = g.z),
            g.z > n.z && (n.z = g.z)
        }
        c.left = m.x,
        c.right = n.x,
        c.top = n.y,
        c.bottom = m.y,
        c.updateProjectionMatrix()
    }
    function d(a) {
        return a.material instanceof THREE.MeshFaceMaterial ? a.material.materials[0] : a.material
    }
    var e, f, g, h, i, j, k = new THREE.Frustum, l = new THREE.Matrix4, m = new THREE.Vector3, n = new THREE.Vector3, o = new THREE.Vector3;
    this.init = function(a) {
        e = a.context,
        f = a;
        var b = THREE.ShaderLib.depthRGBA
          , c = THREE.UniformsUtils.clone(b.uniforms);
        g = new THREE.ShaderMaterial({
            fragmentShader: b.fragmentShader,
            vertexShader: b.vertexShader,
            uniforms: c
        }),
        h = new THREE.ShaderMaterial({
            fragmentShader: b.fragmentShader,
            vertexShader: b.vertexShader,
            uniforms: c,
            morphTargets: !0
        }),
        i = new THREE.ShaderMaterial({
            fragmentShader: b.fragmentShader,
            vertexShader: b.vertexShader,
            uniforms: c,
            skinning: !0
        }),
        j = new THREE.ShaderMaterial({
            fragmentShader: b.fragmentShader,
            vertexShader: b.vertexShader,
            uniforms: c,
            morphTargets: !0,
            skinning: !0
        }),
        g._shadowPass = !0,
        h._shadowPass = !0,
        i._shadowPass = !0,
        j._shadowPass = !0
    }
    ,
    this.render = function(a, b) {
        f.shadowMapEnabled && f.shadowMapAutoUpdate && this.update(a, b)
    }
    ,
    this.update = function(m, n) {
        var p, q, r, s, t, u, v, w, x, y, z, A, B, C, D = [], E = 0, F = null;
        for (e.clearColor(1, 1, 1, 1),
        e.disable(e.BLEND),
        e.enable(e.CULL_FACE),
        e.frontFace(e.CCW),
        f.shadowMapCullFace === THREE.CullFaceFront ? e.cullFace(e.FRONT) : e.cullFace(e.BACK),
        f.setDepthTest(!0),
        p = 0,
        q = m.__lights.length; q > p; p++)
            if (B = m.__lights[p],
            B.castShadow)
                if (B instanceof THREE.DirectionalLight && B.shadowCascade)
                    for (t = 0; t < B.shadowCascadeCount; t++) {
                        var G;
                        if (B.shadowCascadeArray[t])
                            G = B.shadowCascadeArray[t];
                        else {
                            G = a(B, t),
                            G.originalCamera = n;
                            var H = new THREE.Gyroscope;
                            H.position = B.shadowCascadeOffset,
                            H.add(G),
                            H.add(G.target),
                            n.add(H),
                            B.shadowCascadeArray[t] = G,
                            console.log("Created virtualLight", G)
                        }
                        b(B, t),
                        D[E] = G,
                        E++
                    }
                else
                    D[E] = B,
                    E++;
        for (p = 0,
        q = D.length; q > p; p++) {
            if (B = D[p],
            !B.shadowMap) {
                var I = THREE.LinearFilter;
                f.shadowMapType === THREE.PCFSoftShadowMap && (I = THREE.NearestFilter);
                var J = {
                    minFilter: I,
                    magFilter: I,
                    format: THREE.RGBAFormat
                };
                B.shadowMap = new THREE.WebGLRenderTarget(B.shadowMapWidth,B.shadowMapHeight,J),
                B.shadowMapSize = new THREE.Vector2(B.shadowMapWidth,B.shadowMapHeight),
                B.shadowMatrix = new THREE.Matrix4
            }
            if (!B.shadowCamera) {
                if (B instanceof THREE.SpotLight)
                    B.shadowCamera = new THREE.PerspectiveCamera(B.shadowCameraFov,B.shadowMapWidth / B.shadowMapHeight,B.shadowCameraNear,B.shadowCameraFar);
                else {
                    if (!(B instanceof THREE.DirectionalLight)) {
                        console.error("Unsupported light type for shadow");
                        continue
                    }
                    B.shadowCamera = new THREE.OrthographicCamera(B.shadowCameraLeft,B.shadowCameraRight,B.shadowCameraTop,B.shadowCameraBottom,B.shadowCameraNear,B.shadowCameraFar)
                }
                m.add(B.shadowCamera),
                m.autoUpdate === !0 && m.updateMatrixWorld()
            }
            for (B.shadowCameraVisible && !B.cameraHelper && (B.cameraHelper = new THREE.CameraHelper(B.shadowCamera),
            B.shadowCamera.add(B.cameraHelper)),
            B.isVirtual && G.originalCamera == n && c(n, B),
            u = B.shadowMap,
            v = B.shadowMatrix,
            w = B.shadowCamera,
            w.position.setFromMatrixPosition(B.matrixWorld),
            o.setFromMatrixPosition(B.target.matrixWorld),
            w.lookAt(o),
            w.updateMatrixWorld(),
            w.matrixWorldInverse.getInverse(w.matrixWorld),
            B.cameraHelper && (B.cameraHelper.visible = B.shadowCameraVisible),
            B.shadowCameraVisible && B.cameraHelper.update(),
            v.set(.5, 0, 0, .5, 0, .5, 0, .5, 0, 0, .5, .5, 0, 0, 0, 1),
            v.multiply(w.projectionMatrix),
            v.multiply(w.matrixWorldInverse),
            l.multiplyMatrices(w.projectionMatrix, w.matrixWorldInverse),
            k.setFromMatrix(l),
            f.setRenderTarget(u),
            f.clear(),
            C = m.__webglObjects,
            r = 0,
            s = C.length; s > r; r++)
                z = C[r],
                A = z.object,
                z.render = !1,
                A.visible && A.castShadow && ((A instanceof THREE.Mesh || A instanceof THREE.ParticleSystem) && A.frustumCulled && !k.intersectsObject(A) || (A._modelViewMatrix.multiplyMatrices(w.matrixWorldInverse, A.matrixWorld),
                z.render = !0));
            var K, L, M;
            for (r = 0,
            s = C.length; s > r; r++)
                z = C[r],
                z.render && (A = z.object,
                x = z.buffer,
                K = d(A),
                L = void 0 !== A.geometry.morphTargets && A.geometry.morphTargets.length > 0 && K.morphTargets,
                M = A instanceof THREE.SkinnedMesh && K.skinning,
                y = A.customDepthMaterial ? A.customDepthMaterial : M ? L ? j : i : L ? h : g,
                x instanceof THREE.BufferGeometry ? f.renderBufferDirect(w, m.__lights, F, y, x, A) : f.renderBuffer(w, m.__lights, F, y, x, A));
            for (C = m.__webglObjectsImmediate,
            r = 0,
            s = C.length; s > r; r++)
                z = C[r],
                A = z.object,
                A.visible && A.castShadow && (A._modelViewMatrix.multiplyMatrices(w.matrixWorldInverse, A.matrixWorld),
                f.renderImmediateObject(w, m.__lights, F, g, A))
        }
        var N = f.getClearColor()
          , O = f.getClearAlpha();
        e.clearColor(N.r, N.g, N.b, O),
        e.enable(e.BLEND),
        f.shadowMapCullFace === THREE.CullFaceFront && e.cullFace(e.BACK)
    }
}
,
THREE.ShadowMapPlugin.__projector = new THREE.Projector,
THREE.SpritePlugin = function() {
    function a() {
        var a = c.createProgram()
          , b = c.createShader(c.VERTEX_SHADER)
          , e = c.createShader(c.FRAGMENT_SHADER);
        return c.shaderSource(b, ["precision " + d.getPrecision() + " float;", "uniform mat4 modelViewMatrix;", "uniform mat4 projectionMatrix;", "uniform float rotation;", "uniform vec2 scale;", "uniform vec2 uvOffset;", "uniform vec2 uvScale;", "attribute vec2 position;", "attribute vec2 uv;", "varying vec2 vUV;", "void main() {", "vUV = uvOffset + uv * uvScale;", "vec2 alignedPosition = position * scale;", "vec2 rotatedPosition;", "rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;", "rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;", "vec4 finalPosition;", "finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );", "finalPosition.xy += rotatedPosition;", "finalPosition = projectionMatrix * finalPosition;", "gl_Position = finalPosition;", "}"].join("\n")),
        c.shaderSource(e, ["precision " + d.getPrecision() + " float;", "uniform vec3 color;", "uniform sampler2D map;", "uniform float opacity;", "uniform int fogType;", "uniform vec3 fogColor;", "uniform float fogDensity;", "uniform float fogNear;", "uniform float fogFar;", "uniform float alphaTest;", "varying vec2 vUV;", "void main() {", "vec4 texture = texture2D( map, vUV );", "if ( texture.a < alphaTest ) discard;", "gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );", "if ( fogType > 0 ) {", "float depth = gl_FragCoord.z / gl_FragCoord.w;", "float fogFactor = 0.0;", "if ( fogType == 1 ) {", "fogFactor = smoothstep( fogNear, fogFar, depth );", "} else {", "const float LOG2 = 1.442695;", "float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );", "fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );", "}", "gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );", "}", "}"].join("\n")),
        c.compileShader(b),
        c.compileShader(e),
        c.attachShader(a, b),
        c.attachShader(a, e),
        c.linkProgram(a),
        a
    }
    function b(a, b) {
        return a.z !== b.z ? b.z - a.z : b.id - a.id
    }
    var c, d, e, f, g, h, i, j, k, l;
    this.init = function(b) {
        c = b.context,
        d = b,
        f = new Float32Array([-.5, -.5, 0, 0, .5, -.5, 1, 0, .5, .5, 1, 1, -.5, .5, 0, 1]),
        g = new Uint16Array([0, 1, 2, 0, 2, 3]),
        h = c.createBuffer(),
        i = c.createBuffer(),
        c.bindBuffer(c.ARRAY_BUFFER, h),
        c.bufferData(c.ARRAY_BUFFER, f, c.STATIC_DRAW),
        c.bindBuffer(c.ELEMENT_ARRAY_BUFFER, i),
        c.bufferData(c.ELEMENT_ARRAY_BUFFER, g, c.STATIC_DRAW),
        j = a(),
        k = {
            position: c.getAttribLocation(j, "position"),
            uv: c.getAttribLocation(j, "uv")
        },
        l = {
            uvOffset: c.getUniformLocation(j, "uvOffset"),
            uvScale: c.getUniformLocation(j, "uvScale"),
            rotation: c.getUniformLocation(j, "rotation"),
            scale: c.getUniformLocation(j, "scale"),
            color: c.getUniformLocation(j, "color"),
            map: c.getUniformLocation(j, "map"),
            opacity: c.getUniformLocation(j, "opacity"),
            modelViewMatrix: c.getUniformLocation(j, "modelViewMatrix"),
            projectionMatrix: c.getUniformLocation(j, "projectionMatrix"),
            fogType: c.getUniformLocation(j, "fogType"),
            fogDensity: c.getUniformLocation(j, "fogDensity"),
            fogNear: c.getUniformLocation(j, "fogNear"),
            fogFar: c.getUniformLocation(j, "fogFar"),
            fogColor: c.getUniformLocation(j, "fogColor"),
            alphaTest: c.getUniformLocation(j, "alphaTest")
        };
        var m = document.createElement("canvas");
        m.width = 8,
        m.height = 8;
        var n = m.getContext("2d");
        n.fillStyle = "#ffffff",
        n.fillRect(0, 0, m.width, m.height),
        e = new THREE.Texture(m),
        e.needsUpdate = !0
    }
    ,
    this.render = function(a, f) {
        var g = a.__webglSprites
          , m = g.length;
        if (m) {
            c.useProgram(j),
            c.enableVertexAttribArray(k.position),
            c.enableVertexAttribArray(k.uv),
            c.disable(c.CULL_FACE),
            c.enable(c.BLEND),
            c.bindBuffer(c.ARRAY_BUFFER, h),
            c.vertexAttribPointer(k.position, 2, c.FLOAT, !1, 16, 0),
            c.vertexAttribPointer(k.uv, 2, c.FLOAT, !1, 16, 8),
            c.bindBuffer(c.ELEMENT_ARRAY_BUFFER, i),
            c.uniformMatrix4fv(l.projectionMatrix, !1, f.projectionMatrix.elements),
            c.activeTexture(c.TEXTURE0),
            c.uniform1i(l.map, 0);
            var n = 0
              , o = 0
              , p = a.fog;
            p ? (c.uniform3f(l.fogColor, p.color.r, p.color.g, p.color.b),
            p instanceof THREE.Fog ? (c.uniform1f(l.fogNear, p.near),
            c.uniform1f(l.fogFar, p.far),
            c.uniform1i(l.fogType, 1),
            n = 1,
            o = 1) : p instanceof THREE.FogExp2 && (c.uniform1f(l.fogDensity, p.density),
            c.uniform1i(l.fogType, 2),
            n = 2,
            o = 2)) : (c.uniform1i(l.fogType, 0),
            n = 0,
            o = 0);
            var q, r, s, t, u = [];
            for (q = 0; m > q; q++)
                r = g[q],
                s = r.material,
                r.visible !== !1 && (r._modelViewMatrix.multiplyMatrices(f.matrixWorldInverse, r.matrixWorld),
                r.z = -r._modelViewMatrix.elements[14]);
            for (g.sort(b),
            q = 0; m > q; q++)
                r = g[q],
                r.visible !== !1 && (s = r.material,
                c.uniform1f(l.alphaTest, s.alphaTest),
                c.uniformMatrix4fv(l.modelViewMatrix, !1, r._modelViewMatrix.elements),
                u[0] = r.scale.x,
                u[1] = r.scale.y,
                t = a.fog && s.fog ? o : 0,
                n !== t && (c.uniform1i(l.fogType, t),
                n = t),
                null !== s.map ? (c.uniform2f(l.uvOffset, s.map.offset.x, s.map.offset.y),
                c.uniform2f(l.uvScale, s.map.repeat.x, s.map.repeat.y)) : (c.uniform2f(l.uvOffset, 0, 0),
                c.uniform2f(l.uvScale, 1, 1)),
                c.uniform1f(l.opacity, s.opacity),
                c.uniform3f(l.color, s.color.r, s.color.g, s.color.b),
                c.uniform1f(l.rotation, s.rotation),
                c.uniform2fv(l.scale, u),
                d.setBlending(s.blending, s.blendEquation, s.blendSrc, s.blendDst),
                d.setDepthTest(s.depthTest),
                d.setDepthWrite(s.depthWrite),
                s.map && s.map.image && s.map.image.width ? d.setTexture(s.map, 0) : d.setTexture(e, 0),
                c.drawElements(c.TRIANGLES, 6, c.UNSIGNED_SHORT, 0));
            c.enable(c.CULL_FACE)
        }
    }
}
,
THREE.DepthPassPlugin = function() {
    function a(a) {
        return a.material instanceof THREE.MeshFaceMaterial ? a.material.materials[0] : a.material
    }
    this.enabled = !1,
    this.renderTarget = null;
    var b, c, d, e, f, g, h = new THREE.Frustum, i = new THREE.Matrix4;
    this.init = function(a) {
        b = a.context,
        c = a;
        var h = THREE.ShaderLib.depthRGBA
          , i = THREE.UniformsUtils.clone(h.uniforms);
        d = new THREE.ShaderMaterial({
            fragmentShader: h.fragmentShader,
            vertexShader: h.vertexShader,
            uniforms: i
        }),
        e = new THREE.ShaderMaterial({
            fragmentShader: h.fragmentShader,
            vertexShader: h.vertexShader,
            uniforms: i,
            morphTargets: !0
        }),
        f = new THREE.ShaderMaterial({
            fragmentShader: h.fragmentShader,
            vertexShader: h.vertexShader,
            uniforms: i,
            skinning: !0
        }),
        g = new THREE.ShaderMaterial({
            fragmentShader: h.fragmentShader,
            vertexShader: h.vertexShader,
            uniforms: i,
            morphTargets: !0,
            skinning: !0
        }),
        d._shadowPass = !0,
        e._shadowPass = !0,
        f._shadowPass = !0,
        g._shadowPass = !0
    }
    ,
    this.render = function(a, b) {
        this.enabled && this.update(a, b)
    }
    ,
    this.update = function(j, k) {
        var l, m, n, o, p, q, r, s = null;
        for (b.clearColor(1, 1, 1, 1),
        b.disable(b.BLEND),
        c.setDepthTest(!0),
        j.autoUpdate === !0 && j.updateMatrixWorld(),
        k.matrixWorldInverse.getInverse(k.matrixWorld),
        i.multiplyMatrices(k.projectionMatrix, k.matrixWorldInverse),
        h.setFromMatrix(i),
        c.setRenderTarget(this.renderTarget),
        c.clear(),
        r = j.__webglObjects,
        l = 0,
        m = r.length; m > l; l++)
            p = r[l],
            q = p.object,
            p.render = !1,
            q.visible && ((q instanceof THREE.Mesh || q instanceof THREE.ParticleSystem) && q.frustumCulled && !h.intersectsObject(q) || (q._modelViewMatrix.multiplyMatrices(k.matrixWorldInverse, q.matrixWorld),
            p.render = !0));
        var t, u, v;
        for (l = 0,
        m = r.length; m > l; l++)
            if (p = r[l],
            p.render) {
                if (q = p.object,
                n = p.buffer,
                q instanceof THREE.ParticleSystem && !q.customDepthMaterial)
                    continue;
                t = a(q),
                t && c.setMaterialFaces(q.material),
                u = q.geometry.morphTargets.length > 0 && t.morphTargets,
                v = q instanceof THREE.SkinnedMesh && t.skinning,
                o = q.customDepthMaterial ? q.customDepthMaterial : v ? u ? g : f : u ? e : d,
                n instanceof THREE.BufferGeometry ? c.renderBufferDirect(k, j.__lights, s, o, n, q) : c.renderBuffer(k, j.__lights, s, o, n, q)
            }
        for (r = j.__webglObjectsImmediate,
        l = 0,
        m = r.length; m > l; l++)
            p = r[l],
            q = p.object,
            q.visible && (q._modelViewMatrix.multiplyMatrices(k.matrixWorldInverse, q.matrixWorld),
            c.renderImmediateObject(k, j.__lights, s, d, q));
        var w = c.getClearColor()
          , x = c.getClearAlpha();
        b.clearColor(w.r, w.g, w.b, x),
        b.enable(b.BLEND)
    }
}
,
THREE.ShaderFlares = {
    lensFlareVertexTexture: {
        vertexShader: ["uniform lowp int renderType;", "uniform vec3 screenPosition;", "uniform vec2 scale;", "uniform float rotation;", "uniform sampler2D occlusionMap;", "attribute vec2 position;", "attribute vec2 uv;", "varying vec2 vUV;", "varying float vVisibility;", "void main() {", "vUV = uv;", "vec2 pos = position;", "if( renderType == 2 ) {", "vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );", "visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );", "visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );", "visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );", "visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );", "visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );", "visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );", "visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );", "visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );", "vVisibility =        visibility.r / 9.0;", "vVisibility *= 1.0 - visibility.g / 9.0;", "vVisibility *=       visibility.b / 9.0;", "vVisibility *= 1.0 - visibility.a / 9.0;", "pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;", "pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;", "}", "gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );", "}"].join("\n"),
        fragmentShader: ["uniform lowp int renderType;", "uniform sampler2D map;", "uniform float opacity;", "uniform vec3 color;", "varying vec2 vUV;", "varying float vVisibility;", "void main() {", "if( renderType == 0 ) {", "gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );", "} else if( renderType == 1 ) {", "gl_FragColor = texture2D( map, vUV );", "} else {", "vec4 texture = texture2D( map, vUV );", "texture.a *= opacity * vVisibility;", "gl_FragColor = texture;", "gl_FragColor.rgb *= color;", "}", "}"].join("\n")
    },
    lensFlare: {
        vertexShader: ["uniform lowp int renderType;", "uniform vec3 screenPosition;", "uniform vec2 scale;", "uniform float rotation;", "attribute vec2 position;", "attribute vec2 uv;", "varying vec2 vUV;", "void main() {", "vUV = uv;", "vec2 pos = position;", "if( renderType == 2 ) {", "pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;", "pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;", "}", "gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );", "}"].join("\n"),
        fragmentShader: ["precision mediump float;", "uniform lowp int renderType;", "uniform sampler2D map;", "uniform sampler2D occlusionMap;", "uniform float opacity;", "uniform vec3 color;", "varying vec2 vUV;", "void main() {", "if( renderType == 0 ) {", "gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );", "} else if( renderType == 1 ) {", "gl_FragColor = texture2D( map, vUV );", "} else {", "float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;", "visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;", "visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;", "visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;", "visibility = ( 1.0 - visibility / 4.0 );", "vec4 texture = texture2D( map, vUV );", "texture.a *= opacity * visibility;", "gl_FragColor = texture;", "gl_FragColor.rgb *= color;", "}", "}"].join("\n")
    }
},
THREE.ColorConverter = {
    setHSV: function(a, b, c, d) {
        return a.setHSL(b, c * d / ((b = (2 - c) * d) < 1 ? b : 2 - b), .5 * b)
    },
    getHSV: function(a) {
        var b = a.getHSL();
        return b.s *= b.l < .5 ? b.l : 1 - b.l,
        {
            h: b.h,
            s: 2 * b.s / (b.l + b.s),
            v: b.l + b.s
        }
    },
    setCMYK: function(a, b, c, d, e) {
        var f = (1 - b) * (1 - e)
          , g = (1 - c) * (1 - e)
          , h = (1 - d) * (1 - e);
        return a.setRGB(f, g, h)
    },
    getCMYK: function(a) {
        var b = a.r
          , c = a.g
          , d = a.b
          , e = 1 - Math.max(b, c, d)
          , f = (1 - b - e) / (1 - e)
          , g = (1 - c - e) / (1 - e)
          , h = (1 - d - e) / (1 - e);
        return {
            c: f,
            m: g,
            y: h,
            k: e
        }
    }
},
d3 = function() {
    function a(a) {
        return null != a && !isNaN(a)
    }
    function b(a) {
        return a.length
    }
    function c(a) {
        for (var b = 1; a * b % 1; )
            b *= 10;
        return b
    }
    function d(a, b) {
        try {
            for (var c in b)
                Object.defineProperty(a.prototype, c, {
                    value: b[c],
                    enumerable: !1
                })
        } catch (d) {
            a.prototype = b
        }
    }
    function e() {}
    function f() {}
    function g(a, b, c) {
        return function() {
            var d = c.apply(b, arguments);
            return d === b ? a : d
        }
    }
    function h(a, b) {
        if (b in a)
            return b;
        b = b.charAt(0).toUpperCase() + b.substring(1);
        for (var c = 0, d = lh.length; d > c; ++c) {
            var e = lh[c] + b;
            if (e in a)
                return e
        }
    }
    function i() {}
    function j() {}
    function k(a) {
        function b() {
            for (var b, d = c, e = -1, f = d.length; ++e < f; )
                (b = d[e].on) && b.apply(this, arguments);
            return a
        }
        var c = []
          , d = new e;
        return b.on = function(b, e) {
            var f, g = d.get(b);
            return arguments.length < 2 ? g && g.on : (g && (g.on = null,
            c = c.slice(0, f = c.indexOf(g)).concat(c.slice(f + 1)),
            d.remove(b)),
            e && c.push(d.set(b, {
                on: e
            })),
            a)
        }
        ,
        b
    }
    function l() {
        Wg.event.preventDefault()
    }
    function m() {
        for (var a, b = Wg.event; a = b.sourceEvent; )
            b = a;
        return b
    }
    function n(a) {
        for (var b = new j, c = 0, d = arguments.length; ++c < d; )
            b[arguments[c]] = k(b);
        return b.of = function(c, d) {
            return function(e) {
                try {
                    var f = e.sourceEvent = Wg.event;
                    e.target = a,
                    Wg.event = e,
                    b[e.type].apply(c, d)
                } finally {
                    Wg.event = f
                }
            }
        }
        ,
        b
    }
    function o(a) {
        return nh(a, sh),
        a
    }
    function p(a) {
        return "function" == typeof a ? a : function() {
            return oh(a, this)
        }
    }
    function q(a) {
        return "function" == typeof a ? a : function() {
            return ph(a, this)
        }
    }
    function r(a, b) {
        function c() {
            this.removeAttribute(a)
        }
        function d() {
            this.removeAttributeNS(a.space, a.local)
        }
        function e() {
            this.setAttribute(a, b)
        }
        function f() {
            this.setAttributeNS(a.space, a.local, b)
        }
        function g() {
            var c = b.apply(this, arguments);
            null == c ? this.removeAttribute(a) : this.setAttribute(a, c)
        }
        function h() {
            var c = b.apply(this, arguments);
            null == c ? this.removeAttributeNS(a.space, a.local) : this.setAttributeNS(a.space, a.local, c)
        }
        return a = Wg.ns.qualify(a),
        null == b ? a.local ? d : c : "function" == typeof b ? a.local ? h : g : a.local ? f : e
    }
    function s(a) {
        return a.trim().replace(/\s+/g, " ")
    }
    function t(a) {
        return new RegExp("(?:^|\\s+)" + Wg.requote(a) + "(?:\\s+|$)","g")
    }
    function u(a) {
        return a.trim().split(/^|\s+/)
    }
    function v(a, b) {
        function c() {
            for (var c = -1; ++c < e; )
                a[c](this, b)
        }
        function d() {
            for (var c = -1, d = b.apply(this, arguments); ++c < e; )
                a[c](this, d)
        }
        a = u(a).map(w);
        var e = a.length;
        return "function" == typeof b ? d : c
    }
    function w(a) {
        var b = t(a);
        return function(c, d) {
            if (e = c.classList)
                return d ? e.add(a) : e.remove(a);
            var e = c.getAttribute("class") || "";
            d ? (b.lastIndex = 0,
            b.test(e) || c.setAttribute("class", s(e + " " + a))) : c.setAttribute("class", s(e.replace(b, " ")))
        }
    }
    function x(a, b, c) {
        function d() {
            this.style.removeProperty(a)
        }
        function e() {
            this.style.setProperty(a, b, c)
        }
        function f() {
            var d = b.apply(this, arguments);
            null == d ? this.style.removeProperty(a) : this.style.setProperty(a, d, c)
        }
        return null == b ? d : "function" == typeof b ? f : e
    }
    function y(a, b) {
        function c() {
            delete this[a]
        }
        function d() {
            this[a] = b
        }
        function e() {
            var c = b.apply(this, arguments);
            null == c ? delete this[a] : this[a] = c
        }
        return null == b ? c : "function" == typeof b ? e : d
    }
    function z(a) {
        return "function" == typeof a ? a : (a = Wg.ns.qualify(a)).local ? function() {
            return this.ownerDocument.createElementNS(a.space, a.local)
        }
        : function() {
            return this.ownerDocument.createElementNS(this.namespaceURI, a)
        }
    }
    function A(a) {
        return {
            __data__: a
        }
    }
    function B(a) {
        return function() {
            return rh(this, a)
        }
    }
    function C(a) {
        return arguments.length || (a = Wg.ascending),
        function(b, c) {
            return b && c ? a(b.__data__, c.__data__) : !b - !c
        }
    }
    function D(a, b) {
        for (var c = 0, d = a.length; d > c; c++)
            for (var e, f = a[c], g = 0, h = f.length; h > g; g++)
                (e = f[g]) && b(e, g, c);
        return a
    }
    function E(a) {
        return nh(a, uh),
        a
    }
    function F(a) {
        var b, c;
        return function(d, e, f) {
            var g, h = a[f].update, i = h.length;
            for (f != c && (c = f,
            b = 0),
            e >= b && (b = e + 1); !(g = h[b]) && ++b < i; )
                ;
            return g
        }
    }
    function G() {
        var a = this.__transition__;
        a && ++a.active
    }
    function H(a, b, c) {
        function d() {
            var b = this[g];
            b && (this.removeEventListener(a, b, b.$),
            delete this[g])
        }
        function e() {
            var e = j(b, Yg(arguments));
            d.call(this),
            this.addEventListener(a, this[g] = e, e.$ = c),
            e._ = b
        }
        function f() {
            var b, c = new RegExp("^__on([^.]+)" + Wg.requote(a) + "$");
            for (var d in this)
                if (b = d.match(c)) {
                    var e = this[d];
                    this.removeEventListener(b[1], e, e.$),
                    delete this[d]
                }
        }
        var g = "__on" + a
          , h = a.indexOf(".")
          , j = I;
        h > 0 && (a = a.substring(0, h));
        var k = wh.get(a);
        return k && (a = k,
        j = J),
        h ? b ? e : d : b ? i : f
    }
    function I(a, b) {
        return function(c) {
            var d = Wg.event;
            Wg.event = c,
            b[0] = this.__data__;
            try {
                a.apply(this, b)
            } finally {
                Wg.event = d
            }
        }
    }
    function J(a, b) {
        var c = I(a, b);
        return function(a) {
            var b = this
              , d = a.relatedTarget;
            d && (d === b || 8 & d.compareDocumentPosition(b)) || c.call(b, a)
        }
    }
    function K() {
        var a = ".dragsuppress-" + ++yh
          , b = "click" + a
          , c = Wg.select(_g).on("touchmove" + a, l).on("dragstart" + a, l).on("selectstart" + a, l);
        if (xh) {
            var d = $g.style
              , e = d[xh];
            d[xh] = "none"
        }
        return function(f) {
            function g() {
                c.on(b, null)
            }
            c.on(a, null),
            xh && (d[xh] = e),
            f && (c.on(b, function() {
                l(),
                g()
            }, !0),
            setTimeout(g, 0))
        }
    }
    function L(a, b) {
        b.changedTouches && (b = b.changedTouches[0]);
        var c = a.ownerSVGElement || a;
        if (c.createSVGPoint) {
            var d = c.createSVGPoint();
            if (0 > zh && (_g.scrollX || _g.scrollY)) {
                c = Wg.select("body").append("svg").style({
                    position: "absolute",
                    top: 0,
                    left: 0,
                    margin: 0,
                    padding: 0,
                    border: "none"
                }, "important");
                var e = c[0][0].getScreenCTM();
                zh = !(e.f || e.e),
                c.remove()
            }
            return zh ? (d.x = b.pageX,
            d.y = b.pageY) : (d.x = b.clientX,
            d.y = b.clientY),
            d = d.matrixTransform(a.getScreenCTM().inverse()),
            [d.x, d.y]
        }
        var f = a.getBoundingClientRect();
        return [b.clientX - f.left - a.clientLeft, b.clientY - f.top - a.clientTop]
    }
    function M(a) {
        return a > 0 ? 1 : 0 > a ? -1 : 0
    }
    function N(a) {
        return a > 1 ? 0 : -1 > a ? Ah : Math.acos(a)
    }
    function O(a) {
        return a > 1 ? Ch : -1 > a ? -Ch : Math.asin(a)
    }
    function P(a) {
        return ((a = Math.exp(a)) - 1 / a) / 2
    }
    function Q(a) {
        return ((a = Math.exp(a)) + 1 / a) / 2
    }
    function R(a) {
        return ((a = Math.exp(2 * a)) - 1) / (a + 1)
    }
    function S(a) {
        return (a = Math.sin(a / 2)) * a
    }
    function T() {}
    function U(a, b, c) {
        return new V(a,b,c)
    }
    function V(a, b, c) {
        this.h = a,
        this.s = b,
        this.l = c
    }
    function W(a, b, c) {
        function d(a) {
            return a > 360 ? a -= 360 : 0 > a && (a += 360),
            60 > a ? f + (g - f) * a / 60 : 180 > a ? g : 240 > a ? f + (g - f) * (240 - a) / 60 : f
        }
        function e(a) {
            return Math.round(255 * d(a))
        }
        var f, g;
        return a = isNaN(a) ? 0 : (a %= 360) < 0 ? a + 360 : a,
        b = isNaN(b) ? 0 : 0 > b ? 0 : b > 1 ? 1 : b,
        c = 0 > c ? 0 : c > 1 ? 1 : c,
        g = .5 >= c ? c * (1 + b) : c + b - c * b,
        f = 2 * c - g,
        hb(e(a + 120), e(a), e(a - 120))
    }
    function X(a, b, c) {
        return new Y(a,b,c)
    }
    function Y(a, b, c) {
        this.h = a,
        this.c = b,
        this.l = c
    }
    function Z(a, b, c) {
        return isNaN(a) && (a = 0),
        isNaN(b) && (b = 0),
        $(c, Math.cos(a *= Fh) * b, Math.sin(a) * b)
    }
    function $(a, b, c) {
        return new _(a,b,c)
    }
    function _(a, b, c) {
        this.l = a,
        this.a = b,
        this.b = c
    }
    function ab(a, b, c) {
        var d = (a + 16) / 116
          , e = d + b / 500
          , f = d - c / 200;
        return e = cb(e) * Qh,
        d = cb(d) * Rh,
        f = cb(f) * Sh,
        hb(eb(3.2404542 * e - 1.5371385 * d - .4985314 * f), eb(-.969266 * e + 1.8760108 * d + .041556 * f), eb(.0556434 * e - .2040259 * d + 1.0572252 * f))
    }
    function bb(a, b, c) {
        return a > 0 ? X(Math.atan2(c, b) * Gh, Math.sqrt(b * b + c * c), a) : X(0 / 0, 0 / 0, a)
    }
    function cb(a) {
        return a > .206893034 ? a * a * a : (a - 4 / 29) / 7.787037
    }
    function db(a) {
        return a > .008856 ? Math.pow(a, 1 / 3) : 7.787037 * a + 4 / 29
    }
    function eb(a) {
        return Math.round(255 * (.00304 >= a ? 12.92 * a : 1.055 * Math.pow(a, 1 / 2.4) - .055))
    }
    function fb(a) {
        return hb(a >> 16, a >> 8 & 255, 255 & a)
    }
    function gb(a) {
        return fb(a) + ""
    }
    function hb(a, b, c) {
        return new ib(a,b,c)
    }
    function ib(a, b, c) {
        this.r = a,
        this.g = b,
        this.b = c
    }
    function jb(a) {
        return 16 > a ? "0" + Math.max(0, a).toString(16) : Math.min(255, a).toString(16)
    }
    function kb(a, b, c) {
        var d, e, f, g = 0, h = 0, i = 0;
        if (d = /([a-z]+)\((.*)\)/i.exec(a))
            switch (e = d[2].split(","),
            d[1]) {
            case "hsl":
                return c(parseFloat(e[0]), parseFloat(e[1]) / 100, parseFloat(e[2]) / 100);
            case "rgb":
                return b(ob(e[0]), ob(e[1]), ob(e[2]))
            }
        return (f = Vh.get(a)) ? b(f.r, f.g, f.b) : (null != a && "#" === a.charAt(0) && (4 === a.length ? (g = a.charAt(1),
        g += g,
        h = a.charAt(2),
        h += h,
        i = a.charAt(3),
        i += i) : 7 === a.length && (g = a.substring(1, 3),
        h = a.substring(3, 5),
        i = a.substring(5, 7)),
        g = parseInt(g, 16),
        h = parseInt(h, 16),
        i = parseInt(i, 16)),
        b(g, h, i))
    }
    function lb(a, b, c) {
        var d, e, f = Math.min(a /= 255, b /= 255, c /= 255), g = Math.max(a, b, c), h = g - f, i = (g + f) / 2;
        return h ? (e = .5 > i ? h / (g + f) : h / (2 - g - f),
        d = a == g ? (b - c) / h + (c > b ? 6 : 0) : b == g ? (c - a) / h + 2 : (a - b) / h + 4,
        d *= 60) : (d = 0 / 0,
        e = i > 0 && 1 > i ? 0 : d),
        U(d, e, i)
    }
    function mb(a, b, c) {
        a = nb(a),
        b = nb(b),
        c = nb(c);
        var d = db((.4124564 * a + .3575761 * b + .1804375 * c) / Qh)
          , e = db((.2126729 * a + .7151522 * b + .072175 * c) / Rh)
          , f = db((.0193339 * a + .119192 * b + .9503041 * c) / Sh);
        return $(116 * e - 16, 500 * (d - e), 200 * (e - f))
    }
    function nb(a) {
        return (a /= 255) <= .04045 ? a / 12.92 : Math.pow((a + .055) / 1.055, 2.4)
    }
    function ob(a) {
        var b = parseFloat(a);
        return "%" === a.charAt(a.length - 1) ? Math.round(2.55 * b) : b
    }
    function pb(a) {
        return "function" == typeof a ? a : function() {
            return a
        }
    }
    function qb(a) {
        return a
    }
    function rb(a) {
        return function(b, c, d) {
            return 2 === arguments.length && "function" == typeof c && (d = c,
            c = null),
            sb(b, c, a, d)
        }
    }
    function sb(a, b, c, d) {
        function e() {
            var a, b = i.status;
            if (!b && i.responseText || b >= 200 && 300 > b || 304 === b) {
                try {
                    a = c.call(f, i)
                } catch (d) {
                    return g.error.call(f, d),
                    void 0
                }
                g.load.call(f, a)
            } else
                g.error.call(f, i)
        }
        var f = {}
          , g = Wg.dispatch("beforesend", "progress", "load", "error")
          , h = {}
          , i = new XMLHttpRequest
          , j = null;
        return !_g.XDomainRequest || "withCredentials"in i || !/^(http(s)?:)?\/\//.test(a) || (i = new XDomainRequest),
        "onload"in i ? i.onload = i.onerror = e : i.onreadystatechange = function() {
            i.readyState > 3 && e()
        }
        ,
        i.onprogress = function(a) {
            var b = Wg.event;
            Wg.event = a;
            try {
                g.progress.call(f, i)
            } finally {
                Wg.event = b
            }
        }
        ,
        f.header = function(a, b) {
            return a = (a + "").toLowerCase(),
            arguments.length < 2 ? h[a] : (null == b ? delete h[a] : h[a] = b + "",
            f)
        }
        ,
        f.mimeType = function(a) {
            return arguments.length ? (b = null == a ? null : a + "",
            f) : b
        }
        ,
        f.responseType = function(a) {
            return arguments.length ? (j = a,
            f) : j
        }
        ,
        f.response = function(a) {
            return c = a,
            f
        }
        ,
        ["get", "post"].forEach(function(a) {
            f[a] = function() {
                return f.send.apply(f, [a].concat(Yg(arguments)))
            }
        }),
        f.send = function(c, d, e) {
            if (2 === arguments.length && "function" == typeof d && (e = d,
            d = null),
            i.open(c, a, !0),
            null == b || "accept"in h || (h.accept = b + ",*/*"),
            i.setRequestHeader)
                for (var k in h)
                    i.setRequestHeader(k, h[k]);
            return null != b && i.overrideMimeType && i.overrideMimeType(b),
            null != j && (i.responseType = j),
            null != e && f.on("error", e).on("load", function(a) {
                e(null, a)
            }),
            g.beforesend.call(f, i),
            i.send(null == d ? null : d),
            f
        }
        ,
        f.abort = function() {
            return i.abort(),
            f
        }
        ,
        Wg.rebind(f, g, "on"),
        null == d ? f : f.get(tb(d))
    }
    function tb(a) {
        return 1 === a.length ? function(b, c) {
            a(null == b ? c : null)
        }
        : a
    }
    function ub() {
        var a = vb()
          , b = wb() - a;
        b > 24 ? (isFinite(b) && (clearTimeout(Zh),
        Zh = setTimeout(ub, b)),
        Yh = 0) : (Yh = 1,
        _h(ub))
    }
    function vb() {
        var a = Date.now();
        for ($h = Wh; $h; )
            a >= $h.t && ($h.f = $h.c(a - $h.t)),
            $h = $h.n;
        return a
    }
    function wb() {
        for (var a, b = Wh, c = 1 / 0; b; )
            b.f ? b = a ? a.n = b.n : Wh = b.n : (b.t < c && (c = b.t),
            b = (a = b).n);
        return Xh = a,
        c
    }
    function xb(a, b) {
        var c = Math.pow(10, 3 * ih(8 - b));
        return {
            scale: b > 8 ? function(a) {
                return a / c
            }
            : function(a) {
                return a * c
            }
            ,
            symbol: a
        }
    }
    function yb(a, b) {
        return b - (a ? Math.ceil(Math.log(a) / Math.LN10) : 1)
    }
    function zb(a) {
        return a + ""
    }
    function Ab() {}
    function Bb(a, b, c) {
        var d = c.s = a + b
          , e = d - a
          , f = d - e;
        c.t = a - f + (b - e)
    }
    function Cb(a, b) {
        a && li.hasOwnProperty(a.type) && li[a.type](a, b)
    }
    function Db(a, b, c) {
        var d, e = -1, f = a.length - c;
        for (b.lineStart(); ++e < f; )
            d = a[e],
            b.point(d[0], d[1], d[2]);
        b.lineEnd()
    }
    function Eb(a, b) {
        var c = -1
          , d = a.length;
        for (b.polygonStart(); ++c < d; )
            Db(a[c], b, 1);
        b.polygonEnd()
    }
    function Fb() {
        function a(a, b) {
            a *= Fh,
            b = b * Fh / 2 + Ah / 4;
            var c = a - d
              , g = Math.cos(b)
              , h = Math.sin(b)
              , i = f * h
              , j = e * g + i * Math.cos(c)
              , k = i * Math.sin(c);
            ni.add(Math.atan2(k, j)),
            d = a,
            e = g,
            f = h
        }
        var b, c, d, e, f;
        oi.point = function(g, h) {
            oi.point = a,
            d = (b = g) * Fh,
            e = Math.cos(h = (c = h) * Fh / 2 + Ah / 4),
            f = Math.sin(h)
        }
        ,
        oi.lineEnd = function() {
            a(b, c)
        }
    }
    function Gb(a) {
        var b = a[0]
          , c = a[1]
          , d = Math.cos(c);
        return [d * Math.cos(b), d * Math.sin(b), Math.sin(c)]
    }
    function Hb(a, b) {
        return a[0] * b[0] + a[1] * b[1] + a[2] * b[2]
    }
    function Ib(a, b) {
        return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]]
    }
    function Jb(a, b) {
        a[0] += b[0],
        a[1] += b[1],
        a[2] += b[2]
    }
    function Kb(a, b) {
        return [a[0] * b, a[1] * b, a[2] * b]
    }
    function Lb(a) {
        var b = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);
        a[0] /= b,
        a[1] /= b,
        a[2] /= b
    }
    function Mb(a) {
        return [Math.atan2(a[1], a[0]), O(a[2])]
    }
    function Nb(a, b) {
        return ih(a[0] - b[0]) < Dh && ih(a[1] - b[1]) < Dh
    }
    function Ob(a, b) {
        a *= Fh;
        var c = Math.cos(b *= Fh);
        Pb(c * Math.cos(a), c * Math.sin(a), Math.sin(b))
    }
    function Pb(a, b, c) {
        ++pi,
        ri += (a - ri) / pi,
        si += (b - si) / pi,
        ti += (c - ti) / pi
    }
    function Qb() {
        function a(a, e) {
            a *= Fh;
            var f = Math.cos(e *= Fh)
              , g = f * Math.cos(a)
              , h = f * Math.sin(a)
              , i = Math.sin(e)
              , j = Math.atan2(Math.sqrt((j = c * i - d * h) * j + (j = d * g - b * i) * j + (j = b * h - c * g) * j), b * g + c * h + d * i);
            qi += j,
            ui += j * (b + (b = g)),
            vi += j * (c + (c = h)),
            wi += j * (d + (d = i)),
            Pb(b, c, d)
        }
        var b, c, d;
        Ai.point = function(e, f) {
            e *= Fh;
            var g = Math.cos(f *= Fh);
            b = g * Math.cos(e),
            c = g * Math.sin(e),
            d = Math.sin(f),
            Ai.point = a,
            Pb(b, c, d)
        }
    }
    function Rb() {
        Ai.point = Ob
    }
    function Sb() {
        function a(a, b) {
            a *= Fh;
            var c = Math.cos(b *= Fh)
              , g = c * Math.cos(a)
              , h = c * Math.sin(a)
              , i = Math.sin(b)
              , j = e * i - f * h
              , k = f * g - d * i
              , l = d * h - e * g
              , m = Math.sqrt(j * j + k * k + l * l)
              , n = d * g + e * h + f * i
              , o = m && -N(n) / m
              , p = Math.atan2(m, n);
            xi += o * j,
            yi += o * k,
            zi += o * l,
            qi += p,
            ui += p * (d + (d = g)),
            vi += p * (e + (e = h)),
            wi += p * (f + (f = i)),
            Pb(d, e, f)
        }
        var b, c, d, e, f;
        Ai.point = function(g, h) {
            b = g,
            c = h,
            Ai.point = a,
            g *= Fh;
            var i = Math.cos(h *= Fh);
            d = i * Math.cos(g),
            e = i * Math.sin(g),
            f = Math.sin(h),
            Pb(d, e, f)
        }
        ,
        Ai.lineEnd = function() {
            a(b, c),
            Ai.lineEnd = Rb,
            Ai.point = Ob
        }
    }
    function Tb() {
        return !0
    }
    function Ub(a, b, c, d, e) {
        var f = []
          , g = [];
        if (a.forEach(function(a) {
            if (!((b = a.length - 1) <= 0)) {
                var b, c = a[0], d = a[b];
                if (Nb(c, d)) {
                    e.lineStart();
                    for (var h = 0; b > h; ++h)
                        e.point((c = a[h])[0], c[1]);
                    return e.lineEnd(),
                    void 0
                }
                var i = new Wb(c,a,null,!0)
                  , j = new Wb(c,null,i,!1);
                i.o = j,
                f.push(i),
                g.push(j),
                i = new Wb(d,a,null,!1),
                j = new Wb(d,null,i,!0),
                i.o = j,
                f.push(i),
                g.push(j)
            }
        }),
        g.sort(b),
        Vb(f),
        Vb(g),
        f.length) {
            for (var h = 0, i = c, j = g.length; j > h; ++h)
                g[h].e = i = !i;
            for (var k, l, m = f[0]; ; ) {
                for (var n = m, o = !0; n.v; )
                    if ((n = n.n) === m)
                        return;
                k = n.z,
                e.lineStart();
                do {
                    if (n.v = n.o.v = !0,
                    n.e) {
                        if (o)
                            for (var h = 0, j = k.length; j > h; ++h)
                                e.point((l = k[h])[0], l[1]);
                        else
                            d(n.x, n.n.x, 1, e);
                        n = n.n
                    } else {
                        if (o) {
                            k = n.p.z;
                            for (var h = k.length - 1; h >= 0; --h)
                                e.point((l = k[h])[0], l[1])
                        } else
                            d(n.x, n.p.x, -1, e);
                        n = n.p
                    }
                    n = n.o,
                    k = n.z,
                    o = !o
                } while (!n.v);e.lineEnd()
            }
        }
    }
    function Vb(a) {
        if (b = a.length) {
            for (var b, c, d = 0, e = a[0]; ++d < b; )
                e.n = c = a[d],
                c.p = e,
                e = c;
            e.n = c = a[0],
            c.p = e
        }
    }
    function Wb(a, b, c, d) {
        this.x = a,
        this.z = b,
        this.o = c,
        this.e = d,
        this.v = !1,
        this.n = this.p = null
    }
    function Xb(a, b, c, d) {
        return function(e, f) {
            function g(b, c) {
                var d = e(b, c);
                a(b = d[0], c = d[1]) && f.point(b, c)
            }
            function h(a, b) {
                var c = e(a, b);
                q.point(c[0], c[1])
            }
            function i() {
                s.point = h,
                q.lineStart()
            }
            function j() {
                s.point = g,
                q.lineEnd()
            }
            function k(a, b) {
                p.push([a, b]);
                var c = e(a, b);
                u.point(c[0], c[1])
            }
            function l() {
                u.lineStart(),
                p = []
            }
            function m() {
                k(p[0][0], p[0][1]),
                u.lineEnd();
                var a, b = u.clean(), c = t.buffer(), d = c.length;
                if (p.pop(),
                o.push(p),
                p = null,
                d) {
                    if (1 & b) {
                        a = c[0];
                        var e, d = a.length - 1, g = -1;
                        for (f.lineStart(); ++g < d; )
                            f.point((e = a[g])[0], e[1]);
                        return f.lineEnd(),
                        void 0
                    }
                    d > 1 && 2 & b && c.push(c.pop().concat(c.shift())),
                    n.push(c.filter(Yb))
                }
            }
            var n, o, p, q = b(f), r = e.invert(d[0], d[1]), s = {
                point: g,
                lineStart: i,
                lineEnd: j,
                polygonStart: function() {
                    s.point = k,
                    s.lineStart = l,
                    s.lineEnd = m,
                    n = [],
                    o = [],
                    f.polygonStart()
                },
                polygonEnd: function() {
                    s.point = g,
                    s.lineStart = i,
                    s.lineEnd = j,
                    n = Wg.merge(n);
                    var a = _b(r, o);
                    n.length ? Ub(n, $b, a, c, f) : a && (f.lineStart(),
                    c(null, null, 1, f),
                    f.lineEnd()),
                    f.polygonEnd(),
                    n = o = null
                },
                sphere: function() {
                    f.polygonStart(),
                    f.lineStart(),
                    c(null, null, 1, f),
                    f.lineEnd(),
                    f.polygonEnd()
                }
            }, t = Zb(), u = b(t);
            return s
        }
    }
    function Yb(a) {
        return a.length > 1
    }
    function Zb() {
        var a, b = [];
        return {
            lineStart: function() {
                b.push(a = [])
            },
            point: function(b, c) {
                a.push([b, c])
            },
            lineEnd: i,
            buffer: function() {
                var c = b;
                return b = [],
                a = null,
                c
            },
            rejoin: function() {
                b.length > 1 && b.push(b.pop().concat(b.shift()))
            }
        }
    }
    function $b(a, b) {
        return ((a = a.x)[0] < 0 ? a[1] - Ch - Dh : Ch - a[1]) - ((b = b.x)[0] < 0 ? b[1] - Ch - Dh : Ch - b[1])
    }
    function _b(a, b) {
        var c = a[0]
          , d = a[1]
          , e = [Math.sin(c), -Math.cos(c), 0]
          , f = 0
          , g = 0;
        ni.reset();
        for (var h = 0, i = b.length; i > h; ++h) {
            var j = b[h]
              , k = j.length;
            if (k)
                for (var l = j[0], m = l[0], n = l[1] / 2 + Ah / 4, o = Math.sin(n), p = Math.cos(n), q = 1; ; ) {
                    q === k && (q = 0),
                    a = j[q];
                    var r = a[0]
                      , s = a[1] / 2 + Ah / 4
                      , t = Math.sin(s)
                      , u = Math.cos(s)
                      , v = r - m
                      , w = ih(v) > Ah
                      , x = o * t;
                    if (ni.add(Math.atan2(x * Math.sin(v), p * u + x * Math.cos(v))),
                    f += w ? v + (v >= 0 ? Bh : -Bh) : v,
                    w ^ m >= c ^ r >= c) {
                        var y = Ib(Gb(l), Gb(a));
                        Lb(y);
                        var z = Ib(e, y);
                        Lb(z);
                        var A = (w ^ v >= 0 ? -1 : 1) * O(z[2]);
                        (d > A || d === A && (y[0] || y[1])) && (g += w ^ v >= 0 ? 1 : -1)
                    }
                    if (!q++)
                        break;
                    m = r,
                    o = t,
                    p = u,
                    l = a
                }
        }
        return (-Dh > f || Dh > f && 0 > ni) ^ 1 & g
    }
    function ac(a) {
        var b, c = 0 / 0, d = 0 / 0, e = 0 / 0;
        return {
            lineStart: function() {
                a.lineStart(),
                b = 1
            },
            point: function(f, g) {
                var h = f > 0 ? Ah : -Ah
                  , i = ih(f - c);
                ih(i - Ah) < Dh ? (a.point(c, d = (d + g) / 2 > 0 ? Ch : -Ch),
                a.point(e, d),
                a.lineEnd(),
                a.lineStart(),
                a.point(h, d),
                a.point(f, d),
                b = 0) : e !== h && i >= Ah && (ih(c - e) < Dh && (c -= e * Dh),
                ih(f - h) < Dh && (f -= h * Dh),
                d = bc(c, d, f, g),
                a.point(e, d),
                a.lineEnd(),
                a.lineStart(),
                a.point(h, d),
                b = 0),
                a.point(c = f, d = g),
                e = h
            },
            lineEnd: function() {
                a.lineEnd(),
                c = d = 0 / 0
            },
            clean: function() {
                return 2 - b
            }
        }
    }
    function bc(a, b, c, d) {
        var e, f, g = Math.sin(a - c);
        return ih(g) > Dh ? Math.atan((Math.sin(b) * (f = Math.cos(d)) * Math.sin(c) - Math.sin(d) * (e = Math.cos(b)) * Math.sin(a)) / (e * f * g)) : (b + d) / 2
    }
    function cc(a, b, c, d) {
        var e;
        if (null == a)
            e = c * Ch,
            d.point(-Ah, e),
            d.point(0, e),
            d.point(Ah, e),
            d.point(Ah, 0),
            d.point(Ah, -e),
            d.point(0, -e),
            d.point(-Ah, -e),
            d.point(-Ah, 0),
            d.point(-Ah, e);
        else if (ih(a[0] - b[0]) > Dh) {
            var f = a[0] < b[0] ? Ah : -Ah;
            e = c * f / 2,
            d.point(-f, e),
            d.point(0, e),
            d.point(f, e)
        } else
            d.point(b[0], b[1])
    }
    function dc(a) {
        function b(a, b) {
            return Math.cos(a) * Math.cos(b) > f
        }
        function c(a) {
            var c, f, i, j, k;
            return {
                lineStart: function() {
                    j = i = !1,
                    k = 1
                },
                point: function(l, m) {
                    var n, o = [l, m], p = b(l, m), q = g ? p ? 0 : e(l, m) : p ? e(l + (0 > l ? Ah : -Ah), m) : 0;
                    if (!c && (j = i = p) && a.lineStart(),
                    p !== i && (n = d(c, o),
                    (Nb(c, n) || Nb(o, n)) && (o[0] += Dh,
                    o[1] += Dh,
                    p = b(o[0], o[1]))),
                    p !== i)
                        k = 0,
                        p ? (a.lineStart(),
                        n = d(o, c),
                        a.point(n[0], n[1])) : (n = d(c, o),
                        a.point(n[0], n[1]),
                        a.lineEnd()),
                        c = n;
                    else if (h && c && g ^ p) {
                        var r;
                        q & f || !(r = d(o, c, !0)) || (k = 0,
                        g ? (a.lineStart(),
                        a.point(r[0][0], r[0][1]),
                        a.point(r[1][0], r[1][1]),
                        a.lineEnd()) : (a.point(r[1][0], r[1][1]),
                        a.lineEnd(),
                        a.lineStart(),
                        a.point(r[0][0], r[0][1])))
                    }
                    !p || c && Nb(c, o) || a.point(o[0], o[1]),
                    c = o,
                    i = p,
                    f = q
                },
                lineEnd: function() {
                    i && a.lineEnd(),
                    c = null
                },
                clean: function() {
                    return k | (j && i) << 1
                }
            }
        }
        function d(a, b, c) {
            var d = Gb(a)
              , e = Gb(b)
              , g = [1, 0, 0]
              , h = Ib(d, e)
              , i = Hb(h, h)
              , j = h[0]
              , k = i - j * j;
            if (!k)
                return !c && a;
            var l = f * i / k
              , m = -f * j / k
              , n = Ib(g, h)
              , o = Kb(g, l)
              , p = Kb(h, m);
            Jb(o, p);
            var q = n
              , r = Hb(o, q)
              , s = Hb(q, q)
              , t = r * r - s * (Hb(o, o) - 1);
            if (!(0 > t)) {
                var u = Math.sqrt(t)
                  , v = Kb(q, (-r - u) / s);
                if (Jb(v, o),
                v = Mb(v),
                !c)
                    return v;
                var w, x = a[0], y = b[0], z = a[1], A = b[1];
                x > y && (w = x,
                x = y,
                y = w);
                var B = y - x
                  , C = ih(B - Ah) < Dh
                  , D = C || Dh > B;
                if (!C && z > A && (w = z,
                z = A,
                A = w),
                D ? C ? z + A > 0 ^ v[1] < (ih(v[0] - x) < Dh ? z : A) : z <= v[1] && v[1] <= A : B > Ah ^ (x <= v[0] && v[0] <= y)) {
                    var E = Kb(q, (-r + u) / s);
                    return Jb(E, o),
                    [v, Mb(E)]
                }
            }
        }
        function e(b, c) {
            var d = g ? a : Ah - a
              , e = 0;
            return -d > b ? e |= 1 : b > d && (e |= 2),
            -d > c ? e |= 4 : c > d && (e |= 8),
            e
        }
        var f = Math.cos(a)
          , g = f > 0
          , h = ih(f) > Dh
          , i = Fc(a, 6 * Fh);
        return Xb(b, c, i, g ? [0, -a] : [-Ah, a - Ah])
    }
    function ec(a, b, c, d) {
        return function(e) {
            var f, g = e.a, h = e.b, i = g.x, j = g.y, k = h.x, l = h.y, m = 0, n = 1, o = k - i, p = l - j;
            if (f = a - i,
            o || !(f > 0)) {
                if (f /= o,
                0 > o) {
                    if (m > f)
                        return;
                    n > f && (n = f)
                } else if (o > 0) {
                    if (f > n)
                        return;
                    f > m && (m = f)
                }
                if (f = c - i,
                o || !(0 > f)) {
                    if (f /= o,
                    0 > o) {
                        if (f > n)
                            return;
                        f > m && (m = f)
                    } else if (o > 0) {
                        if (m > f)
                            return;
                        n > f && (n = f)
                    }
                    if (f = b - j,
                    p || !(f > 0)) {
                        if (f /= p,
                        0 > p) {
                            if (m > f)
                                return;
                            n > f && (n = f)
                        } else if (p > 0) {
                            if (f > n)
                                return;
                            f > m && (m = f)
                        }
                        if (f = d - j,
                        p || !(0 > f)) {
                            if (f /= p,
                            0 > p) {
                                if (f > n)
                                    return;
                                f > m && (m = f)
                            } else if (p > 0) {
                                if (m > f)
                                    return;
                                n > f && (n = f)
                            }
                            return m > 0 && (e.a = {
                                x: i + m * o,
                                y: j + m * p
                            }),
                            1 > n && (e.b = {
                                x: i + n * o,
                                y: j + n * p
                            }),
                            e
                        }
                    }
                }
            }
        }
    }
    function fc(a, b, c, d) {
        function e(d, e) {
            return ih(d[0] - a) < Dh ? e > 0 ? 0 : 3 : ih(d[0] - c) < Dh ? e > 0 ? 2 : 1 : ih(d[1] - b) < Dh ? e > 0 ? 1 : 0 : e > 0 ? 3 : 2
        }
        function f(a, b) {
            return g(a.x, b.x)
        }
        function g(a, b) {
            var c = e(a, 1)
              , d = e(b, 1);
            return c !== d ? c - d : 0 === c ? b[1] - a[1] : 1 === c ? a[0] - b[0] : 2 === c ? a[1] - b[1] : b[0] - a[0]
        }
        return function(h) {
            function i(a) {
                for (var b = 0, c = r.length, d = a[1], e = 0; c > e; ++e)
                    for (var f, g = 1, h = r[e], i = h.length, k = h[0]; i > g; ++g)
                        f = h[g],
                        k[1] <= d ? f[1] > d && j(k, f, a) > 0 && ++b : f[1] <= d && j(k, f, a) < 0 && --b,
                        k = f;
                return 0 !== b
            }
            function j(a, b, c) {
                return (b[0] - a[0]) * (c[1] - a[1]) - (c[0] - a[0]) * (b[1] - a[1])
            }
            function k(f, h, i, j) {
                var k = 0
                  , l = 0;
                if (null == f || (k = e(f, i)) !== (l = e(h, i)) || g(f, h) < 0 ^ i > 0) {
                    do
                        j.point(0 === k || 3 === k ? a : c, k > 1 ? d : b);
                    while ((k = (k + i + 4) % 4) !== l)
                } else
                    j.point(h[0], h[1])
            }
            function l(e, f) {
                return e >= a && c >= e && f >= b && d >= f
            }
            function m(a, b) {
                l(a, b) && h.point(a, b)
            }
            function n() {
                E.point = p,
                r && r.push(s = []),
                z = !0,
                y = !1,
                w = x = 0 / 0
            }
            function o() {
                q && (p(t, u),
                v && y && C.rejoin(),
                q.push(C.buffer())),
                E.point = m,
                y && h.lineEnd()
            }
            function p(a, b) {
                a = Math.max(-Ci, Math.min(Ci, a)),
                b = Math.max(-Ci, Math.min(Ci, b));
                var c = l(a, b);
                if (r && s.push([a, b]),
                z)
                    t = a,
                    u = b,
                    v = c,
                    z = !1,
                    c && (h.lineStart(),
                    h.point(a, b));
                else if (c && y)
                    h.point(a, b);
                else {
                    var d = {
                        a: {
                            x: w,
                            y: x
                        },
                        b: {
                            x: a,
                            y: b
                        }
                    };
                    D(d) ? (y || (h.lineStart(),
                    h.point(d.a.x, d.a.y)),
                    h.point(d.b.x, d.b.y),
                    c || h.lineEnd(),
                    A = !1) : c && (h.lineStart(),
                    h.point(a, b),
                    A = !1)
                }
                w = a,
                x = b,
                y = c
            }
            var q, r, s, t, u, v, w, x, y, z, A, B = h, C = Zb(), D = ec(a, b, c, d), E = {
                point: m,
                lineStart: n,
                lineEnd: o,
                polygonStart: function() {
                    h = C,
                    q = [],
                    r = [],
                    A = !0
                },
                polygonEnd: function() {
                    h = B,
                    q = Wg.merge(q);
                    var b = i([a, d])
                      , c = A && b
                      , e = q.length;
                    (c || e) && (h.polygonStart(),
                    c && (h.lineStart(),
                    k(null, null, 1, h),
                    h.lineEnd()),
                    e && Ub(q, f, b, k, h),
                    h.polygonEnd()),
                    q = r = s = null
                }
            };
            return E
        }
    }
    function gc(a, b) {
        function c(c, d) {
            return c = a(c, d),
            b(c[0], c[1])
        }
        return a.invert && b.invert && (c.invert = function(c, d) {
            return c = b.invert(c, d),
            c && a.invert(c[0], c[1])
        }
        ),
        c
    }
    function hc(a) {
        var b = 0
          , c = Ah / 3
          , d = xc(a)
          , e = d(b, c);
        return e.parallels = function(a) {
            return arguments.length ? d(b = a[0] * Ah / 180, c = a[1] * Ah / 180) : [b / Ah * 180, c / Ah * 180]
        }
        ,
        e
    }
    function ic(a, b) {
        function c(a, b) {
            var c = Math.sqrt(f - 2 * e * Math.sin(b)) / e;
            return [c * Math.sin(a *= e), g - c * Math.cos(a)]
        }
        var d = Math.sin(a)
          , e = (d + Math.sin(b)) / 2
          , f = 1 + d * (2 * e - d)
          , g = Math.sqrt(f) / e;
        return c.invert = function(a, b) {
            var c = g - b;
            return [Math.atan2(a, c) / e, O((f - (a * a + c * c) * e * e) / (2 * e))]
        }
        ,
        c
    }
    function jc() {
        function a(a, b) {
            Ei += e * a - d * b,
            d = a,
            e = b
        }
        var b, c, d, e;
        Ji.point = function(f, g) {
            Ji.point = a,
            b = d = f,
            c = e = g
        }
        ,
        Ji.lineEnd = function() {
            a(b, c)
        }
    }
    function kc(a, b) {
        Fi > a && (Fi = a),
        a > Hi && (Hi = a),
        Gi > b && (Gi = b),
        b > Ii && (Ii = b)
    }
    function lc() {
        function a(a, b) {
            g.push("M", a, ",", b, f)
        }
        function b(a, b) {
            g.push("M", a, ",", b),
            h.point = c
        }
        function c(a, b) {
            g.push("L", a, ",", b)
        }
        function d() {
            h.point = a
        }
        function e() {
            g.push("Z")
        }
        var f = mc(4.5)
          , g = []
          , h = {
            point: a,
            lineStart: function() {
                h.point = b
            },
            lineEnd: d,
            polygonStart: function() {
                h.lineEnd = e
            },
            polygonEnd: function() {
                h.lineEnd = d,
                h.point = a
            },
            pointRadius: function(a) {
                return f = mc(a),
                h
            },
            result: function() {
                if (g.length) {
                    var a = g.join("");
                    return g = [],
                    a
                }
            }
        };
        return h
    }
    function mc(a) {
        return "m0," + a + "a" + a + "," + a + " 0 1,1 0," + -2 * a + "a" + a + "," + a + " 0 1,1 0," + 2 * a + "z"
    }
    function nc(a, b) {
        ri += a,
        si += b,
        ++ti
    }
    function oc() {
        function a(a, d) {
            var e = a - b
              , f = d - c
              , g = Math.sqrt(e * e + f * f);
            ui += g * (b + a) / 2,
            vi += g * (c + d) / 2,
            wi += g,
            nc(b = a, c = d)
        }
        var b, c;
        Li.point = function(d, e) {
            Li.point = a,
            nc(b = d, c = e)
        }
    }
    function pc() {
        Li.point = nc
    }
    function qc() {
        function a(a, b) {
            var c = a - d
              , f = b - e
              , g = Math.sqrt(c * c + f * f);
            ui += g * (d + a) / 2,
            vi += g * (e + b) / 2,
            wi += g,
            g = e * a - d * b,
            xi += g * (d + a),
            yi += g * (e + b),
            zi += 3 * g,
            nc(d = a, e = b)
        }
        var b, c, d, e;
        Li.point = function(f, g) {
            Li.point = a,
            nc(b = d = f, c = e = g)
        }
        ,
        Li.lineEnd = function() {
            a(b, c)
        }
    }
    function rc(a) {
        function b(b, c) {
            a.moveTo(b, c),
            a.arc(b, c, g, 0, Bh)
        }
        function c(b, c) {
            a.moveTo(b, c),
            h.point = d
        }
        function d(b, c) {
            a.lineTo(b, c)
        }
        function e() {
            h.point = b
        }
        function f() {
            a.closePath()
        }
        var g = 4.5
          , h = {
            point: b,
            lineStart: function() {
                h.point = c
            },
            lineEnd: e,
            polygonStart: function() {
                h.lineEnd = f
            },
            polygonEnd: function() {
                h.lineEnd = e,
                h.point = b
            },
            pointRadius: function(a) {
                return g = a,
                h
            },
            result: i
        };
        return h
    }
    function sc(a) {
        function b(a) {
            return (h ? d : c)(a)
        }
        function c(b) {
            return vc(b, function(c, d) {
                c = a(c, d),
                b.point(c[0], c[1])
            })
        }
        function d(b) {
            function c(c, d) {
                c = a(c, d),
                b.point(c[0], c[1])
            }
            function d() {
                t = 0 / 0,
                y.point = f,
                b.lineStart()
            }
            function f(c, d) {
                var f = Gb([c, d])
                  , g = a(c, d);
                e(t, u, s, v, w, x, t = g[0], u = g[1], s = c, v = f[0], w = f[1], x = f[2], h, b),
                b.point(t, u)
            }
            function g() {
                y.point = c,
                b.lineEnd()
            }
            function i() {
                d(),
                y.point = j,
                y.lineEnd = k
            }
            function j(a, b) {
                f(l = a, m = b),
                n = t,
                o = u,
                p = v,
                q = w,
                r = x,
                y.point = f
            }
            function k() {
                e(t, u, s, v, w, x, n, o, l, p, q, r, h, b),
                y.lineEnd = g,
                g()
            }
            var l, m, n, o, p, q, r, s, t, u, v, w, x, y = {
                point: c,
                lineStart: d,
                lineEnd: g,
                polygonStart: function() {
                    b.polygonStart(),
                    y.lineStart = i
                },
                polygonEnd: function() {
                    b.polygonEnd(),
                    y.lineStart = d
                }
            };
            return y
        }
        function e(b, c, d, h, i, j, k, l, m, n, o, p, q, r) {
            var s = k - b
              , t = l - c
              , u = s * s + t * t;
            if (u > 4 * f && q--) {
                var v = h + n
                  , w = i + o
                  , x = j + p
                  , y = Math.sqrt(v * v + w * w + x * x)
                  , z = Math.asin(x /= y)
                  , A = ih(ih(x) - 1) < Dh || ih(d - m) < Dh ? (d + m) / 2 : Math.atan2(w, v)
                  , B = a(A, z)
                  , C = B[0]
                  , D = B[1]
                  , E = C - b
                  , F = D - c
                  , G = t * E - s * F;
                (G * G / u > f || ih((s * E + t * F) / u - .5) > .3 || g > h * n + i * o + j * p) && (e(b, c, d, h, i, j, C, D, A, v /= y, w /= y, x, q, r),
                r.point(C, D),
                e(C, D, A, v, w, x, k, l, m, n, o, p, q, r))
            }
        }
        var f = .5
          , g = Math.cos(30 * Fh)
          , h = 16;
        return b.precision = function(a) {
            return arguments.length ? (h = (f = a * a) > 0 && 16,
            b) : Math.sqrt(f)
        }
        ,
        b
    }
    function tc(a) {
        var b = sc(function(b, c) {
            return a([b * Gh, c * Gh])
        });
        return function(a) {
            return yc(b(a))
        }
    }
    function uc(a) {
        this.stream = a
    }
    function vc(a, b) {
        return {
            point: b,
            sphere: function() {
                a.sphere()
            },
            lineStart: function() {
                a.lineStart()
            },
            lineEnd: function() {
                a.lineEnd()
            },
            polygonStart: function() {
                a.polygonStart()
            },
            polygonEnd: function() {
                a.polygonEnd()
            }
        }
    }
    function wc(a) {
        return xc(function() {
            return a
        })()
    }
    function xc(a) {
        function b(a) {
            return a = h(a[0] * Fh, a[1] * Fh),
            [a[0] * m + i, j - a[1] * m]
        }
        function c(a) {
            return a = h.invert((a[0] - i) / m, (j - a[1]) / m),
            a && [a[0] * Gh, a[1] * Gh]
        }
        function d() {
            h = gc(g = Bc(r, s, t), f);
            var a = f(p, q);
            return i = n - a[0] * m,
            j = o + a[1] * m,
            e()
        }
        function e() {
            return k && (k.valid = !1,
            k = null),
            b
        }
        var f, g, h, i, j, k, l = sc(function(a, b) {
            return a = f(a, b),
            [a[0] * m + i, j - a[1] * m]
        }), m = 150, n = 480, o = 250, p = 0, q = 0, r = 0, s = 0, t = 0, u = Bi, v = qb, w = null, x = null;
        return b.stream = function(a) {
            return k && (k.valid = !1),
            k = yc(u(g, l(v(a)))),
            k.valid = !0,
            k
        }
        ,
        b.clipAngle = function(a) {
            return arguments.length ? (u = null == a ? (w = a,
            Bi) : dc((w = +a) * Fh),
            e()) : w
        }
        ,
        b.clipExtent = function(a) {
            return arguments.length ? (x = a,
            v = a ? fc(a[0][0], a[0][1], a[1][0], a[1][1]) : qb,
            e()) : x
        }
        ,
        b.scale = function(a) {
            return arguments.length ? (m = +a,
            d()) : m
        }
        ,
        b.translate = function(a) {
            return arguments.length ? (n = +a[0],
            o = +a[1],
            d()) : [n, o]
        }
        ,
        b.center = function(a) {
            return arguments.length ? (p = a[0] % 360 * Fh,
            q = a[1] % 360 * Fh,
            d()) : [p * Gh, q * Gh]
        }
        ,
        b.rotate = function(a) {
            return arguments.length ? (r = a[0] % 360 * Fh,
            s = a[1] % 360 * Fh,
            t = a.length > 2 ? a[2] % 360 * Fh : 0,
            d()) : [r * Gh, s * Gh, t * Gh]
        }
        ,
        Wg.rebind(b, l, "precision"),
        function() {
            return f = a.apply(this, arguments),
            b.invert = f.invert && c,
            d()
        }
    }
    function yc(a) {
        return vc(a, function(b, c) {
            a.point(b * Fh, c * Fh)
        })
    }
    function zc(a, b) {
        return [a, b]
    }
    function Ac(a, b) {
        return [a > Ah ? a - Bh : -Ah > a ? a + Bh : a, b]
    }
    function Bc(a, b, c) {
        return a ? b || c ? gc(Dc(a), Ec(b, c)) : Dc(a) : b || c ? Ec(b, c) : Ac
    }
    function Cc(a) {
        return function(b, c) {
            return b += a,
            [b > Ah ? b - Bh : -Ah > b ? b + Bh : b, c]
        }
    }
    function Dc(a) {
        var b = Cc(a);
        return b.invert = Cc(-a),
        b
    }
    function Ec(a, b) {
        function c(a, b) {
            var c = Math.cos(b)
              , h = Math.cos(a) * c
              , i = Math.sin(a) * c
              , j = Math.sin(b)
              , k = j * d + h * e;
            return [Math.atan2(i * f - k * g, h * d - j * e), O(k * f + i * g)]
        }
        var d = Math.cos(a)
          , e = Math.sin(a)
          , f = Math.cos(b)
          , g = Math.sin(b);
        return c.invert = function(a, b) {
            var c = Math.cos(b)
              , h = Math.cos(a) * c
              , i = Math.sin(a) * c
              , j = Math.sin(b)
              , k = j * f - i * g;
            return [Math.atan2(i * f + j * g, h * d + k * e), O(k * d - h * e)]
        }
        ,
        c
    }
    function Fc(a, b) {
        var c = Math.cos(a)
          , d = Math.sin(a);
        return function(e, f, g, h) {
            var i = g * b;
            null != e ? (e = Gc(c, e),
            f = Gc(c, f),
            (g > 0 ? f > e : e > f) && (e += g * Bh)) : (e = a + g * Bh,
            f = a - .5 * i);
            for (var j, k = e; g > 0 ? k > f : f > k; k -= i)
                h.point((j = Mb([c, -d * Math.cos(k), -d * Math.sin(k)]))[0], j[1])
        }
    }
    function Gc(a, b) {
        var c = Gb(b);
        c[0] -= a,
        Lb(c);
        var d = N(-c[1]);
        return ((-c[2] < 0 ? -d : d) + 2 * Math.PI - Dh) % (2 * Math.PI)
    }
    function Hc(a, b, c) {
        var d = Wg.range(a, b - Dh, c).concat(b);
        return function(a) {
            return d.map(function(b) {
                return [a, b]
            })
        }
    }
    function Ic(a, b, c) {
        var d = Wg.range(a, b - Dh, c).concat(b);
        return function(a) {
            return d.map(function(b) {
                return [b, a]
            })
        }
    }
    function Jc(a) {
        return a.source
    }
    function Kc(a) {
        return a.target
    }
    function Lc(a, b, c, d) {
        var e = Math.cos(b)
          , f = Math.sin(b)
          , g = Math.cos(d)
          , h = Math.sin(d)
          , i = e * Math.cos(a)
          , j = e * Math.sin(a)
          , k = g * Math.cos(c)
          , l = g * Math.sin(c)
          , m = 2 * Math.asin(Math.sqrt(S(d - b) + e * g * S(c - a)))
          , n = 1 / Math.sin(m)
          , o = m ? function(a) {
            var b = Math.sin(a *= m) * n
              , c = Math.sin(m - a) * n
              , d = c * i + b * k
              , e = c * j + b * l
              , g = c * f + b * h;
            return [Math.atan2(e, d) * Gh, Math.atan2(g, Math.sqrt(d * d + e * e)) * Gh]
        }
        : function() {
            return [a * Gh, b * Gh]
        }
        ;
        return o.distance = m,
        o
    }
    function Mc() {
        function a(a, e) {
            var f = Math.sin(e *= Fh)
              , g = Math.cos(e)
              , h = ih((a *= Fh) - b)
              , i = Math.cos(h);
            Mi += Math.atan2(Math.sqrt((h = g * Math.sin(h)) * h + (h = d * f - c * g * i) * h), c * f + d * g * i),
            b = a,
            c = f,
            d = g
        }
        var b, c, d;
        Ni.point = function(e, f) {
            b = e * Fh,
            c = Math.sin(f *= Fh),
            d = Math.cos(f),
            Ni.point = a
        }
        ,
        Ni.lineEnd = function() {
            Ni.point = Ni.lineEnd = i
        }
    }
    function Nc(a, b) {
        function c(b, c) {
            var d = Math.cos(b)
              , e = Math.cos(c)
              , f = a(d * e);
            return [f * e * Math.sin(b), f * Math.sin(c)]
        }
        return c.invert = function(a, c) {
            var d = Math.sqrt(a * a + c * c)
              , e = b(d)
              , f = Math.sin(e)
              , g = Math.cos(e);
            return [Math.atan2(a * f, d * g), Math.asin(d && c * f / d)]
        }
        ,
        c
    }
    function Oc(a, b) {
        function c(a, b) {
            var c = ih(ih(b) - Ch) < Dh ? 0 : g / Math.pow(e(b), f);
            return [c * Math.sin(f * a), g - c * Math.cos(f * a)]
        }
        var d = Math.cos(a)
          , e = function(a) {
            return Math.tan(Ah / 4 + a / 2)
        }
          , f = a === b ? Math.sin(a) : Math.log(d / Math.cos(b)) / Math.log(e(b) / e(a))
          , g = d * Math.pow(e(a), f) / f;
        return f ? (c.invert = function(a, b) {
            var c = g - b
              , d = M(f) * Math.sqrt(a * a + c * c);
            return [Math.atan2(a, c) / f, 2 * Math.atan(Math.pow(g / d, 1 / f)) - Ch]
        }
        ,
        c) : Qc
    }
    function Pc(a, b) {
        function c(a, b) {
            var c = f - b;
            return [c * Math.sin(e * a), f - c * Math.cos(e * a)]
        }
        var d = Math.cos(a)
          , e = a === b ? Math.sin(a) : (d - Math.cos(b)) / (b - a)
          , f = d / e + a;
        return ih(e) < Dh ? zc : (c.invert = function(a, b) {
            var c = f - b;
            return [Math.atan2(a, c) / e, f - M(e) * Math.sqrt(a * a + c * c)]
        }
        ,
        c)
    }
    function Qc(a, b) {
        return [a, Math.log(Math.tan(Ah / 4 + b / 2))]
    }
    function Rc(a) {
        var b, c = wc(a), d = c.scale, e = c.translate, f = c.clipExtent;
        return c.scale = function() {
            var a = d.apply(c, arguments);
            return a === c ? b ? c.clipExtent(null) : c : a
        }
        ,
        c.translate = function() {
            var a = e.apply(c, arguments);
            return a === c ? b ? c.clipExtent(null) : c : a
        }
        ,
        c.clipExtent = function(a) {
            var g = f.apply(c, arguments);
            if (g === c) {
                if (b = null == a) {
                    var h = Ah * d()
                      , i = e();
                    f([[i[0] - h, i[1] - h], [i[0] + h, i[1] + h]])
                }
            } else
                b && (g = null);
            return g
        }
        ,
        c.clipExtent(null)
    }
    function Sc(a, b) {
        return [Math.log(Math.tan(Ah / 4 + b / 2)), -a]
    }
    function Tc(a) {
        return a[0]
    }
    function Uc(a) {
        return a[1]
    }
    function Vc(a, b, c, d) {
        var e, f, g, h, i, j, k;
        return e = d[a],
        f = e[0],
        g = e[1],
        e = d[b],
        h = e[0],
        i = e[1],
        e = d[c],
        j = e[0],
        k = e[1],
        (k - g) * (h - f) - (i - g) * (j - f) > 0
    }
    function Wc(a, b, c) {
        return (c[0] - b[0]) * (a[1] - b[1]) < (c[1] - b[1]) * (a[0] - b[0])
    }
    function Xc(a, b, c, d) {
        var e = a[0]
          , f = c[0]
          , g = b[0] - e
          , h = d[0] - f
          , i = a[1]
          , j = c[1]
          , k = b[1] - i
          , l = d[1] - j
          , m = (h * (i - j) - l * (e - f)) / (l * g - h * k);
        return [e + m * g, i + m * k]
    }
    function Yc(a) {
        var b = a[0]
          , c = a[a.length - 1];
        return !(b[0] - c[0] || b[1] - c[1])
    }
    function Zc() {
        sd(this),
        this.edge = this.site = this.circle = null
    }
    function $c(a) {
        var b = Zi.pop() || new Zc;
        return b.site = a,
        b
    }
    function _c(a) {
        jd(a),
        Wi.remove(a),
        Zi.push(a),
        sd(a)
    }
    function ad(a) {
        var b = a.circle
          , c = b.x
          , d = b.cy
          , e = {
            x: c,
            y: d
        }
          , f = a.P
          , g = a.N
          , h = [a];
        _c(a);
        for (var i = f; i.circle && ih(c - i.circle.x) < Dh && ih(d - i.circle.cy) < Dh; )
            f = i.P,
            h.unshift(i),
            _c(i),
            i = f;
        h.unshift(i),
        jd(i);
        for (var j = g; j.circle && ih(c - j.circle.x) < Dh && ih(d - j.circle.cy) < Dh; )
            g = j.N,
            h.push(j),
            _c(j),
            j = g;
        h.push(j),
        jd(j);
        var k, l = h.length;
        for (k = 1; l > k; ++k)
            j = h[k],
            i = h[k - 1],
            pd(j.edge, i.site, j.site, e);
        i = h[0],
        j = h[l - 1],
        j.edge = nd(i.site, j.site, null, e),
        id(i),
        id(j)
    }
    function bd(a) {
        for (var b, c, d, e, f = a.x, g = a.y, h = Wi._; h; )
            if (d = cd(h, g) - f,
            d > Dh)
                h = h.L;
            else {
                if (e = f - dd(h, g),
                !(e > Dh)) {
                    d > -Dh ? (b = h.P,
                    c = h) : e > -Dh ? (b = h,
                    c = h.N) : b = c = h;
                    break
                }
                if (!h.R) {
                    b = h;
                    break
                }
                h = h.R
            }
        var i = $c(a);
        if (Wi.insert(b, i),
        b || c) {
            if (b === c)
                return jd(b),
                c = $c(b.site),
                Wi.insert(i, c),
                i.edge = c.edge = nd(b.site, i.site),
                id(b),
                id(c),
                void 0;
            if (!c)
                return i.edge = nd(b.site, i.site),
                void 0;
            jd(b),
            jd(c);
            var j = b.site
              , k = j.x
              , l = j.y
              , m = a.x - k
              , n = a.y - l
              , o = c.site
              , p = o.x - k
              , q = o.y - l
              , r = 2 * (m * q - n * p)
              , s = m * m + n * n
              , t = p * p + q * q
              , u = {
                x: (q * s - n * t) / r + k,
                y: (m * t - p * s) / r + l
            };
            pd(c.edge, j, o, u),
            i.edge = nd(j, a, null, u),
            c.edge = nd(a, o, null, u),
            id(b),
            id(c)
        }
    }
    function cd(a, b) {
        var c = a.site
          , d = c.x
          , e = c.y
          , f = e - b;
        if (!f)
            return d;
        var g = a.P;
        if (!g)
            return -1 / 0;
        c = g.site;
        var h = c.x
          , i = c.y
          , j = i - b;
        if (!j)
            return h;
        var k = h - d
          , l = 1 / f - 1 / j
          , m = k / j;
        return l ? (-m + Math.sqrt(m * m - 2 * l * (k * k / (-2 * j) - i + j / 2 + e - f / 2))) / l + d : (d + h) / 2
    }
    function dd(a, b) {
        var c = a.N;
        if (c)
            return cd(c, b);
        var d = a.site;
        return d.y === b ? d.x : 1 / 0
    }
    function ed(a) {
        this.site = a,
        this.edges = []
    }
    function fd(a) {
        for (var b, c, d, e, f, g, h, i, j, k, l = a[0][0], m = a[1][0], n = a[0][1], o = a[1][1], p = Vi, q = p.length; q--; )
            if (f = p[q],
            f && f.prepare())
                for (h = f.edges,
                i = h.length,
                g = 0; i > g; )
                    k = h[g].end(),
                    d = k.x,
                    e = k.y,
                    j = h[++g % i].start(),
                    b = j.x,
                    c = j.y,
                    (ih(d - b) > Dh || ih(e - c) > Dh) && (h.splice(g, 0, new qd(od(f.site, k, ih(d - l) < Dh && o - e > Dh ? {
                        x: l,
                        y: ih(b - l) < Dh ? c : o
                    } : ih(e - o) < Dh && m - d > Dh ? {
                        x: ih(c - o) < Dh ? b : m,
                        y: o
                    } : ih(d - m) < Dh && e - n > Dh ? {
                        x: m,
                        y: ih(b - m) < Dh ? c : n
                    } : ih(e - n) < Dh && d - l > Dh ? {
                        x: ih(c - n) < Dh ? b : l,
                        y: n
                    } : null),f.site,null)),
                    ++i)
    }
    function gd(a, b) {
        return b.angle - a.angle
    }
    function hd() {
        sd(this),
        this.x = this.y = this.arc = this.site = this.cy = null
    }
    function id(a) {
        var b = a.P
          , c = a.N;
        if (b && c) {
            var d = b.site
              , e = a.site
              , f = c.site;
            if (d !== f) {
                var g = e.x
                  , h = e.y
                  , i = d.x - g
                  , j = d.y - h
                  , k = f.x - g
                  , l = f.y - h
                  , m = 2 * (i * l - j * k);
                if (!(m >= -Eh)) {
                    var n = i * i + j * j
                      , o = k * k + l * l
                      , p = (l * n - j * o) / m
                      , q = (i * o - k * n) / m
                      , l = q + h
                      , r = $i.pop() || new hd;
                    r.arc = a,
                    r.site = e,
                    r.x = p + g,
                    r.y = l + Math.sqrt(p * p + q * q),
                    r.cy = l,
                    a.circle = r;
                    for (var s = null, t = Yi._; t; )
                        if (r.y < t.y || r.y === t.y && r.x <= t.x) {
                            if (!t.L) {
                                s = t.P;
                                break
                            }
                            t = t.L
                        } else {
                            if (!t.R) {
                                s = t;
                                break
                            }
                            t = t.R
                        }
                    Yi.insert(s, r),
                    s || (Xi = r)
                }
            }
        }
    }
    function jd(a) {
        var b = a.circle;
        b && (b.P || (Xi = b.N),
        Yi.remove(b),
        $i.push(b),
        sd(b),
        a.circle = null)
    }
    function kd(a) {
        for (var b, c = Ui, d = ec(a[0][0], a[0][1], a[1][0], a[1][1]), e = c.length; e--; )
            b = c[e],
            (!ld(b, a) || !d(b) || ih(b.a.x - b.b.x) < Dh && ih(b.a.y - b.b.y) < Dh) && (b.a = b.b = null,
            c.splice(e, 1))
    }
    function ld(a, b) {
        var c = a.b;
        if (c)
            return !0;
        var d, e, f = a.a, g = b[0][0], h = b[1][0], i = b[0][1], j = b[1][1], k = a.l, l = a.r, m = k.x, n = k.y, o = l.x, p = l.y, q = (m + o) / 2, r = (n + p) / 2;
        if (p === n) {
            if (g > q || q >= h)
                return;
            if (m > o) {
                if (f) {
                    if (f.y >= j)
                        return
                } else
                    f = {
                        x: q,
                        y: i
                    };
                c = {
                    x: q,
                    y: j
                }
            } else {
                if (f) {
                    if (f.y < i)
                        return
                } else
                    f = {
                        x: q,
                        y: j
                    };
                c = {
                    x: q,
                    y: i
                }
            }
        } else if (d = (m - o) / (p - n),
        e = r - d * q,
        -1 > d || d > 1)
            if (m > o) {
                if (f) {
                    if (f.y >= j)
                        return
                } else
                    f = {
                        x: (i - e) / d,
                        y: i
                    };
                c = {
                    x: (j - e) / d,
                    y: j
                }
            } else {
                if (f) {
                    if (f.y < i)
                        return
                } else
                    f = {
                        x: (j - e) / d,
                        y: j
                    };
                c = {
                    x: (i - e) / d,
                    y: i
                }
            }
        else if (p > n) {
            if (f) {
                if (f.x >= h)
                    return
            } else
                f = {
                    x: g,
                    y: d * g + e
                };
            c = {
                x: h,
                y: d * h + e
            }
        } else {
            if (f) {
                if (f.x < g)
                    return
            } else
                f = {
                    x: h,
                    y: d * h + e
                };
            c = {
                x: g,
                y: d * g + e
            }
        }
        return a.a = f,
        a.b = c,
        !0
    }
    function md(a, b) {
        this.l = a,
        this.r = b,
        this.a = this.b = null
    }
    function nd(a, b, c, d) {
        var e = new md(a,b);
        return Ui.push(e),
        c && pd(e, a, b, c),
        d && pd(e, b, a, d),
        Vi[a.i].edges.push(new qd(e,a,b)),
        Vi[b.i].edges.push(new qd(e,b,a)),
        e
    }
    function od(a, b, c) {
        var d = new md(a,null);
        return d.a = b,
        d.b = c,
        Ui.push(d),
        d
    }
    function pd(a, b, c, d) {
        a.a || a.b ? a.l === c ? a.b = d : a.a = d : (a.a = d,
        a.l = b,
        a.r = c)
    }
    function qd(a, b, c) {
        var d = a.a
          , e = a.b;
        this.edge = a,
        this.site = b,
        this.angle = c ? Math.atan2(c.y - b.y, c.x - b.x) : a.l === b ? Math.atan2(e.x - d.x, d.y - e.y) : Math.atan2(d.x - e.x, e.y - d.y)
    }
    function rd() {
        this._ = null
    }
    function sd(a) {
        a.U = a.C = a.L = a.R = a.P = a.N = null
    }
    function td(a, b) {
        var c = b
          , d = b.R
          , e = c.U;
        e ? e.L === c ? e.L = d : e.R = d : a._ = d,
        d.U = e,
        c.U = d,
        c.R = d.L,
        c.R && (c.R.U = c),
        d.L = c
    }
    function ud(a, b) {
        var c = b
          , d = b.L
          , e = c.U;
        e ? e.L === c ? e.L = d : e.R = d : a._ = d,
        d.U = e,
        c.U = d,
        c.L = d.R,
        c.L && (c.L.U = c),
        d.R = c
    }
    function vd(a) {
        for (; a.L; )
            a = a.L;
        return a
    }
    function wd(a, b) {
        var c, d, e, f = a.sort(xd).pop();
        for (Ui = [],
        Vi = new Array(a.length),
        Wi = new rd,
        Yi = new rd; ; )
            if (e = Xi,
            f && (!e || f.y < e.y || f.y === e.y && f.x < e.x))
                (f.x !== c || f.y !== d) && (Vi[f.i] = new ed(f),
                bd(f),
                c = f.x,
                d = f.y),
                f = a.pop();
            else {
                if (!e)
                    break;
                ad(e.arc)
            }
        b && (kd(b),
        fd(b));
        var g = {
            cells: Vi,
            edges: Ui
        };
        return Wi = Yi = Ui = Vi = null,
        g
    }
    function xd(a, b) {
        return b.y - a.y || b.x - a.x
    }
    function yd(a, b, c) {
        return (a.x - c.x) * (b.y - a.y) - (a.x - b.x) * (c.y - a.y)
    }
    function zd(a) {
        return a.x
    }
    function Ad(a) {
        return a.y
    }
    function Bd() {
        return {
            leaf: !0,
            nodes: [],
            point: null,
            x: null,
            y: null
        }
    }
    function Cd(a, b, c, d, e, f) {
        if (!a(b, c, d, e, f)) {
            var g = .5 * (c + e)
              , h = .5 * (d + f)
              , i = b.nodes;
            i[0] && Cd(a, i[0], c, d, g, h),
            i[1] && Cd(a, i[1], g, d, e, h),
            i[2] && Cd(a, i[2], c, h, g, f),
            i[3] && Cd(a, i[3], g, h, e, f)
        }
    }
    function Dd(a, b) {
        a = Wg.rgb(a),
        b = Wg.rgb(b);
        var c = a.r
          , d = a.g
          , e = a.b
          , f = b.r - c
          , g = b.g - d
          , h = b.b - e;
        return function(a) {
            return "#" + jb(Math.round(c + f * a)) + jb(Math.round(d + g * a)) + jb(Math.round(e + h * a))
        }
    }
    function Ed(a, b) {
        var c, d = {}, e = {};
        for (c in a)
            c in b ? d[c] = Hd(a[c], b[c]) : e[c] = a[c];
        for (c in b)
            c in a || (e[c] = b[c]);
        return function(a) {
            for (c in d)
                e[c] = d[c](a);
            return e
        }
    }
    function Fd(a, b) {
        return b -= a = +a,
        function(c) {
            return a + b * c
        }
    }
    function Gd(a, b) {
        var c, d, e, f, g, h = 0, i = 0, j = [], k = [];
        for (a += "",
        b += "",
        aj.lastIndex = 0,
        d = 0; c = aj.exec(b); ++d)
            c.index && j.push(b.substring(h, i = c.index)),
            k.push({
                i: j.length,
                x: c[0]
            }),
            j.push(null),
            h = aj.lastIndex;
        for (h < b.length && j.push(b.substring(h)),
        d = 0,
        f = k.length; (c = aj.exec(a)) && f > d; ++d)
            if (g = k[d],
            g.x == c[0]) {
                if (g.i)
                    if (null == j[g.i + 1])
                        for (j[g.i - 1] += g.x,
                        j.splice(g.i, 1),
                        e = d + 1; f > e; ++e)
                            k[e].i--;
                    else
                        for (j[g.i - 1] += g.x + j[g.i + 1],
                        j.splice(g.i, 2),
                        e = d + 1; f > e; ++e)
                            k[e].i -= 2;
                else if (null == j[g.i + 1])
                    j[g.i] = g.x;
                else
                    for (j[g.i] = g.x + j[g.i + 1],
                    j.splice(g.i + 1, 1),
                    e = d + 1; f > e; ++e)
                        k[e].i--;
                k.splice(d, 1),
                f--,
                d--
            } else
                g.x = Fd(parseFloat(c[0]), parseFloat(g.x));
        for (; f > d; )
            g = k.pop(),
            null == j[g.i + 1] ? j[g.i] = g.x : (j[g.i] = g.x + j[g.i + 1],
            j.splice(g.i + 1, 1)),
            f--;
        return 1 === j.length ? null == j[0] ? (g = k[0].x,
        function(a) {
            return g(a) + ""
        }
        ) : function() {
            return b
        }
        : function(a) {
            for (d = 0; f > d; ++d)
                j[(g = k[d]).i] = g.x(a);
            return j.join("")
        }
    }
    function Hd(a, b) {
        for (var c, d = Wg.interpolators.length; --d >= 0 && !(c = Wg.interpolators[d](a, b)); )
            ;
        return c
    }
    function Id(a, b) {
        var c, d = [], e = [], f = a.length, g = b.length, h = Math.min(a.length, b.length);
        for (c = 0; h > c; ++c)
            d.push(Hd(a[c], b[c]));
        for (; f > c; ++c)
            e[c] = a[c];
        for (; g > c; ++c)
            e[c] = b[c];
        return function(a) {
            for (c = 0; h > c; ++c)
                e[c] = d[c](a);
            return e
        }
    }
    function Jd(a) {
        return function(b) {
            return 0 >= b ? 0 : b >= 1 ? 1 : a(b)
        }
    }
    function Kd(a) {
        return function(b) {
            return 1 - a(1 - b)
        }
    }
    function Ld(a) {
        return function(b) {
            return .5 * (.5 > b ? a(2 * b) : 2 - a(2 - 2 * b))
        }
    }
    function Md(a) {
        return a * a
    }
    function Nd(a) {
        return a * a * a
    }
    function Od(a) {
        if (0 >= a)
            return 0;
        if (a >= 1)
            return 1;
        var b = a * a
          , c = b * a;
        return 4 * (.5 > a ? c : 3 * (a - b) + c - .75)
    }
    function Pd(a) {
        return function(b) {
            return Math.pow(b, a)
        }
    }
    function Qd(a) {
        return 1 - Math.cos(a * Ch)
    }
    function Rd(a) {
        return Math.pow(2, 10 * (a - 1))
    }
    function Sd(a) {
        return 1 - Math.sqrt(1 - a * a)
    }
    function Td(a, b) {
        var c;
        return arguments.length < 2 && (b = .45),
        arguments.length ? c = b / Bh * Math.asin(1 / a) : (a = 1,
        c = b / 4),
        function(d) {
            return 1 + a * Math.pow(2, -10 * d) * Math.sin((d - c) * Bh / b)
        }
    }
    function Ud(a) {
        return a || (a = 1.70158),
        function(b) {
            return b * b * ((a + 1) * b - a)
        }
    }
    function Vd(a) {
        return 1 / 2.75 > a ? 7.5625 * a * a : 2 / 2.75 > a ? 7.5625 * (a -= 1.5 / 2.75) * a + .75 : 2.5 / 2.75 > a ? 7.5625 * (a -= 2.25 / 2.75) * a + .9375 : 7.5625 * (a -= 2.625 / 2.75) * a + .984375
    }
    function Wd(a, b) {
        a = Wg.hcl(a),
        b = Wg.hcl(b);
        var c = a.h
          , d = a.c
          , e = a.l
          , f = b.h - c
          , g = b.c - d
          , h = b.l - e;
        return isNaN(g) && (g = 0,
        d = isNaN(d) ? b.c : d),
        isNaN(f) ? (f = 0,
        c = isNaN(c) ? b.h : c) : f > 180 ? f -= 360 : -180 > f && (f += 360),
        function(a) {
            return Z(c + f * a, d + g * a, e + h * a) + ""
        }
    }
    function Xd(a, b) {
        a = Wg.hsl(a),
        b = Wg.hsl(b);
        var c = a.h
          , d = a.s
          , e = a.l
          , f = b.h - c
          , g = b.s - d
          , h = b.l - e;
        return isNaN(g) && (g = 0,
        d = isNaN(d) ? b.s : d),
        isNaN(f) ? (f = 0,
        c = isNaN(c) ? b.h : c) : f > 180 ? f -= 360 : -180 > f && (f += 360),
        function(a) {
            return W(c + f * a, d + g * a, e + h * a) + ""
        }
    }
    function Yd(a, b) {
        a = Wg.lab(a),
        b = Wg.lab(b);
        var c = a.l
          , d = a.a
          , e = a.b
          , f = b.l - c
          , g = b.a - d
          , h = b.b - e;
        return function(a) {
            return ab(c + f * a, d + g * a, e + h * a) + ""
        }
    }
    function Zd(a, b) {
        return b -= a,
        function(c) {
            return Math.round(a + b * c)
        }
    }
    function $d(a) {
        var b = [a.a, a.b]
          , c = [a.c, a.d]
          , d = ae(b)
          , e = _d(b, c)
          , f = ae(be(c, b, -e)) || 0;
        b[0] * c[1] < c[0] * b[1] && (b[0] *= -1,
        b[1] *= -1,
        d *= -1,
        e *= -1),
        this.rotate = (d ? Math.atan2(b[1], b[0]) : Math.atan2(-c[0], c[1])) * Gh,
        this.translate = [a.e, a.f],
        this.scale = [d, f],
        this.skew = f ? Math.atan2(e, f) * Gh : 0
    }
    function _d(a, b) {
        return a[0] * b[0] + a[1] * b[1]
    }
    function ae(a) {
        var b = Math.sqrt(_d(a, a));
        return b && (a[0] /= b,
        a[1] /= b),
        b
    }
    function be(a, b, c) {
        return a[0] += c * b[0],
        a[1] += c * b[1],
        a
    }
    function ce(a, b) {
        var c, d = [], e = [], f = Wg.transform(a), g = Wg.transform(b), h = f.translate, i = g.translate, j = f.rotate, k = g.rotate, l = f.skew, m = g.skew, n = f.scale, o = g.scale;
        return h[0] != i[0] || h[1] != i[1] ? (d.push("translate(", null, ",", null, ")"),
        e.push({
            i: 1,
            x: Fd(h[0], i[0])
        }, {
            i: 3,
            x: Fd(h[1], i[1])
        })) : i[0] || i[1] ? d.push("translate(" + i + ")") : d.push(""),
        j != k ? (j - k > 180 ? k += 360 : k - j > 180 && (j += 360),
        e.push({
            i: d.push(d.pop() + "rotate(", null, ")") - 2,
            x: Fd(j, k)
        })) : k && d.push(d.pop() + "rotate(" + k + ")"),
        l != m ? e.push({
            i: d.push(d.pop() + "skewX(", null, ")") - 2,
            x: Fd(l, m)
        }) : m && d.push(d.pop() + "skewX(" + m + ")"),
        n[0] != o[0] || n[1] != o[1] ? (c = d.push(d.pop() + "scale(", null, ",", null, ")"),
        e.push({
            i: c - 4,
            x: Fd(n[0], o[0])
        }, {
            i: c - 2,
            x: Fd(n[1], o[1])
        })) : (1 != o[0] || 1 != o[1]) && d.push(d.pop() + "scale(" + o + ")"),
        c = e.length,
        function(a) {
            for (var b, f = -1; ++f < c; )
                d[(b = e[f]).i] = b.x(a);
            return d.join("")
        }
    }
    function de(a, b) {
        return b = b - (a = +a) ? 1 / (b - a) : 0,
        function(c) {
            return (c - a) * b
        }
    }
    function ee(a, b) {
        return b = b - (a = +a) ? 1 / (b - a) : 0,
        function(c) {
            return Math.max(0, Math.min(1, (c - a) * b))
        }
    }
    function fe(a) {
        for (var b = a.source, c = a.target, d = he(b, c), e = [b]; b !== d; )
            b = b.parent,
            e.push(b);
        for (var f = e.length; c !== d; )
            e.splice(f, 0, c),
            c = c.parent;
        return e
    }
    function ge(a) {
        for (var b = [], c = a.parent; null != c; )
            b.push(a),
            a = c,
            c = c.parent;
        return b.push(a),
        b
    }
    function he(a, b) {
        if (a === b)
            return a;
        for (var c = ge(a), d = ge(b), e = c.pop(), f = d.pop(), g = null; e === f; )
            g = e,
            e = c.pop(),
            f = d.pop();
        return g
    }
    function ie(a) {
        a.fixed |= 2
    }
    function je(a) {
        a.fixed &= -7
    }
    function ke(a) {
        a.fixed |= 4,
        a.px = a.x,
        a.py = a.y
    }
    function le(a) {
        a.fixed &= -5
    }
    function me(a, b, c) {
        var d = 0
          , e = 0;
        if (a.charge = 0,
        !a.leaf)
            for (var f, g = a.nodes, h = g.length, i = -1; ++i < h; )
                f = g[i],
                null != f && (me(f, b, c),
                a.charge += f.charge,
                d += f.charge * f.cx,
                e += f.charge * f.cy);
        if (a.point) {
            a.leaf || (a.point.x += Math.random() - .5,
            a.point.y += Math.random() - .5);
            var j = b * c[a.point.index];
            a.charge += a.pointCharge = j,
            d += j * a.point.x,
            e += j * a.point.y
        }
        a.cx = d / a.charge,
        a.cy = e / a.charge
    }
    function ne(a, b) {
        return Wg.rebind(a, b, "sort", "children", "value"),
        a.nodes = a,
        a.links = re,
        a
    }
    function oe(a) {
        return a.children
    }
    function pe(a) {
        return a.value
    }
    function qe(a, b) {
        return b.value - a.value
    }
    function re(a) {
        return Wg.merge(a.map(function(a) {
            return (a.children || []).map(function(b) {
                return {
                    source: a,
                    target: b
                }
            })
        }))
    }
    function se(a) {
        return a.x
    }
    function te(a) {
        return a.y
    }
    function ue(a, b, c) {
        a.y0 = b,
        a.y = c
    }
    function ve(a) {
        return Wg.range(a.length)
    }
    function we(a) {
        for (var b = -1, c = a[0].length, d = []; ++b < c; )
            d[b] = 0;
        return d
    }
    function xe(a) {
        for (var b, c = 1, d = 0, e = a[0][1], f = a.length; f > c; ++c)
            (b = a[c][1]) > e && (d = c,
            e = b);
        return d
    }
    function ye(a) {
        return a.reduce(ze, 0)
    }
    function ze(a, b) {
        return a + b[1]
    }
    function Ae(a, b) {
        return Be(a, Math.ceil(Math.log(b.length) / Math.LN2 + 1))
    }
    function Be(a, b) {
        for (var c = -1, d = +a[0], e = (a[1] - d) / b, f = []; ++c <= b; )
            f[c] = e * c + d;
        return f
    }
    function Ce(a) {
        return [Wg.min(a), Wg.max(a)]
    }
    function De(a, b) {
        return a.parent == b.parent ? 1 : 2
    }
    function Ee(a) {
        var b = a.children;
        return b && b.length ? b[0] : a._tree.thread
    }
    function Fe(a) {
        var b, c = a.children;
        return c && (b = c.length) ? c[b - 1] : a._tree.thread
    }
    function Ge(a, b) {
        var c = a.children;
        if (c && (e = c.length))
            for (var d, e, f = -1; ++f < e; )
                b(d = Ge(c[f], b), a) > 0 && (a = d);
        return a
    }
    function He(a, b) {
        return a.x - b.x
    }
    function Ie(a, b) {
        return b.x - a.x
    }
    function Je(a, b) {
        return a.depth - b.depth
    }
    function Ke(a, b) {
        function c(a, d) {
            var e = a.children;
            if (e && (g = e.length))
                for (var f, g, h = null, i = -1; ++i < g; )
                    f = e[i],
                    c(f, h),
                    h = f;
            b(a, d)
        }
        c(a, null)
    }
    function Le(a) {
        for (var b, c = 0, d = 0, e = a.children, f = e.length; --f >= 0; )
            b = e[f]._tree,
            b.prelim += c,
            b.mod += c,
            c += b.shift + (d += b.change)
    }
    function Me(a, b, c) {
        a = a._tree,
        b = b._tree;
        var d = c / (b.number - a.number);
        a.change += d,
        b.change -= d,
        b.shift += c,
        b.prelim += c,
        b.mod += c
    }
    function Ne(a, b, c) {
        return a._tree.ancestor.parent == b.parent ? a._tree.ancestor : c
    }
    function Oe(a, b) {
        return a.value - b.value
    }
    function Pe(a, b) {
        var c = a._pack_next;
        a._pack_next = b,
        b._pack_prev = a,
        b._pack_next = c,
        c._pack_prev = b
    }
    function Qe(a, b) {
        a._pack_next = b,
        b._pack_prev = a
    }
    function Re(a, b) {
        var c = b.x - a.x
          , d = b.y - a.y
          , e = a.r + b.r;
        return .999 * e * e > c * c + d * d
    }
    function Se(a) {
        function b(a) {
            k = Math.min(a.x - a.r, k),
            l = Math.max(a.x + a.r, l),
            m = Math.min(a.y - a.r, m),
            n = Math.max(a.y + a.r, n)
        }
        if ((c = a.children) && (j = c.length)) {
            var c, d, e, f, g, h, i, j, k = 1 / 0, l = -1 / 0, m = 1 / 0, n = -1 / 0;
            if (c.forEach(Te),
            d = c[0],
            d.x = -d.r,
            d.y = 0,
            b(d),
            j > 1 && (e = c[1],
            e.x = e.r,
            e.y = 0,
            b(e),
            j > 2))
                for (f = c[2],
                We(d, e, f),
                b(f),
                Pe(d, f),
                d._pack_prev = f,
                Pe(f, e),
                e = d._pack_next,
                g = 3; j > g; g++) {
                    We(d, e, f = c[g]);
                    var o = 0
                      , p = 1
                      , q = 1;
                    for (h = e._pack_next; h !== e; h = h._pack_next,
                    p++)
                        if (Re(h, f)) {
                            o = 1;
                            break
                        }
                    if (1 == o)
                        for (i = d._pack_prev; i !== h._pack_prev && !Re(i, f); i = i._pack_prev,
                        q++)
                            ;
                    o ? (q > p || p == q && e.r < d.r ? Qe(d, e = h) : Qe(d = i, e),
                    g--) : (Pe(d, f),
                    e = f,
                    b(f))
                }
            var r = (k + l) / 2
              , s = (m + n) / 2
              , t = 0;
            for (g = 0; j > g; g++)
                f = c[g],
                f.x -= r,
                f.y -= s,
                t = Math.max(t, f.r + Math.sqrt(f.x * f.x + f.y * f.y));
            a.r = t,
            c.forEach(Ue)
        }
    }
    function Te(a) {
        a._pack_next = a._pack_prev = a
    }
    function Ue(a) {
        delete a._pack_next,
        delete a._pack_prev
    }
    function Ve(a, b, c, d) {
        var e = a.children;
        if (a.x = b += d * a.x,
        a.y = c += d * a.y,
        a.r *= d,
        e)
            for (var f = -1, g = e.length; ++f < g; )
                Ve(e[f], b, c, d)
    }
    function We(a, b, c) {
        var d = a.r + c.r
          , e = b.x - a.x
          , f = b.y - a.y;
        if (d && (e || f)) {
            var g = b.r + c.r
              , h = e * e + f * f;
            g *= g,
            d *= d;
            var i = .5 + (d - g) / (2 * h)
              , j = Math.sqrt(Math.max(0, 2 * g * (d + h) - (d -= h) * d - g * g)) / (2 * h);
            c.x = a.x + i * e + j * f,
            c.y = a.y + i * f - j * e
        } else
            c.x = a.x + d,
            c.y = a.y
    }
    function Xe(a) {
        return 1 + Wg.max(a, function(a) {
            return a.y
        })
    }
    function Ye(a) {
        return a.reduce(function(a, b) {
            return a + b.x
        }, 0) / a.length
    }
    function Ze(a) {
        var b = a.children;
        return b && b.length ? Ze(b[0]) : a
    }
    function $e(a) {
        var b, c = a.children;
        return c && (b = c.length) ? $e(c[b - 1]) : a
    }
    function _e(a) {
        return {
            x: a.x,
            y: a.y,
            dx: a.dx,
            dy: a.dy
        }
    }
    function af(a, b) {
        var c = a.x + b[3]
          , d = a.y + b[0]
          , e = a.dx - b[1] - b[3]
          , f = a.dy - b[0] - b[2];
        return 0 > e && (c += e / 2,
        e = 0),
        0 > f && (d += f / 2,
        f = 0),
        {
            x: c,
            y: d,
            dx: e,
            dy: f
        }
    }
    function bf(a) {
        var b = a[0]
          , c = a[a.length - 1];
        return c > b ? [b, c] : [c, b]
    }
    function cf(a) {
        return a.rangeExtent ? a.rangeExtent() : bf(a.range())
    }
    function df(a, b, c, d) {
        var e = c(a[0], a[1])
          , f = d(b[0], b[1]);
        return function(a) {
            return f(e(a))
        }
    }
    function ef(a, b) {
        var c, d = 0, e = a.length - 1, f = a[d], g = a[e];
        return f > g && (c = d,
        d = e,
        e = c,
        c = f,
        f = g,
        g = c),
        a[d] = b.floor(f),
        a[e] = b.ceil(g),
        a
    }
    function ff(a) {
        return a ? {
            floor: function(b) {
                return Math.floor(b / a) * a
            },
            ceil: function(b) {
                return Math.ceil(b / a) * a
            }
        } : kj
    }
    function gf(a, b, c, d) {
        var e = []
          , f = []
          , g = 0
          , h = Math.min(a.length, b.length) - 1;
        for (a[h] < a[0] && (a = a.slice().reverse(),
        b = b.slice().reverse()); ++g <= h; )
            e.push(c(a[g - 1], a[g])),
            f.push(d(b[g - 1], b[g]));
        return function(b) {
            var c = Wg.bisect(a, b, 1, h) - 1;
            return f[c](e[c](b))
        }
    }
    function hf(a, b, c, d) {
        function e() {
            var e = Math.min(a.length, b.length) > 2 ? gf : df
              , i = d ? ee : de;
            return g = e(a, b, i, c),
            h = e(b, a, i, Hd),
            f
        }
        function f(a) {
            return g(a)
        }
        var g, h;
        return f.invert = function(a) {
            return h(a)
        }
        ,
        f.domain = function(b) {
            return arguments.length ? (a = b.map(Number),
            e()) : a
        }
        ,
        f.range = function(a) {
            return arguments.length ? (b = a,
            e()) : b
        }
        ,
        f.rangeRound = function(a) {
            return f.range(a).interpolate(Zd)
        }
        ,
        f.clamp = function(a) {
            return arguments.length ? (d = a,
            e()) : d
        }
        ,
        f.interpolate = function(a) {
            return arguments.length ? (c = a,
            e()) : c
        }
        ,
        f.ticks = function(b) {
            return mf(a, b)
        }
        ,
        f.tickFormat = function(b, c) {
            return nf(a, b, c)
        }
        ,
        f.nice = function(b) {
            return kf(a, b),
            e()
        }
        ,
        f.copy = function() {
            return hf(a, b, c, d)
        }
        ,
        e()
    }
    function jf(a, b) {
        return Wg.rebind(a, b, "range", "rangeRound", "interpolate", "clamp")
    }
    function kf(a, b) {
        return ef(a, ff(lf(a, b)[2]))
    }
    function lf(a, b) {
        null == b && (b = 10);
        var c = bf(a)
          , d = c[1] - c[0]
          , e = Math.pow(10, Math.floor(Math.log(d / b) / Math.LN10))
          , f = b / d * e;
        return .15 >= f ? e *= 10 : .35 >= f ? e *= 5 : .75 >= f && (e *= 2),
        c[0] = Math.ceil(c[0] / e) * e,
        c[1] = Math.floor(c[1] / e) * e + .5 * e,
        c[2] = e,
        c
    }
    function mf(a, b) {
        return Wg.range.apply(Wg, lf(a, b))
    }
    function nf(a, b, c) {
        var d = lf(a, b);
        return Wg.format(c ? c.replace(fi, function(a, b, c, e, f, g, h, i, j, k) {
            return [b, c, e, f, g, h, i, j || "." + pf(k, d), k].join("")
        }) : ",." + of(d[2]) + "f")
    }
    function of(a) {
        return -Math.floor(Math.log(a) / Math.LN10 + .01)
    }
    function pf(a, b) {
        var c = of(b[2]);
        return a in lj ? Math.abs(c - of(Math.max(Math.abs(b[0]), Math.abs(b[1])))) + +("e" !== a) : c - 2 * ("%" === a)
    }
    function qf(a, b, c, d) {
        function e(a) {
            return (c ? Math.log(0 > a ? 0 : a) : -Math.log(a > 0 ? 0 : -a)) / Math.log(b)
        }
        function f(a) {
            return c ? Math.pow(b, a) : -Math.pow(b, -a)
        }
        function g(b) {
            return a(e(b))
        }
        return g.invert = function(b) {
            return f(a.invert(b))
        }
        ,
        g.domain = function(b) {
            return arguments.length ? (c = b[0] >= 0,
            a.domain((d = b.map(Number)).map(e)),
            g) : d
        }
        ,
        g.base = function(c) {
            return arguments.length ? (b = +c,
            a.domain(d.map(e)),
            g) : b
        }
        ,
        g.nice = function() {
            var b = ef(d.map(e), c ? Math : nj);
            return a.domain(b),
            d = b.map(f),
            g
        }
        ,
        g.ticks = function() {
            var a = bf(d)
              , g = []
              , h = a[0]
              , i = a[1]
              , j = Math.floor(e(h))
              , k = Math.ceil(e(i))
              , l = b % 1 ? 2 : b;
            if (isFinite(k - j)) {
                if (c) {
                    for (; k > j; j++)
                        for (var m = 1; l > m; m++)
                            g.push(f(j) * m);
                    g.push(f(j))
                } else
                    for (g.push(f(j)); j++ < k; )
                        for (var m = l - 1; m > 0; m--)
                            g.push(f(j) * m);
                for (j = 0; g[j] < h; j++)
                    ;
                for (k = g.length; g[k - 1] > i; k--)
                    ;
                g = g.slice(j, k)
            }
            return g
        }
        ,
        g.tickFormat = function(a, b) {
            if (!arguments.length)
                return mj;
            arguments.length < 2 ? b = mj : "function" != typeof b && (b = Wg.format(b));
            var d, h = Math.max(.1, a / g.ticks().length), i = c ? (d = 1e-12,
            Math.ceil) : (d = -1e-12,
            Math.floor);
            return function(a) {
                return a / f(i(e(a) + d)) <= h ? b(a) : ""
            }
        }
        ,
        g.copy = function() {
            return qf(a.copy(), b, c, d)
        }
        ,
        jf(g, a)
    }
    function rf(a, b, c) {
        function d(b) {
            return a(e(b))
        }
        var e = sf(b)
          , f = sf(1 / b);
        return d.invert = function(b) {
            return f(a.invert(b))
        }
        ,
        d.domain = function(b) {
            return arguments.length ? (a.domain((c = b.map(Number)).map(e)),
            d) : c
        }
        ,
        d.ticks = function(a) {
            return mf(c, a)
        }
        ,
        d.tickFormat = function(a, b) {
            return nf(c, a, b)
        }
        ,
        d.nice = function(a) {
            return d.domain(kf(c, a))
        }
        ,
        d.exponent = function(g) {
            return arguments.length ? (e = sf(b = g),
            f = sf(1 / b),
            a.domain(c.map(e)),
            d) : b
        }
        ,
        d.copy = function() {
            return rf(a.copy(), b, c)
        }
        ,
        jf(d, a)
    }
    function sf(a) {
        return function(b) {
            return 0 > b ? -Math.pow(-b, a) : Math.pow(b, a)
        }
    }
    function tf(a, b) {
        function c(c) {
            return g[((f.get(c) || "range" === b.t && f.set(c, a.push(c))) - 1) % g.length]
        }
        function d(b, c) {
            return Wg.range(a.length).map(function(a) {
                return b + c * a
            })
        }
        var f, g, h;
        return c.domain = function(d) {
            if (!arguments.length)
                return a;
            a = [],
            f = new e;
            for (var g, h = -1, i = d.length; ++h < i; )
                f.has(g = d[h]) || f.set(g, a.push(g));
            return c[b.t].apply(c, b.a)
        }
        ,
        c.range = function(a) {
            return arguments.length ? (g = a,
            h = 0,
            b = {
                t: "range",
                a: arguments
            },
            c) : g
        }
        ,
        c.rangePoints = function(e, f) {
            arguments.length < 2 && (f = 0);
            var i = e[0]
              , j = e[1]
              , k = (j - i) / (Math.max(1, a.length - 1) + f);
            return g = d(a.length < 2 ? (i + j) / 2 : i + k * f / 2, k),
            h = 0,
            b = {
                t: "rangePoints",
                a: arguments
            },
            c
        }
        ,
        c.rangeBands = function(e, f, i) {
            arguments.length < 2 && (f = 0),
            arguments.length < 3 && (i = f);
            var j = e[1] < e[0]
              , k = e[j - 0]
              , l = e[1 - j]
              , m = (l - k) / (a.length - f + 2 * i);
            return g = d(k + m * i, m),
            j && g.reverse(),
            h = m * (1 - f),
            b = {
                t: "rangeBands",
                a: arguments
            },
            c
        }
        ,
        c.rangeRoundBands = function(e, f, i) {
            arguments.length < 2 && (f = 0),
            arguments.length < 3 && (i = f);
            var j = e[1] < e[0]
              , k = e[j - 0]
              , l = e[1 - j]
              , m = Math.floor((l - k) / (a.length - f + 2 * i))
              , n = l - k - (a.length - f) * m;
            return g = d(k + Math.round(n / 2), m),
            j && g.reverse(),
            h = Math.round(m * (1 - f)),
            b = {
                t: "rangeRoundBands",
                a: arguments
            },
            c
        }
        ,
        c.rangeBand = function() {
            return h
        }
        ,
        c.rangeExtent = function() {
            return bf(b.a[0])
        }
        ,
        c.copy = function() {
            return tf(a, b)
        }
        ,
        c.domain(a)
    }
    function uf(a, b) {
        function c() {
            var c = 0
              , f = b.length;
            for (e = []; ++c < f; )
                e[c - 1] = Wg.quantile(a, c / f);
            return d
        }
        function d(a) {
            return isNaN(a = +a) ? void 0 : b[Wg.bisect(e, a)]
        }
        var e;
        return d.domain = function(b) {
            return arguments.length ? (a = b.filter(function(a) {
                return !isNaN(a)
            }).sort(Wg.ascending),
            c()) : a
        }
        ,
        d.range = function(a) {
            return arguments.length ? (b = a,
            c()) : b
        }
        ,
        d.quantiles = function() {
            return e
        }
        ,
        d.invertExtent = function(c) {
            return c = b.indexOf(c),
            0 > c ? [0 / 0, 0 / 0] : [c > 0 ? e[c - 1] : a[0], c < e.length ? e[c] : a[a.length - 1]]
        }
        ,
        d.copy = function() {
            return uf(a, b)
        }
        ,
        c()
    }
    function vf(a, b, c) {
        function d(b) {
            return c[Math.max(0, Math.min(g, Math.floor(f * (b - a))))]
        }
        function e() {
            return f = c.length / (b - a),
            g = c.length - 1,
            d
        }
        var f, g;
        return d.domain = function(c) {
            return arguments.length ? (a = +c[0],
            b = +c[c.length - 1],
            e()) : [a, b]
        }
        ,
        d.range = function(a) {
            return arguments.length ? (c = a,
            e()) : c
        }
        ,
        d.invertExtent = function(b) {
            return b = c.indexOf(b),
            b = 0 > b ? 0 / 0 : b / f + a,
            [b, b + 1 / f]
        }
        ,
        d.copy = function() {
            return vf(a, b, c)
        }
        ,
        e()
    }
    function wf(a, b) {
        function c(c) {
            return c >= c ? b[Wg.bisect(a, c)] : void 0
        }
        return c.domain = function(b) {
            return arguments.length ? (a = b,
            c) : a
        }
        ,
        c.range = function(a) {
            return arguments.length ? (b = a,
            c) : b
        }
        ,
        c.invertExtent = function(c) {
            return c = b.indexOf(c),
            [a[c - 1], a[c]]
        }
        ,
        c.copy = function() {
            return wf(a, b)
        }
        ,
        c
    }
    function xf(a) {
        function b(a) {
            return +a
        }
        return b.invert = b,
        b.domain = b.range = function(c) {
            return arguments.length ? (a = c.map(b),
            b) : a
        }
        ,
        b.ticks = function(b) {
            return mf(a, b)
        }
        ,
        b.tickFormat = function(b, c) {
            return nf(a, b, c)
        }
        ,
        b.copy = function() {
            return xf(a)
        }
        ,
        b
    }
    function yf(a) {
        return a.innerRadius
    }
    function zf(a) {
        return a.outerRadius
    }
    function Af(a) {
        return a.startAngle
    }
    function Bf(a) {
        return a.endAngle
    }
    function Cf(a) {
        function b(b) {
            function g() {
                j.push("M", f(a(k), h))
            }
            for (var i, j = [], k = [], l = -1, m = b.length, n = pb(c), o = pb(d); ++l < m; )
                e.call(this, i = b[l], l) ? k.push([+n.call(this, i, l), +o.call(this, i, l)]) : k.length && (g(),
                k = []);
            return k.length && g(),
            j.length ? j.join("") : null
        }
        var c = Tc
          , d = Uc
          , e = Tb
          , f = Df
          , g = f.key
          , h = .7;
        return b.x = function(a) {
            return arguments.length ? (c = a,
            b) : c
        }
        ,
        b.y = function(a) {
            return arguments.length ? (d = a,
            b) : d
        }
        ,
        b.defined = function(a) {
            return arguments.length ? (e = a,
            b) : e
        }
        ,
        b.interpolate = function(a) {
            return arguments.length ? (g = "function" == typeof a ? f = a : (f = uj.get(a) || Df).key,
            b) : g
        }
        ,
        b.tension = function(a) {
            return arguments.length ? (h = a,
            b) : h
        }
        ,
        b
    }
    function Df(a) {
        return a.join("L")
    }
    function Ef(a) {
        return Df(a) + "Z"
    }
    function Ff(a) {
        for (var b = 0, c = a.length, d = a[0], e = [d[0], ",", d[1]]; ++b < c; )
            e.push("H", (d[0] + (d = a[b])[0]) / 2, "V", d[1]);
        return c > 1 && e.push("H", d[0]),
        e.join("")
    }
    function Gf(a) {
        for (var b = 0, c = a.length, d = a[0], e = [d[0], ",", d[1]]; ++b < c; )
            e.push("V", (d = a[b])[1], "H", d[0]);
        return e.join("")
    }
    function Hf(a) {
        for (var b = 0, c = a.length, d = a[0], e = [d[0], ",", d[1]]; ++b < c; )
            e.push("H", (d = a[b])[0], "V", d[1]);
        return e.join("")
    }
    function If(a, b) {
        return a.length < 4 ? Df(a) : a[1] + Lf(a.slice(1, a.length - 1), Mf(a, b))
    }
    function Jf(a, b) {
        return a.length < 3 ? Df(a) : a[0] + Lf((a.push(a[0]),
        a), Mf([a[a.length - 2]].concat(a, [a[1]]), b))
    }
    function Kf(a, b) {
        return a.length < 3 ? Df(a) : a[0] + Lf(a, Mf(a, b))
    }
    function Lf(a, b) {
        if (b.length < 1 || a.length != b.length && a.length != b.length + 2)
            return Df(a);
        var c = a.length != b.length
          , d = ""
          , e = a[0]
          , f = a[1]
          , g = b[0]
          , h = g
          , i = 1;
        if (c && (d += "Q" + (f[0] - 2 * g[0] / 3) + "," + (f[1] - 2 * g[1] / 3) + "," + f[0] + "," + f[1],
        e = a[1],
        i = 2),
        b.length > 1) {
            h = b[1],
            f = a[i],
            i++,
            d += "C" + (e[0] + g[0]) + "," + (e[1] + g[1]) + "," + (f[0] - h[0]) + "," + (f[1] - h[1]) + "," + f[0] + "," + f[1];
            for (var j = 2; j < b.length; j++,
            i++)
                f = a[i],
                h = b[j],
                d += "S" + (f[0] - h[0]) + "," + (f[1] - h[1]) + "," + f[0] + "," + f[1]
        }
        if (c) {
            var k = a[i];
            d += "Q" + (f[0] + 2 * h[0] / 3) + "," + (f[1] + 2 * h[1] / 3) + "," + k[0] + "," + k[1]
        }
        return d
    }
    function Mf(a, b) {
        for (var c, d = [], e = (1 - b) / 2, f = a[0], g = a[1], h = 1, i = a.length; ++h < i; )
            c = f,
            f = g,
            g = a[h],
            d.push([e * (g[0] - c[0]), e * (g[1] - c[1])]);
        return d
    }
    function Nf(a) {
        if (a.length < 3)
            return Df(a);
        var b = 1
          , c = a.length
          , d = a[0]
          , e = d[0]
          , f = d[1]
          , g = [e, e, e, (d = a[1])[0]]
          , h = [f, f, f, d[1]]
          , i = [e, ",", f, "L", Rf(xj, g), ",", Rf(xj, h)];
        for (a.push(a[c - 1]); ++b <= c; )
            d = a[b],
            g.shift(),
            g.push(d[0]),
            h.shift(),
            h.push(d[1]),
            Sf(i, g, h);
        return a.pop(),
        i.push("L", d),
        i.join("")
    }
    function Of(a) {
        if (a.length < 4)
            return Df(a);
        for (var b, c = [], d = -1, e = a.length, f = [0], g = [0]; ++d < 3; )
            b = a[d],
            f.push(b[0]),
            g.push(b[1]);
        for (c.push(Rf(xj, f) + "," + Rf(xj, g)),
        --d; ++d < e; )
            b = a[d],
            f.shift(),
            f.push(b[0]),
            g.shift(),
            g.push(b[1]),
            Sf(c, f, g);
        return c.join("")
    }
    function Pf(a) {
        for (var b, c, d = -1, e = a.length, f = e + 4, g = [], h = []; ++d < 4; )
            c = a[d % e],
            g.push(c[0]),
            h.push(c[1]);
        for (b = [Rf(xj, g), ",", Rf(xj, h)],
        --d; ++d < f; )
            c = a[d % e],
            g.shift(),
            g.push(c[0]),
            h.shift(),
            h.push(c[1]),
            Sf(b, g, h);
        return b.join("")
    }
    function Qf(a, b) {
        var c = a.length - 1;
        if (c)
            for (var d, e, f = a[0][0], g = a[0][1], h = a[c][0] - f, i = a[c][1] - g, j = -1; ++j <= c; )
                d = a[j],
                e = j / c,
                d[0] = b * d[0] + (1 - b) * (f + e * h),
                d[1] = b * d[1] + (1 - b) * (g + e * i);
        return Nf(a)
    }
    function Rf(a, b) {
        return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3]
    }
    function Sf(a, b, c) {
        a.push("C", Rf(vj, b), ",", Rf(vj, c), ",", Rf(wj, b), ",", Rf(wj, c), ",", Rf(xj, b), ",", Rf(xj, c))
    }
    function Tf(a, b) {
        return (b[1] - a[1]) / (b[0] - a[0])
    }
    function Uf(a) {
        for (var b = 0, c = a.length - 1, d = [], e = a[0], f = a[1], g = d[0] = Tf(e, f); ++b < c; )
            d[b] = (g + (g = Tf(e = f, f = a[b + 1]))) / 2;
        return d[b] = g,
        d
    }
    function Vf(a) {
        for (var b, c, d, e, f = [], g = Uf(a), h = -1, i = a.length - 1; ++h < i; )
            b = Tf(a[h], a[h + 1]),
            ih(b) < Dh ? g[h] = g[h + 1] = 0 : (c = g[h] / b,
            d = g[h + 1] / b,
            e = c * c + d * d,
            e > 9 && (e = 3 * b / Math.sqrt(e),
            g[h] = e * c,
            g[h + 1] = e * d));
        for (h = -1; ++h <= i; )
            e = (a[Math.min(i, h + 1)][0] - a[Math.max(0, h - 1)][0]) / (6 * (1 + g[h] * g[h])),
            f.push([e || 0, g[h] * e || 0]);
        return f
    }
    function Wf(a) {
        return a.length < 3 ? Df(a) : a[0] + Lf(a, Vf(a))
    }
    function Xf(a) {
        for (var b, c, d, e = -1, f = a.length; ++e < f; )
            b = a[e],
            c = b[0],
            d = b[1] + sj,
            b[0] = c * Math.cos(d),
            b[1] = c * Math.sin(d);
        return a
    }
    function Yf(a) {
        function b(b) {
            function i() {
                p.push("M", h(a(r), l), k, j(a(q.reverse()), l), "Z")
            }
            for (var m, n, o, p = [], q = [], r = [], s = -1, t = b.length, u = pb(c), v = pb(e), w = c === d ? function() {
                return n
            }
            : pb(d), x = e === f ? function() {
                return o
            }
            : pb(f); ++s < t; )
                g.call(this, m = b[s], s) ? (q.push([n = +u.call(this, m, s), o = +v.call(this, m, s)]),
                r.push([+w.call(this, m, s), +x.call(this, m, s)])) : q.length && (i(),
                q = [],
                r = []);
            return q.length && i(),
            p.length ? p.join("") : null
        }
        var c = Tc
          , d = Tc
          , e = 0
          , f = Uc
          , g = Tb
          , h = Df
          , i = h.key
          , j = h
          , k = "L"
          , l = .7;
        return b.x = function(a) {
            return arguments.length ? (c = d = a,
            b) : d
        }
        ,
        b.x0 = function(a) {
            return arguments.length ? (c = a,
            b) : c
        }
        ,
        b.x1 = function(a) {
            return arguments.length ? (d = a,
            b) : d
        }
        ,
        b.y = function(a) {
            return arguments.length ? (e = f = a,
            b) : f
        }
        ,
        b.y0 = function(a) {
            return arguments.length ? (e = a,
            b) : e
        }
        ,
        b.y1 = function(a) {
            return arguments.length ? (f = a,
            b) : f
        }
        ,
        b.defined = function(a) {
            return arguments.length ? (g = a,
            b) : g
        }
        ,
        b.interpolate = function(a) {
            return arguments.length ? (i = "function" == typeof a ? h = a : (h = uj.get(a) || Df).key,
            j = h.reverse || h,
            k = h.closed ? "M" : "L",
            b) : i
        }
        ,
        b.tension = function(a) {
            return arguments.length ? (l = a,
            b) : l
        }
        ,
        b
    }
    function Zf(a) {
        return a.radius
    }
    function $f(a) {
        return [a.x, a.y]
    }
    function _f(a) {
        return function() {
            var b = a.apply(this, arguments)
              , c = b[0]
              , d = b[1] + sj;
            return [c * Math.cos(d), c * Math.sin(d)]
        }
    }
    function ag() {
        return 64
    }
    function bg() {
        return "circle"
    }
    function cg(a) {
        var b = Math.sqrt(a / Ah);
        return "M0," + b + "A" + b + "," + b + " 0 1,1 0," + -b + "A" + b + "," + b + " 0 1,1 0," + b + "Z"
    }
    function dg(a, b) {
        return nh(a, Dj),
        a.id = b,
        a
    }
    function eg(a, b, c, d) {
        var e = a.id;
        return D(a, "function" == typeof c ? function(a, f, g) {
            a.__transition__[e].tween.set(b, d(c.call(a, a.__data__, f, g)))
        }
        : (c = d(c),
        function(a) {
            a.__transition__[e].tween.set(b, c)
        }
        ))
    }
    function fg(a) {
        return null == a && (a = ""),
        function() {
            this.textContent = a
        }
    }
    function gg(a, b, c, d) {
        var f = a.__transition__ || (a.__transition__ = {
            active: 0,
            count: 0
        })
          , g = f[c];
        if (!g) {
            var h = d.time;
            g = f[c] = {
                tween: new e,
                time: h,
                ease: d.ease,
                delay: d.delay,
                duration: d.duration
            },
            ++f.count,
            Wg.timer(function(d) {
                function e(d) {
                    return f.active > c ? j() : (f.active = c,
                    g.event && g.event.start.call(a, k, b),
                    g.tween.forEach(function(c, d) {
                        (d = d.call(a, k, b)) && p.push(d)
                    }),
                    Wg.timer(function() {
                        return o.c = i(d || 1) ? Tb : i,
                        1
                    }, 0, h),
                    void 0)
                }
                function i(d) {
                    if (f.active !== c)
                        return j();
                    for (var e = d / n, h = l(e), i = p.length; i > 0; )
                        p[--i].call(a, h);
                    return e >= 1 ? (g.event && g.event.end.call(a, k, b),
                    j()) : void 0
                }
                function j() {
                    return --f.count ? delete f[c] : delete a.__transition__,
                    1
                }
                var k = a.__data__
                  , l = g.ease
                  , m = g.delay
                  , n = g.duration
                  , o = $h
                  , p = [];
                return o.t = m + h,
                d >= m ? e(d - m) : (o.c = e,
                void 0)
            }, 0, h)
        }
    }
    function hg(a, b) {
        a.attr("transform", function(a) {
            return "translate(" + b(a) + ",0)"
        })
    }
    function ig(a, b) {
        a.attr("transform", function(a) {
            return "translate(0," + b(a) + ")"
        })
    }
    function jg() {
        this._ = new Date(arguments.length > 1 ? Date.UTC.apply(this, arguments) : arguments[0])
    }
    function kg(a, b, c) {
        function d(b) {
            var c = a(b)
              , d = f(c, 1);
            return d - b > b - c ? c : d
        }
        function e(c) {
            return b(c = a(new Kj(c - 1)), 1),
            c
        }
        function f(a, c) {
            return b(a = new Kj(+a), c),
            a
        }
        function g(a, d, f) {
            var g = e(a)
              , h = [];
            if (f > 1)
                for (; d > g; )
                    c(g) % f || h.push(new Date(+g)),
                    b(g, 1);
            else
                for (; d > g; )
                    h.push(new Date(+g)),
                    b(g, 1);
            return h
        }
        function h(a, b, c) {
            try {
                Kj = jg;
                var d = new jg;
                return d._ = a,
                g(d, b, c)
            } finally {
                Kj = Date
            }
        }
        a.floor = a,
        a.round = d,
        a.ceil = e,
        a.offset = f,
        a.range = g;
        var i = a.utc = lg(a);
        return i.floor = i,
        i.round = lg(d),
        i.ceil = lg(e),
        i.offset = lg(f),
        i.range = h,
        a
    }
    function lg(a) {
        return function(b, c) {
            try {
                Kj = jg;
                var d = new jg;
                return d._ = b,
                a(d, c)._
            } finally {
                Kj = Date
            }
        }
    }
    function mg(a) {
        function b(b) {
            for (var d, e, f, g = [], h = -1, i = 0; ++h < c; )
                37 === a.charCodeAt(h) && (g.push(a.substring(i, h)),
                null != (e = bk[d = a.charAt(++h)]) && (d = a.charAt(++h)),
                (f = ck[d]) && (d = f(b, null == e ? "e" === d ? " " : "0" : e)),
                g.push(d),
                i = h + 1);
            return g.push(a.substring(i, h)),
            g.join("")
        }
        var c = a.length;
        return b.parse = function(b) {
            var c = {
                y: 1900,
                m: 0,
                d: 1,
                H: 0,
                M: 0,
                S: 0,
                L: 0,
                Z: null
            }
              , d = ng(c, a, b, 0);
            if (d != b.length)
                return null;
            "p"in c && (c.H = c.H % 12 + 12 * c.p);
            var e = null != c.Z && Kj !== jg
              , f = new (e ? jg : Kj);
            return "j"in c ? f.setFullYear(c.y, 0, c.j) : "w"in c && ("W"in c || "U"in c) ? (f.setFullYear(c.y, 0, 1),
            f.setFullYear(c.y, 0, "W"in c ? (c.w + 6) % 7 + 7 * c.W - (f.getDay() + 5) % 7 : c.w + 7 * c.U - (f.getDay() + 6) % 7)) : f.setFullYear(c.y, c.m, c.d),
            f.setHours(c.H + Math.floor(c.Z / 100), c.M + c.Z % 100, c.S, c.L),
            e ? f._ : f
        }
        ,
        b.toString = function() {
            return a
        }
        ,
        b
    }
    function ng(a, b, c, d) {
        for (var e, f, g, h = 0, i = b.length, j = c.length; i > h; ) {
            if (d >= j)
                return -1;
            if (e = b.charCodeAt(h++),
            37 === e) {
                if (g = b.charAt(h++),
                f = dk[g in bk ? b.charAt(h++) : g],
                !f || (d = f(a, c, d)) < 0)
                    return -1
            } else if (e != c.charCodeAt(d++))
                return -1
        }
        return d
    }
    function og(a) {
        return new RegExp("^(?:" + a.map(Wg.requote).join("|") + ")","i")
    }
    function pg(a) {
        for (var b = new e, c = -1, d = a.length; ++c < d; )
            b.set(a[c].toLowerCase(), c);
        return b
    }
    function qg(a, b, c) {
        var d = 0 > a ? "-" : ""
          , e = (d ? -a : a) + ""
          , f = e.length;
        return d + (c > f ? new Array(c - f + 1).join(b) + e : e)
    }
    function rg(a, b, c) {
        Wj.lastIndex = 0;
        var d = Wj.exec(b.substring(c));
        return d ? (a.w = Xj.get(d[0].toLowerCase()),
        c + d[0].length) : -1
    }
    function sg(a, b, c) {
        Uj.lastIndex = 0;
        var d = Uj.exec(b.substring(c));
        return d ? (a.w = Vj.get(d[0].toLowerCase()),
        c + d[0].length) : -1
    }
    function tg(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c, c + 1));
        return d ? (a.w = +d[0],
        c + d[0].length) : -1
    }
    function ug(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c));
        return d ? (a.U = +d[0],
        c + d[0].length) : -1
    }
    function vg(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c));
        return d ? (a.W = +d[0],
        c + d[0].length) : -1
    }
    function wg(a, b, c) {
        $j.lastIndex = 0;
        var d = $j.exec(b.substring(c));
        return d ? (a.m = _j.get(d[0].toLowerCase()),
        c + d[0].length) : -1
    }
    function xg(a, b, c) {
        Yj.lastIndex = 0;
        var d = Yj.exec(b.substring(c));
        return d ? (a.m = Zj.get(d[0].toLowerCase()),
        c + d[0].length) : -1
    }
    function yg(a, b, c) {
        return ng(a, ck.c.toString(), b, c)
    }
    function zg(a, b, c) {
        return ng(a, ck.x.toString(), b, c)
    }
    function Ag(a, b, c) {
        return ng(a, ck.X.toString(), b, c)
    }
    function Bg(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c, c + 4));
        return d ? (a.y = +d[0],
        c + d[0].length) : -1
    }
    function Cg(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c, c + 2));
        return d ? (a.y = Eg(+d[0]),
        c + d[0].length) : -1
    }
    function Dg(a, b, c) {
        return /^[+-]\d{4}$/.test(b = b.substring(c, c + 5)) ? (a.Z = +b,
        c + 5) : -1
    }
    function Eg(a) {
        return a + (a > 68 ? 1900 : 2e3)
    }
    function Fg(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c, c + 2));
        return d ? (a.m = d[0] - 1,
        c + d[0].length) : -1
    }
    function Gg(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c, c + 2));
        return d ? (a.d = +d[0],
        c + d[0].length) : -1
    }
    function Hg(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c, c + 3));
        return d ? (a.j = +d[0],
        c + d[0].length) : -1
    }
    function Ig(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c, c + 2));
        return d ? (a.H = +d[0],
        c + d[0].length) : -1
    }
    function Jg(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c, c + 2));
        return d ? (a.M = +d[0],
        c + d[0].length) : -1
    }
    function Kg(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c, c + 2));
        return d ? (a.S = +d[0],
        c + d[0].length) : -1
    }
    function Lg(a, b, c) {
        ek.lastIndex = 0;
        var d = ek.exec(b.substring(c, c + 3));
        return d ? (a.L = +d[0],
        c + d[0].length) : -1
    }
    function Mg(a, b, c) {
        var d = fk.get(b.substring(c, c += 2).toLowerCase());
        return null == d ? -1 : (a.p = d,
        c)
    }
    function Ng(a) {
        var b = a.getTimezoneOffset()
          , c = b > 0 ? "-" : "+"
          , d = ~~(ih(b) / 60)
          , e = ih(b) % 60;
        return c + qg(d, "0", 2) + qg(e, "0", 2)
    }
    function Og(a, b, c) {
        ak.lastIndex = 0;
        var d = ak.exec(b.substring(c, c + 1));
        return d ? c + d[0].length : -1
    }
    function Pg(a) {
        function b(a) {
            try {
                Kj = jg;
                var b = new Kj;
                return b._ = a,
                c(b)
            } finally {
                Kj = Date
            }
        }
        var c = mg(a);
        return b.parse = function(a) {
            try {
                Kj = jg;
                var b = c.parse(a);
                return b && b._
            } finally {
                Kj = Date
            }
        }
        ,
        b.toString = c.toString,
        b
    }
    function Qg(a) {
        return a.toISOString()
    }
    function Rg(a, b, c) {
        function d(b) {
            return a(b)
        }
        function e(a, c) {
            var d = a[1] - a[0]
              , e = d / c
              , f = Wg.bisect(hk, e);
            return f == hk.length ? [b.year, lf(a.map(function(a) {
                return a / 31536e6
            }), c)[2]] : f ? b[e / hk[f - 1] < hk[f] / e ? f - 1 : f] : [lk, lf(a, c)[2]]
        }
        return d.invert = function(b) {
            return Sg(a.invert(b))
        }
        ,
        d.domain = function(b) {
            return arguments.length ? (a.domain(b),
            d) : a.domain().map(Sg)
        }
        ,
        d.nice = function(a, b) {
            function c(c) {
                return !isNaN(c) && !a.range(c, Sg(+c + 1), b).length
            }
            var f = d.domain()
              , g = bf(f)
              , h = null == a ? e(g, 10) : "number" == typeof a && e(g, a);
            return h && (a = h[0],
            b = h[1]),
            d.domain(ef(f, b > 1 ? {
                floor: function(b) {
                    for (; c(b = a.floor(b)); )
                        b = Sg(b - 1);
                    return b
                },
                ceil: function(b) {
                    for (; c(b = a.ceil(b)); )
                        b = Sg(+b + 1);
                    return b
                }
            } : a))
        }
        ,
        d.ticks = function(a, b) {
            var c = bf(d.domain())
              , f = null == a ? e(c, 10) : "number" == typeof a ? e(c, a) : !a.range && [{
                range: a
            }, b];
            return f && (a = f[0],
            b = f[1]),
            a.range(c[0], Sg(+c[1] + 1), 1 > b ? 1 : b)
        }
        ,
        d.tickFormat = function() {
            return c
        }
        ,
        d.copy = function() {
            return Rg(a.copy(), b, c)
        }
        ,
        jf(d, a)
    }
    function Sg(a) {
        return new Date(a)
    }
    function Tg(a) {
        return function(b) {
            for (var c = a.length - 1, d = a[c]; !d[1](b); )
                d = a[--c];
            return d[0](b)
        }
    }
    function Ug(a) {
        return JSON.parse(a.responseText)
    }
    function Vg(a) {
        var b = Zg.createRange();
        return b.selectNode(Zg.body),
        b.createContextualFragment(a.responseText)
    }
    var Wg = {
        version: "3.3.13"
    };
    Date.now || (Date.now = function() {
        return +new Date
    }
    );
    var Xg = [].slice
      , Yg = function(a) {
        return Xg.call(a)
    }
      , Zg = document
      , $g = Zg.documentElement
      , _g = window;
    try {
        Yg($g.childNodes)[0].nodeType
    } catch (ah) {
        Yg = function(a) {
            for (var b = a.length, c = new Array(b); b--; )
                c[b] = a[b];
            return c
        }
    }
    try {
        Zg.createElement("div").style.setProperty("opacity", 0, "")
    } catch (bh) {
        var ch = _g.Element.prototype
          , dh = ch.setAttribute
          , eh = ch.setAttributeNS
          , fh = _g.CSSStyleDeclaration.prototype
          , gh = fh.setProperty;
        ch.setAttribute = function(a, b) {
            dh.call(this, a, b + "")
        }
        ,
        ch.setAttributeNS = function(a, b, c) {
            eh.call(this, a, b, c + "")
        }
        ,
        fh.setProperty = function(a, b, c) {
            gh.call(this, a, b + "", c)
        }
    }
    Wg.ascending = function(a, b) {
        return b > a ? -1 : a > b ? 1 : a >= b ? 0 : 0 / 0
    }
    ,
    Wg.descending = function(a, b) {
        return a > b ? -1 : b > a ? 1 : b >= a ? 0 : 0 / 0
    }
    ,
    Wg.min = function(a, b) {
        var c, d, e = -1, f = a.length;
        if (1 === arguments.length) {
            for (; ++e < f && !(null != (c = a[e]) && c >= c); )
                c = void 0;
            for (; ++e < f; )
                null != (d = a[e]) && c > d && (c = d)
        } else {
            for (; ++e < f && !(null != (c = b.call(a, a[e], e)) && c >= c); )
                c = void 0;
            for (; ++e < f; )
                null != (d = b.call(a, a[e], e)) && c > d && (c = d)
        }
        return c
    }
    ,
    Wg.max = function(a, b) {
        var c, d, e = -1, f = a.length;
        if (1 === arguments.length) {
            for (; ++e < f && !(null != (c = a[e]) && c >= c); )
                c = void 0;
            for (; ++e < f; )
                null != (d = a[e]) && d > c && (c = d)
        } else {
            for (; ++e < f && !(null != (c = b.call(a, a[e], e)) && c >= c); )
                c = void 0;
            for (; ++e < f; )
                null != (d = b.call(a, a[e], e)) && d > c && (c = d)
        }
        return c
    }
    ,
    Wg.extent = function(a, b) {
        var c, d, e, f = -1, g = a.length;
        if (1 === arguments.length) {
            for (; ++f < g && !(null != (c = e = a[f]) && c >= c); )
                c = e = void 0;
            for (; ++f < g; )
                null != (d = a[f]) && (c > d && (c = d),
                d > e && (e = d))
        } else {
            for (; ++f < g && !(null != (c = e = b.call(a, a[f], f)) && c >= c); )
                c = void 0;
            for (; ++f < g; )
                null != (d = b.call(a, a[f], f)) && (c > d && (c = d),
                d > e && (e = d))
        }
        return [c, e]
    }
    ,
    Wg.sum = function(a, b) {
        var c, d = 0, e = a.length, f = -1;
        if (1 === arguments.length)
            for (; ++f < e; )
                isNaN(c = +a[f]) || (d += c);
        else
            for (; ++f < e; )
                isNaN(c = +b.call(a, a[f], f)) || (d += c);
        return d
    }
    ,
    Wg.mean = function(b, c) {
        var d, e = b.length, f = 0, g = -1, h = 0;
        if (1 === arguments.length)
            for (; ++g < e; )
                a(d = b[g]) && (f += (d - f) / ++h);
        else
            for (; ++g < e; )
                a(d = c.call(b, b[g], g)) && (f += (d - f) / ++h);
        return h ? f : void 0
    }
    ,
    Wg.quantile = function(a, b) {
        var c = (a.length - 1) * b + 1
          , d = Math.floor(c)
          , e = +a[d - 1]
          , f = c - d;
        return f ? e + f * (a[d] - e) : e
    }
    ,
    Wg.median = function(b, c) {
        return arguments.length > 1 && (b = b.map(c)),
        b = b.filter(a),
        b.length ? Wg.quantile(b.sort(Wg.ascending), .5) : void 0
    }
    ,
    Wg.bisector = function(a) {
        return {
            left: function(b, c, d, e) {
                for (arguments.length < 3 && (d = 0),
                arguments.length < 4 && (e = b.length); e > d; ) {
                    var f = d + e >>> 1;
                    a.call(b, b[f], f) < c ? d = f + 1 : e = f
                }
                return d
            },
            right: function(b, c, d, e) {
                for (arguments.length < 3 && (d = 0),
                arguments.length < 4 && (e = b.length); e > d; ) {
                    var f = d + e >>> 1;
                    c < a.call(b, b[f], f) ? e = f : d = f + 1
                }
                return d
            }
        }
    }
    ;
    var hh = Wg.bisector(function(a) {
        return a
    });
    Wg.bisectLeft = hh.left,
    Wg.bisect = Wg.bisectRight = hh.right,
    Wg.shuffle = function(a) {
        for (var b, c, d = a.length; d; )
            c = Math.random() * d-- | 0,
            b = a[d],
            a[d] = a[c],
            a[c] = b;
        return a
    }
    ,
    Wg.permute = function(a, b) {
        for (var c = b.length, d = new Array(c); c--; )
            d[c] = a[b[c]];
        return d
    }
    ,
    Wg.pairs = function(a) {
        for (var b, c = 0, d = a.length - 1, e = a[0], f = new Array(0 > d ? 0 : d); d > c; )
            f[c] = [b = e, e = a[++c]];
        return f
    }
    ,
    Wg.zip = function() {
        if (!(e = arguments.length))
            return [];
        for (var a = -1, c = Wg.min(arguments, b), d = new Array(c); ++a < c; )
            for (var e, f = -1, g = d[a] = new Array(e); ++f < e; )
                g[f] = arguments[f][a];
        return d
    }
    ,
    Wg.transpose = function(a) {
        return Wg.zip.apply(Wg, a)
    }
    ,
    Wg.keys = function(a) {
        var b = [];
        for (var c in a)
            b.push(c);
        return b
    }
    ,
    Wg.values = function(a) {
        var b = [];
        for (var c in a)
            b.push(a[c]);
        return b
    }
    ,
    Wg.entries = function(a) {
        var b = [];
        for (var c in a)
            b.push({
                key: c,
                value: a[c]
            });
        return b
    }
    ,
    Wg.merge = function(a) {
        for (var b, c, d, e = a.length, f = -1, g = 0; ++f < e; )
            g += a[f].length;
        for (c = new Array(g); --e >= 0; )
            for (d = a[e],
            b = d.length; --b >= 0; )
                c[--g] = d[b];
        return c
    }
    ;
    var ih = Math.abs;
    Wg.range = function(a, b, d) {
        if (arguments.length < 3 && (d = 1,
        arguments.length < 2 && (b = a,
        a = 0)),
        (b - a) / d === 1 / 0)
            throw new Error("infinite range");
        var e, f = [], g = c(ih(d)), h = -1;
        if (a *= g,
        b *= g,
        d *= g,
        0 > d)
            for (; (e = a + d * ++h) > b; )
                f.push(e / g);
        else
            for (; (e = a + d * ++h) < b; )
                f.push(e / g);
        return f
    }
    ,
    Wg.map = function(a) {
        var b = new e;
        if (a instanceof e)
            a.forEach(function(a, c) {
                b.set(a, c)
            });
        else
            for (var c in a)
                b.set(c, a[c]);
        return b
    }
    ,
    d(e, {
        has: function(a) {
            return jh + a in this
        },
        get: function(a) {
            return this[jh + a]
        },
        set: function(a, b) {
            return this[jh + a] = b
        },
        remove: function(a) {
            return a = jh + a,
            a in this && delete this[a]
        },
        keys: function() {
            var a = [];
            return this.forEach(function(b) {
                a.push(b)
            }),
            a
        },
        values: function() {
            var a = [];
            return this.forEach(function(b, c) {
                a.push(c)
            }),
            a
        },
        entries: function() {
            var a = [];
            return this.forEach(function(b, c) {
                a.push({
                    key: b,
                    value: c
                })
            }),
            a
        },
        forEach: function(a) {
            for (var b in this)
                b.charCodeAt(0) === kh && a.call(this, b.substring(1), this[b])
        }
    });
    var jh = "\x00"
      , kh = jh.charCodeAt(0);
    Wg.nest = function() {
        function a(b, h, i) {
            if (i >= g.length)
                return d ? d.call(f, h) : c ? h.sort(c) : h;
            for (var j, k, l, m, n = -1, o = h.length, p = g[i++], q = new e; ++n < o; )
                (m = q.get(j = p(k = h[n]))) ? m.push(k) : q.set(j, [k]);
            return b ? (k = b(),
            l = function(c, d) {
                k.set(c, a(b, d, i))
            }
            ) : (k = {},
            l = function(c, d) {
                k[c] = a(b, d, i)
            }
            ),
            q.forEach(l),
            k
        }
        function b(a, c) {
            if (c >= g.length)
                return a;
            var d = []
              , e = h[c++];
            return a.forEach(function(a, e) {
                d.push({
                    key: a,
                    values: b(e, c)
                })
            }),
            e ? d.sort(function(a, b) {
                return e(a.key, b.key)
            }) : d
        }
        var c, d, f = {}, g = [], h = [];
        return f.map = function(b, c) {
            return a(c, b, 0)
        }
        ,
        f.entries = function(c) {
            return b(a(Wg.map, c, 0), 0)
        }
        ,
        f.key = function(a) {
            return g.push(a),
            f
        }
        ,
        f.sortKeys = function(a) {
            return h[g.length - 1] = a,
            f
        }
        ,
        f.sortValues = function(a) {
            return c = a,
            f
        }
        ,
        f.rollup = function(a) {
            return d = a,
            f
        }
        ,
        f
    }
    ,
    Wg.set = function(a) {
        var b = new f;
        if (a)
            for (var c = 0, d = a.length; d > c; ++c)
                b.add(a[c]);
        return b
    }
    ,
    d(f, {
        has: function(a) {
            return jh + a in this
        },
        add: function(a) {
            return this[jh + a] = !0,
            a
        },
        remove: function(a) {
            return a = jh + a,
            a in this && delete this[a]
        },
        values: function() {
            var a = [];
            return this.forEach(function(b) {
                a.push(b)
            }),
            a
        },
        forEach: function(a) {
            for (var b in this)
                b.charCodeAt(0) === kh && a.call(this, b.substring(1))
        }
    }),
    Wg.behavior = {},
    Wg.rebind = function(a, b) {
        for (var c, d = 1, e = arguments.length; ++d < e; )
            a[c = arguments[d]] = g(a, b, b[c]);
        return a
    }
    ;
    var lh = ["webkit", "ms", "moz", "Moz", "o", "O"];
    Wg.dispatch = function() {
        for (var a = new j, b = -1, c = arguments.length; ++b < c; )
            a[arguments[b]] = k(a);
        return a
    }
    ,
    j.prototype.on = function(a, b) {
        var c = a.indexOf(".")
          , d = "";
        if (c >= 0 && (d = a.substring(c + 1),
        a = a.substring(0, c)),
        a)
            return arguments.length < 2 ? this[a].on(d) : this[a].on(d, b);
        if (2 === arguments.length) {
            if (null == b)
                for (a in this)
                    this.hasOwnProperty(a) && this[a].on(d, null);
            return this
        }
    }
    ,
    Wg.event = null,
    Wg.requote = function(a) {
        return a.replace(mh, "\\$&")
    }
    ;
    var mh = /[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g
      , nh = {}.__proto__ ? function(a, b) {
        a.__proto__ = b
    }
    : function(a, b) {
        for (var c in b)
            a[c] = b[c]
    }
      , oh = function(a, b) {
        return b.querySelector(a)
    }
      , ph = function(a, b) {
        return b.querySelectorAll(a)
    }
      , qh = $g[h($g, "matchesSelector")]
      , rh = function(a, b) {
        return qh.call(a, b)
    };
    "function" == typeof Sizzle && (oh = function(a, b) {
        return Sizzle(a, b)[0] || null
    }
    ,
    ph = function(a, b) {
        return Sizzle.uniqueSort(Sizzle(a, b))
    }
    ,
    rh = Sizzle.matchesSelector),
    Wg.selection = function() {
        return vh
    }
    ;
    var sh = Wg.selection.prototype = [];
    sh.select = function(a) {
        var b, c, d, e, f = [];
        a = p(a);
        for (var g = -1, h = this.length; ++g < h; ) {
            f.push(b = []),
            b.parentNode = (d = this[g]).parentNode;
            for (var i = -1, j = d.length; ++i < j; )
                (e = d[i]) ? (b.push(c = a.call(e, e.__data__, i, g)),
                c && "__data__"in e && (c.__data__ = e.__data__)) : b.push(null)
        }
        return o(f)
    }
    ,
    sh.selectAll = function(a) {
        var b, c, d = [];
        a = q(a);
        for (var e = -1, f = this.length; ++e < f; )
            for (var g = this[e], h = -1, i = g.length; ++h < i; )
                (c = g[h]) && (d.push(b = Yg(a.call(c, c.__data__, h, e))),
                b.parentNode = c);
        return o(d)
    }
    ;
    var th = {
        svg: "http://www.w3.org/2000/svg",
        xhtml: "http://www.w3.org/1999/xhtml",
        xlink: "http://www.w3.org/1999/xlink",
        xml: "http://www.w3.org/XML/1998/namespace",
        xmlns: "http://www.w3.org/2000/xmlns/"
    };
    Wg.ns = {
        prefix: th,
        qualify: function(a) {
            var b = a.indexOf(":")
              , c = a;
            return b >= 0 && (c = a.substring(0, b),
            a = a.substring(b + 1)),
            th.hasOwnProperty(c) ? {
                space: th[c],
                local: a
            } : a
        }
    },
    sh.attr = function(a, b) {
        if (arguments.length < 2) {
            if ("string" == typeof a) {
                var c = this.node();
                return a = Wg.ns.qualify(a),
                a.local ? c.getAttributeNS(a.space, a.local) : c.getAttribute(a)
            }
            for (b in a)
                this.each(r(b, a[b]));
            return this
        }
        return this.each(r(a, b))
    }
    ,
    sh.classed = function(a, b) {
        if (arguments.length < 2) {
            if ("string" == typeof a) {
                var c = this.node()
                  , d = (a = u(a)).length
                  , e = -1;
                if (b = c.classList) {
                    for (; ++e < d; )
                        if (!b.contains(a[e]))
                            return !1
                } else
                    for (b = c.getAttribute("class"); ++e < d; )
                        if (!t(a[e]).test(b))
                            return !1;
                return !0
            }
            for (b in a)
                this.each(v(b, a[b]));
            return this
        }
        return this.each(v(a, b))
    }
    ,
    sh.style = function(a, b, c) {
        var d = arguments.length;
        if (3 > d) {
            if ("string" != typeof a) {
                2 > d && (b = "");
                for (c in a)
                    this.each(x(c, a[c], b));
                return this
            }
            if (2 > d)
                return _g.getComputedStyle(this.node(), null).getPropertyValue(a);
            c = ""
        }
        return this.each(x(a, b, c))
    }
    ,
    sh.property = function(a, b) {
        if (arguments.length < 2) {
            if ("string" == typeof a)
                return this.node()[a];
            for (b in a)
                this.each(y(b, a[b]));
            return this
        }
        return this.each(y(a, b))
    }
    ,
    sh.text = function(a) {
        return arguments.length ? this.each("function" == typeof a ? function() {
            var b = a.apply(this, arguments);
            this.textContent = null == b ? "" : b
        }
        : null == a ? function() {
            this.textContent = ""
        }
        : function() {
            this.textContent = a
        }
        ) : this.node().textContent
    }
    ,
    sh.html = function(a) {
        return arguments.length ? this.each("function" == typeof a ? function() {
            var b = a.apply(this, arguments);
            this.innerHTML = null == b ? "" : b
        }
        : null == a ? function() {
            this.innerHTML = ""
        }
        : function() {
            this.innerHTML = a
        }
        ) : this.node().innerHTML
    }
    ,
    sh.append = function(a) {
        return a = z(a),
        this.select(function() {
            return this.appendChild(a.apply(this, arguments))
        })
    }
    ,
    sh.insert = function(a, b) {
        return a = z(a),
        b = p(b),
        this.select(function() {
            return this.insertBefore(a.apply(this, arguments), b.apply(this, arguments) || null)
        })
    }
    ,
    sh.remove = function() {
        return this.each(function() {
            var a = this.parentNode;
            a && a.removeChild(this)
        })
    }
    ,
    sh.data = function(a, b) {
        function c(a, c) {
            var d, f, g, h = a.length, l = c.length, m = Math.min(h, l), n = new Array(l), o = new Array(l), p = new Array(h);
            if (b) {
                var q, r = new e, s = new e, t = [];
                for (d = -1; ++d < h; )
                    q = b.call(f = a[d], f.__data__, d),
                    r.has(q) ? p[d] = f : r.set(q, f),
                    t.push(q);
                for (d = -1; ++d < l; )
                    q = b.call(c, g = c[d], d),
                    (f = r.get(q)) ? (n[d] = f,
                    f.__data__ = g) : s.has(q) || (o[d] = A(g)),
                    s.set(q, g),
                    r.remove(q);
                for (d = -1; ++d < h; )
                    r.has(t[d]) && (p[d] = a[d])
            } else {
                for (d = -1; ++d < m; )
                    f = a[d],
                    g = c[d],
                    f ? (f.__data__ = g,
                    n[d] = f) : o[d] = A(g);
                for (; l > d; ++d)
                    o[d] = A(c[d]);
                for (; h > d; ++d)
                    p[d] = a[d]
            }
            o.update = n,
            o.parentNode = n.parentNode = p.parentNode = a.parentNode,
            i.push(o),
            j.push(n),
            k.push(p)
        }
        var d, f, g = -1, h = this.length;
        if (!arguments.length) {
            for (a = new Array(h = (d = this[0]).length); ++g < h; )
                (f = d[g]) && (a[g] = f.__data__);
            return a
        }
        var i = E([])
          , j = o([])
          , k = o([]);
        if ("function" == typeof a)
            for (; ++g < h; )
                c(d = this[g], a.call(d, d.parentNode.__data__, g));
        else
            for (; ++g < h; )
                c(d = this[g], a);
        return j.enter = function() {
            return i
        }
        ,
        j.exit = function() {
            return k
        }
        ,
        j
    }
    ,
    sh.datum = function(a) {
        return arguments.length ? this.property("__data__", a) : this.property("__data__")
    }
    ,
    sh.filter = function(a) {
        var b, c, d, e = [];
        "function" != typeof a && (a = B(a));
        for (var f = 0, g = this.length; g > f; f++) {
            e.push(b = []),
            b.parentNode = (c = this[f]).parentNode;
            for (var h = 0, i = c.length; i > h; h++)
                (d = c[h]) && a.call(d, d.__data__, h, f) && b.push(d)
        }
        return o(e)
    }
    ,
    sh.order = function() {
        for (var a = -1, b = this.length; ++a < b; )
            for (var c, d = this[a], e = d.length - 1, f = d[e]; --e >= 0; )
                (c = d[e]) && (f && f !== c.nextSibling && f.parentNode.insertBefore(c, f),
                f = c);
        return this
    }
    ,
    sh.sort = function(a) {
        a = C.apply(this, arguments);
        for (var b = -1, c = this.length; ++b < c; )
            this[b].sort(a);
        return this.order()
    }
    ,
    sh.each = function(a) {
        return D(this, function(b, c, d) {
            a.call(b, b.__data__, c, d)
        })
    }
    ,
    sh.call = function(a) {
        var b = Yg(arguments);
        return a.apply(b[0] = this, b),
        this
    }
    ,
    sh.empty = function() {
        return !this.node()
    }
    ,
    sh.node = function() {
        for (var a = 0, b = this.length; b > a; a++)
            for (var c = this[a], d = 0, e = c.length; e > d; d++) {
                var f = c[d];
                if (f)
                    return f
            }
        return null
    }
    ,
    sh.size = function() {
        var a = 0;
        return this.each(function() {
            ++a
        }),
        a
    }
    ;
    var uh = [];
    Wg.selection.enter = E,
    Wg.selection.enter.prototype = uh,
    uh.append = sh.append,
    uh.empty = sh.empty,
    uh.node = sh.node,
    uh.call = sh.call,
    uh.size = sh.size,
    uh.select = function(a) {
        for (var b, c, d, e, f, g = [], h = -1, i = this.length; ++h < i; ) {
            d = (e = this[h]).update,
            g.push(b = []),
            b.parentNode = e.parentNode;
            for (var j = -1, k = e.length; ++j < k; )
                (f = e[j]) ? (b.push(d[j] = c = a.call(e.parentNode, f.__data__, j, h)),
                c.__data__ = f.__data__) : b.push(null)
        }
        return o(g)
    }
    ,
    uh.insert = function(a, b) {
        return arguments.length < 2 && (b = F(this)),
        sh.insert.call(this, a, b)
    }
    ,
    sh.transition = function() {
        for (var a, b, c = zj || ++Ej, d = [], e = Aj || {
            time: Date.now(),
            ease: Od,
            delay: 0,
            duration: 250
        }, f = -1, g = this.length; ++f < g; ) {
            d.push(a = []);
            for (var h = this[f], i = -1, j = h.length; ++i < j; )
                (b = h[i]) && gg(b, i, c, e),
                a.push(b)
        }
        return dg(d, c)
    }
    ,
    sh.interrupt = function() {
        return this.each(G)
    }
    ,
    Wg.select = function(a) {
        var b = ["string" == typeof a ? oh(a, Zg) : a];
        return b.parentNode = $g,
        o([b])
    }
    ,
    Wg.selectAll = function(a) {
        var b = Yg("string" == typeof a ? ph(a, Zg) : a);
        return b.parentNode = $g,
        o([b])
    }
    ;
    var vh = Wg.select($g);
    sh.on = function(a, b, c) {
        var d = arguments.length;
        if (3 > d) {
            if ("string" != typeof a) {
                2 > d && (b = !1);
                for (c in a)
                    this.each(H(c, a[c], b));
                return this
            }
            if (2 > d)
                return (d = this.node()["__on" + a]) && d._;
            c = !1
        }
        return this.each(H(a, b, c))
    }
    ;
    var wh = Wg.map({
        mouseenter: "mouseover",
        mouseleave: "mouseout"
    });
    wh.forEach(function(a) {
        "on" + a in Zg && wh.remove(a)
    });
    var xh = "onselectstart"in Zg ? null : h($g.style, "userSelect")
      , yh = 0;
    Wg.mouse = function(a) {
        return L(a, m())
    }
    ;
    var zh = /WebKit/.test(_g.navigator.userAgent) ? -1 : 0;
    Wg.touches = function(a, b) {
        return arguments.length < 2 && (b = m().touches),
        b ? Yg(b).map(function(b) {
            var c = L(a, b);
            return c.identifier = b.identifier,
            c
        }) : []
    }
    ,
    Wg.behavior.drag = function() {
        function a() {
            this.on("mousedown.drag", g).on("touchstart.drag", h)
        }
        function b() {
            return Wg.event.changedTouches[0].identifier
        }
        function c(a, b) {
            return Wg.touches(a).filter(function(a) {
                return a.identifier === b
            })[0]
        }
        function d(a, b, c, d) {
            return function() {
                function g() {
                    var a = b(k, n)
                      , c = a[0] - p[0]
                      , d = a[1] - p[1];
                    q |= c | d,
                    p = a,
                    l({
                        type: "drag",
                        x: a[0] + i[0],
                        y: a[1] + i[1],
                        dx: c,
                        dy: d
                    })
                }
                function h() {
                    r.on(c + "." + o, null).on(d + "." + o, null),
                    s(q && Wg.event.target === m),
                    l({
                        type: "dragend"
                    })
                }
                var i, j = this, k = j.parentNode, l = e.of(j, arguments), m = Wg.event.target, n = a(), o = null == n ? "drag" : "drag-" + n, p = b(k, n), q = 0, r = Wg.select(_g).on(c + "." + o, g).on(d + "." + o, h), s = K();
                f ? (i = f.apply(j, arguments),
                i = [i.x - p[0], i.y - p[1]]) : i = [0, 0],
                l({
                    type: "dragstart"
                })
            }
        }
        var e = n(a, "drag", "dragstart", "dragend")
          , f = null
          , g = d(i, Wg.mouse, "mousemove", "mouseup")
          , h = d(b, c, "touchmove", "touchend");
        return a.origin = function(b) {
            return arguments.length ? (f = b,
            a) : f
        }
        ,
        Wg.rebind(a, e, "on")
    }
    ;
    var Ah = Math.PI
      , Bh = 2 * Ah
      , Ch = Ah / 2
      , Dh = 1e-6
      , Eh = Dh * Dh
      , Fh = Ah / 180
      , Gh = 180 / Ah
      , Hh = Math.SQRT2
      , Ih = 2
      , Jh = 4;
    Wg.interpolateZoom = function(a, b) {
        function c(a) {
            var b = a * s;
            if (r) {
                var c = Q(p)
                  , g = f / (Ih * m) * (c * R(Hh * b + p) - P(p));
                return [d + g * j, e + g * k, f * c / Q(Hh * b + p)]
            }
            return [d + a * j, e + a * k, f * Math.exp(Hh * b)]
        }
        var d = a[0]
          , e = a[1]
          , f = a[2]
          , g = b[0]
          , h = b[1]
          , i = b[2]
          , j = g - d
          , k = h - e
          , l = j * j + k * k
          , m = Math.sqrt(l)
          , n = (i * i - f * f + Jh * l) / (2 * f * Ih * m)
          , o = (i * i - f * f - Jh * l) / (2 * i * Ih * m)
          , p = Math.log(Math.sqrt(n * n + 1) - n)
          , q = Math.log(Math.sqrt(o * o + 1) - o)
          , r = q - p
          , s = (r || Math.log(i / f)) / Hh;
        return c.duration = 1e3 * s,
        c
    }
    ,
    Wg.behavior.zoom = function() {
        function a(a) {
            a.on(B, j).on(Mh + ".zoom", m).on(C, o).on("dblclick.zoom", p).on(E, k)
        }
        function b(a) {
            return [(a[0] - y.x) / y.k, (a[1] - y.y) / y.k]
        }
        function c(a) {
            return [a[0] * y.k + y.x, a[1] * y.k + y.y]
        }
        function d(a) {
            y.k = Math.max(A[0], Math.min(A[1], a))
        }
        function e(a, b) {
            b = c(b),
            y.x += a[0] - b[0],
            y.y += a[1] - b[1]
        }
        function f() {
            v && v.domain(u.range().map(function(a) {
                return (a - y.x) / y.k
            }).map(u.invert)),
            x && x.domain(w.range().map(function(a) {
                return (a - y.y) / y.k
            }).map(w.invert))
        }
        function g(a) {
            a({
                type: "zoomstart"
            })
        }
        function h(a) {
            f(),
            a({
                type: "zoom",
                scale: y.k,
                translate: [y.x, y.y]
            })
        }
        function i(a) {
            a({
                type: "zoomend"
            })
        }
        function j() {
            function a() {
                k = 1,
                e(Wg.mouse(d), m),
                h(f)
            }
            function c() {
                l.on(C, _g === d ? o : null).on(D, null),
                n(k && Wg.event.target === j),
                i(f)
            }
            var d = this
              , f = F.of(d, arguments)
              , j = Wg.event.target
              , k = 0
              , l = Wg.select(_g).on(C, a).on(D, c)
              , m = b(Wg.mouse(d))
              , n = K();
            G.call(d),
            g(f)
        }
        function k() {
            function a() {
                var a = Wg.touches(o);
                return n = y.k,
                a.forEach(function(a) {
                    a.identifier in q && (q[a.identifier] = b(a))
                }),
                a
            }
            function c() {
                for (var b = Wg.event.changedTouches, c = 0, f = b.length; f > c; ++c)
                    q[b[c].identifier] = null;
                var g = a()
                  , i = Date.now();
                if (1 === g.length) {
                    if (500 > i - t) {
                        var j = g[0]
                          , k = q[j.identifier];
                        d(2 * y.k),
                        e(j, k),
                        l(),
                        h(p)
                    }
                    t = i
                } else if (g.length > 1) {
                    var j = g[0]
                      , m = g[1]
                      , n = j[0] - m[0]
                      , o = j[1] - m[1];
                    r = n * n + o * o
                }
            }
            function f() {
                for (var a, b, c, f, g = Wg.touches(o), i = 0, j = g.length; j > i; ++i,
                f = null)
                    if (c = g[i],
                    f = q[c.identifier]) {
                        if (b)
                            break;
                        a = c,
                        b = f
                    }
                if (f) {
                    var k = (k = c[0] - a[0]) * k + (k = c[1] - a[1]) * k
                      , l = r && Math.sqrt(k / r);
                    a = [(a[0] + c[0]) / 2, (a[1] + c[1]) / 2],
                    b = [(b[0] + f[0]) / 2, (b[1] + f[1]) / 2],
                    d(l * n)
                }
                t = null,
                e(a, b),
                h(p)
            }
            function m() {
                if (Wg.event.touches.length) {
                    for (var b = Wg.event.changedTouches, c = 0, d = b.length; d > c; ++c)
                        delete q[b[c].identifier];
                    for (var e in q)
                        return void a()
                }
                w.on(u, null).on(v, null),
                x.on(B, j).on(E, k),
                z(),
                i(p)
            }
            var n, o = this, p = F.of(o, arguments), q = {}, r = 0, s = Wg.event.changedTouches[0].identifier, u = "touchmove.zoom-" + s, v = "touchend.zoom-" + s, w = Wg.select(_g).on(u, f).on(v, m), x = Wg.select(o).on(B, null).on(E, c), z = K();
            G.call(o),
            c(),
            g(p)
        }
        function m() {
            var a = F.of(this, arguments);
            s ? clearTimeout(s) : (G.call(this),
            g(a)),
            s = setTimeout(function() {
                s = null,
                i(a)
            }, 50),
            l();
            var c = r || Wg.mouse(this);
            q || (q = b(c)),
            d(Math.pow(2, .002 * Kh()) * y.k),
            e(c, q),
            h(a)
        }
        function o() {
            q = null
        }
        function p() {
            var a = F.of(this, arguments)
              , c = Wg.mouse(this)
              , f = b(c)
              , j = Math.log(y.k) / Math.LN2;
            g(a),
            d(Math.pow(2, Wg.event.shiftKey ? Math.ceil(j) - 1 : Math.floor(j) + 1)),
            e(c, f),
            h(a),
            i(a)
        }
        var q, r, s, t, u, v, w, x, y = {
            x: 0,
            y: 0,
            k: 1
        }, z = [960, 500], A = Lh, B = "mousedown.zoom", C = "mousemove.zoom", D = "mouseup.zoom", E = "touchstart.zoom", F = n(a, "zoomstart", "zoom", "zoomend");
        return a.event = function(a) {
            a.each(function() {
                var a = F.of(this, arguments)
                  , b = y;
                zj ? Wg.select(this).transition().each("start.zoom", function() {
                    y = this.__chart__ || {
                        x: 0,
                        y: 0,
                        k: 1
                    },
                    g(a)
                }).tween("zoom:zoom", function() {
                    var c = z[0]
                      , d = z[1]
                      , e = c / 2
                      , f = d / 2
                      , g = Wg.interpolateZoom([(e - y.x) / y.k, (f - y.y) / y.k, c / y.k], [(e - b.x) / b.k, (f - b.y) / b.k, c / b.k]);
                    return function(b) {
                        var d = g(b)
                          , i = c / d[2];
                        this.__chart__ = y = {
                            x: e - d[0] * i,
                            y: f - d[1] * i,
                            k: i
                        },
                        h(a)
                    }
                }).each("end.zoom", function() {
                    i(a)
                }) : (this.__chart__ = y,
                g(a),
                h(a),
                i(a))
            })
        }
        ,
        a.translate = function(b) {
            return arguments.length ? (y = {
                x: +b[0],
                y: +b[1],
                k: y.k
            },
            f(),
            a) : [y.x, y.y]
        }
        ,
        a.scale = function(b) {
            return arguments.length ? (y = {
                x: y.x,
                y: y.y,
                k: +b
            },
            f(),
            a) : y.k
        }
        ,
        a.scaleExtent = function(b) {
            return arguments.length ? (A = null == b ? Lh : [+b[0], +b[1]],
            a) : A
        }
        ,
        a.center = function(b) {
            return arguments.length ? (r = b && [+b[0], +b[1]],
            a) : r
        }
        ,
        a.size = function(b) {
            return arguments.length ? (z = b && [+b[0], +b[1]],
            a) : z
        }
        ,
        a.x = function(b) {
            return arguments.length ? (v = b,
            u = b.copy(),
            y = {
                x: 0,
                y: 0,
                k: 1
            },
            a) : v
        }
        ,
        a.y = function(b) {
            return arguments.length ? (x = b,
            w = b.copy(),
            y = {
                x: 0,
                y: 0,
                k: 1
            },
            a) : x
        }
        ,
        Wg.rebind(a, F, "on")
    }
    ;
    var Kh, Lh = [0, 1 / 0], Mh = "onwheel"in Zg ? (Kh = function() {
        return -Wg.event.deltaY * (Wg.event.deltaMode ? 120 : 1)
    }
    ,
    "wheel") : "onmousewheel"in Zg ? (Kh = function() {
        return Wg.event.wheelDelta
    }
    ,
    "mousewheel") : (Kh = function() {
        return -Wg.event.detail
    }
    ,
    "MozMousePixelScroll");
    T.prototype.toString = function() {
        return this.rgb() + ""
    }
    ,
    Wg.hsl = function(a, b, c) {
        return 1 === arguments.length ? a instanceof V ? U(a.h, a.s, a.l) : kb("" + a, lb, U) : U(+a, +b, +c)
    }
    ;
    var Nh = V.prototype = new T;
    Nh.brighter = function(a) {
        return a = Math.pow(.7, arguments.length ? a : 1),
        U(this.h, this.s, this.l / a)
    }
    ,
    Nh.darker = function(a) {
        return a = Math.pow(.7, arguments.length ? a : 1),
        U(this.h, this.s, a * this.l)
    }
    ,
    Nh.rgb = function() {
        return W(this.h, this.s, this.l)
    }
    ,
    Wg.hcl = function(a, b, c) {
        return 1 === arguments.length ? a instanceof Y ? X(a.h, a.c, a.l) : a instanceof _ ? bb(a.l, a.a, a.b) : bb((a = mb((a = Wg.rgb(a)).r, a.g, a.b)).l, a.a, a.b) : X(+a, +b, +c)
    }
    ;
    var Oh = Y.prototype = new T;
    Oh.brighter = function(a) {
        return X(this.h, this.c, Math.min(100, this.l + Ph * (arguments.length ? a : 1)))
    }
    ,
    Oh.darker = function(a) {
        return X(this.h, this.c, Math.max(0, this.l - Ph * (arguments.length ? a : 1)))
    }
    ,
    Oh.rgb = function() {
        return Z(this.h, this.c, this.l).rgb()
    }
    ,
    Wg.lab = function(a, b, c) {
        return 1 === arguments.length ? a instanceof _ ? $(a.l, a.a, a.b) : a instanceof Y ? Z(a.l, a.c, a.h) : mb((a = Wg.rgb(a)).r, a.g, a.b) : $(+a, +b, +c)
    }
    ;
    var Ph = 18
      , Qh = .95047
      , Rh = 1
      , Sh = 1.08883
      , Th = _.prototype = new T;
    Th.brighter = function(a) {
        return $(Math.min(100, this.l + Ph * (arguments.length ? a : 1)), this.a, this.b)
    }
    ,
    Th.darker = function(a) {
        return $(Math.max(0, this.l - Ph * (arguments.length ? a : 1)), this.a, this.b)
    }
    ,
    Th.rgb = function() {
        return ab(this.l, this.a, this.b)
    }
    ,
    Wg.rgb = function(a, b, c) {
        return 1 === arguments.length ? a instanceof ib ? hb(a.r, a.g, a.b) : kb("" + a, hb, W) : hb(~~a, ~~b, ~~c)
    }
    ;
    var Uh = ib.prototype = new T;
    Uh.brighter = function(a) {
        a = Math.pow(.7, arguments.length ? a : 1);
        var b = this.r
          , c = this.g
          , d = this.b
          , e = 30;
        return b || c || d ? (b && e > b && (b = e),
        c && e > c && (c = e),
        d && e > d && (d = e),
        hb(Math.min(255, ~~(b / a)), Math.min(255, ~~(c / a)), Math.min(255, ~~(d / a)))) : hb(e, e, e)
    }
    ,
    Uh.darker = function(a) {
        return a = Math.pow(.7, arguments.length ? a : 1),
        hb(~~(a * this.r), ~~(a * this.g), ~~(a * this.b))
    }
    ,
    Uh.hsl = function() {
        return lb(this.r, this.g, this.b)
    }
    ,
    Uh.toString = function() {
        return "#" + jb(this.r) + jb(this.g) + jb(this.b)
    }
    ;
    var Vh = Wg.map({
        aliceblue: 15792383,
        antiquewhite: 16444375,
        aqua: 65535,
        aquamarine: 8388564,
        azure: 15794175,
        beige: 16119260,
        bisque: 16770244,
        black: 0,
        blanchedalmond: 16772045,
        blue: 255,
        blueviolet: 9055202,
        brown: 10824234,
        burlywood: 14596231,
        cadetblue: 6266528,
        chartreuse: 8388352,
        chocolate: 13789470,
        coral: 16744272,
        cornflowerblue: 6591981,
        cornsilk: 16775388,
        crimson: 14423100,
        cyan: 65535,
        darkblue: 139,
        darkcyan: 35723,
        darkgoldenrod: 12092939,
        darkgray: 11119017,
        darkgreen: 25600,
        darkgrey: 11119017,
        darkkhaki: 12433259,
        darkmagenta: 9109643,
        darkolivegreen: 5597999,
        darkorange: 16747520,
        darkorchid: 10040012,
        darkred: 9109504,
        darksalmon: 15308410,
        darkseagreen: 9419919,
        darkslateblue: 4734347,
        darkslategray: 3100495,
        darkslategrey: 3100495,
        darkturquoise: 52945,
        darkviolet: 9699539,
        deeppink: 16716947,
        deepskyblue: 49151,
        dimgray: 6908265,
        dimgrey: 6908265,
        dodgerblue: 2003199,
        firebrick: 11674146,
        floralwhite: 16775920,
        forestgreen: 2263842,
        fuchsia: 16711935,
        gainsboro: 14474460,
        ghostwhite: 16316671,
        gold: 16766720,
        goldenrod: 14329120,
        gray: 8421504,
        green: 32768,
        greenyellow: 11403055,
        grey: 8421504,
        honeydew: 15794160,
        hotpink: 16738740,
        indianred: 13458524,
        indigo: 4915330,
        ivory: 16777200,
        khaki: 15787660,
        lavender: 15132410,
        lavenderblush: 16773365,
        lawngreen: 8190976,
        lemonchiffon: 16775885,
        lightblue: 11393254,
        lightcoral: 15761536,
        lightcyan: 14745599,
        lightgoldenrodyellow: 16448210,
        lightgray: 13882323,
        lightgreen: 9498256,
        lightgrey: 13882323,
        lightpink: 16758465,
        lightsalmon: 16752762,
        lightseagreen: 2142890,
        lightskyblue: 8900346,
        lightslategray: 7833753,
        lightslategrey: 7833753,
        lightsteelblue: 11584734,
        lightyellow: 16777184,
        lime: 65280,
        limegreen: 3329330,
        linen: 16445670,
        magenta: 16711935,
        maroon: 8388608,
        mediumaquamarine: 6737322,
        mediumblue: 205,
        mediumorchid: 12211667,
        mediumpurple: 9662683,
        mediumseagreen: 3978097,
        mediumslateblue: 8087790,
        mediumspringgreen: 64154,
        mediumturquoise: 4772300,
        mediumvioletred: 13047173,
        midnightblue: 1644912,
        mintcream: 16121850,
        mistyrose: 16770273,
        moccasin: 16770229,
        navajowhite: 16768685,
        navy: 128,
        oldlace: 16643558,
        olive: 8421376,
        olivedrab: 7048739,
        orange: 16753920,
        orangered: 16729344,
        orchid: 14315734,
        palegoldenrod: 15657130,
        palegreen: 10025880,
        paleturquoise: 11529966,
        palevioletred: 14381203,
        papayawhip: 16773077,
        peachpuff: 16767673,
        peru: 13468991,
        pink: 16761035,
        plum: 14524637,
        powderblue: 11591910,
        purple: 8388736,
        red: 16711680,
        rosybrown: 12357519,
        royalblue: 4286945,
        saddlebrown: 9127187,
        salmon: 16416882,
        sandybrown: 16032864,
        seagreen: 3050327,
        seashell: 16774638,
        sienna: 10506797,
        silver: 12632256,
        skyblue: 8900331,
        slateblue: 6970061,
        slategray: 7372944,
        slategrey: 7372944,
        snow: 16775930,
        springgreen: 65407,
        steelblue: 4620980,
        tan: 13808780,
        teal: 32896,
        thistle: 14204888,
        tomato: 16737095,
        turquoise: 4251856,
        violet: 15631086,
        wheat: 16113331,
        white: 16777215,
        whitesmoke: 16119285,
        yellow: 16776960,
        yellowgreen: 10145074
    });
    Vh.forEach(function(a, b) {
        Vh.set(a, fb(b))
    }),
    Wg.functor = pb,
    Wg.xhr = rb(qb),
    Wg.dsv = function(a, b) {
        function c(a, c, f) {
            arguments.length < 3 && (f = c,
            c = null);
            var g = sb(a, b, null == c ? d : e(c), f);
            return g.row = function(a) {
                return arguments.length ? g.response(null == (c = a) ? d : e(a)) : c
            }
            ,
            g
        }
        function d(a) {
            return c.parse(a.responseText)
        }
        function e(a) {
            return function(b) {
                return c.parse(b.responseText, a)
            }
        }
        function g(b) {
            return b.map(h).join(a)
        }
        function h(a) {
            return i.test(a) ? '"' + a.replace(/\"/g, '""') + '"' : a
        }
        var i = new RegExp('["' + a + "\n]")
          , j = a.charCodeAt(0);
        return c.parse = function(a, b) {
            var d;
            return c.parseRows(a, function(a, c) {
                if (d)
                    return d(a, c - 1);
                var e = new Function("d","return {" + a.map(function(a, b) {
                    return JSON.stringify(a) + ": d[" + b + "]"
                }).join(",") + "}");
                d = b ? function(a, c) {
                    return b(e(a), c)
                }
                : e
            })
        }
        ,
        c.parseRows = function(a, b) {
            function c() {
                if (k >= i)
                    return g;
                if (e)
                    return e = !1,
                    f;
                var b = k;
                if (34 === a.charCodeAt(b)) {
                    for (var c = b; c++ < i; )
                        if (34 === a.charCodeAt(c)) {
                            if (34 !== a.charCodeAt(c + 1))
                                break;
                            ++c
                        }
                    k = c + 2;
                    var d = a.charCodeAt(c + 1);
                    return 13 === d ? (e = !0,
                    10 === a.charCodeAt(c + 2) && ++k) : 10 === d && (e = !0),
                    a.substring(b + 1, c).replace(/""/g, '"')
                }
                for (; i > k; ) {
                    var d = a.charCodeAt(k++)
                      , h = 1;
                    if (10 === d)
                        e = !0;
                    else if (13 === d)
                        e = !0,
                        10 === a.charCodeAt(k) && (++k,
                        ++h);
                    else if (d !== j)
                        continue;
                    return a.substring(b, k - h)
                }
                return a.substring(b)
            }
            for (var d, e, f = {}, g = {}, h = [], i = a.length, k = 0, l = 0; (d = c()) !== g; ) {
                for (var m = []; d !== f && d !== g; )
                    m.push(d),
                    d = c();
                (!b || (m = b(m, l++))) && h.push(m)
            }
            return h
        }
        ,
        c.format = function(b) {
            if (Array.isArray(b[0]))
                return c.formatRows(b);
            var d = new f
              , e = [];
            return b.forEach(function(a) {
                for (var b in a)
                    d.has(b) || e.push(d.add(b))
            }),
            [e.map(h).join(a)].concat(b.map(function(b) {
                return e.map(function(a) {
                    return h(b[a])
                }).join(a)
            })).join("\n")
        }
        ,
        c.formatRows = function(a) {
            return a.map(g).join("\n")
        }
        ,
        c
    }
    ,
    Wg.csv = Wg.dsv(",", "text/csv"),
    Wg.tsv = Wg.dsv("	", "text/tab-separated-values");
    var Wh, Xh, Yh, Zh, $h, _h = _g[h(_g, "requestAnimationFrame")] || function(a) {
        setTimeout(a, 17)
    }
    ;
    Wg.timer = function(a, b, c) {
        var d = arguments.length;
        2 > d && (b = 0),
        3 > d && (c = Date.now());
        var e = c + b
          , f = {
            c: a,
            t: e,
            f: !1,
            n: null
        };
        Xh ? Xh.n = f : Wh = f,
        Xh = f,
        Yh || (Zh = clearTimeout(Zh),
        Yh = 1,
        _h(ub))
    }
    ,
    Wg.timer.flush = function() {
        vb(),
        wb()
    }
    ;
    var ai = "."
      , bi = ","
      , ci = [3, 3]
      , di = "$"
      , ei = ["y", "z", "a", "f", "p", "n", "\xb5", "m", "", "k", "M", "G", "T", "P", "E", "Z", "Y"].map(xb);
    Wg.formatPrefix = function(a, b) {
        var c = 0;
        return a && (0 > a && (a *= -1),
        b && (a = Wg.round(a, yb(a, b))),
        c = 1 + Math.floor(1e-12 + Math.log(a) / Math.LN10),
        c = Math.max(-24, Math.min(24, 3 * Math.floor((0 >= c ? c + 1 : c - 1) / 3)))),
        ei[8 + c / 3]
    }
    ,
    Wg.round = function(a, b) {
        return b ? Math.round(a * (b = Math.pow(10, b))) / b : Math.round(a)
    }
    ,
    Wg.format = function(a) {
        var b = fi.exec(a)
          , c = b[1] || " "
          , d = b[2] || ">"
          , e = b[3] || ""
          , f = b[4] || ""
          , g = b[5]
          , h = +b[6]
          , i = b[7]
          , j = b[8]
          , k = b[9]
          , l = 1
          , m = ""
          , n = !1;
        switch (j && (j = +j.substring(1)),
        (g || "0" === c && "=" === d) && (g = c = "0",
        d = "=",
        i && (h -= Math.floor((h - 1) / 4))),
        k) {
        case "n":
            i = !0,
            k = "g";
            break;
        case "%":
            l = 100,
            m = "%",
            k = "f";
            break;
        case "p":
            l = 100,
            m = "%",
            k = "r";
            break;
        case "b":
        case "o":
        case "x":
        case "X":
            "#" === f && (f = "0" + k.toLowerCase());
        case "c":
        case "d":
            n = !0,
            j = 0;
            break;
        case "s":
            l = -1,
            k = "r"
        }
        "#" === f ? f = "" : "$" === f && (f = di),
        "r" != k || j || (k = "g"),
        null != j && ("g" == k ? j = Math.max(1, Math.min(21, j)) : ("e" == k || "f" == k) && (j = Math.max(0, Math.min(20, j)))),
        k = gi.get(k) || zb;
        var o = g && i;
        return function(a) {
            if (n && a % 1)
                return "";
            var b = 0 > a || 0 === a && 0 > 1 / a ? (a = -a,
            "-") : e;
            if (0 > l) {
                var p = Wg.formatPrefix(a, j);
                a = p.scale(a),
                m = p.symbol
            } else
                a *= l;
            a = k(a, j);
            var q = a.lastIndexOf(".")
              , r = 0 > q ? a : a.substring(0, q)
              , s = 0 > q ? "" : ai + a.substring(q + 1);
            !g && i && (r = hi(r));
            var t = f.length + r.length + s.length + (o ? 0 : b.length)
              , u = h > t ? new Array(t = h - t + 1).join(c) : "";
            return o && (r = hi(u + r)),
            b += f,
            a = r + s,
            ("<" === d ? b + a + u : ">" === d ? u + b + a : "^" === d ? u.substring(0, t >>= 1) + b + a + u.substring(t) : b + (o ? a : u + a)) + m
        }
    }
    ;
    var fi = /(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i
      , gi = Wg.map({
        b: function(a) {
            return a.toString(2)
        },
        c: function(a) {
            return String.fromCharCode(a)
        },
        o: function(a) {
            return a.toString(8)
        },
        x: function(a) {
            return a.toString(16)
        },
        X: function(a) {
            return a.toString(16).toUpperCase()
        },
        g: function(a, b) {
            return a.toPrecision(b)
        },
        e: function(a, b) {
            return a.toExponential(b)
        },
        f: function(a, b) {
            return a.toFixed(b)
        },
        r: function(a, b) {
            return (a = Wg.round(a, yb(a, b))).toFixed(Math.max(0, Math.min(20, yb(a * (1 + 1e-15), b))))
        }
    })
      , hi = qb;
    if (ci) {
        var ii = ci.length;
        hi = function(a) {
            for (var b = a.length, c = [], d = 0, e = ci[0]; b > 0 && e > 0; )
                c.push(a.substring(b -= e, b + e)),
                e = ci[d = (d + 1) % ii];
            return c.reverse().join(bi)
        }
    }
    Wg.geo = {},
    Ab.prototype = {
        s: 0,
        t: 0,
        add: function(a) {
            Bb(a, this.t, ji),
            Bb(ji.s, this.s, this),
            this.s ? this.t += ji.t : this.s = ji.t
        },
        reset: function() {
            this.s = this.t = 0
        },
        valueOf: function() {
            return this.s
        }
    };
    var ji = new Ab;
    Wg.geo.stream = function(a, b) {
        a && ki.hasOwnProperty(a.type) ? ki[a.type](a, b) : Cb(a, b)
    }
    ;
    var ki = {
        Feature: function(a, b) {
            Cb(a.geometry, b)
        },
        FeatureCollection: function(a, b) {
            for (var c = a.features, d = -1, e = c.length; ++d < e; )
                Cb(c[d].geometry, b)
        }
    }
      , li = {
        Sphere: function(a, b) {
            b.sphere()
        },
        Point: function(a, b) {
            a = a.coordinates,
            b.point(a[0], a[1], a[2])
        },
        MultiPoint: function(a, b) {
            for (var c = a.coordinates, d = -1, e = c.length; ++d < e; )
                a = c[d],
                b.point(a[0], a[1], a[2])
        },
        LineString: function(a, b) {
            Db(a.coordinates, b, 0)
        },
        MultiLineString: function(a, b) {
            for (var c = a.coordinates, d = -1, e = c.length; ++d < e; )
                Db(c[d], b, 0)
        },
        Polygon: function(a, b) {
            Eb(a.coordinates, b)
        },
        MultiPolygon: function(a, b) {
            for (var c = a.coordinates, d = -1, e = c.length; ++d < e; )
                Eb(c[d], b)
        },
        GeometryCollection: function(a, b) {
            for (var c = a.geometries, d = -1, e = c.length; ++d < e; )
                Cb(c[d], b)
        }
    };
    Wg.geo.area = function(a) {
        return mi = 0,
        Wg.geo.stream(a, oi),
        mi
    }
    ;
    var mi, ni = new Ab, oi = {
        sphere: function() {
            mi += 4 * Ah
        },
        point: i,
        lineStart: i,
        lineEnd: i,
        polygonStart: function() {
            ni.reset(),
            oi.lineStart = Fb
        },
        polygonEnd: function() {
            var a = 2 * ni;
            mi += 0 > a ? 4 * Ah + a : a,
            oi.lineStart = oi.lineEnd = oi.point = i
        }
    };
    Wg.geo.bounds = function() {
        function a(a, b) {
            t.push(u = [k = a, m = a]),
            l > b && (l = b),
            b > n && (n = b)
        }
        function b(b, c) {
            var d = Gb([b * Fh, c * Fh]);
            if (r) {
                var e = Ib(r, d)
                  , f = [e[1], -e[0], 0]
                  , g = Ib(f, e);
                Lb(g),
                g = Mb(g);
                var i = b - o
                  , j = i > 0 ? 1 : -1
                  , p = g[0] * Gh * j
                  , q = ih(i) > 180;
                if (q ^ (p > j * o && j * b > p)) {
                    var s = g[1] * Gh;
                    s > n && (n = s)
                } else if (p = (p + 360) % 360 - 180,
                q ^ (p > j * o && j * b > p)) {
                    var s = -g[1] * Gh;
                    l > s && (l = s)
                } else
                    l > c && (l = c),
                    c > n && (n = c);
                q ? o > b ? h(k, b) > h(k, m) && (m = b) : h(b, m) > h(k, m) && (k = b) : m >= k ? (k > b && (k = b),
                b > m && (m = b)) : b > o ? h(k, b) > h(k, m) && (m = b) : h(b, m) > h(k, m) && (k = b)
            } else
                a(b, c);
            r = d,
            o = b
        }
        function c() {
            v.point = b
        }
        function d() {
            u[0] = k,
            u[1] = m,
            v.point = a,
            r = null
        }
        function e(a, c) {
            if (r) {
                var d = a - o;
                s += ih(d) > 180 ? d + (d > 0 ? 360 : -360) : d
            } else
                p = a,
                q = c;
            oi.point(a, c),
            b(a, c)
        }
        function f() {
            oi.lineStart()
        }
        function g() {
            e(p, q),
            oi.lineEnd(),
            ih(s) > Dh && (k = -(m = 180)),
            u[0] = k,
            u[1] = m,
            r = null
        }
        function h(a, b) {
            return (b -= a) < 0 ? b + 360 : b
        }
        function i(a, b) {
            return a[0] - b[0]
        }
        function j(a, b) {
            return b[0] <= b[1] ? b[0] <= a && a <= b[1] : a < b[0] || b[1] < a
        }
        var k, l, m, n, o, p, q, r, s, t, u, v = {
            point: a,
            lineStart: c,
            lineEnd: d,
            polygonStart: function() {
                v.point = e,
                v.lineStart = f,
                v.lineEnd = g,
                s = 0,
                oi.polygonStart()
            },
            polygonEnd: function() {
                oi.polygonEnd(),
                v.point = a,
                v.lineStart = c,
                v.lineEnd = d,
                0 > ni ? (k = -(m = 180),
                l = -(n = 90)) : s > Dh ? n = 90 : -Dh > s && (l = -90),
                u[0] = k,
                u[1] = m
            }
        };
        return function(a) {
            n = m = -(k = l = 1 / 0),
            t = [],
            Wg.geo.stream(a, v);
            var b = t.length;
            if (b) {
                t.sort(i);
                for (var c, d = 1, e = t[0], f = [e]; b > d; ++d)
                    c = t[d],
                    j(c[0], e) || j(c[1], e) ? (h(e[0], c[1]) > h(e[0], e[1]) && (e[1] = c[1]),
                    h(c[0], e[1]) > h(e[0], e[1]) && (e[0] = c[0])) : f.push(e = c);
                for (var g, c, o = -1 / 0, b = f.length - 1, d = 0, e = f[b]; b >= d; e = c,
                ++d)
                    c = f[d],
                    (g = h(e[1], c[0])) > o && (o = g,
                    k = c[0],
                    m = e[1])
            }
            return t = u = null,
            1 / 0 === k || 1 / 0 === l ? [[0 / 0, 0 / 0], [0 / 0, 0 / 0]] : [[k, l], [m, n]]
        }
    }(),
    Wg.geo.centroid = function(a) {
        pi = qi = ri = si = ti = ui = vi = wi = xi = yi = zi = 0,
        Wg.geo.stream(a, Ai);
        var b = xi
          , c = yi
          , d = zi
          , e = b * b + c * c + d * d;
        return Eh > e && (b = ui,
        c = vi,
        d = wi,
        Dh > qi && (b = ri,
        c = si,
        d = ti),
        e = b * b + c * c + d * d,
        Eh > e) ? [0 / 0, 0 / 0] : [Math.atan2(c, b) * Gh, O(d / Math.sqrt(e)) * Gh]
    }
    ;
    var pi, qi, ri, si, ti, ui, vi, wi, xi, yi, zi, Ai = {
        sphere: i,
        point: Ob,
        lineStart: Qb,
        lineEnd: Rb,
        polygonStart: function() {
            Ai.lineStart = Sb
        },
        polygonEnd: function() {
            Ai.lineStart = Qb
        }
    }, Bi = Xb(Tb, ac, cc, [-Ah, -Ah / 2]), Ci = 1e9;
    Wg.geo.clipExtent = function() {
        var a, b, c, d, e, f, g = {
            stream: function(a) {
                return e && (e.valid = !1),
                e = f(a),
                e.valid = !0,
                e
            },
            extent: function(h) {
                return arguments.length ? (f = fc(a = +h[0][0], b = +h[0][1], c = +h[1][0], d = +h[1][1]),
                e && (e.valid = !1,
                e = null),
                g) : [[a, b], [c, d]]
            }
        };
        return g.extent([[0, 0], [960, 500]])
    }
    ,
    (Wg.geo.conicEqualArea = function() {
        return hc(ic)
    }
    ).raw = ic,
    Wg.geo.albers = function() {
        return Wg.geo.conicEqualArea().rotate([96, 0]).center([-.6, 38.7]).parallels([29.5, 45.5]).scale(1070)
    }
    ,
    Wg.geo.albersUsa = function() {
        function a(a) {
            var f = a[0]
              , g = a[1];
            return b = null,
            c(f, g),
            b || (d(f, g),
            b) || e(f, g),
            b
        }
        var b, c, d, e, f = Wg.geo.albers(), g = Wg.geo.conicEqualArea().rotate([154, 0]).center([-2, 58.5]).parallels([55, 65]), h = Wg.geo.conicEqualArea().rotate([157, 0]).center([-3, 19.9]).parallels([8, 18]), i = {
            point: function(a, c) {
                b = [a, c]
            }
        };
        return a.invert = function(a) {
            var b = f.scale()
              , c = f.translate()
              , d = (a[0] - c[0]) / b
              , e = (a[1] - c[1]) / b;
            return (e >= .12 && .234 > e && d >= -.425 && -.214 > d ? g : e >= .166 && .234 > e && d >= -.214 && -.115 > d ? h : f).invert(a)
        }
        ,
        a.stream = function(a) {
            var b = f.stream(a)
              , c = g.stream(a)
              , d = h.stream(a);
            return {
                point: function(a, e) {
                    b.point(a, e),
                    c.point(a, e),
                    d.point(a, e)
                },
                sphere: function() {
                    b.sphere(),
                    c.sphere(),
                    d.sphere()
                },
                lineStart: function() {
                    b.lineStart(),
                    c.lineStart(),
                    d.lineStart()
                },
                lineEnd: function() {
                    b.lineEnd(),
                    c.lineEnd(),
                    d.lineEnd()
                },
                polygonStart: function() {
                    b.polygonStart(),
                    c.polygonStart(),
                    d.polygonStart()
                },
                polygonEnd: function() {
                    b.polygonEnd(),
                    c.polygonEnd(),
                    d.polygonEnd()
                }
            }
        }
        ,
        a.precision = function(b) {
            return arguments.length ? (f.precision(b),
            g.precision(b),
            h.precision(b),
            a) : f.precision()
        }
        ,
        a.scale = function(b) {
            return arguments.length ? (f.scale(b),
            g.scale(.35 * b),
            h.scale(b),
            a.translate(f.translate())) : f.scale()
        }
        ,
        a.translate = function(b) {
            if (!arguments.length)
                return f.translate();
            var j = f.scale()
              , k = +b[0]
              , l = +b[1];
            return c = f.translate(b).clipExtent([[k - .455 * j, l - .238 * j], [k + .455 * j, l + .238 * j]]).stream(i).point,
            d = g.translate([k - .307 * j, l + .201 * j]).clipExtent([[k - .425 * j + Dh, l + .12 * j + Dh], [k - .214 * j - Dh, l + .234 * j - Dh]]).stream(i).point,
            e = h.translate([k - .205 * j, l + .212 * j]).clipExtent([[k - .214 * j + Dh, l + .166 * j + Dh], [k - .115 * j - Dh, l + .234 * j - Dh]]).stream(i).point,
            a
        }
        ,
        a.scale(1070)
    }
    ;
    var Di, Ei, Fi, Gi, Hi, Ii, Ji = {
        point: i,
        lineStart: i,
        lineEnd: i,
        polygonStart: function() {
            Ei = 0,
            Ji.lineStart = jc
        },
        polygonEnd: function() {
            Ji.lineStart = Ji.lineEnd = Ji.point = i,
            Di += ih(Ei / 2)
        }
    }, Ki = {
        point: kc,
        lineStart: i,
        lineEnd: i,
        polygonStart: i,
        polygonEnd: i
    }, Li = {
        point: nc,
        lineStart: oc,
        lineEnd: pc,
        polygonStart: function() {
            Li.lineStart = qc
        },
        polygonEnd: function() {
            Li.point = nc,
            Li.lineStart = oc,
            Li.lineEnd = pc
        }
    };
    Wg.geo.path = function() {
        function a(a) {
            return a && ("function" == typeof h && f.pointRadius(+h.apply(this, arguments)),
            g && g.valid || (g = e(f)),
            Wg.geo.stream(a, g)),
            f.result()
        }
        function b() {
            return g = null,
            a
        }
        var c, d, e, f, g, h = 4.5;
        return a.area = function(a) {
            return Di = 0,
            Wg.geo.stream(a, e(Ji)),
            Di
        }
        ,
        a.centroid = function(a) {
            return ri = si = ti = ui = vi = wi = xi = yi = zi = 0,
            Wg.geo.stream(a, e(Li)),
            zi ? [xi / zi, yi / zi] : wi ? [ui / wi, vi / wi] : ti ? [ri / ti, si / ti] : [0 / 0, 0 / 0]
        }
        ,
        a.bounds = function(a) {
            return Hi = Ii = -(Fi = Gi = 1 / 0),
            Wg.geo.stream(a, e(Ki)),
            [[Fi, Gi], [Hi, Ii]]
        }
        ,
        a.projection = function(a) {
            return arguments.length ? (e = (c = a) ? a.stream || tc(a) : qb,
            b()) : c
        }
        ,
        a.context = function(a) {
            return arguments.length ? (f = null == (d = a) ? new lc : new rc(a),
            "function" != typeof h && f.pointRadius(h),
            b()) : d
        }
        ,
        a.pointRadius = function(b) {
            return arguments.length ? (h = "function" == typeof b ? b : (f.pointRadius(+b),
            +b),
            a) : h
        }
        ,
        a.projection(Wg.geo.albersUsa()).context(null)
    }
    ,
    Wg.geo.transform = function(a) {
        return {
            stream: function(b) {
                var c = new uc(b);
                for (var d in a)
                    c[d] = a[d];
                return c
            }
        }
    }
    ,
    uc.prototype = {
        point: function(a, b) {
            this.stream.point(a, b)
        },
        sphere: function() {
            this.stream.sphere()
        },
        lineStart: function() {
            this.stream.lineStart()
        },
        lineEnd: function() {
            this.stream.lineEnd()
        },
        polygonStart: function() {
            this.stream.polygonStart()
        },
        polygonEnd: function() {
            this.stream.polygonEnd()
        }
    },
    Wg.geo.projection = wc,
    Wg.geo.projectionMutator = xc,
    (Wg.geo.equirectangular = function() {
        return wc(zc)
    }
    ).raw = zc.invert = zc,
    Wg.geo.rotation = function(a) {
        function b(b) {
            return b = a(b[0] * Fh, b[1] * Fh),
            b[0] *= Gh,
            b[1] *= Gh,
            b
        }
        return a = Bc(a[0] % 360 * Fh, a[1] * Fh, a.length > 2 ? a[2] * Fh : 0),
        b.invert = function(b) {
            return b = a.invert(b[0] * Fh, b[1] * Fh),
            b[0] *= Gh,
            b[1] *= Gh,
            b
        }
        ,
        b
    }
    ,
    Ac.invert = zc,
    Wg.geo.circle = function() {
        function a() {
            var a = "function" == typeof d ? d.apply(this, arguments) : d
              , b = Bc(-a[0] * Fh, -a[1] * Fh, 0).invert
              , e = [];
            return c(null, null, 1, {
                point: function(a, c) {
                    e.push(a = b(a, c)),
                    a[0] *= Gh,
                    a[1] *= Gh
                }
            }),
            {
                type: "Polygon",
                coordinates: [e]
            }
        }
        var b, c, d = [0, 0], e = 6;
        return a.origin = function(b) {
            return arguments.length ? (d = b,
            a) : d
        }
        ,
        a.angle = function(d) {
            return arguments.length ? (c = Fc((b = +d) * Fh, e * Fh),
            a) : b
        }
        ,
        a.precision = function(d) {
            return arguments.length ? (c = Fc(b * Fh, (e = +d) * Fh),
            a) : e
        }
        ,
        a.angle(90)
    }
    ,
    Wg.geo.distance = function(a, b) {
        var c, d = (b[0] - a[0]) * Fh, e = a[1] * Fh, f = b[1] * Fh, g = Math.sin(d), h = Math.cos(d), i = Math.sin(e), j = Math.cos(e), k = Math.sin(f), l = Math.cos(f);
        return Math.atan2(Math.sqrt((c = l * g) * c + (c = j * k - i * l * h) * c), i * k + j * l * h)
    }
    ,
    Wg.geo.graticule = function() {
        function a() {
            return {
                type: "MultiLineString",
                coordinates: b()
            }
        }
        function b() {
            return Wg.range(Math.ceil(f / q) * q, e, q).map(m).concat(Wg.range(Math.ceil(j / r) * r, i, r).map(n)).concat(Wg.range(Math.ceil(d / o) * o, c, o).filter(function(a) {
                return ih(a % q) > Dh
            }).map(k)).concat(Wg.range(Math.ceil(h / p) * p, g, p).filter(function(a) {
                return ih(a % r) > Dh
            }).map(l))
        }
        var c, d, e, f, g, h, i, j, k, l, m, n, o = 10, p = o, q = 90, r = 360, s = 2.5;
        return a.lines = function() {
            return b().map(function(a) {
                return {
                    type: "LineString",
                    coordinates: a
                }
            })
        }
        ,
        a.outline = function() {
            return {
                type: "Polygon",
                coordinates: [m(f).concat(n(i).slice(1), m(e).reverse().slice(1), n(j).reverse().slice(1))]
            }
        }
        ,
        a.extent = function(b) {
            return arguments.length ? a.majorExtent(b).minorExtent(b) : a.minorExtent()
        }
        ,
        a.majorExtent = function(b) {
            return arguments.length ? (f = +b[0][0],
            e = +b[1][0],
            j = +b[0][1],
            i = +b[1][1],
            f > e && (b = f,
            f = e,
            e = b),
            j > i && (b = j,
            j = i,
            i = b),
            a.precision(s)) : [[f, j], [e, i]]
        }
        ,
        a.minorExtent = function(b) {
            return arguments.length ? (d = +b[0][0],
            c = +b[1][0],
            h = +b[0][1],
            g = +b[1][1],
            d > c && (b = d,
            d = c,
            c = b),
            h > g && (b = h,
            h = g,
            g = b),
            a.precision(s)) : [[d, h], [c, g]]
        }
        ,
        a.step = function(b) {
            return arguments.length ? a.majorStep(b).minorStep(b) : a.minorStep()
        }
        ,
        a.majorStep = function(b) {
            return arguments.length ? (q = +b[0],
            r = +b[1],
            a) : [q, r]
        }
        ,
        a.minorStep = function(b) {
            return arguments.length ? (o = +b[0],
            p = +b[1],
            a) : [o, p]
        }
        ,
        a.precision = function(b) {
            return arguments.length ? (s = +b,
            k = Hc(h, g, 90),
            l = Ic(d, c, s),
            m = Hc(j, i, 90),
            n = Ic(f, e, s),
            a) : s
        }
        ,
        a.majorExtent([[-180, -90 + Dh], [180, 90 - Dh]]).minorExtent([[-180, -80 - Dh], [180, 80 + Dh]])
    }
    ,
    Wg.geo.greatArc = function() {
        function a() {
            return {
                type: "LineString",
                coordinates: [b || d.apply(this, arguments), c || e.apply(this, arguments)]
            }
        }
        var b, c, d = Jc, e = Kc;
        return a.distance = function() {
            return Wg.geo.distance(b || d.apply(this, arguments), c || e.apply(this, arguments))
        }
        ,
        a.source = function(c) {
            return arguments.length ? (d = c,
            b = "function" == typeof c ? null : c,
            a) : d
        }
        ,
        a.target = function(b) {
            return arguments.length ? (e = b,
            c = "function" == typeof b ? null : b,
            a) : e
        }
        ,
        a.precision = function() {
            return arguments.length ? a : 0
        }
        ,
        a
    }
    ,
    Wg.geo.interpolate = function(a, b) {
        return Lc(a[0] * Fh, a[1] * Fh, b[0] * Fh, b[1] * Fh)
    }
    ,
    Wg.geo.length = function(a) {
        return Mi = 0,
        Wg.geo.stream(a, Ni),
        Mi
    }
    ;
    var Mi, Ni = {
        sphere: i,
        point: i,
        lineStart: Mc,
        lineEnd: i,
        polygonStart: i,
        polygonEnd: i
    }, Oi = Nc(function(a) {
        return Math.sqrt(2 / (1 + a))
    }, function(a) {
        return 2 * Math.asin(a / 2)
    });
    (Wg.geo.azimuthalEqualArea = function() {
        return wc(Oi)
    }
    ).raw = Oi;
    var Pi = Nc(function(a) {
        var b = Math.acos(a);
        return b && b / Math.sin(b)
    }, qb);
    (Wg.geo.azimuthalEquidistant = function() {
        return wc(Pi)
    }
    ).raw = Pi,
    (Wg.geo.conicConformal = function() {
        return hc(Oc)
    }
    ).raw = Oc,
    (Wg.geo.conicEquidistant = function() {
        return hc(Pc)
    }
    ).raw = Pc;
    var Qi = Nc(function(a) {
        return 1 / a
    }, Math.atan);
    (Wg.geo.gnomonic = function() {
        return wc(Qi)
    }
    ).raw = Qi,
    Qc.invert = function(a, b) {
        return [a, 2 * Math.atan(Math.exp(b)) - Ch]
    }
    ,
    (Wg.geo.mercator = function() {
        return Rc(Qc)
    }
    ).raw = Qc;
    var Ri = Nc(function() {
        return 1
    }, Math.asin);
    (Wg.geo.orthographic = function() {
        return wc(Ri)
    }
    ).raw = Ri;
    var Si = Nc(function(a) {
        return 1 / (1 + a)
    }, function(a) {
        return 2 * Math.atan(a)
    });
    (Wg.geo.stereographic = function() {
        return wc(Si)
    }
    ).raw = Si,
    Sc.invert = function(a, b) {
        return [-b, 2 * Math.atan(Math.exp(a)) - Ch]
    }
    ,
    (Wg.geo.transverseMercator = function() {
        var a = Rc(Sc)
          , b = a.center
          , c = a.rotate;
        return a.center = function(a) {
            return a ? b([-a[1], a[0]]) : (a = b(),
            [-a[1], a[0]])
        }
        ,
        a.rotate = function(a) {
            return a ? c([a[0], a[1], a.length > 2 ? a[2] + 90 : 90]) : (a = c(),
            [a[0], a[1], a[2] - 90])
        }
        ,
        a.rotate([0, 0])
    }
    ).raw = Sc,
    Wg.geom = {},
    Wg.geom.hull = function(a) {
        function b(a) {
            if (a.length < 3)
                return [];
            var b, e, f, g, h, i, j, k, l, m, n, o, p = pb(c), q = pb(d), r = a.length, s = r - 1, t = [], u = [], v = 0;
            if (p === Tc && d === Uc)
                b = a;
            else
                for (f = 0,
                b = []; r > f; ++f)
                    b.push([+p.call(this, e = a[f], f), +q.call(this, e, f)]);
            for (f = 1; r > f; ++f)
                (b[f][1] < b[v][1] || b[f][1] == b[v][1] && b[f][0] < b[v][0]) && (v = f);
            for (f = 0; r > f; ++f)
                f !== v && (i = b[f][1] - b[v][1],
                h = b[f][0] - b[v][0],
                t.push({
                    angle: Math.atan2(i, h),
                    index: f
                }));
            for (t.sort(function(a, b) {
                return a.angle - b.angle
            }),
            n = t[0].angle,
            m = t[0].index,
            l = 0,
            f = 1; s > f; ++f) {
                if (g = t[f].index,
                n == t[f].angle) {
                    if (h = b[m][0] - b[v][0],
                    i = b[m][1] - b[v][1],
                    j = b[g][0] - b[v][0],
                    k = b[g][1] - b[v][1],
                    h * h + i * i >= j * j + k * k) {
                        t[f].index = -1;
                        continue
                    }
                    t[l].index = -1
                }
                n = t[f].angle,
                l = f,
                m = g
            }
            for (u.push(v),
            f = 0,
            g = 0; 2 > f; ++g)
                t[g].index > -1 && (u.push(t[g].index),
                f++);
            for (o = u.length; s > g; ++g)
                if (!(t[g].index < 0)) {
                    for (; !Vc(u[o - 2], u[o - 1], t[g].index, b); )
                        --o;
                    u[o++] = t[g].index
                }
            var w = [];
            for (f = o - 1; f >= 0; --f)
                w.push(a[u[f]]);
            return w
        }
        var c = Tc
          , d = Uc;
        return arguments.length ? b(a) : (b.x = function(a) {
            return arguments.length ? (c = a,
            b) : c
        }
        ,
        b.y = function(a) {
            return arguments.length ? (d = a,
            b) : d
        }
        ,
        b)
    }
    ,
    Wg.geom.polygon = function(a) {
        return nh(a, Ti),
        a
    }
    ;
    var Ti = Wg.geom.polygon.prototype = [];
    Ti.area = function() {
        for (var a, b = -1, c = this.length, d = this[c - 1], e = 0; ++b < c; )
            a = d,
            d = this[b],
            e += a[1] * d[0] - a[0] * d[1];
        return .5 * e
    }
    ,
    Ti.centroid = function(a) {
        var b, c, d = -1, e = this.length, f = 0, g = 0, h = this[e - 1];
        for (arguments.length || (a = -1 / (6 * this.area())); ++d < e; )
            b = h,
            h = this[d],
            c = b[0] * h[1] - h[0] * b[1],
            f += (b[0] + h[0]) * c,
            g += (b[1] + h[1]) * c;
        return [f * a, g * a]
    }
    ,
    Ti.clip = function(a) {
        for (var b, c, d, e, f, g, h = Yc(a), i = -1, j = this.length - Yc(this), k = this[j - 1]; ++i < j; ) {
            for (b = a.slice(),
            a.length = 0,
            e = this[i],
            f = b[(d = b.length - h) - 1],
            c = -1; ++c < d; )
                g = b[c],
                Wc(g, k, e) ? (Wc(f, k, e) || a.push(Xc(f, g, k, e)),
                a.push(g)) : Wc(f, k, e) && a.push(Xc(f, g, k, e)),
                f = g;
            h && a.push(a[0]),
            k = e
        }
        return a
    }
    ;
    var Ui, Vi, Wi, Xi, Yi, Zi = [], $i = [];
    ed.prototype.prepare = function() {
        for (var a, b = this.edges, c = b.length; c--; )
            a = b[c].edge,
            a.b && a.a || b.splice(c, 1);
        return b.sort(gd),
        b.length
    }
    ,
    qd.prototype = {
        start: function() {
            return this.edge.l === this.site ? this.edge.a : this.edge.b
        },
        end: function() {
            return this.edge.l === this.site ? this.edge.b : this.edge.a
        }
    },
    rd.prototype = {
        insert: function(a, b) {
            var c, d, e;
            if (a) {
                if (b.P = a,
                b.N = a.N,
                a.N && (a.N.P = b),
                a.N = b,
                a.R) {
                    for (a = a.R; a.L; )
                        a = a.L;
                    a.L = b
                } else
                    a.R = b;
                c = a
            } else
                this._ ? (a = vd(this._),
                b.P = null,
                b.N = a,
                a.P = a.L = b,
                c = a) : (b.P = b.N = null,
                this._ = b,
                c = null);
            for (b.L = b.R = null,
            b.U = c,
            b.C = !0,
            a = b; c && c.C; )
                d = c.U,
                c === d.L ? (e = d.R,
                e && e.C ? (c.C = e.C = !1,
                d.C = !0,
                a = d) : (a === c.R && (td(this, c),
                a = c,
                c = a.U),
                c.C = !1,
                d.C = !0,
                ud(this, d))) : (e = d.L,
                e && e.C ? (c.C = e.C = !1,
                d.C = !0,
                a = d) : (a === c.L && (ud(this, c),
                a = c,
                c = a.U),
                c.C = !1,
                d.C = !0,
                td(this, d))),
                c = a.U;
            this._.C = !1
        },
        remove: function(a) {
            a.N && (a.N.P = a.P),
            a.P && (a.P.N = a.N),
            a.N = a.P = null;
            var b, c, d, e = a.U, f = a.L, g = a.R;
            if (c = f ? g ? vd(g) : f : g,
            e ? e.L === a ? e.L = c : e.R = c : this._ = c,
            f && g ? (d = c.C,
            c.C = a.C,
            c.L = f,
            f.U = c,
            c !== g ? (e = c.U,
            c.U = a.U,
            a = c.R,
            e.L = a,
            c.R = g,
            g.U = c) : (c.U = e,
            e = c,
            a = c.R)) : (d = a.C,
            a = c),
            a && (a.U = e),
            !d) {
                if (a && a.C)
                    return a.C = !1,
                    void 0;
                do {
                    if (a === this._)
                        break;
                    if (a === e.L) {
                        if (b = e.R,
                        b.C && (b.C = !1,
                        e.C = !0,
                        td(this, e),
                        b = e.R),
                        b.L && b.L.C || b.R && b.R.C) {
                            b.R && b.R.C || (b.L.C = !1,
                            b.C = !0,
                            ud(this, b),
                            b = e.R),
                            b.C = e.C,
                            e.C = b.R.C = !1,
                            td(this, e),
                            a = this._;
                            break
                        }
                    } else if (b = e.L,
                    b.C && (b.C = !1,
                    e.C = !0,
                    ud(this, e),
                    b = e.L),
                    b.L && b.L.C || b.R && b.R.C) {
                        b.L && b.L.C || (b.R.C = !1,
                        b.C = !0,
                        td(this, b),
                        b = e.L),
                        b.C = e.C,
                        e.C = b.L.C = !1,
                        ud(this, e),
                        a = this._;
                        break
                    }
                    b.C = !0,
                    a = e,
                    e = e.U
                } while (!a.C);a && (a.C = !1)
            }
        }
    },
    Wg.geom.voronoi = function(a) {
        function b(a) {
            var b = new Array(a.length)
              , d = h[0][0]
              , e = h[0][1]
              , f = h[1][0]
              , g = h[1][1];
            return wd(c(a), h).cells.forEach(function(c, h) {
                var i = c.edges
                  , j = c.site
                  , k = b[h] = i.length ? i.map(function(a) {
                    var b = a.start();
                    return [b.x, b.y]
                }) : j.x >= d && j.x <= f && j.y >= e && j.y <= g ? [[d, g], [f, g], [f, e], [d, e]] : [];
                k.point = a[h]
            }),
            b
        }
        function c(a) {
            return a.map(function(a, b) {
                return {
                    x: Math.round(f(a, b) / Dh) * Dh,
                    y: Math.round(g(a, b) / Dh) * Dh,
                    i: b
                }
            })
        }
        var d = Tc
          , e = Uc
          , f = d
          , g = e
          , h = _i;
        return a ? b(a) : (b.links = function(a) {
            return wd(c(a)).edges.filter(function(a) {
                return a.l && a.r
            }).map(function(b) {
                return {
                    source: a[b.l.i],
                    target: a[b.r.i]
                }
            })
        }
        ,
        b.triangles = function(a) {
            var b = [];
            return wd(c(a)).cells.forEach(function(c, d) {
                for (var e, f, g = c.site, h = c.edges.sort(gd), i = -1, j = h.length, k = h[j - 1].edge, l = k.l === g ? k.r : k.l; ++i < j; )
                    e = k,
                    f = l,
                    k = h[i].edge,
                    l = k.l === g ? k.r : k.l,
                    d < f.i && d < l.i && yd(g, f, l) < 0 && b.push([a[d], a[f.i], a[l.i]])
            }),
            b
        }
        ,
        b.x = function(a) {
            return arguments.length ? (f = pb(d = a),
            b) : d
        }
        ,
        b.y = function(a) {
            return arguments.length ? (g = pb(e = a),
            b) : e
        }
        ,
        b.clipExtent = function(a) {
            return arguments.length ? (h = null == a ? _i : a,
            b) : h === _i ? null : h
        }
        ,
        b.size = function(a) {
            return arguments.length ? b.clipExtent(a && [[0, 0], a]) : h === _i ? null : h && h[1]
        }
        ,
        b)
    }
    ;
    var _i = [[-1e6, -1e6], [1e6, 1e6]];
    Wg.geom.delaunay = function(a) {
        return Wg.geom.voronoi().triangles(a)
    }
    ,
    Wg.geom.quadtree = function(a, b, c, d, e) {
        function f(a) {
            function f(a, b, c, d, e, f, g, h) {
                if (!isNaN(c) && !isNaN(d))
                    if (a.leaf) {
                        var i = a.x
                          , k = a.y;
                        if (null != i)
                            if (ih(i - c) + ih(k - d) < .01)
                                j(a, b, c, d, e, f, g, h);
                            else {
                                var l = a.point;
                                a.x = a.y = a.point = null,
                                j(a, l, i, k, e, f, g, h),
                                j(a, b, c, d, e, f, g, h)
                            }
                        else
                            a.x = c,
                            a.y = d,
                            a.point = b
                    } else
                        j(a, b, c, d, e, f, g, h)
            }
            function j(a, b, c, d, e, g, h, i) {
                var j = .5 * (e + h)
                  , k = .5 * (g + i)
                  , l = c >= j
                  , m = d >= k
                  , n = (m << 1) + l;
                a.leaf = !1,
                a = a.nodes[n] || (a.nodes[n] = Bd()),
                l ? e = j : h = j,
                m ? g = k : i = k,
                f(a, b, c, d, e, g, h, i)
            }
            var k, l, m, n, o, p, q, r, s, t = pb(h), u = pb(i);
            if (null != b)
                p = b,
                q = c,
                r = d,
                s = e;
            else if (r = s = -(p = q = 1 / 0),
            l = [],
            m = [],
            o = a.length,
            g)
                for (n = 0; o > n; ++n)
                    k = a[n],
                    k.x < p && (p = k.x),
                    k.y < q && (q = k.y),
                    k.x > r && (r = k.x),
                    k.y > s && (s = k.y),
                    l.push(k.x),
                    m.push(k.y);
            else
                for (n = 0; o > n; ++n) {
                    var v = +t(k = a[n], n)
                      , w = +u(k, n);
                    p > v && (p = v),
                    q > w && (q = w),
                    v > r && (r = v),
                    w > s && (s = w),
                    l.push(v),
                    m.push(w)
                }
            var x = r - p
              , y = s - q;
            x > y ? s = q + x : r = p + y;
            var z = Bd();
            if (z.add = function(a) {
                f(z, a, +t(a, ++n), +u(a, n), p, q, r, s)
            }
            ,
            z.visit = function(a) {
                Cd(a, z, p, q, r, s)
            }
            ,
            n = -1,
            null == b) {
                for (; ++n < o; )
                    f(z, a[n], l[n], m[n], p, q, r, s);
                --n
            } else
                a.forEach(z.add);
            return l = m = a = k = null,
            z
        }
        var g, h = Tc, i = Uc;
        return (g = arguments.length) ? (h = zd,
        i = Ad,
        3 === g && (e = c,
        d = b,
        c = b = 0),
        f(a)) : (f.x = function(a) {
            return arguments.length ? (h = a,
            f) : h
        }
        ,
        f.y = function(a) {
            return arguments.length ? (i = a,
            f) : i
        }
        ,
        f.extent = function(a) {
            return arguments.length ? (null == a ? b = c = d = e = null : (b = +a[0][0],
            c = +a[0][1],
            d = +a[1][0],
            e = +a[1][1]),
            f) : null == b ? null : [[b, c], [d, e]]
        }
        ,
        f.size = function(a) {
            return arguments.length ? (null == a ? b = c = d = e = null : (b = c = 0,
            d = +a[0],
            e = +a[1]),
            f) : null == b ? null : [d - b, e - c]
        }
        ,
        f)
    }
    ,
    Wg.interpolateRgb = Dd,
    Wg.interpolateObject = Ed,
    Wg.interpolateNumber = Fd,
    Wg.interpolateString = Gd;
    var aj = /[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;
    Wg.interpolate = Hd,
    Wg.interpolators = [function(a, b) {
        var c = typeof b;
        return ("string" === c ? Vh.has(b) || /^(#|rgb\(|hsl\()/.test(b) ? Dd : Gd : b instanceof T ? Dd : "object" === c ? Array.isArray(b) ? Id : Ed : Fd)(a, b)
    }
    ],
    Wg.interpolateArray = Id;
    var bj = function() {
        return qb
    }
      , cj = Wg.map({
        linear: bj,
        poly: Pd,
        quad: function() {
            return Md
        },
        cubic: function() {
            return Nd
        },
        sin: function() {
            return Qd
        },
        exp: function() {
            return Rd
        },
        circle: function() {
            return Sd
        },
        elastic: Td,
        back: Ud,
        bounce: function() {
            return Vd
        }
    })
      , dj = Wg.map({
        "in": qb,
        out: Kd,
        "in-out": Ld,
        "out-in": function(a) {
            return Ld(Kd(a))
        }
    });
    Wg.ease = function(a) {
        var b = a.indexOf("-")
          , c = b >= 0 ? a.substring(0, b) : a
          , d = b >= 0 ? a.substring(b + 1) : "in";
        return c = cj.get(c) || bj,
        d = dj.get(d) || qb,
        Jd(d(c.apply(null, Xg.call(arguments, 1))))
    }
    ,
    Wg.interpolateHcl = Wd,
    Wg.interpolateHsl = Xd,
    Wg.interpolateLab = Yd,
    Wg.interpolateRound = Zd,
    Wg.transform = function(a) {
        var b = Zg.createElementNS(Wg.ns.prefix.svg, "g");
        return (Wg.transform = function(a) {
            if (null != a) {
                b.setAttribute("transform", a);
                var c = b.transform.baseVal.consolidate()
            }
            return new $d(c ? c.matrix : ej)
        }
        )(a)
    }
    ,
    $d.prototype.toString = function() {
        return "translate(" + this.translate + ")rotate(" + this.rotate + ")skewX(" + this.skew + ")scale(" + this.scale + ")"
    }
    ;
    var ej = {
        a: 1,
        b: 0,
        c: 0,
        d: 1,
        e: 0,
        f: 0
    };
    Wg.interpolateTransform = ce,
    Wg.layout = {},
    Wg.layout.bundle = function() {
        return function(a) {
            for (var b = [], c = -1, d = a.length; ++c < d; )
                b.push(fe(a[c]));
            return b
        }
    }
    ,
    Wg.layout.chord = function() {
        function a() {
            var a, j, l, m, n, o = {}, p = [], q = Wg.range(f), r = [];
            for (c = [],
            d = [],
            a = 0,
            m = -1; ++m < f; ) {
                for (j = 0,
                n = -1; ++n < f; )
                    j += e[m][n];
                p.push(j),
                r.push(Wg.range(f)),
                a += j
            }
            for (g && q.sort(function(a, b) {
                return g(p[a], p[b])
            }),
            h && r.forEach(function(a, b) {
                a.sort(function(a, c) {
                    return h(e[b][a], e[b][c])
                })
            }),
            a = (Bh - k * f) / a,
            j = 0,
            m = -1; ++m < f; ) {
                for (l = j,
                n = -1; ++n < f; ) {
                    var s = q[m]
                      , t = r[s][n]
                      , u = e[s][t]
                      , v = j
                      , w = j += u * a;
                    o[s + "-" + t] = {
                        index: s,
                        subindex: t,
                        startAngle: v,
                        endAngle: w,
                        value: u
                    }
                }
                d[s] = {
                    index: s,
                    startAngle: l,
                    endAngle: j,
                    value: (j - l) / a
                },
                j += k
            }
            for (m = -1; ++m < f; )
                for (n = m - 1; ++n < f; ) {
                    var x = o[m + "-" + n]
                      , y = o[n + "-" + m];
                    (x.value || y.value) && c.push(x.value < y.value ? {
                        source: y,
                        target: x
                    } : {
                        source: x,
                        target: y
                    })
                }
            i && b()
        }
        function b() {
            c.sort(function(a, b) {
                return i((a.source.value + a.target.value) / 2, (b.source.value + b.target.value) / 2)
            })
        }
        var c, d, e, f, g, h, i, j = {}, k = 0;
        return j.matrix = function(a) {
            return arguments.length ? (f = (e = a) && e.length,
            c = d = null,
            j) : e
        }
        ,
        j.padding = function(a) {
            return arguments.length ? (k = a,
            c = d = null,
            j) : k
        }
        ,
        j.sortGroups = function(a) {
            return arguments.length ? (g = a,
            c = d = null,
            j) : g
        }
        ,
        j.sortSubgroups = function(a) {
            return arguments.length ? (h = a,
            c = null,
            j) : h
        }
        ,
        j.sortChords = function(a) {
            return arguments.length ? (i = a,
            c && b(),
            j) : i
        }
        ,
        j.chords = function() {
            return c || a(),
            c
        }
        ,
        j.groups = function() {
            return d || a(),
            d
        }
        ,
        j
    }
    ,
    Wg.layout.force = function() {
        function a(a) {
            return function(b, c, d, e) {
                if (b.point !== a) {
                    var f = b.cx - a.x
                      , g = b.cy - a.y
                      , h = 1 / Math.sqrt(f * f + g * g);
                    if (p > (e - c) * h) {
                        var i = b.charge * h * h;
                        return a.px -= f * i,
                        a.py -= g * i,
                        !0
                    }
                    if (b.point && isFinite(h)) {
                        var i = b.pointCharge * h * h;
                        a.px -= f * i,
                        a.py -= g * i
                    }
                }
                return !b.charge
            }
        }
        function b(a) {
            a.px = Wg.event.x,
            a.py = Wg.event.y,
            h.resume()
        }
        var c, d, e, f, g, h = {}, i = Wg.dispatch("start", "tick", "end"), j = [1, 1], k = .9, l = fj, m = gj, n = -30, o = .1, p = .8, q = [], r = [];
        return h.tick = function() {
            if ((d *= .99) < .005)
                return i.end({
                    type: "end",
                    alpha: d = 0
                }),
                !0;
            var b, c, h, l, m, p, s, t, u, v = q.length, w = r.length;
            for (c = 0; w > c; ++c)
                h = r[c],
                l = h.source,
                m = h.target,
                t = m.x - l.x,
                u = m.y - l.y,
                (p = t * t + u * u) && (p = d * f[c] * ((p = Math.sqrt(p)) - e[c]) / p,
                t *= p,
                u *= p,
                m.x -= t * (s = l.weight / (m.weight + l.weight)),
                m.y -= u * s,
                l.x += t * (s = 1 - s),
                l.y += u * s);
            if ((s = d * o) && (t = j[0] / 2,
            u = j[1] / 2,
            c = -1,
            s))
                for (; ++c < v; )
                    h = q[c],
                    h.x += (t - h.x) * s,
                    h.y += (u - h.y) * s;
            if (n)
                for (me(b = Wg.geom.quadtree(q), d, g),
                c = -1; ++c < v; )
                    (h = q[c]).fixed || b.visit(a(h));
            for (c = -1; ++c < v; )
                h = q[c],
                h.fixed ? (h.x = h.px,
                h.y = h.py) : (h.x -= (h.px - (h.px = h.x)) * k,
                h.y -= (h.py - (h.py = h.y)) * k);
            i.tick({
                type: "tick",
                alpha: d
            })
        }
        ,
        h.nodes = function(a) {
            return arguments.length ? (q = a,
            h) : q
        }
        ,
        h.links = function(a) {
            return arguments.length ? (r = a,
            h) : r
        }
        ,
        h.size = function(a) {
            return arguments.length ? (j = a,
            h) : j
        }
        ,
        h.linkDistance = function(a) {
            return arguments.length ? (l = "function" == typeof a ? a : +a,
            h) : l
        }
        ,
        h.distance = h.linkDistance,
        h.linkStrength = function(a) {
            return arguments.length ? (m = "function" == typeof a ? a : +a,
            h) : m
        }
        ,
        h.friction = function(a) {
            return arguments.length ? (k = +a,
            h) : k
        }
        ,
        h.charge = function(a) {
            return arguments.length ? (n = "function" == typeof a ? a : +a,
            h) : n
        }
        ,
        h.gravity = function(a) {
            return arguments.length ? (o = +a,
            h) : o
        }
        ,
        h.theta = function(a) {
            return arguments.length ? (p = +a,
            h) : p
        }
        ,
        h.alpha = function(a) {
            return arguments.length ? (a = +a,
            d ? d = a > 0 ? a : 0 : a > 0 && (i.start({
                type: "start",
                alpha: d = a
            }),
            Wg.timer(h.tick)),
            h) : d
        }
        ,
        h.start = function() {
            function a(a, d) {
                if (!c) {
                    for (c = new Array(i),
                    h = 0; i > h; ++h)
                        c[h] = [];
                    for (h = 0; j > h; ++h) {
                        var e = r[h];
                        c[e.source.index].push(e.target),
                        c[e.target.index].push(e.source)
                    }
                }
                for (var f, g = c[b], h = -1, j = g.length; ++h < j; )
                    if (!isNaN(f = g[h][a]))
                        return f;
                return Math.random() * d
            }
            var b, c, d, i = q.length, k = r.length, o = j[0], p = j[1];
            for (b = 0; i > b; ++b)
                (d = q[b]).index = b,
                d.weight = 0;
            for (b = 0; k > b; ++b)
                d = r[b],
                "number" == typeof d.source && (d.source = q[d.source]),
                "number" == typeof d.target && (d.target = q[d.target]),
                ++d.source.weight,
                ++d.target.weight;
            for (b = 0; i > b; ++b)
                d = q[b],
                isNaN(d.x) && (d.x = a("x", o)),
                isNaN(d.y) && (d.y = a("y", p)),
                isNaN(d.px) && (d.px = d.x),
                isNaN(d.py) && (d.py = d.y);
            if (e = [],
            "function" == typeof l)
                for (b = 0; k > b; ++b)
                    e[b] = +l.call(this, r[b], b);
            else
                for (b = 0; k > b; ++b)
                    e[b] = l;
            if (f = [],
            "function" == typeof m)
                for (b = 0; k > b; ++b)
                    f[b] = +m.call(this, r[b], b);
            else
                for (b = 0; k > b; ++b)
                    f[b] = m;
            if (g = [],
            "function" == typeof n)
                for (b = 0; i > b; ++b)
                    g[b] = +n.call(this, q[b], b);
            else
                for (b = 0; i > b; ++b)
                    g[b] = n;
            return h.resume()
        }
        ,
        h.resume = function() {
            return h.alpha(.1)
        }
        ,
        h.stop = function() {
            return h.alpha(0)
        }
        ,
        h.drag = function() {
            return c || (c = Wg.behavior.drag().origin(qb).on("dragstart.force", ie).on("drag.force", b).on("dragend.force", je)),
            arguments.length ? (this.on("mouseover.force", ke).on("mouseout.force", le).call(c),
            void 0) : c
        }
        ,
        Wg.rebind(h, i, "on")
    }
    ;
    var fj = 20
      , gj = 1;
    Wg.layout.hierarchy = function() {
        function a(b, g, h) {
            var i = e.call(c, b, g);
            if (b.depth = g,
            h.push(b),
            i && (j = i.length)) {
                for (var j, k, l = -1, m = b.children = new Array(j), n = 0, o = g + 1; ++l < j; )
                    k = m[l] = a(i[l], o, h),
                    k.parent = b,
                    n += k.value;
                d && m.sort(d),
                f && (b.value = n)
            } else
                delete b.children,
                f && (b.value = +f.call(c, b, g) || 0);
            return b
        }
        function b(a, d) {
            var e = a.children
              , g = 0;
            if (e && (h = e.length))
                for (var h, i = -1, j = d + 1; ++i < h; )
                    g += b(e[i], j);
            else
                f && (g = +f.call(c, a, d) || 0);
            return f && (a.value = g),
            g
        }
        function c(b) {
            var c = [];
            return a(b, 0, c),
            c
        }
        var d = qe
          , e = oe
          , f = pe;
        return c.sort = function(a) {
            return arguments.length ? (d = a,
            c) : d
        }
        ,
        c.children = function(a) {
            return arguments.length ? (e = a,
            c) : e
        }
        ,
        c.value = function(a) {
            return arguments.length ? (f = a,
            c) : f
        }
        ,
        c.revalue = function(a) {
            return b(a, 0),
            a
        }
        ,
        c
    }
    ,
    Wg.layout.partition = function() {
        function a(b, c, d, e) {
            var f = b.children;
            if (b.x = c,
            b.y = b.depth * e,
            b.dx = d,
            b.dy = e,
            f && (g = f.length)) {
                var g, h, i, j = -1;
                for (d = b.value ? d / b.value : 0; ++j < g; )
                    a(h = f[j], c, i = h.value * d, e),
                    c += i
            }
        }
        function b(a) {
            var c = a.children
              , d = 0;
            if (c && (e = c.length))
                for (var e, f = -1; ++f < e; )
                    d = Math.max(d, b(c[f]));
            return 1 + d
        }
        function c(c, f) {
            var g = d.call(this, c, f);
            return a(g[0], 0, e[0], e[1] / b(g[0])),
            g
        }
        var d = Wg.layout.hierarchy()
          , e = [1, 1];
        return c.size = function(a) {
            return arguments.length ? (e = a,
            c) : e
        }
        ,
        ne(c, d)
    }
    ,
    Wg.layout.pie = function() {
        function a(f) {
            var g = f.map(function(c, d) {
                return +b.call(a, c, d)
            })
              , h = +("function" == typeof d ? d.apply(this, arguments) : d)
              , i = (("function" == typeof e ? e.apply(this, arguments) : e) - h) / Wg.sum(g)
              , j = Wg.range(f.length);
            null != c && j.sort(c === hj ? function(a, b) {
                return g[b] - g[a]
            }
            : function(a, b) {
                return c(f[a], f[b])
            }
            );
            var k = [];
            return j.forEach(function(a) {
                var b;
                k[a] = {
                    data: f[a],
                    value: b = g[a],
                    startAngle: h,
                    endAngle: h += b * i
                }
            }),
            k
        }
        var b = Number
          , c = hj
          , d = 0
          , e = Bh;
        return a.value = function(c) {
            return arguments.length ? (b = c,
            a) : b
        }
        ,
        a.sort = function(b) {
            return arguments.length ? (c = b,
            a) : c
        }
        ,
        a.startAngle = function(b) {
            return arguments.length ? (d = b,
            a) : d
        }
        ,
        a.endAngle = function(b) {
            return arguments.length ? (e = b,
            a) : e
        }
        ,
        a
    }
    ;
    var hj = {};
    Wg.layout.stack = function() {
        function a(h, i) {
            var j = h.map(function(c, d) {
                return b.call(a, c, d)
            })
              , k = j.map(function(b) {
                return b.map(function(b, c) {
                    return [f.call(a, b, c), g.call(a, b, c)]
                })
            })
              , l = c.call(a, k, i);
            j = Wg.permute(j, l),
            k = Wg.permute(k, l);
            var m, n, o, p = d.call(a, k, i), q = j.length, r = j[0].length;
            for (n = 0; r > n; ++n)
                for (e.call(a, j[0][n], o = p[n], k[0][n][1]),
                m = 1; q > m; ++m)
                    e.call(a, j[m][n], o += k[m - 1][n][1], k[m][n][1]);
            return h
        }
        var b = qb
          , c = ve
          , d = we
          , e = ue
          , f = se
          , g = te;
        return a.values = function(c) {
            return arguments.length ? (b = c,
            a) : b
        }
        ,
        a.order = function(b) {
            return arguments.length ? (c = "function" == typeof b ? b : ij.get(b) || ve,
            a) : c
        }
        ,
        a.offset = function(b) {
            return arguments.length ? (d = "function" == typeof b ? b : jj.get(b) || we,
            a) : d
        }
        ,
        a.x = function(b) {
            return arguments.length ? (f = b,
            a) : f
        }
        ,
        a.y = function(b) {
            return arguments.length ? (g = b,
            a) : g
        }
        ,
        a.out = function(b) {
            return arguments.length ? (e = b,
            a) : e
        }
        ,
        a
    }
    ;
    var ij = Wg.map({
        "inside-out": function(a) {
            var b, c, d = a.length, e = a.map(xe), f = a.map(ye), g = Wg.range(d).sort(function(a, b) {
                return e[a] - e[b]
            }), h = 0, i = 0, j = [], k = [];
            for (b = 0; d > b; ++b)
                c = g[b],
                i > h ? (h += f[c],
                j.push(c)) : (i += f[c],
                k.push(c));
            return k.reverse().concat(j)
        },
        reverse: function(a) {
            return Wg.range(a.length).reverse()
        },
        "default": ve
    })
      , jj = Wg.map({
        silhouette: function(a) {
            var b, c, d, e = a.length, f = a[0].length, g = [], h = 0, i = [];
            for (c = 0; f > c; ++c) {
                for (b = 0,
                d = 0; e > b; b++)
                    d += a[b][c][1];
                d > h && (h = d),
                g.push(d)
            }
            for (c = 0; f > c; ++c)
                i[c] = (h - g[c]) / 2;
            return i
        },
        wiggle: function(a) {
            var b, c, d, e, f, g, h, i, j, k = a.length, l = a[0], m = l.length, n = [];
            for (n[0] = i = j = 0,
            c = 1; m > c; ++c) {
                for (b = 0,
                e = 0; k > b; ++b)
                    e += a[b][c][1];
                for (b = 0,
                f = 0,
                h = l[c][0] - l[c - 1][0]; k > b; ++b) {
                    for (d = 0,
                    g = (a[b][c][1] - a[b][c - 1][1]) / (2 * h); b > d; ++d)
                        g += (a[d][c][1] - a[d][c - 1][1]) / h;
                    f += g * a[b][c][1]
                }
                n[c] = i -= e ? f / e * h : 0,
                j > i && (j = i)
            }
            for (c = 0; m > c; ++c)
                n[c] -= j;
            return n
        },
        expand: function(a) {
            var b, c, d, e = a.length, f = a[0].length, g = 1 / e, h = [];
            for (c = 0; f > c; ++c) {
                for (b = 0,
                d = 0; e > b; b++)
                    d += a[b][c][1];
                if (d)
                    for (b = 0; e > b; b++)
                        a[b][c][1] /= d;
                else
                    for (b = 0; e > b; b++)
                        a[b][c][1] = g
            }
            for (c = 0; f > c; ++c)
                h[c] = 0;
            return h
        },
        zero: we
    });
    Wg.layout.histogram = function() {
        function a(a, f) {
            for (var g, h, i = [], j = a.map(c, this), k = d.call(this, j, f), l = e.call(this, k, j, f), f = -1, m = j.length, n = l.length - 1, o = b ? 1 : 1 / m; ++f < n; )
                g = i[f] = [],
                g.dx = l[f + 1] - (g.x = l[f]),
                g.y = 0;
            if (n > 0)
                for (f = -1; ++f < m; )
                    h = j[f],
                    h >= k[0] && h <= k[1] && (g = i[Wg.bisect(l, h, 1, n) - 1],
                    g.y += o,
                    g.push(a[f]));
            return i
        }
        var b = !0
          , c = Number
          , d = Ce
          , e = Ae;
        return a.value = function(b) {
            return arguments.length ? (c = b,
            a) : c
        }
        ,
        a.range = function(b) {
            return arguments.length ? (d = pb(b),
            a) : d
        }
        ,
        a.bins = function(b) {
            return arguments.length ? (e = "number" == typeof b ? function(a) {
                return Be(a, b)
            }
            : pb(b),
            a) : e
        }
        ,
        a.frequency = function(c) {
            return arguments.length ? (b = !!c,
            a) : b
        }
        ,
        a
    }
    ,
    Wg.layout.tree = function() {
        function a(a, f) {
            function g(a, b) {
                var d = a.children
                  , e = a._tree;
                if (d && (f = d.length)) {
                    for (var f, h, j, k = d[0], l = k, m = -1; ++m < f; )
                        j = d[m],
                        g(j, h),
                        l = i(j, h, l),
                        h = j;
                    Le(a);
                    var n = .5 * (k._tree.prelim + j._tree.prelim);
                    b ? (e.prelim = b._tree.prelim + c(a, b),
                    e.mod = e.prelim - n) : e.prelim = n
                } else
                    b && (e.prelim = b._tree.prelim + c(a, b))
            }
            function h(a, b) {
                a.x = a._tree.prelim + b;
                var c = a.children;
                if (c && (d = c.length)) {
                    var d, e = -1;
                    for (b += a._tree.mod; ++e < d; )
                        h(c[e], b)
                }
            }
            function i(a, b, d) {
                if (b) {
                    for (var e, f = a, g = a, h = b, i = a.parent.children[0], j = f._tree.mod, k = g._tree.mod, l = h._tree.mod, m = i._tree.mod; h = Fe(h),
                    f = Ee(f),
                    h && f; )
                        i = Ee(i),
                        g = Fe(g),
                        g._tree.ancestor = a,
                        e = h._tree.prelim + l - f._tree.prelim - j + c(h, f),
                        e > 0 && (Me(Ne(h, a, d), a, e),
                        j += e,
                        k += e),
                        l += h._tree.mod,
                        j += f._tree.mod,
                        m += i._tree.mod,
                        k += g._tree.mod;
                    h && !Fe(g) && (g._tree.thread = h,
                    g._tree.mod += l - k),
                    f && !Ee(i) && (i._tree.thread = f,
                    i._tree.mod += j - m,
                    d = a)
                }
                return d
            }
            var j = b.call(this, a, f)
              , k = j[0];
            Ke(k, function(a, b) {
                a._tree = {
                    ancestor: a,
                    prelim: 0,
                    mod: 0,
                    change: 0,
                    shift: 0,
                    number: b ? b._tree.number + 1 : 0
                }
            }),
            g(k),
            h(k, -k._tree.prelim);
            var l = Ge(k, Ie)
              , m = Ge(k, He)
              , n = Ge(k, Je)
              , o = l.x - c(l, m) / 2
              , p = m.x + c(m, l) / 2
              , q = n.depth || 1;
            return Ke(k, e ? function(a) {
                a.x *= d[0],
                a.y = a.depth * d[1],
                delete a._tree
            }
            : function(a) {
                a.x = (a.x - o) / (p - o) * d[0],
                a.y = a.depth / q * d[1],
                delete a._tree
            }
            ),
            j
        }
        var b = Wg.layout.hierarchy().sort(null).value(null)
          , c = De
          , d = [1, 1]
          , e = !1;
        return a.separation = function(b) {
            return arguments.length ? (c = b,
            a) : c
        }
        ,
        a.size = function(b) {
            return arguments.length ? (e = null == (d = b),
            a) : e ? null : d
        }
        ,
        a.nodeSize = function(b) {
            return arguments.length ? (e = null != (d = b),
            a) : e ? d : null
        }
        ,
        ne(a, b)
    }
    ,
    Wg.layout.pack = function() {
        function a(a, f) {
            var g = c.call(this, a, f)
              , h = g[0]
              , i = e[0]
              , j = e[1]
              , k = null == b ? Math.sqrt : "function" == typeof b ? b : function() {
                return b
            }
            ;
            if (h.x = h.y = 0,
            Ke(h, function(a) {
                a.r = +k(a.value)
            }),
            Ke(h, Se),
            d) {
                var l = d * (b ? 1 : Math.max(2 * h.r / i, 2 * h.r / j)) / 2;
                Ke(h, function(a) {
                    a.r += l
                }),
                Ke(h, Se),
                Ke(h, function(a) {
                    a.r -= l
                })
            }
            return Ve(h, i / 2, j / 2, b ? 1 : 1 / Math.max(2 * h.r / i, 2 * h.r / j)),
            g
        }
        var b, c = Wg.layout.hierarchy().sort(Oe), d = 0, e = [1, 1];
        return a.size = function(b) {
            return arguments.length ? (e = b,
            a) : e
        }
        ,
        a.radius = function(c) {
            return arguments.length ? (b = null == c || "function" == typeof c ? c : +c,
            a) : b
        }
        ,
        a.padding = function(b) {
            return arguments.length ? (d = +b,
            a) : d
        }
        ,
        ne(a, c)
    }
    ,
    Wg.layout.cluster = function() {
        function a(a, f) {
            var g, h = b.call(this, a, f), i = h[0], j = 0;
            Ke(i, function(a) {
                var b = a.children;
                b && b.length ? (a.x = Ye(b),
                a.y = Xe(b)) : (a.x = g ? j += c(a, g) : 0,
                a.y = 0,
                g = a)
            });
            var k = Ze(i)
              , l = $e(i)
              , m = k.x - c(k, l) / 2
              , n = l.x + c(l, k) / 2;
            return Ke(i, e ? function(a) {
                a.x = (a.x - i.x) * d[0],
                a.y = (i.y - a.y) * d[1]
            }
            : function(a) {
                a.x = (a.x - m) / (n - m) * d[0],
                a.y = (1 - (i.y ? a.y / i.y : 1)) * d[1]
            }
            ),
            h
        }
        var b = Wg.layout.hierarchy().sort(null).value(null)
          , c = De
          , d = [1, 1]
          , e = !1;
        return a.separation = function(b) {
            return arguments.length ? (c = b,
            a) : c
        }
        ,
        a.size = function(b) {
            return arguments.length ? (e = null == (d = b),
            a) : e ? null : d
        }
        ,
        a.nodeSize = function(b) {
            return arguments.length ? (e = null != (d = b),
            a) : e ? d : null
        }
        ,
        ne(a, b)
    }
    ,
    Wg.layout.treemap = function() {
        function a(a, b) {
            for (var c, d, e = -1, f = a.length; ++e < f; )
                d = (c = a[e]).value * (0 > b ? 0 : b),
                c.area = isNaN(d) || 0 >= d ? 0 : d
        }
        function b(c) {
            var f = c.children;
            if (f && f.length) {
                var g, h, i, j = l(c), k = [], m = f.slice(), o = 1 / 0, p = "slice" === n ? j.dx : "dice" === n ? j.dy : "slice-dice" === n ? 1 & c.depth ? j.dy : j.dx : Math.min(j.dx, j.dy);
                for (a(m, j.dx * j.dy / c.value),
                k.area = 0; (i = m.length) > 0; )
                    k.push(g = m[i - 1]),
                    k.area += g.area,
                    "squarify" !== n || (h = d(k, p)) <= o ? (m.pop(),
                    o = h) : (k.area -= k.pop().area,
                    e(k, p, j, !1),
                    p = Math.min(j.dx, j.dy),
                    k.length = k.area = 0,
                    o = 1 / 0);
                k.length && (e(k, p, j, !0),
                k.length = k.area = 0),
                f.forEach(b)
            }
        }
        function c(b) {
            var d = b.children;
            if (d && d.length) {
                var f, g = l(b), h = d.slice(), i = [];
                for (a(h, g.dx * g.dy / b.value),
                i.area = 0; f = h.pop(); )
                    i.push(f),
                    i.area += f.area,
                    null != f.z && (e(i, f.z ? g.dx : g.dy, g, !h.length),
                    i.length = i.area = 0);
                d.forEach(c)
            }
        }
        function d(a, b) {
            for (var c, d = a.area, e = 0, f = 1 / 0, g = -1, h = a.length; ++g < h; )
                (c = a[g].area) && (f > c && (f = c),
                c > e && (e = c));
            return d *= d,
            b *= b,
            d ? Math.max(b * e * o / d, d / (b * f * o)) : 1 / 0
        }
        function e(a, b, c, d) {
            var e, f = -1, g = a.length, h = c.x, j = c.y, k = b ? i(a.area / b) : 0;
            if (b == c.dx) {
                for ((d || k > c.dy) && (k = c.dy); ++f < g; )
                    e = a[f],
                    e.x = h,
                    e.y = j,
                    e.dy = k,
                    h += e.dx = Math.min(c.x + c.dx - h, k ? i(e.area / k) : 0);
                e.z = !0,
                e.dx += c.x + c.dx - h,
                c.y += k,
                c.dy -= k
            } else {
                for ((d || k > c.dx) && (k = c.dx); ++f < g; )
                    e = a[f],
                    e.x = h,
                    e.y = j,
                    e.dx = k,
                    j += e.dy = Math.min(c.y + c.dy - j, k ? i(e.area / k) : 0);
                e.z = !1,
                e.dy += c.y + c.dy - j,
                c.x += k,
                c.dx -= k
            }
        }
        function f(d) {
            var e = g || h(d)
              , f = e[0];
            return f.x = 0,
            f.y = 0,
            f.dx = j[0],
            f.dy = j[1],
            g && h.revalue(f),
            a([f], f.dx * f.dy / f.value),
            (g ? c : b)(f),
            m && (g = e),
            e
        }
        var g, h = Wg.layout.hierarchy(), i = Math.round, j = [1, 1], k = null, l = _e, m = !1, n = "squarify", o = .5 * (1 + Math.sqrt(5));
        return f.size = function(a) {
            return arguments.length ? (j = a,
            f) : j
        }
        ,
        f.padding = function(a) {
            function b(b) {
                var c = a.call(f, b, b.depth);
                return null == c ? _e(b) : af(b, "number" == typeof c ? [c, c, c, c] : c)
            }
            function c(b) {
                return af(b, a)
            }
            if (!arguments.length)
                return k;
            var d;
            return l = null == (k = a) ? _e : "function" == (d = typeof a) ? b : "number" === d ? (a = [a, a, a, a],
            c) : c,
            f
        }
        ,
        f.round = function(a) {
            return arguments.length ? (i = a ? Math.round : Number,
            f) : i != Number
        }
        ,
        f.sticky = function(a) {
            return arguments.length ? (m = a,
            g = null,
            f) : m
        }
        ,
        f.ratio = function(a) {
            return arguments.length ? (o = a,
            f) : o
        }
        ,
        f.mode = function(a) {
            return arguments.length ? (n = a + "",
            f) : n
        }
        ,
        ne(f, h)
    }
    ,
    Wg.random = {
        normal: function(a, b) {
            var c = arguments.length;
            return 2 > c && (b = 1),
            1 > c && (a = 0),
            function() {
                var c, d, e;
                do
                    c = 2 * Math.random() - 1,
                    d = 2 * Math.random() - 1,
                    e = c * c + d * d;
                while (!e || e > 1);return a + b * c * Math.sqrt(-2 * Math.log(e) / e)
            }
        },
        logNormal: function() {
            var a = Wg.random.normal.apply(Wg, arguments);
            return function() {
                return Math.exp(a())
            }
        },
        bates: function(a) {
            var b = Wg.random.irwinHall(a);
            return function() {
                return b() / a
            }
        },
        irwinHall: function(a) {
            return function() {
                for (var b = 0, c = 0; a > c; c++)
                    b += Math.random();
                return b
            }
        }
    },
    Wg.scale = {};
    var kj = {
        floor: qb,
        ceil: qb
    };
    Wg.scale.linear = function() {
        return hf([0, 1], [0, 1], Hd, !1)
    }
    ;
    var lj = {
        s: 1,
        g: 1,
        p: 1,
        r: 1,
        e: 1
    };
    Wg.scale.log = function() {
        return qf(Wg.scale.linear().domain([0, 1]), 10, !0, [1, 10])
    }
    ;
    var mj = Wg.format(".0e")
      , nj = {
        floor: function(a) {
            return -Math.ceil(-a)
        },
        ceil: function(a) {
            return -Math.floor(-a)
        }
    };
    Wg.scale.pow = function() {
        return rf(Wg.scale.linear(), 1, [0, 1])
    }
    ,
    Wg.scale.sqrt = function() {
        return Wg.scale.pow().exponent(.5)
    }
    ,
    Wg.scale.ordinal = function() {
        return tf([], {
            t: "range",
            a: [[]]
        })
    }
    ,
    Wg.scale.category10 = function() {
        return Wg.scale.ordinal().range(oj)
    }
    ,
    Wg.scale.category20 = function() {
        return Wg.scale.ordinal().range(pj)
    }
    ,
    Wg.scale.category20b = function() {
        return Wg.scale.ordinal().range(qj)
    }
    ,
    Wg.scale.category20c = function() {
        return Wg.scale.ordinal().range(rj)
    }
    ;
    var oj = [2062260, 16744206, 2924588, 14034728, 9725885, 9197131, 14907330, 8355711, 12369186, 1556175].map(gb)
      , pj = [2062260, 11454440, 16744206, 16759672, 2924588, 10018698, 14034728, 16750742, 9725885, 12955861, 9197131, 12885140, 14907330, 16234194, 8355711, 13092807, 12369186, 14408589, 1556175, 10410725].map(gb)
      , qj = [3750777, 5395619, 7040719, 10264286, 6519097, 9216594, 11915115, 13556636, 9202993, 12426809, 15186514, 15190932, 8666169, 11356490, 14049643, 15177372, 8077683, 10834324, 13528509, 14589654].map(gb)
      , rj = [3244733, 7057110, 10406625, 13032431, 15095053, 16616764, 16625259, 16634018, 3253076, 7652470, 10607003, 13101504, 7695281, 10394312, 12369372, 14342891, 6513507, 9868950, 12434877, 14277081].map(gb);
    Wg.scale.quantile = function() {
        return uf([], [])
    }
    ,
    Wg.scale.quantize = function() {
        return vf(0, 1, [0, 1])
    }
    ,
    Wg.scale.threshold = function() {
        return wf([.5], [0, 1])
    }
    ,
    Wg.scale.identity = function() {
        return xf([0, 1])
    }
    ,
    Wg.svg = {},
    Wg.svg.arc = function() {
        function a() {
            var a = b.apply(this, arguments)
              , f = c.apply(this, arguments)
              , g = d.apply(this, arguments) + sj
              , h = e.apply(this, arguments) + sj
              , i = (g > h && (i = g,
            g = h,
            h = i),
            h - g)
              , j = Ah > i ? "0" : "1"
              , k = Math.cos(g)
              , l = Math.sin(g)
              , m = Math.cos(h)
              , n = Math.sin(h);
            return i >= tj ? a ? "M0," + f + "A" + f + "," + f + " 0 1,1 0," + -f + "A" + f + "," + f + " 0 1,1 0," + f + "M0," + a + "A" + a + "," + a + " 0 1,0 0," + -a + "A" + a + "," + a + " 0 1,0 0," + a + "Z" : "M0," + f + "A" + f + "," + f + " 0 1,1 0," + -f + "A" + f + "," + f + " 0 1,1 0," + f + "Z" : a ? "M" + f * k + "," + f * l + "A" + f + "," + f + " 0 " + j + ",1 " + f * m + "," + f * n + "L" + a * m + "," + a * n + "A" + a + "," + a + " 0 " + j + ",0 " + a * k + "," + a * l + "Z" : "M" + f * k + "," + f * l + "A" + f + "," + f + " 0 " + j + ",1 " + f * m + "," + f * n + "L0,0Z"
        }
        var b = yf
          , c = zf
          , d = Af
          , e = Bf;
        return a.innerRadius = function(c) {
            return arguments.length ? (b = pb(c),
            a) : b
        }
        ,
        a.outerRadius = function(b) {
            return arguments.length ? (c = pb(b),
            a) : c
        }
        ,
        a.startAngle = function(b) {
            return arguments.length ? (d = pb(b),
            a) : d
        }
        ,
        a.endAngle = function(b) {
            return arguments.length ? (e = pb(b),
            a) : e
        }
        ,
        a.centroid = function() {
            var a = (b.apply(this, arguments) + c.apply(this, arguments)) / 2
              , f = (d.apply(this, arguments) + e.apply(this, arguments)) / 2 + sj;
            return [Math.cos(f) * a, Math.sin(f) * a]
        }
        ,
        a
    }
    ;
    var sj = -Ch
      , tj = Bh - Dh;
    Wg.svg.line = function() {
        return Cf(qb)
    }
    ;
    var uj = Wg.map({
        linear: Df,
        "linear-closed": Ef,
        step: Ff,
        "step-before": Gf,
        "step-after": Hf,
        basis: Nf,
        "basis-open": Of,
        "basis-closed": Pf,
        bundle: Qf,
        cardinal: Kf,
        "cardinal-open": If,
        "cardinal-closed": Jf,
        monotone: Wf
    });
    uj.forEach(function(a, b) {
        b.key = a,
        b.closed = /-closed$/.test(a)
    });
    var vj = [0, 2 / 3, 1 / 3, 0]
      , wj = [0, 1 / 3, 2 / 3, 0]
      , xj = [0, 1 / 6, 2 / 3, 1 / 6];
    Wg.svg.line.radial = function() {
        var a = Cf(Xf);
        return a.radius = a.x,
        delete a.x,
        a.angle = a.y,
        delete a.y,
        a
    }
    ,
    Gf.reverse = Hf,
    Hf.reverse = Gf,
    Wg.svg.area = function() {
        return Yf(qb)
    }
    ,
    Wg.svg.area.radial = function() {
        var a = Yf(Xf);
        return a.radius = a.x,
        delete a.x,
        a.innerRadius = a.x0,
        delete a.x0,
        a.outerRadius = a.x1,
        delete a.x1,
        a.angle = a.y,
        delete a.y,
        a.startAngle = a.y0,
        delete a.y0,
        a.endAngle = a.y1,
        delete a.y1,
        a
    }
    ,
    Wg.svg.chord = function() {
        function a(a, h) {
            var i = b(this, f, a, h)
              , j = b(this, g, a, h);
            return "M" + i.p0 + d(i.r, i.p1, i.a1 - i.a0) + (c(i, j) ? e(i.r, i.p1, i.r, i.p0) : e(i.r, i.p1, j.r, j.p0) + d(j.r, j.p1, j.a1 - j.a0) + e(j.r, j.p1, i.r, i.p0)) + "Z"
        }
        function b(a, b, c, d) {
            var e = b.call(a, c, d)
              , f = h.call(a, e, d)
              , g = i.call(a, e, d) + sj
              , k = j.call(a, e, d) + sj;
            return {
                r: f,
                a0: g,
                a1: k,
                p0: [f * Math.cos(g), f * Math.sin(g)],
                p1: [f * Math.cos(k), f * Math.sin(k)]
            }
        }
        function c(a, b) {
            return a.a0 == b.a0 && a.a1 == b.a1
        }
        function d(a, b, c) {
            return "A" + a + "," + a + " 0 " + +(c > Ah) + ",1 " + b
        }
        function e(a, b, c, d) {
            return "Q 0,0 " + d
        }
        var f = Jc
          , g = Kc
          , h = Zf
          , i = Af
          , j = Bf;
        return a.radius = function(b) {
            return arguments.length ? (h = pb(b),
            a) : h
        }
        ,
        a.source = function(b) {
            return arguments.length ? (f = pb(b),
            a) : f
        }
        ,
        a.target = function(b) {
            return arguments.length ? (g = pb(b),
            a) : g
        }
        ,
        a.startAngle = function(b) {
            return arguments.length ? (i = pb(b),
            a) : i
        }
        ,
        a.endAngle = function(b) {
            return arguments.length ? (j = pb(b),
            a) : j
        }
        ,
        a
    }
    ,
    Wg.svg.diagonal = function() {
        function a(a, e) {
            var f = b.call(this, a, e)
              , g = c.call(this, a, e)
              , h = (f.y + g.y) / 2
              , i = [f, {
                x: f.x,
                y: h
            }, {
                x: g.x,
                y: h
            }, g];
            return i = i.map(d),
            "M" + i[0] + "C" + i[1] + " " + i[2] + " " + i[3]
        }
        var b = Jc
          , c = Kc
          , d = $f;
        return a.source = function(c) {
            return arguments.length ? (b = pb(c),
            a) : b
        }
        ,
        a.target = function(b) {
            return arguments.length ? (c = pb(b),
            a) : c
        }
        ,
        a.projection = function(b) {
            return arguments.length ? (d = b,
            a) : d
        }
        ,
        a
    }
    ,
    Wg.svg.diagonal.radial = function() {
        var a = Wg.svg.diagonal()
          , b = $f
          , c = a.projection;
        return a.projection = function(a) {
            return arguments.length ? c(_f(b = a)) : b
        }
        ,
        a
    }
    ,
    Wg.svg.symbol = function() {
        function a(a, d) {
            return (yj.get(b.call(this, a, d)) || cg)(c.call(this, a, d))
        }
        var b = bg
          , c = ag;
        return a.type = function(c) {
            return arguments.length ? (b = pb(c),
            a) : b
        }
        ,
        a.size = function(b) {
            return arguments.length ? (c = pb(b),
            a) : c
        }
        ,
        a
    }
    ;
    var yj = Wg.map({
        circle: cg,
        cross: function(a) {
            var b = Math.sqrt(a / 5) / 2;
            return "M" + -3 * b + "," + -b + "H" + -b + "V" + -3 * b + "H" + b + "V" + -b + "H" + 3 * b + "V" + b + "H" + b + "V" + 3 * b + "H" + -b + "V" + b + "H" + -3 * b + "Z"
        },
        diamond: function(a) {
            var b = Math.sqrt(a / (2 * Cj))
              , c = b * Cj;
            return "M0," + -b + "L" + c + ",0 0," + b + " " + -c + ",0Z"
        },
        square: function(a) {
            var b = Math.sqrt(a) / 2;
            return "M" + -b + "," + -b + "L" + b + "," + -b + " " + b + "," + b + " " + -b + "," + b + "Z"
        },
        "triangle-down": function(a) {
            var b = Math.sqrt(a / Bj)
              , c = b * Bj / 2;
            return "M0," + c + "L" + b + "," + -c + " " + -b + "," + -c + "Z"
        },
        "triangle-up": function(a) {
            var b = Math.sqrt(a / Bj)
              , c = b * Bj / 2;
            return "M0," + -c + "L" + b + "," + c + " " + -b + "," + c + "Z"
        }
    });
    Wg.svg.symbolTypes = yj.keys();
    var zj, Aj, Bj = Math.sqrt(3), Cj = Math.tan(30 * Fh), Dj = [], Ej = 0;
    Dj.call = sh.call,
    Dj.empty = sh.empty,
    Dj.node = sh.node,
    Dj.size = sh.size,
    Wg.transition = function(a) {
        return arguments.length ? zj ? a.transition() : a : vh.transition()
    }
    ,
    Wg.transition.prototype = Dj,
    Dj.select = function(a) {
        var b, c, d, e = this.id, f = [];
        a = p(a);
        for (var g = -1, h = this.length; ++g < h; ) {
            f.push(b = []);
            for (var i = this[g], j = -1, k = i.length; ++j < k; )
                (d = i[j]) && (c = a.call(d, d.__data__, j, g)) ? ("__data__"in d && (c.__data__ = d.__data__),
                gg(c, j, e, d.__transition__[e]),
                b.push(c)) : b.push(null)
        }
        return dg(f, e)
    }
    ,
    Dj.selectAll = function(a) {
        var b, c, d, e, f, g = this.id, h = [];
        a = q(a);
        for (var i = -1, j = this.length; ++i < j; )
            for (var k = this[i], l = -1, m = k.length; ++l < m; )
                if (d = k[l]) {
                    f = d.__transition__[g],
                    c = a.call(d, d.__data__, l, i),
                    h.push(b = []);
                    for (var n = -1, o = c.length; ++n < o; )
                        (e = c[n]) && gg(e, n, g, f),
                        b.push(e)
                }
        return dg(h, g)
    }
    ,
    Dj.filter = function(a) {
        var b, c, d, e = [];
        "function" != typeof a && (a = B(a));
        for (var f = 0, g = this.length; g > f; f++) {
            e.push(b = []);
            for (var c = this[f], h = 0, i = c.length; i > h; h++)
                (d = c[h]) && a.call(d, d.__data__, h, f) && b.push(d)
        }
        return dg(e, this.id)
    }
    ,
    Dj.tween = function(a, b) {
        var c = this.id;
        return arguments.length < 2 ? this.node().__transition__[c].tween.get(a) : D(this, null == b ? function(b) {
            b.__transition__[c].tween.remove(a)
        }
        : function(d) {
            d.__transition__[c].tween.set(a, b)
        }
        )
    }
    ,
    Dj.attr = function(a, b) {
        function c() {
            this.removeAttribute(h)
        }
        function d() {
            this.removeAttributeNS(h.space, h.local)
        }
        function e(a) {
            return null == a ? c : (a += "",
            function() {
                var b, c = this.getAttribute(h);
                return c !== a && (b = g(c, a),
                function(a) {
                    this.setAttribute(h, b(a))
                }
                )
            }
            )
        }
        function f(a) {
            return null == a ? d : (a += "",
            function() {
                var b, c = this.getAttributeNS(h.space, h.local);
                return c !== a && (b = g(c, a),
                function(a) {
                    this.setAttributeNS(h.space, h.local, b(a))
                }
                )
            }
            )
        }
        if (arguments.length < 2) {
            for (b in a)
                this.attr(b, a[b]);
            return this
        }
        var g = "transform" == a ? ce : Hd
          , h = Wg.ns.qualify(a);
        return eg(this, "attr." + a, b, h.local ? f : e)
    }
    ,
    Dj.attrTween = function(a, b) {
        function c(a, c) {
            var d = b.call(this, a, c, this.getAttribute(e));
            return d && function(a) {
                this.setAttribute(e, d(a))
            }
        }
        function d(a, c) {
            var d = b.call(this, a, c, this.getAttributeNS(e.space, e.local));
            return d && function(a) {
                this.setAttributeNS(e.space, e.local, d(a))
            }
        }
        var e = Wg.ns.qualify(a);
        return this.tween("attr." + a, e.local ? d : c)
    }
    ,
    Dj.style = function(a, b, c) {
        function d() {
            this.style.removeProperty(a)
        }
        function e(b) {
            return null == b ? d : (b += "",
            function() {
                var d, e = _g.getComputedStyle(this, null).getPropertyValue(a);
                return e !== b && (d = Hd(e, b),
                function(b) {
                    this.style.setProperty(a, d(b), c)
                }
                )
            }
            )
        }
        var f = arguments.length;
        if (3 > f) {
            if ("string" != typeof a) {
                2 > f && (b = "");
                for (c in a)
                    this.style(c, a[c], b);
                return this
            }
            c = ""
        }
        return eg(this, "style." + a, b, e)
    }
    ,
    Dj.styleTween = function(a, b, c) {
        function d(d, e) {
            var f = b.call(this, d, e, _g.getComputedStyle(this, null).getPropertyValue(a));
            return f && function(b) {
                this.style.setProperty(a, f(b), c)
            }
        }
        return arguments.length < 3 && (c = ""),
        this.tween("style." + a, d)
    }
    ,
    Dj.text = function(a) {
        return eg(this, "text", a, fg)
    }
    ,
    Dj.remove = function() {
        return this.each("end.transition", function() {
            var a;
            this.__transition__.count < 2 && (a = this.parentNode) && a.removeChild(this)
        })
    }
    ,
    Dj.ease = function(a) {
        var b = this.id;
        return arguments.length < 1 ? this.node().__transition__[b].ease : ("function" != typeof a && (a = Wg.ease.apply(Wg, arguments)),
        D(this, function(c) {
            c.__transition__[b].ease = a
        }))
    }
    ,
    Dj.delay = function(a) {
        var b = this.id;
        return D(this, "function" == typeof a ? function(c, d, e) {
            c.__transition__[b].delay = +a.call(c, c.__data__, d, e)
        }
        : (a = +a,
        function(c) {
            c.__transition__[b].delay = a
        }
        ))
    }
    ,
    Dj.duration = function(a) {
        var b = this.id;
        return D(this, "function" == typeof a ? function(c, d, e) {
            c.__transition__[b].duration = Math.max(1, a.call(c, c.__data__, d, e))
        }
        : (a = Math.max(1, a),
        function(c) {
            c.__transition__[b].duration = a
        }
        ))
    }
    ,
    Dj.each = function(a, b) {
        var c = this.id;
        if (arguments.length < 2) {
            var d = Aj
              , e = zj;
            zj = c,
            D(this, function(b, d, e) {
                Aj = b.__transition__[c],
                a.call(b, b.__data__, d, e)
            }),
            Aj = d,
            zj = e
        } else
            D(this, function(d) {
                var e = d.__transition__[c];
                (e.event || (e.event = Wg.dispatch("start", "end"))).on(a, b)
            });
        return this
    }
    ,
    Dj.transition = function() {
        for (var a, b, c, d, e = this.id, f = ++Ej, g = [], h = 0, i = this.length; i > h; h++) {
            g.push(a = []);
            for (var b = this[h], j = 0, k = b.length; k > j; j++)
                (c = b[j]) && (d = Object.create(c.__transition__[e]),
                d.delay += d.duration,
                gg(c, j, f, d)),
                a.push(c)
        }
        return dg(g, f)
    }
    ,
    Wg.svg.axis = function() {
        function a(a) {
            a.each(function() {
                var a, j = Wg.select(this), k = this.__chart__ || c, l = this.__chart__ = c.copy(), m = null == i ? l.ticks ? l.ticks.apply(l, h) : l.domain() : i, n = null == b ? l.tickFormat ? l.tickFormat.apply(l, h) : qb : b, o = j.selectAll(".tick").data(m, l), p = o.enter().insert("g", ".domain").attr("class", "tick").style("opacity", Dh), q = Wg.transition(o.exit()).style("opacity", Dh).remove(), r = Wg.transition(o).style("opacity", 1), s = cf(l), t = j.selectAll(".domain").data([0]), u = (t.enter().append("path").attr("class", "domain"),
                Wg.transition(t));
                p.append("line"),
                p.append("text");
                var v = p.select("line")
                  , w = r.select("line")
                  , x = o.select("text").text(n)
                  , y = p.select("text")
                  , z = r.select("text");
                switch (d) {
                case "bottom":
                    a = hg,
                    v.attr("y2", e),
                    y.attr("y", Math.max(e, 0) + g),
                    w.attr("x2", 0).attr("y2", e),
                    z.attr("x", 0).attr("y", Math.max(e, 0) + g),
                    x.attr("dy", ".71em").style("text-anchor", "middle"),
                    u.attr("d", "M" + s[0] + "," + f + "V0H" + s[1] + "V" + f);
                    break;
                case "top":
                    a = hg,
                    v.attr("y2", -e),
                    y.attr("y", -(Math.max(e, 0) + g)),
                    w.attr("x2", 0).attr("y2", -e),
                    z.attr("x", 0).attr("y", -(Math.max(e, 0) + g)),
                    x.attr("dy", "0em").style("text-anchor", "middle"),
                    u.attr("d", "M" + s[0] + "," + -f + "V0H" + s[1] + "V" + -f);
                    break;
                case "left":
                    a = ig,
                    v.attr("x2", -e),
                    y.attr("x", -(Math.max(e, 0) + g)),
                    w.attr("x2", -e).attr("y2", 0),
                    z.attr("x", -(Math.max(e, 0) + g)).attr("y", 0),
                    x.attr("dy", ".32em").style("text-anchor", "end"),
                    u.attr("d", "M" + -f + "," + s[0] + "H0V" + s[1] + "H" + -f);
                    break;
                case "right":
                    a = ig,
                    v.attr("x2", e),
                    y.attr("x", Math.max(e, 0) + g),
                    w.attr("x2", e).attr("y2", 0),
                    z.attr("x", Math.max(e, 0) + g).attr("y", 0),
                    x.attr("dy", ".32em").style("text-anchor", "start"),
                    u.attr("d", "M" + f + "," + s[0] + "H0V" + s[1] + "H" + f)
                }
                if (l.rangeBand) {
                    var A = l
                      , B = A.rangeBand() / 2;
                    k = l = function(a) {
                        return A(a) + B
                    }
                } else
                    k.rangeBand ? k = l : q.call(a, l);
                p.call(a, k),
                r.call(a, l)
            })
        }
        var b, c = Wg.scale.linear(), d = Fj, e = 6, f = 6, g = 3, h = [10], i = null;
        return a.scale = function(b) {
            return arguments.length ? (c = b,
            a) : c
        }
        ,
        a.orient = function(b) {
            return arguments.length ? (d = b in Gj ? b + "" : Fj,
            a) : d
        }
        ,
        a.ticks = function() {
            return arguments.length ? (h = arguments,
            a) : h
        }
        ,
        a.tickValues = function(b) {
            return arguments.length ? (i = b,
            a) : i
        }
        ,
        a.tickFormat = function(c) {
            return arguments.length ? (b = c,
            a) : b
        }
        ,
        a.tickSize = function(b) {
            var c = arguments.length;
            return c ? (e = +b,
            f = +arguments[c - 1],
            a) : e
        }
        ,
        a.innerTickSize = function(b) {
            return arguments.length ? (e = +b,
            a) : e
        }
        ,
        a.outerTickSize = function(b) {
            return arguments.length ? (f = +b,
            a) : f
        }
        ,
        a.tickPadding = function(b) {
            return arguments.length ? (g = +b,
            a) : g
        }
        ,
        a.tickSubdivide = function() {
            return arguments.length && a
        }
        ,
        a
    }
    ;
    var Fj = "bottom"
      , Gj = {
        top: 1,
        right: 1,
        bottom: 1,
        left: 1
    };
    Wg.svg.brush = function() {
        function a(f) {
            f.each(function() {
                var f = Wg.select(this).style("pointer-events", "all").style("-webkit-tap-highlight-color", "rgba(0,0,0,0)").on("mousedown.brush", e).on("touchstart.brush", e)
                  , g = f.selectAll(".background").data([0]);
                g.enter().append("rect").attr("class", "background").style("visibility", "hidden").style("cursor", "crosshair"),
                f.selectAll(".extent").data([0]).enter().append("rect").attr("class", "extent").style("cursor", "move");
                var h = f.selectAll(".resize").data(q, qb);
                h.exit().remove(),
                h.enter().append("g").attr("class", function(a) {
                    return "resize " + a
                }).style("cursor", function(a) {
                    return Hj[a]
                }).append("rect").attr("x", function(a) {
                    return /[ew]$/.test(a) ? -3 : null
                }).attr("y", function(a) {
                    return /^[ns]/.test(a) ? -3 : null
                }).attr("width", 6).attr("height", 6).style("visibility", "hidden"),
                h.style("display", a.empty() ? "none" : null);
                var k, l = Wg.transition(f), m = Wg.transition(g);
                i && (k = cf(i),
                m.attr("x", k[0]).attr("width", k[1] - k[0]),
                c(l)),
                j && (k = cf(j),
                m.attr("y", k[0]).attr("height", k[1] - k[0]),
                d(l)),
                b(l)
            })
        }
        function b(a) {
            a.selectAll(".resize").attr("transform", function(a) {
                return "translate(" + k[+/e$/.test(a)] + "," + m[+/^s/.test(a)] + ")"
            })
        }
        function c(a) {
            a.select(".extent").attr("x", k[0]),
            a.selectAll(".extent,.n>rect,.s>rect").attr("width", k[1] - k[0])
        }
        function d(a) {
            a.select(".extent").attr("y", m[0]),
            a.selectAll(".extent,.e>rect,.w>rect").attr("height", m[1] - m[0])
        }
        function e() {
            function e() {
                32 == Wg.event.keyCode && (C || (t = null,
                E[0] -= k[1],
                E[1] -= m[1],
                C = 2),
                l())
            }
            function n() {
                32 == Wg.event.keyCode && 2 == C && (E[0] += k[1],
                E[1] += m[1],
                C = 0,
                l())
            }
            function q() {
                var a = Wg.mouse(v)
                  , e = !1;
                u && (a[0] += u[0],
                a[1] += u[1]),
                C || (Wg.event.altKey ? (t || (t = [(k[0] + k[1]) / 2, (m[0] + m[1]) / 2]),
                E[0] = k[+(a[0] < t[0])],
                E[1] = m[+(a[1] < t[1])]) : t = null),
                A && r(a, i, 0) && (c(y),
                e = !0),
                B && r(a, j, 1) && (d(y),
                e = !0),
                e && (b(y),
                x({
                    type: "brush",
                    mode: C ? "move" : "resize"
                }))
            }
            function r(a, b, c) {
                var d, e, h = cf(b), i = h[0], j = h[1], l = E[c], n = c ? m : k, q = n[1] - n[0];
                return C && (i -= l,
                j -= q + l),
                d = (c ? p : o) ? Math.max(i, Math.min(j, a[c])) : a[c],
                C ? e = (d += l) + q : (t && (l = Math.max(i, Math.min(j, 2 * t[c] - d))),
                d > l ? (e = d,
                d = l) : e = l),
                n[0] != d || n[1] != e ? (c ? g = null : f = null,
                n[0] = d,
                n[1] = e,
                !0) : void 0
            }
            function s() {
                q(),
                y.style("pointer-events", "all").selectAll(".resize").style("display", a.empty() ? "none" : null),
                Wg.select("body").style("cursor", null),
                F.on("mousemove.brush", null).on("mouseup.brush", null).on("touchmove.brush", null).on("touchend.brush", null).on("keydown.brush", null).on("keyup.brush", null),
                D(),
                x({
                    type: "brushend"
                })
            }
            var t, u, v = this, w = Wg.select(Wg.event.target), x = h.of(v, arguments), y = Wg.select(v), z = w.datum(), A = !/^(n|s)$/.test(z) && i, B = !/^(e|w)$/.test(z) && j, C = w.classed("extent"), D = K(), E = Wg.mouse(v), F = Wg.select(_g).on("keydown.brush", e).on("keyup.brush", n);
            if (Wg.event.changedTouches ? F.on("touchmove.brush", q).on("touchend.brush", s) : F.on("mousemove.brush", q).on("mouseup.brush", s),
            y.interrupt().selectAll("*").interrupt(),
            C)
                E[0] = k[0] - E[0],
                E[1] = m[0] - E[1];
            else if (z) {
                var G = +/w$/.test(z)
                  , H = +/^n/.test(z);
                u = [k[1 - G] - E[0], m[1 - H] - E[1]],
                E[0] = k[G],
                E[1] = m[H]
            } else
                Wg.event.altKey && (t = E.slice());
            y.style("pointer-events", "none").selectAll(".resize").style("display", null),
            Wg.select("body").style("cursor", w.style("cursor")),
            x({
                type: "brushstart"
            }),
            q()
        }
        var f, g, h = n(a, "brushstart", "brush", "brushend"), i = null, j = null, k = [0, 0], m = [0, 0], o = !0, p = !0, q = Ij[0];
        return a.event = function(a) {
            a.each(function() {
                var a = h.of(this, arguments)
                  , b = {
                    x: k,
                    y: m,
                    i: f,
                    j: g
                }
                  , c = this.__chart__ || b;
                this.__chart__ = b,
                zj ? Wg.select(this).transition().each("start.brush", function() {
                    f = c.i,
                    g = c.j,
                    k = c.x,
                    m = c.y,
                    a({
                        type: "brushstart"
                    })
                }).tween("brush:brush", function() {
                    var c = Id(k, b.x)
                      , d = Id(m, b.y);
                    return f = g = null,
                    function(e) {
                        k = b.x = c(e),
                        m = b.y = d(e),
                        a({
                            type: "brush",
                            mode: "resize"
                        })
                    }
                }).each("end.brush", function() {
                    f = b.i,
                    g = b.j,
                    a({
                        type: "brush",
                        mode: "resize"
                    }),
                    a({
                        type: "brushend"
                    })
                }) : (a({
                    type: "brushstart"
                }),
                a({
                    type: "brush",
                    mode: "resize"
                }),
                a({
                    type: "brushend"
                }))
            })
        }
        ,
        a.x = function(b) {
            return arguments.length ? (i = b,
            q = Ij[!i << 1 | !j],
            a) : i
        }
        ,
        a.y = function(b) {
            return arguments.length ? (j = b,
            q = Ij[!i << 1 | !j],
            a) : j
        }
        ,
        a.clamp = function(b) {
            return arguments.length ? (i && j ? (o = !!b[0],
            p = !!b[1]) : i ? o = !!b : j && (p = !!b),
            a) : i && j ? [o, p] : i ? o : j ? p : null
        }
        ,
        a.extent = function(b) {
            var c, d, e, h, l;
            return arguments.length ? (i && (c = b[0],
            d = b[1],
            j && (c = c[0],
            d = d[0]),
            f = [c, d],
            i.invert && (c = i(c),
            d = i(d)),
            c > d && (l = c,
            c = d,
            d = l),
            (c != k[0] || d != k[1]) && (k = [c, d])),
            j && (e = b[0],
            h = b[1],
            i && (e = e[1],
            h = h[1]),
            g = [e, h],
            j.invert && (e = j(e),
            h = j(h)),
            e > h && (l = e,
            e = h,
            h = l),
            (e != m[0] || h != m[1]) && (m = [e, h])),
            a) : (i && (f ? (c = f[0],
            d = f[1]) : (c = k[0],
            d = k[1],
            i.invert && (c = i.invert(c),
            d = i.invert(d)),
            c > d && (l = c,
            c = d,
            d = l))),
            j && (g ? (e = g[0],
            h = g[1]) : (e = m[0],
            h = m[1],
            j.invert && (e = j.invert(e),
            h = j.invert(h)),
            e > h && (l = e,
            e = h,
            h = l))),
            i && j ? [[c, e], [d, h]] : i ? [c, d] : j && [e, h])
        }
        ,
        a.clear = function() {
            return a.empty() || (k = [0, 0],
            m = [0, 0],
            f = g = null),
            a
        }
        ,
        a.empty = function() {
            return !!i && k[0] == k[1] || !!j && m[0] == m[1]
        }
        ,
        Wg.rebind(a, h, "on")
    }
    ;
    var Hj = {
        n: "ns-resize",
        e: "ew-resize",
        s: "ns-resize",
        w: "ew-resize",
        nw: "nwse-resize",
        ne: "nesw-resize",
        se: "nwse-resize",
        sw: "nesw-resize"
    }
      , Ij = [["n", "e", "s", "w", "nw", "ne", "se", "sw"], ["e", "w"], ["n", "s"], []]
      , Jj = Wg.time = {}
      , Kj = Date
      , Lj = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    jg.prototype = {
        getDate: function() {
            return this._.getUTCDate()
        },
        getDay: function() {
            return this._.getUTCDay()
        },
        getFullYear: function() {
            return this._.getUTCFullYear()
        },
        getHours: function() {
            return this._.getUTCHours()
        },
        getMilliseconds: function() {
            return this._.getUTCMilliseconds()
        },
        getMinutes: function() {
            return this._.getUTCMinutes()
        },
        getMonth: function() {
            return this._.getUTCMonth()
        },
        getSeconds: function() {
            return this._.getUTCSeconds()
        },
        getTime: function() {
            return this._.getTime()
        },
        getTimezoneOffset: function() {
            return 0
        },
        valueOf: function() {
            return this._.valueOf()
        },
        setDate: function() {
            Mj.setUTCDate.apply(this._, arguments)
        },
        setDay: function() {
            Mj.setUTCDay.apply(this._, arguments)
        },
        setFullYear: function() {
            Mj.setUTCFullYear.apply(this._, arguments)
        },
        setHours: function() {
            Mj.setUTCHours.apply(this._, arguments)
        },
        setMilliseconds: function() {
            Mj.setUTCMilliseconds.apply(this._, arguments)
        },
        setMinutes: function() {
            Mj.setUTCMinutes.apply(this._, arguments)
        },
        setMonth: function() {
            Mj.setUTCMonth.apply(this._, arguments)
        },
        setSeconds: function() {
            Mj.setUTCSeconds.apply(this._, arguments)
        },
        setTime: function() {
            Mj.setTime.apply(this._, arguments)
        }
    };
    var Mj = Date.prototype
      , Nj = "%a %b %e %X %Y"
      , Oj = "%m/%d/%Y"
      , Pj = "%H:%M:%S"
      , Qj = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
      , Rj = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
      , Sj = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
      , Tj = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    Jj.year = kg(function(a) {
        return a = Jj.day(a),
        a.setMonth(0, 1),
        a
    }, function(a, b) {
        a.setFullYear(a.getFullYear() + b)
    }, function(a) {
        return a.getFullYear()
    }),
    Jj.years = Jj.year.range,
    Jj.years.utc = Jj.year.utc.range,
    Jj.day = kg(function(a) {
        var b = new Kj(2e3,0);
        return b.setFullYear(a.getFullYear(), a.getMonth(), a.getDate()),
        b
    }, function(a, b) {
        a.setDate(a.getDate() + b)
    }, function(a) {
        return a.getDate() - 1
    }),
    Jj.days = Jj.day.range,
    Jj.days.utc = Jj.day.utc.range,
    Jj.dayOfYear = function(a) {
        var b = Jj.year(a);
        return Math.floor((a - b - 6e4 * (a.getTimezoneOffset() - b.getTimezoneOffset())) / 864e5)
    }
    ,
    Lj.forEach(function(a, b) {
        a = a.toLowerCase(),
        b = 7 - b;
        var c = Jj[a] = kg(function(a) {
            return (a = Jj.day(a)).setDate(a.getDate() - (a.getDay() + b) % 7),
            a
        }, function(a, b) {
            a.setDate(a.getDate() + 7 * Math.floor(b))
        }, function(a) {
            var c = Jj.year(a).getDay();
            return Math.floor((Jj.dayOfYear(a) + (c + b) % 7) / 7) - (c !== b)
        });
        Jj[a + "s"] = c.range,
        Jj[a + "s"].utc = c.utc.range,
        Jj[a + "OfYear"] = function(a) {
            var c = Jj.year(a).getDay();
            return Math.floor((Jj.dayOfYear(a) + (c + b) % 7) / 7)
        }
    }),
    Jj.week = Jj.sunday,
    Jj.weeks = Jj.sunday.range,
    Jj.weeks.utc = Jj.sunday.utc.range,
    Jj.weekOfYear = Jj.sundayOfYear,
    Jj.format = mg;
    var Uj = og(Qj)
      , Vj = pg(Qj)
      , Wj = og(Rj)
      , Xj = pg(Rj)
      , Yj = og(Sj)
      , Zj = pg(Sj)
      , $j = og(Tj)
      , _j = pg(Tj)
      , ak = /^%/
      , bk = {
        "-": "",
        _: " ",
        0: "0"
    }
      , ck = {
        a: function(a) {
            return Rj[a.getDay()]
        },
        A: function(a) {
            return Qj[a.getDay()]
        },
        b: function(a) {
            return Tj[a.getMonth()]
        },
        B: function(a) {
            return Sj[a.getMonth()]
        },
        c: mg(Nj),
        d: function(a, b) {
            return qg(a.getDate(), b, 2)
        },
        e: function(a, b) {
            return qg(a.getDate(), b, 2)
        },
        H: function(a, b) {
            return qg(a.getHours(), b, 2)
        },
        I: function(a, b) {
            return qg(a.getHours() % 12 || 12, b, 2)
        },
        j: function(a, b) {
            return qg(1 + Jj.dayOfYear(a), b, 3)
        },
        L: function(a, b) {
            return qg(a.getMilliseconds(), b, 3)
        },
        m: function(a, b) {
            return qg(a.getMonth() + 1, b, 2)
        },
        M: function(a, b) {
            return qg(a.getMinutes(), b, 2)
        },
        p: function(a) {
            return a.getHours() >= 12 ? "PM" : "AM"
        },
        S: function(a, b) {
            return qg(a.getSeconds(), b, 2)
        },
        U: function(a, b) {
            return qg(Jj.sundayOfYear(a), b, 2)
        },
        w: function(a) {
            return a.getDay()
        },
        W: function(a, b) {
            return qg(Jj.mondayOfYear(a), b, 2)
        },
        x: mg(Oj),
        X: mg(Pj),
        y: function(a, b) {
            return qg(a.getFullYear() % 100, b, 2)
        },
        Y: function(a, b) {
            return qg(a.getFullYear() % 1e4, b, 4)
        },
        Z: Ng,
        "%": function() {
            return "%"
        }
    }
      , dk = {
        a: rg,
        A: sg,
        b: wg,
        B: xg,
        c: yg,
        d: Gg,
        e: Gg,
        H: Ig,
        I: Ig,
        j: Hg,
        L: Lg,
        m: Fg,
        M: Jg,
        p: Mg,
        S: Kg,
        U: ug,
        w: tg,
        W: vg,
        x: zg,
        X: Ag,
        y: Cg,
        Y: Bg,
        Z: Dg,
        "%": Og
    }
      , ek = /^\s*\d+/
      , fk = Wg.map({
        am: 0,
        pm: 1
    });
    mg.utc = Pg;
    var gk = Pg("%Y-%m-%dT%H:%M:%S.%LZ");
    mg.iso = Date.prototype.toISOString && +new Date("2000-01-01T00:00:00.000Z") ? Qg : gk,
    Qg.parse = function(a) {
        var b = new Date(a);
        return isNaN(b) ? null : b
    }
    ,
    Qg.toString = gk.toString,
    Jj.second = kg(function(a) {
        return new Kj(1e3 * Math.floor(a / 1e3))
    }, function(a, b) {
        a.setTime(a.getTime() + 1e3 * Math.floor(b))
    }, function(a) {
        return a.getSeconds()
    }),
    Jj.seconds = Jj.second.range,
    Jj.seconds.utc = Jj.second.utc.range,
    Jj.minute = kg(function(a) {
        return new Kj(6e4 * Math.floor(a / 6e4))
    }, function(a, b) {
        a.setTime(a.getTime() + 6e4 * Math.floor(b))
    }, function(a) {
        return a.getMinutes()
    }),
    Jj.minutes = Jj.minute.range,
    Jj.minutes.utc = Jj.minute.utc.range,
    Jj.hour = kg(function(a) {
        var b = a.getTimezoneOffset() / 60;
        return new Kj(36e5 * (Math.floor(a / 36e5 - b) + b))
    }, function(a, b) {
        a.setTime(a.getTime() + 36e5 * Math.floor(b))
    }, function(a) {
        return a.getHours()
    }),
    Jj.hours = Jj.hour.range,
    Jj.hours.utc = Jj.hour.utc.range,
    Jj.month = kg(function(a) {
        return a = Jj.day(a),
        a.setDate(1),
        a
    }, function(a, b) {
        a.setMonth(a.getMonth() + b)
    }, function(a) {
        return a.getMonth()
    }),
    Jj.months = Jj.month.range,
    Jj.months.utc = Jj.month.utc.range;
    var hk = [1e3, 5e3, 15e3, 3e4, 6e4, 3e5, 9e5, 18e5, 36e5, 108e5, 216e5, 432e5, 864e5, 1728e5, 6048e5, 2592e6, 7776e6, 31536e6]
      , ik = [[Jj.second, 1], [Jj.second, 5], [Jj.second, 15], [Jj.second, 30], [Jj.minute, 1], [Jj.minute, 5], [Jj.minute, 15], [Jj.minute, 30], [Jj.hour, 1], [Jj.hour, 3], [Jj.hour, 6], [Jj.hour, 12], [Jj.day, 1], [Jj.day, 2], [Jj.week, 1], [Jj.month, 1], [Jj.month, 3], [Jj.year, 1]]
      , jk = [[mg("%Y"), Tb], [mg("%B"), function(a) {
        return a.getMonth()
    }
    ], [mg("%b %d"), function(a) {
        return 1 != a.getDate()
    }
    ], [mg("%a %d"), function(a) {
        return a.getDay() && 1 != a.getDate()
    }
    ], [mg("%I %p"), function(a) {
        return a.getHours()
    }
    ], [mg("%I:%M"), function(a) {
        return a.getMinutes()
    }
    ], [mg(":%S"), function(a) {
        return a.getSeconds()
    }
    ], [mg(".%L"), function(a) {
        return a.getMilliseconds()
    }
    ]]
      , kk = Tg(jk);
    ik.year = Jj.year,
    Jj.scale = function() {
        return Rg(Wg.scale.linear(), ik, kk)
    }
    ;
    var lk = {
        range: function(a, b, c) {
            return Wg.range(+a, +b, c).map(Sg)
        },
        floor: qb,
        ceil: qb
    }
      , mk = ik.map(function(a) {
        return [a[0].utc, a[1]]
    })
      , nk = [[Pg("%Y"), Tb], [Pg("%B"), function(a) {
        return a.getUTCMonth()
    }
    ], [Pg("%b %d"), function(a) {
        return 1 != a.getUTCDate()
    }
    ], [Pg("%a %d"), function(a) {
        return a.getUTCDay() && 1 != a.getUTCDate()
    }
    ], [Pg("%I %p"), function(a) {
        return a.getUTCHours()
    }
    ], [Pg("%I:%M"), function(a) {
        return a.getUTCMinutes()
    }
    ], [Pg(":%S"), function(a) {
        return a.getUTCSeconds()
    }
    ], [Pg(".%L"), function(a) {
        return a.getUTCMilliseconds()
    }
    ]]
      , ok = Tg(nk);
    return mk.year = Jj.year.utc,
    Jj.scale.utc = function() {
        return Rg(Wg.scale.linear(), mk, ok)
    }
    ,
    Wg.text = rb(function(a) {
        return a.responseText
    }),
    Wg.json = function(a, b) {
        return sb(a, "application/json", Ug, b)
    }
    ,
    Wg.html = function(a, b) {
        return sb(a, "text/html", Vg, b)
    }
    ,
    Wg.xml = rb(function(a) {
        return a.responseXML
    }),
    Wg
}(),
"undefined" == typeof document ? (self._noTransferable = !0,
self.onmessage = function(e) {
    eval(e.data)
}
) : !function(a) {
    "use strict";
    function b() {
        var a, b = 0, c = G;
        for (G = []; a = c[b++]; )
            a()
    }
    function c() {
        function a() {
            this.then = function(a, c) {
                return b(a, c)
            }
        }
        var b = function(a, g, h) {
            if (a !== b) {
                var i = d();
                return b.queue.push({
                    deferred: i,
                    resolve: a,
                    reject: g
                }),
                i.promise
            }
            for (var j = g ? "resolve" : "reject", k = 0, l = b.queue.length; l > k; k++) {
                var m = b.queue[k]
                  , n = m.deferred
                  , o = m[j];
                typeof o !== H ? n[j](h) : f(o, h, n)
            }
            b = e(c, h, g)
        }
          , c = new a;
        this.promise = c,
        b.queue = [],
        this.resolve = function(a) {
            b.queue && b(b, !0, a)
        }
        ,
        this.fulfill = this.resolve,
        this.reject = function(a) {
            b.queue && b(b, !1, a)
        }
    }
    function d() {
        return new c
    }
    function e(a, b, c) {
        return function(e, g) {
            var h = c ? e : g;
            if (typeof h !== H)
                return a;
            var i = d();
            return f(h, b, i),
            i.promise
        }
    }
    function f(a, b, c) {
        z.nextTick(function() {
            try {
                var d = a(b);
                d && typeof d.then === H ? d.then(c.resolve, c.reject) : c.resolve(d)
            } catch (e) {
                c.reject(e)
            }
        })
    }
    function g(a) {
        for (var b = a, c = !0, d = {}, e = function(a, b) {
            b && "importScripts(" + b.split(",").forEach(function(a) {
                d[z.makeUrl(a.match(/\s*[\'\"](\S*)[\'\"]\s*/)[1])] = !0
            }) + ");\n"
        }; c; )
            c = b.match(/(importScripts\(.*?\);?)/),
            b = b.replace(/(importScripts\(\s*(?:[\'\"].*?[\'\"])?\s*\);?)/, "\n"),
            c && c[0].replace(/importScripts\(\s*([\'\"].*?[\'\"])?\s*\);?/g, e);
        return d = Object.keys(d),
        [d, b]
    }
    function h(a, b) {
        var c = g(a)
          , d = c[0]
          , e = c[1];
        return d.length > 0 ? "importScripts('" + d.join("','") + b + e : e
    }
    function i() {
        if ("undefined" != typeof SHIM_WORKER_PATH)
            return SHIM_WORKER_PATH;
        if ("SHIM_WORKER_PATH"in z)
            return z.SHIM_WORKER_PATH;
        for (var a = document.getElementsByTagName("script"), b = a.length, c = 0; b > c; ) {
            if (/catiline(\.min)?\.js/.test(a[c].src))
                return a[c].src;
            c++
        }
    }
    function j(a, b) {
        var c = a.createElement("script");
        "undefined" != typeof c.text ? c.text = b : c.innerHTML = b,
        "complete" === a.readyState ? a.documentElement.appendChild(c) : a.onreadystatechange = function() {
            "complete" === a.readyState && a.documentElement.appendChild(c)
        }
    }
    function k(a, b) {
        var c = document.createElement("iframe");
        c.style.display = "none",
        document.body.appendChild(c);
        var d = c.contentWindow.document
          , e = ["try{ ", "var __scripts__='';function importScripts(scripts){", "	if(Array.isArray(scripts)&&scripts.length>0){", "		scripts.forEach(function(url){", "			var ajax = new XMLHttpRequest();", "			ajax.open('GET',url,false);", "			ajax.send();__scripts__+=ajax.responseText;", "			__scripts__+='\\n;';", "		});", "	}", "};", a, "}catch(e){", "	window.parent.postMessage(['" + b + "','error'],'*')", "}"].join("\n");
        return j(d, e),
        c
    }
    function l(a, b) {
        var c = z.deferred();
        return "complete" === document.readyState ? c.resolve(k(a, b)) : window.addEventListener("load", function() {
            c.resolve(k(a, b))
        }, !1),
        c.promise
    }
    function m(a) {
        z._noTransferable = !0;
        var b = new Worker(i());
        return b.postMessage(a),
        b
    }
    function n(a) {
        var b = "{"
          , c = !0;
        for (var d in a)
            c ? c = !1 : b += ",",
            b += d,
            b += ":",
            b += z.stringify(a[d]);
        return b += "}"
    }
    function o(a) {
        if (a.length) {
            var b = "[";
            b += z.stringify(a[0]);
            for (var c = 0, d = a.length; ++c < d; )
                b += ",",
                b += z.stringify(a[c]);
            return b += "]"
        }
        return "[]"
    }
    function p(a, b) {
        var c, d = {};
        "undefined" != typeof __self__ ? c = __self__.postMessage : b && (c = b),
        a.on = function(b, c, e) {
            if (e = e || a,
            b.indexOf(" ") > 0)
                return b.split(" ").map(function(b) {
                    return a.on(b, c, e)
                }, this),
                a;
            b in d || (d[b] = []);
            var f = function(a) {
                c.call(e, a, e)
            };
            return f.orig = c,
            d[b].push(f),
            a
        }
        ,
        a.one = function(b, c, d) {
            function e(f) {
                a.off(b, e),
                c.call(d, f, d)
            }
            return d = d || a,
            a.on(b, e)
        }
        ,
        a.trigger = function(b, c) {
            return b.indexOf(" ") > 0 ? (b.split(" ").forEach(function(b) {
                a.trigger(b, c)
            }),
            a) : b in d ? (d[b].forEach(function(a) {
                a(c)
            }),
            a) : a
        }
        ,
        a.fire = function(b, d, e) {
            return c([[b], d], e),
            a
        }
        ,
        a.off = function(b, c) {
            return b.indexOf(" ") > 0 ? (b.split(" ").map(function(b) {
                return a.off(b, c)
            }),
            a) : b in d ? (c ? d[b] = d[b].map(function(a) {
                return a.orig === c ? !1 : a
            }).filter(function(a) {
                return a
            }) : delete d[b],
            a) : a
        }
    }
    function q(a) {
        if ("undefined" != typeof console) {
            var b = console[a[0]] ? a[0] : "log";
            "undefined" == typeof console[b].apply ? console[b](a[1].join(" ")) : console[b].apply(console, a[1])
        }
    }
    function r(a) {
        function b(b) {
            return function() {
                for (var c = arguments.length, d = [], e = 0; c > e; )
                    d.push(arguments[e]),
                    e++;
                a.fire("console", [b, d])
            }
        }
        ["log", "debug", "error", "info", "warn", "time", "timeEnd"].forEach(function(a) {
            console[a] = b(a)
        })
    }
    function s(a) {
        "function" == typeof a && (a = {
            data: a
        });
        var b = "com.catilinejs." + (s._hasWorker ? "iframe" : "worker") + Math.random()
          , c = this
          , d = [];
        p(c, function(a, b) {
            z._noTransferable ? l.postMessage(a) : l.postMessage(a, b)
        });
        var e = function(a) {
            "string" != typeof a && "preventDefault"in a && (a.preventDefault(),
            a = a.message),
            d.forEach(function(b) {
                b && b.reject(a)
            })
        };
        if (a.__codeWord__ = b,
        a.__initialize__ = [I, p, r],
        "initialize"in a ? a.__initialize__.push(a.initialize) : "init"in a && a.__initialize__.push(a.init),
        "events"in a || (a.events = {}),
        "listners"in a && "function" != typeof a.listners)
            for (var f in a.listners)
                c.on(f, a.listners[f]);
        var g = "var _db = {\n	"
          , h = function(a) {
            var c = function(c, e) {
                var f = d.length;
                return d[f] = z.deferred(),
                z._noTransferable ? l.postMessage([[b, f], a, c]) : l.postMessage([[b, f], a, c], e),
                d[f].promise
            };
            return c
        }
          , i = !1;
        for (var j in a)
            if (!(["listners", "initialize", "init"].indexOf(j) > -1))
                if (i ? g += ",\n	" : i = !0,
                "function" == typeof a[j])
                    g = g + j + ":" + a[j].toString(),
                    c[j] = h(j);
                else {
                    var k = z.stringify(a[j]);
                    "undefined" != typeof k && (g = g + j + ":" + k)
                }
        g += "};";
        var l = z.makeWorker(["'use strict';", "", g, "_db.__initialize__.forEach(function(f){", "	f.call(_db,_db);", "});", "for(var key in _db.events){", "	_db.on(key,_db.events[key]);", "}"], b);
        l.onmessage = function(a) {
            c.trigger("message", a.data[1]),
            a.data[0][0] === b ? (d[a.data[0][1]].resolve(a.data[1]),
            d[a.data[0][1]] = 0) : c.trigger(a.data[0][0], a.data[1])
        }
        ,
        c.on("error", e),
        l.onerror = function(a) {
            c.trigger("error", a)
        }
        ,
        c.on("console", q),
        c._close = function() {
            return l.terminate(),
            e("closed"),
            z.resolve()
        }
        ,
        "close"in c || (c.close = c._close)
    }
    function t(a, b) {
        return {
            keyFunc: function(b) {
                return function(c, d) {
                    return a(b, c, d)
                }
            },
            keyFuncBatch: function(b) {
                return function(c) {
                    return z.all(c.map(function(c) {
                        return a(b, c)
                    }))
                }
            },
            keyFuncBatchCB: function(c) {
                return function(d) {
                    return z.all(d.map(function(d) {
                        return a(c, d).then(b.__cb__)
                    }))
                }
            },
            keyFuncBatchTransfer: function(b) {
                return function(c) {
                    return z.all(c.map(function(c) {
                        return a(b, c[0], c[1])
                    }))
                }
            },
            keyFuncBatchTransferCB: function(c) {
                return function(d) {
                    return z.all(d.map(function(d) {
                        return a(c, d[0], d[1]).then(b.__cb__)
                    }))
                }
            }
        }
    }
    function u(a, b, c) {
        var d = t(a, b);
        for (var e in c)
            b[e] = d.keyFunc(e),
            b.batch[e] = d.keyFuncBatch(e),
            b.__batchcb__[e] = d.keyFuncBatchCB(e),
            b.batchTransfer[e] = d.keyFuncBatchTransfer(e),
            b.__batchtcb__[e] = d.keyFuncBatchTransferCB(e)
    }
    function v(a, b, c) {
        a.on = function(c, d, e) {
            return b.forEach(function(a) {
                a.on(c, d, e)
            }),
            a
        }
        ,
        a.off = function(c, d, e) {
            return b.forEach(function(a) {
                a.off(c, d, e)
            }),
            a
        }
        ,
        a.fire = function(d, e) {
            return b[~~(Math.random() * c)].fire(d, e),
            a
        }
    }
    function w(a, b) {
        return function(c, d, e, f) {
            return f.promise.cancel = function(a) {
                return f.reject(a)
            }
            ,
            a[~~(Math.random() * b)][c](d, e).then(function(a) {
                return f.resolve(a)
            }, function(a) {
                return f.reject(a)
            }),
            f.promise
        }
    }
    function x(a, b, c) {
        for (var d = [], e = -1; ++e < a; )
            d[e] = new z.Worker(c),
            b.push(e);
        return d
    }
    function y(a, b, c) {
        function d(a) {
            a = a || "canceled",
            k = 0;
            var b = j;
            return j = [],
            b.forEach(function(b) {
                b[3].reject(a)
            }),
            g
        }
        function e(a) {
            if (k) {
                var b = j.shift();
                k--,
                l[a][b[0]](b[1], b[2]).then(function(c) {
                    e(a),
                    b[3].resolve(c)
                }, function(c) {
                    e(a),
                    b[3].reject(c)
                })
            } else
                h++,
                i.push(a)
        }
        function f(a, b, d) {
            var f = z.deferred();
            if (c)
                return n(a, b, d, f);
            if (!k && h) {
                var g = i.pop();
                h--,
                f.promise.cancel = function(a) {
                    return f.reject(a)
                }
                ,
                l[g][a](b, d).then(function(a) {
                    e(g),
                    f.resolve(a)
                }, function(a) {
                    e(g),
                    f.reject(a)
                })
            } else if (k || !h) {
                var m = [a, b, d, f];
                f.promise.cancel = function(a) {
                    var b = j.indexOf(m);
                    return b > -1 && (j.splice(b, 1),
                    k--),
                    f.reject(a)
                }
                ,
                k = j.push(m)
            }
            return f.promise
        }
        var g = this
          , h = b
          , i = []
          , j = []
          , k = 0
          , l = x(b, i, a);
        v(g, l, b);
        var m = function(a, b) {
            return l.forEach(function(c) {
                c.fire(a, b)
            }),
            g
        };
        g.batch.fire = m,
        g.batchTransfer.fire = m,
        g.clearQueue = d,
        u(f, g, a);
        var n;
        c && (n = w(l, b)),
        g._close = function() {
            return z.all(l.map(function(a) {
                return a._close()
            }))
        }
        ,
        "close"in g || (g.close = g._close)
    }
    function z(a, b, c) {
        return 1 === arguments.length || !b || 1 >= b ? new z.Worker(a) : new z.Queue(a,b,c)
    }
    function A(b) {
        var c = a.cw;
        b.noConflict = function(d) {
            a.cw = c,
            d && (a[d] = b)
        }
        ,
        a.catiline = b,
        a.cw = b,
        "communist"in a || (a.communist = b)
    }
    var B, C = a.MutationObserver || a.WebKitMutationObserver;
    if (C) {
        var D = new C(b)
          , E = document.createElement("div");
        D.observe(E, {
            attributes: !0
        }),
        addEventListener("unload", function() {
            D.disconnect(),
            D = null
        }, !1),
        B = function() {
            E.setAttribute("drainQueue", "drainQueue")
        }
    } else {
        var F = "com.catiline.setImmediate" + Math.random();
        addEventListener("message", function(a) {
            a.source === window && a.data === F && b()
        }, !1),
        B = function() {
            postMessage(F, "*")
        }
    }
    var G = [];
    z.nextTick = function(a) {
        1 === G.push(a) && B()
    }
    ;
    var H = "function";
    z.deferred = d,
    z.resolve = function(a) {
        var b = {};
        return b.then = e(b, a, !0),
        b
    }
    ,
    z.reject = function(a) {
        var b = {};
        return b.then = e(b, a, !1),
        b
    }
    ,
    z.all = function(a) {
        var b = d()
          , c = a.length
          , e = 0
          , f = []
          , g = function(a) {
            return function(d) {
                f[a] = d,
                e++,
                e === c && b.resolve(f)
            }
        };
        return a.forEach(function(a, c) {
            a.then(g(c), function(a) {
                b.reject(a)
            })
        }),
        b.promise
    }
    ,
    z._hasWorker = "undefined" != typeof Worker && "undefined" == typeof fakeLegacy,
    z.URL = window.URL || window.webkitURL,
    z._noTransferable = !z.URL,
    z.makeIWorker = function(a, b) {
        var c = h(a.join(""), "');eval(__scripts__);\n")
          , d = {
            onmessage: function() {}
        }
          , e = l(c, b);
        return window.addEventListener("message", function(a) {
            a.data.slice && a.data.slice(0, b.length) === b && d.onmessage({
                data: JSON.parse(a.data.slice(b.length))
            })
        }),
        d.postMessage = function(a) {
            e.then(function(b) {
                b.contentWindow.postMessage(JSON.stringify(a), "*")
            })
        }
        ,
        d.terminate = function() {
            e.then(function(a) {
                document.body.removeChild(a)
            })
        }
        ,
        d
    }
    ,
    z.makeWorker = function(a, b) {
        if (!z._hasWorker)
            return z.makeIWorker(a, b);
        var c, d = h(a.join("\n"), "');\n");
        if (z._noTransferable)
            return m(d);
        try {
            c = new Worker(z.URL.createObjectURL(new Blob([d],{
                type: "text/javascript"
            })))
        } catch (e) {
            try {
                c = m(d)
            } catch (f) {
                c = z.makeIWorker(a, b)
            }
        } finally {
            return c
        }
    }
    ,
    z.makeUrl = function(a) {
        var b = document.createElement("link");
        return b.href = a,
        b.href
    }
    ,
    z.stringify = function(a) {
        return Array.isArray(a) ? o(a) : "function" == typeof a || "number" == typeof a || "boolean" == typeof a ? a.toString() : "string" == typeof a ? '"' + a + '"' : "[object Object]" === a.toString() ? n(a) : void 0
    }
    ;
    var I = function(a) {
        self.__iFrame__ = "undefined" != typeof document,
        self.__self__ = {
            onmessage: function(c) {
                return a.trigger("messege", c.data[1]),
                c.data[0][0] === a.__codeWord__ ? b(c) : (a.trigger(c.data[0][0], c.data[1]),
                void 0)
            }
        },
        __iFrame__ ? window.onmessage = function(a) {
            "string" == typeof a.data && (a = {
                data: JSON.parse(a.data)
            }),
            __self__.onmessage(a)
        }
        : self.onmessage = __self__.onmessage,
        __self__.postMessage = function(b, c) {
            if (self._noTransferable || __iFrame__)
                if (__iFrame__) {
                    var d = a.__codeWord__ + JSON.stringify(b);
                    window.parent.postMessage(d, "*")
                } else
                    self._noTransferable && self.postMessage(b);
            else
                self.postMessage(b, c)
        }
        ,
        self.console = {};
        var b = function(b) {
            var c, d = function(a, c) {
                __self__.postMessage([b.data[0], a], c)
            };
            if (__iFrame__)
                try {
                    c = a[b.data[1]](b.data[2], d, a)
                } catch (e) {
                    a.fire("error", JSON.stringify(e))
                }
            else
                c = a[b.data[1]](b.data[2], d, a);
            "undefined" != typeof c && d(c)
        }
    };
    z.Worker = s,
    z.worker = function(a) {
        return new s(a)
    }
    ,
    y.prototype.__batchcb__ = {},
    y.prototype.__batchtcb__ = {},
    y.prototype.batch = function(a) {
        return "function" == typeof a ? (this.__cb__ = a,
        this.__batchcb__) : this.clearQueue(a)
    }
    ,
    y.prototype.batchTransfer = function(a) {
        return "function" == typeof a ? (this.__batchtcb__.__cb__ = a,
        this.__batchtcb__) : this.clearQueue(a)
    }
    ,
    z.Queue = y,
    z.queue = function(a, b, c) {
        return new z.Queue(a,b,c)
    }
    ,
    z.setImmediate = z.nextTick,
    "function" == typeof define ? define(function(a) {
        return z.SHIM_WORKER_PATH = a.toUrl("./catiline.js"),
        z
    }) : "undefined" != typeof module && "exports"in module ? module.exports = z : A(z),
    z.version = "2.9.3"
}(this);
var dat = dat || {};
dat.gui = dat.gui || {},
dat.utils = dat.utils || {},
dat.controllers = dat.controllers || {},
dat.dom = dat.dom || {},
dat.color = dat.color || {},
dat.utils.css = function() {
    return {
        load: function(a, b) {
            b = b || document;
            var c = b.createElement("link");
            c.type = "text/css",
            c.rel = "stylesheet",
            c.href = a,
            b.getElementsByTagName("head")[0].appendChild(c)
        },
        inject: function(a, b) {
            b = b || document;
            var c = document.createElement("style");
            c.type = "text/css",
            c.innerHTML = a,
            b.getElementsByTagName("head")[0].appendChild(c)
        }
    }
}(),
dat.utils.common = function() {
    var a = Array.prototype.forEach
      , b = Array.prototype.slice;
    return {
        BREAK: {},
        extend: function(a) {
            return this.each(b.call(arguments, 1), function(b) {
                for (var c in b)
                    this.isUndefined(b[c]) || (a[c] = b[c])
            }, this),
            a
        },
        defaults: function(a) {
            return this.each(b.call(arguments, 1), function(b) {
                for (var c in b)
                    this.isUndefined(a[c]) && (a[c] = b[c])
            }, this),
            a
        },
        compose: function() {
            var a = b.call(arguments);
            return function() {
                for (var c = b.call(arguments), d = a.length - 1; d >= 0; d--)
                    c = [a[d].apply(this, c)];
                return c[0]
            }
        },
        each: function(b, c, d) {
            if (a && b.forEach === a)
                b.forEach(c, d);
            else if (b.length === b.length + 0) {
                for (var e = 0, f = b.length; f > e; e++)
                    if (e in b && c.call(d, b[e], e) === this.BREAK)
                        return
            } else
                for (var e in b)
                    if (c.call(d, b[e], e) === this.BREAK)
                        return
        },
        defer: function(a) {
            setTimeout(a, 0)
        },
        toArray: function(a) {
            return a.toArray ? a.toArray() : b.call(a)
        },
        isUndefined: function(a) {
            return void 0 === a
        },
        isNull: function(a) {
            return null === a
        },
        isNaN: function(a) {
            return a !== a
        },
        isArray: Array.isArray || function(a) {
            return a.constructor === Array
        }
        ,
        isObject: function(a) {
            return a === Object(a)
        },
        isNumber: function(a) {
            return a === a + 0
        },
        isString: function(a) {
            return a === a + ""
        },
        isBoolean: function(a) {
            return a === !1 || a === !0
        },
        isFunction: function(a) {
            return "[object Function]" === Object.prototype.toString.call(a)
        }
    }
}(),
dat.controllers.Controller = function(a) {
    var b = function(a, b) {
        this.initialValue = a[b],
        this.domElement = document.createElement("div"),
        this.object = a,
        this.property = b,
        this.__onChange = void 0,
        this.__onFinishChange = void 0
    };
    return a.extend(b.prototype, {
        onChange: function(a) {
            return this.__onChange = a,
            this
        },
        onFinishChange: function(a) {
            return this.__onFinishChange = a,
            this
        },
        setValue: function(a) {
            return this.object[this.property] = a,
            this.__onChange && this.__onChange.call(this, a),
            this.updateDisplay(),
            this
        },
        getValue: function() {
            return this.object[this.property]
        },
        updateDisplay: function() {
            return this
        },
        isModified: function() {
            return this.initialValue !== this.getValue()
        }
    }),
    b
}(dat.utils.common),
dat.dom.dom = function(a) {
    function b(b) {
        if ("0" === b || a.isUndefined(b))
            return 0;
        var c = b.match(e);
        return a.isNull(c) ? 0 : parseFloat(c[1])
    }
    var c = {
        HTMLEvents: ["change"],
        MouseEvents: ["click", "mousemove", "mousedown", "mouseup", "mouseover"],
        KeyboardEvents: ["keydown"]
    }
      , d = {};
    a.each(c, function(b, c) {
        a.each(b, function(a) {
            d[a] = c
        })
    });
    var e = /(\d+(\.\d+)?)px/
      , f = {
        makeSelectable: function(a, b) {
            void 0 !== a && void 0 !== a.style && (a.onselectstart = b ? function() {
                return !1
            }
            : function() {}
            ,
            a.style.MozUserSelect = b ? "auto" : "none",
            a.style.KhtmlUserSelect = b ? "auto" : "none",
            a.unselectable = b ? "on" : "off")
        },
        makeFullscreen: function(b, c, d) {
            a.isUndefined(c) && (c = !0),
            a.isUndefined(d) && (d = !0),
            b.style.position = "absolute",
            c && (b.style.left = 0,
            b.style.right = 0),
            d && (b.style.top = 0,
            b.style.bottom = 0)
        },
        fakeEvent: function(b, c, e, f) {
            e = e || {};
            var g = d[c];
            if (!g)
                throw new Error("Event type " + c + " not supported.");
            var h = document.createEvent(g);
            switch (g) {
            case "MouseEvents":
                var i = e.x || e.clientX || 0
                  , j = e.y || e.clientY || 0;
                h.initMouseEvent(c, e.bubbles || !1, e.cancelable || !0, window, e.clickCount || 1, 0, 0, i, j, !1, !1, !1, !1, 0, null);
                break;
            case "KeyboardEvents":
                var k = h.initKeyboardEvent || h.initKeyEvent;
                a.defaults(e, {
                    cancelable: !0,
                    ctrlKey: !1,
                    altKey: !1,
                    shiftKey: !1,
                    metaKey: !1,
                    keyCode: void 0,
                    charCode: void 0
                }),
                k(c, e.bubbles || !1, e.cancelable, window, e.ctrlKey, e.altKey, e.shiftKey, e.metaKey, e.keyCode, e.charCode);
                break;
            default:
                h.initEvent(c, e.bubbles || !1, e.cancelable || !0)
            }
            a.defaults(h, f),
            b.dispatchEvent(h)
        },
        bind: function(a, b, c, d) {
            return d = d || !1,
            a.addEventListener ? a.addEventListener(b, c, d) : a.attachEvent && a.attachEvent("on" + b, c),
            f
        },
        unbind: function(a, b, c, d) {
            return d = d || !1,
            a.removeEventListener ? a.removeEventListener(b, c, d) : a.detachEvent && a.detachEvent("on" + b, c),
            f
        },
        addClass: function(a, b) {
            if (void 0 === a.className)
                a.className = b;
            else if (a.className !== b) {
                var c = a.className.split(/ +/);
                -1 == c.indexOf(b) && (c.push(b),
                a.className = c.join(" ").replace(/^\s+/, "").replace(/\s+$/, ""))
            }
            return f
        },
        removeClass: function(a, b) {
            if (b)
                if (void 0 === a.className)
                    ;
                else if (a.className === b)
                    a.removeAttribute("class");
                else {
                    var c = a.className.split(/ +/)
                      , d = c.indexOf(b);
                    -1 != d && (c.splice(d, 1),
                    a.className = c.join(" "))
                }
            else
                a.className = void 0;
            return f
        },
        hasClass: function(a, b) {
            return new RegExp("(?:^|\\s+)" + b + "(?:\\s+|$)").test(a.className) || !1
        },
        getWidth: function(a) {
            var c = getComputedStyle(a);
            return b(c["border-left-width"]) + b(c["border-right-width"]) + b(c["padding-left"]) + b(c["padding-right"]) + b(c.width)
        },
        getHeight: function(a) {
            var c = getComputedStyle(a);
            return b(c["border-top-width"]) + b(c["border-bottom-width"]) + b(c["padding-top"]) + b(c["padding-bottom"]) + b(c.height)
        },
        getOffset: function(a) {
            var b = {
                left: 0,
                top: 0
            };
            if (a.offsetParent)
                do
                    b.left += a.offsetLeft,
                    b.top += a.offsetTop;
                while (a = a.offsetParent);return b
        },
        isActive: function(a) {
            return a === document.activeElement && (a.type || a.href)
        }
    };
    return f
}(dat.utils.common),
dat.controllers.OptionController = function(a, b, c) {
    var d = function(a, e, f) {
        d.superclass.call(this, a, e);
        var g = this;
        if (this.__select = document.createElement("select"),
        c.isArray(f)) {
            var h = {};
            c.each(f, function(a) {
                h[a] = a
            }),
            f = h
        }
        c.each(f, function(a, b) {
            var c = document.createElement("option");
            c.innerHTML = b,
            c.setAttribute("value", a),
            g.__select.appendChild(c)
        }),
        this.updateDisplay(),
        b.bind(this.__select, "change", function() {
            var a = this.options[this.selectedIndex].value;
            g.setValue(a)
        }),
        this.domElement.appendChild(this.__select)
    };
    return d.superclass = a,
    c.extend(d.prototype, a.prototype, {
        setValue: function(a) {
            var b = d.superclass.prototype.setValue.call(this, a);
            return this.__onFinishChange && this.__onFinishChange.call(this, this.getValue()),
            b
        },
        updateDisplay: function() {
            return this.__select.value = this.getValue(),
            d.superclass.prototype.updateDisplay.call(this)
        }
    }),
    d
}(dat.controllers.Controller, dat.dom.dom, dat.utils.common),
dat.controllers.NumberController = function(a, b) {
    function c(a) {
        return a = a.toString(),
        a.indexOf(".") > -1 ? a.length - a.indexOf(".") - 1 : 0
    }
    var d = function(a, e, f) {
        d.superclass.call(this, a, e),
        f = f || {},
        this.__min = f.min,
        this.__max = f.max,
        this.__step = f.step,
        this.__impliedStep = b.isUndefined(this.__step) ? 0 == this.initialValue ? 1 : Math.pow(10, Math.floor(Math.log(this.initialValue) / Math.LN10)) / 10 : this.__step,
        this.__precision = c(this.__impliedStep)
    };
    return d.superclass = a,
    b.extend(d.prototype, a.prototype, {
        setValue: function(a) {
            return void 0 !== this.__min && a < this.__min ? a = this.__min : void 0 !== this.__max && a > this.__max && (a = this.__max),
            void 0 !== this.__step && a % this.__step != 0 && (a = Math.round(a / this.__step) * this.__step),
            d.superclass.prototype.setValue.call(this, a)
        },
        min: function(a) {
            return this.__min = a,
            this
        },
        max: function(a) {
            return this.__max = a,
            this
        },
        step: function(a) {
            return this.__step = a,
            this
        }
    }),
    d
}(dat.controllers.Controller, dat.utils.common),
dat.controllers.NumberControllerBox = function(a, b, c) {
    function d(a, b) {
        var c = Math.pow(10, b);
        return Math.round(a * c) / c
    }
    var e = function(a, d, f) {
        function g() {
            var a = parseFloat(m.__input.value);
            c.isNaN(a) || m.setValue(a)
        }
        function h() {
            g(),
            m.__onFinishChange && m.__onFinishChange.call(m, m.getValue())
        }
        function i(a) {
            b.bind(window, "mousemove", j),
            b.bind(window, "mouseup", k),
            l = a.clientY
        }
        function j(a) {
            var b = l - a.clientY;
            m.setValue(m.getValue() + b * m.__impliedStep),
            l = a.clientY
        }
        function k() {
            b.unbind(window, "mousemove", j),
            b.unbind(window, "mouseup", k)
        }
        this.__truncationSuspended = !1,
        e.superclass.call(this, a, d, f);
        var l, m = this;
        this.__input = document.createElement("input"),
        this.__input.setAttribute("type", "text"),
        b.bind(this.__input, "change", g),
        b.bind(this.__input, "blur", h),
        b.bind(this.__input, "mousedown", i),
        b.bind(this.__input, "keydown", function(a) {
            13 === a.keyCode && (m.__truncationSuspended = !0,
            this.blur(),
            m.__truncationSuspended = !1)
        }),
        this.updateDisplay(),
        this.domElement.appendChild(this.__input)
    };
    return e.superclass = a,
    c.extend(e.prototype, a.prototype, {
        updateDisplay: function() {
            return this.__input.value = this.__truncationSuspended ? this.getValue() : d(this.getValue(), this.__precision),
            e.superclass.prototype.updateDisplay.call(this)
        }
    }),
    e
}(dat.controllers.NumberController, dat.dom.dom, dat.utils.common),
dat.controllers.NumberControllerSlider = function(a, b, c, d, e) {
    function f(a, b, c, d, e) {
        return d + (e - d) * ((a - b) / (c - b))
    }
    var g = function(a, c, d, e, h) {
        function i(a) {
            b.bind(window, "mousemove", j),
            b.bind(window, "mouseup", k),
            j(a)
        }
        function j(a) {
            a.preventDefault();
            var c = b.getOffset(l.__background)
              , d = b.getWidth(l.__background);
            return l.setValue(f(a.clientX, c.left, c.left + d, l.__min, l.__max)),
            !1
        }
        function k() {
            b.unbind(window, "mousemove", j),
            b.unbind(window, "mouseup", k),
            l.__onFinishChange && l.__onFinishChange.call(l, l.getValue())
        }
        g.superclass.call(this, a, c, {
            min: d,
            max: e,
            step: h
        });
        var l = this;
        this.__background = document.createElement("div"),
        this.__foreground = document.createElement("div"),
        b.bind(this.__background, "mousedown", i),
        b.addClass(this.__background, "slider"),
        b.addClass(this.__foreground, "slider-fg"),
        this.updateDisplay(),
        this.__background.appendChild(this.__foreground),
        this.domElement.appendChild(this.__background)
    };
    return g.superclass = a,
    g.useDefaultStyles = function() {
        c.inject(e)
    }
    ,
    d.extend(g.prototype, a.prototype, {
        updateDisplay: function() {
            var a = (this.getValue() - this.__min) / (this.__max - this.__min);
            return this.__foreground.style.width = 100 * a + "%",
            g.superclass.prototype.updateDisplay.call(this)
        }
    }),
    g
}(dat.controllers.NumberController, dat.dom.dom, dat.utils.css, dat.utils.common, ".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),
dat.controllers.FunctionController = function(a, b, c) {
    var d = function(a, c, e) {
        d.superclass.call(this, a, c);
        var f = this;
        this.__button = document.createElement("div"),
        this.__button.innerHTML = void 0 === e ? "Fire" : e,
        b.bind(this.__button, "click", function(a) {
            return a.preventDefault(),
            f.fire(),
            !1
        }),
        b.addClass(this.__button, "button"),
        this.domElement.appendChild(this.__button)
    };
    return d.superclass = a,
    c.extend(d.prototype, a.prototype, {
        fire: function() {
            this.__onChange && this.__onChange.call(this),
            this.__onFinishChange && this.__onFinishChange.call(this, this.getValue()),
            this.getValue().call(this.object)
        }
    }),
    d
}(dat.controllers.Controller, dat.dom.dom, dat.utils.common),
dat.controllers.BooleanController = function(a, b, c) {
    var d = function(a, c) {
        function e() {
            f.setValue(!f.__prev)
        }
        d.superclass.call(this, a, c);
        var f = this;
        this.__prev = this.getValue(),
        this.__checkbox = document.createElement("input"),
        this.__checkbox.setAttribute("type", "checkbox"),
        b.bind(this.__checkbox, "change", e, !1),
        this.domElement.appendChild(this.__checkbox),
        this.updateDisplay()
    };
    return d.superclass = a,
    c.extend(d.prototype, a.prototype, {
        setValue: function(a) {
            var b = d.superclass.prototype.setValue.call(this, a);
            return this.__onFinishChange && this.__onFinishChange.call(this, this.getValue()),
            this.__prev = this.getValue(),
            b
        },
        updateDisplay: function() {
            return this.getValue() === !0 ? (this.__checkbox.setAttribute("checked", "checked"),
            this.__checkbox.checked = !0) : this.__checkbox.checked = !1,
            d.superclass.prototype.updateDisplay.call(this)
        }
    }),
    d
}(dat.controllers.Controller, dat.dom.dom, dat.utils.common),
dat.color.toString = function(a) {
    return function(b) {
        if (1 == b.a || a.isUndefined(b.a)) {
            for (var c = b.hex.toString(16); c.length < 6; )
                c = "0" + c;
            return "#" + c
        }
        return "rgba(" + Math.round(b.r) + "," + Math.round(b.g) + "," + Math.round(b.b) + "," + b.a + ")"
    }
}(dat.utils.common),
dat.color.interpret = function(a, b) {
    var c, d, e = function() {
        d = !1;
        var a = arguments.length > 1 ? b.toArray(arguments) : arguments[0];
        return b.each(f, function(e) {
            return e.litmus(a) ? (b.each(e.conversions, function(e, f) {
                return c = e.read(a),
                d === !1 && c !== !1 ? (d = c,
                c.conversionName = f,
                c.conversion = e,
                b.BREAK) : void 0
            }),
            b.BREAK) : void 0
        }),
        d
    }, f = [{
        litmus: b.isString,
        conversions: {
            THREE_CHAR_HEX: {
                read: function(a) {
                    var b = a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);
                    return null === b ? !1 : {
                        space: "HEX",
                        hex: parseInt("0x" + b[1].toString() + b[1].toString() + b[2].toString() + b[2].toString() + b[3].toString() + b[3].toString())
                    }
                },
                write: a
            },
            SIX_CHAR_HEX: {
                read: function(a) {
                    var b = a.match(/^#([A-F0-9]{6})$/i);
                    return null === b ? !1 : {
                        space: "HEX",
                        hex: parseInt("0x" + b[1].toString())
                    }
                },
                write: a
            },
            CSS_RGB: {
                read: function(a) {
                    var b = a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
                    return null === b ? !1 : {
                        space: "RGB",
                        r: parseFloat(b[1]),
                        g: parseFloat(b[2]),
                        b: parseFloat(b[3])
                    }
                },
                write: a
            },
            CSS_RGBA: {
                read: function(a) {
                    var b = a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);
                    return null === b ? !1 : {
                        space: "RGB",
                        r: parseFloat(b[1]),
                        g: parseFloat(b[2]),
                        b: parseFloat(b[3]),
                        a: parseFloat(b[4])
                    }
                },
                write: a
            }
        }
    }, {
        litmus: b.isNumber,
        conversions: {
            HEX: {
                read: function(a) {
                    return {
                        space: "HEX",
                        hex: a,
                        conversionName: "HEX"
                    }
                },
                write: function(a) {
                    return a.hex
                }
            }
        }
    }, {
        litmus: b.isArray,
        conversions: {
            RGB_ARRAY: {
                read: function(a) {
                    return 3 != a.length ? !1 : {
                        space: "RGB",
                        r: a[0],
                        g: a[1],
                        b: a[2]
                    }
                },
                write: function(a) {
                    return [a.r, a.g, a.b]
                }
            },
            RGBA_ARRAY: {
                read: function(a) {
                    return 4 != a.length ? !1 : {
                        space: "RGB",
                        r: a[0],
                        g: a[1],
                        b: a[2],
                        a: a[3]
                    }
                },
                write: function(a) {
                    return [a.r, a.g, a.b, a.a]
                }
            }
        }
    }, {
        litmus: b.isObject,
        conversions: {
            RGBA_OBJ: {
                read: function(a) {
                    return b.isNumber(a.r) && b.isNumber(a.g) && b.isNumber(a.b) && b.isNumber(a.a) ? {
                        space: "RGB",
                        r: a.r,
                        g: a.g,
                        b: a.b,
                        a: a.a
                    } : !1
                },
                write: function(a) {
                    return {
                        r: a.r,
                        g: a.g,
                        b: a.b,
                        a: a.a
                    }
                }
            },
            RGB_OBJ: {
                read: function(a) {
                    return b.isNumber(a.r) && b.isNumber(a.g) && b.isNumber(a.b) ? {
                        space: "RGB",
                        r: a.r,
                        g: a.g,
                        b: a.b
                    } : !1
                },
                write: function(a) {
                    return {
                        r: a.r,
                        g: a.g,
                        b: a.b
                    }
                }
            },
            HSVA_OBJ: {
                read: function(a) {
                    return b.isNumber(a.h) && b.isNumber(a.s) && b.isNumber(a.v) && b.isNumber(a.a) ? {
                        space: "HSV",
                        h: a.h,
                        s: a.s,
                        v: a.v,
                        a: a.a
                    } : !1
                },
                write: function(a) {
                    return {
                        h: a.h,
                        s: a.s,
                        v: a.v,
                        a: a.a
                    }
                }
            },
            HSV_OBJ: {
                read: function(a) {
                    return b.isNumber(a.h) && b.isNumber(a.s) && b.isNumber(a.v) ? {
                        space: "HSV",
                        h: a.h,
                        s: a.s,
                        v: a.v
                    } : !1
                },
                write: function(a) {
                    return {
                        h: a.h,
                        s: a.s,
                        v: a.v
                    }
                }
            }
        }
    }];
    return e
}(dat.color.toString, dat.utils.common),
dat.GUI = dat.gui.GUI = function(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o) {
    function p(a, b, c, f) {
        if (void 0 === b[c])
            throw new Error("Object " + b + ' has no property "' + c + '"');
        var g;
        if (f.color)
            g = new k(b,c);
        else {
            var h = [b, c].concat(f.factoryArgs);
            g = d.apply(a, h)
        }
        f.before instanceof e && (f.before = f.before.__li),
        s(a, g),
        n.addClass(g.domElement, "c");
        var i = document.createElement("span");
        n.addClass(i, "property-name"),
        i.innerHTML = g.property;
        var j = document.createElement("div");
        j.appendChild(i),
        j.appendChild(g.domElement);
        var l = q(a, j, f.before);
        return n.addClass(l, M.CLASS_CONTROLLER_ROW),
        n.addClass(l, typeof g.getValue()),
        r(a, l, g),
        a.__controllers.push(g),
        g
    }
    function q(a, b, c) {
        var d = document.createElement("li");
        return b && d.appendChild(b),
        c ? a.__ul.insertBefore(d, params.before) : a.__ul.appendChild(d),
        a.onResize(),
        d
    }
    function r(a, b, c) {
        if (c.__li = b,
        c.__gui = a,
        o.extend(c, {
            options: function(b) {
                return arguments.length > 1 ? (c.remove(),
                p(a, c.object, c.property, {
                    before: c.__li.nextElementSibling,
                    factoryArgs: [o.toArray(arguments)]
                })) : o.isArray(b) || o.isObject(b) ? (c.remove(),
                p(a, c.object, c.property, {
                    before: c.__li.nextElementSibling,
                    factoryArgs: [b]
                })) : void 0
            },
            name: function(a) {
                return c.__li.firstElementChild.firstElementChild.innerHTML = a,
                c
            },
            listen: function() {
                return c.__gui.listen(c),
                c
            },
            remove: function() {
                return c.__gui.remove(c),
                c
            }
        }),
        c instanceof i) {
            var d = new h(c.object,c.property,{
                min: c.__min,
                max: c.__max,
                step: c.__step
            });
            o.each(["updateDisplay", "onChange", "onFinishChange"], function(a) {
                var b = c[a]
                  , e = d[a];
                c[a] = d[a] = function() {
                    var a = Array.prototype.slice.call(arguments);
                    return b.apply(c, a),
                    e.apply(d, a)
                }
            }),
            n.addClass(b, "has-slider"),
            c.domElement.insertBefore(d.domElement, c.domElement.firstElementChild)
        } else if (c instanceof h) {
            var e = function(b) {
                return o.isNumber(c.__min) && o.isNumber(c.__max) ? (c.remove(),
                p(a, c.object, c.property, {
                    before: c.__li.nextElementSibling,
                    factoryArgs: [c.__min, c.__max, c.__step]
                })) : b
            };
            c.min = o.compose(e, c.min),
            c.max = o.compose(e, c.max)
        } else
            c instanceof f ? (n.bind(b, "click", function() {
                n.fakeEvent(c.__checkbox, "click")
            }),
            n.bind(c.__checkbox, "click", function(a) {
                a.stopPropagation()
            })) : c instanceof g ? (n.bind(b, "click", function() {
                n.fakeEvent(c.__button, "click")
            }),
            n.bind(b, "mouseover", function() {
                n.addClass(c.__button, "hover")
            }),
            n.bind(b, "mouseout", function() {
                n.removeClass(c.__button, "hover")
            })) : c instanceof k && (n.addClass(b, "color"),
            c.updateDisplay = o.compose(function(a) {
                return b.style.borderLeftColor = c.__color.toString(),
                a
            }, c.updateDisplay),
            c.updateDisplay());
        c.setValue = o.compose(function(b) {
            return a.getRoot().__preset_select && c.isModified() && A(a.getRoot(), !0),
            b
        }, c.setValue)
    }
    function s(a, b) {
        var c = a.getRoot()
          , d = c.__rememberedObjects.indexOf(b.object);
        if (-1 != d) {
            var e = c.__rememberedObjectIndecesToControllers[d];
            if (void 0 === e && (e = {},
            c.__rememberedObjectIndecesToControllers[d] = e),
            e[b.property] = b,
            c.load && c.load.remembered) {
                var f, g = c.load.remembered;
                if (g[a.preset])
                    f = g[a.preset];
                else {
                    if (!g[H])
                        return;
                    f = g[H]
                }
                if (f[d] && void 0 !== f[d][b.property]) {
                    var h = f[d][b.property];
                    b.initialValue = h,
                    b.setValue(h)
                }
            }
        }
    }
    function t(a, b) {
        return document.location.href + "." + b
    }
    function u(a) {
        function b() {
            j.style.display = a.useLocalStorage ? "block" : "none"
        }
        var c = a.__save_row = document.createElement("li");
        n.addClass(a.domElement, "has-save"),
        a.__ul.insertBefore(c, a.__ul.firstChild),
        n.addClass(c, "save-row");
        var d = document.createElement("span");
        d.innerHTML = "&nbsp;",
        n.addClass(d, "button gears");
        var e = document.createElement("span");
        e.innerHTML = "Save",
        n.addClass(e, "button"),
        n.addClass(e, "save");
        var f = document.createElement("span");
        f.innerHTML = "New",
        n.addClass(f, "button"),
        n.addClass(f, "save-as");
        var g = document.createElement("span");
        g.innerHTML = "Revert",
        n.addClass(g, "button"),
        n.addClass(g, "revert");
        var h = a.__preset_select = document.createElement("select");
        if (a.load && a.load.remembered ? o.each(a.load.remembered, function(b, c) {
            y(a, c, c == a.preset)
        }) : y(a, H, !1),
        n.bind(h, "change", function() {
            for (var b = 0; b < a.__preset_select.length; b++)
                a.__preset_select[b].innerHTML = a.__preset_select[b].value;
            a.preset = this.value
        }),
        c.appendChild(h),
        c.appendChild(d),
        c.appendChild(e),
        c.appendChild(f),
        c.appendChild(g),
        I) {
            var i = document.getElementById("dg-save-locally")
              , j = document.getElementById("dg-local-explain");
            i.style.display = "block";
            var k = document.getElementById("dg-local-storage");
            "true" === localStorage.getItem(t(a, "isLocal")) && k.setAttribute("checked", "checked"),
            b(),
            n.bind(k, "change", function() {
                a.useLocalStorage = !a.useLocalStorage,
                b()
            })
        }
        var l = document.getElementById("dg-new-constructor");
        n.bind(l, "keydown", function(a) {
            !a.metaKey || 67 !== a.which && 67 != a.keyCode || C.hide()
        }),
        n.bind(d, "click", function() {
            l.innerHTML = JSON.stringify(a.getSaveObject(), void 0, 2),
            C.show(),
            l.focus(),
            l.select()
        }),
        n.bind(e, "click", function() {
            a.save()
        }),
        n.bind(f, "click", function() {
            var b = prompt("Enter a new preset name.");
            b && a.saveAs(b)
        }),
        n.bind(g, "click", function() {
            a.revert()
        })
    }
    function v(a) {
        function b(b) {
            return b.preventDefault(),
            e = b.clientX,
            n.addClass(a.__closeButton, M.CLASS_DRAG),
            n.bind(window, "mousemove", c),
            n.bind(window, "mouseup", d),
            !1
        }
        function c(b) {
            return b.preventDefault(),
            a.width += e - b.clientX,
            a.onResize(),
            e = b.clientX,
            !1
        }
        function d() {
            n.removeClass(a.__closeButton, M.CLASS_DRAG),
            n.unbind(window, "mousemove", c),
            n.unbind(window, "mouseup", d)
        }
        a.__resize_handle = document.createElement("div"),
        o.extend(a.__resize_handle.style, {
            width: "6px",
            marginLeft: "-3px",
            height: "200px",
            cursor: "ew-resize",
            position: "absolute"
        });
        var e;
        n.bind(a.__resize_handle, "mousedown", b),
        n.bind(a.__closeButton, "mousedown", b),
        a.domElement.insertBefore(a.__resize_handle, a.domElement.firstElementChild)
    }
    function w(a, b) {
        a.domElement.style.width = b + "px",
        a.__save_row && a.autoPlace && (a.__save_row.style.width = b + "px"),
        a.__closeButton && (a.__closeButton.style.width = b + "px")
    }
    function x(a, b) {
        var c = {};
        return o.each(a.__rememberedObjects, function(d, e) {
            var f = {}
              , g = a.__rememberedObjectIndecesToControllers[e];
            o.each(g, function(a, c) {
                f[c] = b ? a.initialValue : a.getValue()
            }),
            c[e] = f
        }),
        c
    }
    function y(a, b, c) {
        var d = document.createElement("option");
        d.innerHTML = b,
        d.value = b,
        a.__preset_select.appendChild(d),
        c && (a.__preset_select.selectedIndex = a.__preset_select.length - 1)
    }
    function z(a) {
        for (var b = 0; b < a.__preset_select.length; b++)
            a.__preset_select[b].value == a.preset && (a.__preset_select.selectedIndex = b)
    }
    function A(a, b) {
        var c = a.__preset_select[a.__preset_select.selectedIndex];
        c.innerHTML = b ? c.value + "*" : c.value
    }
    function B(a) {
        0 != a.length && l(function() {
            B(a)
        }),
        o.each(a, function(a) {
            a.updateDisplay()
        })
    }
    a.inject(c);
    var C, D, E = "dg", F = 72, G = 20, H = "Default", I = function() {
        try {
            return "localStorage"in window && null !== window.localStorage
        } catch (a) {
            return !1
        }
    }(), J = !0, K = !1, L = [], M = function(a) {
        function b() {
            localStorage.setItem(t(d, "gui"), JSON.stringify(d.getSaveObject()))
        }
        function c() {
            var a = d.getRoot();
            a.width += 1,
            o.defer(function() {
                a.width -= 1
            })
        }
        var d = this;
        this.domElement = document.createElement("div"),
        this.__ul = document.createElement("ul"),
        this.domElement.appendChild(this.__ul),
        n.addClass(this.domElement, E),
        this.__folders = {},
        this.__controllers = [],
        this.__rememberedObjects = [],
        this.__rememberedObjectIndecesToControllers = [],
        this.__listening = [],
        a = a || {},
        a = o.defaults(a, {
            autoPlace: !0,
            width: M.DEFAULT_WIDTH
        }),
        a = o.defaults(a, {
            resizable: a.autoPlace,
            hideable: a.autoPlace
        }),
        o.isUndefined(a.load) ? a.load = {
            preset: H
        } : a.preset && (a.load.preset = a.preset),
        o.isUndefined(a.parent) && a.hideable && L.push(this),
        a.resizable = o.isUndefined(a.parent) && a.resizable,
        a.autoPlace && o.isUndefined(a.scrollable) && (a.scrollable = !0);
        var e = I && "true" === localStorage.getItem(t(this, "isLocal"));
        if (Object.defineProperties(this, {
            parent: {
                get: function() {
                    return a.parent
                }
            },
            scrollable: {
                get: function() {
                    return a.scrollable
                }
            },
            autoPlace: {
                get: function() {
                    return a.autoPlace
                }
            },
            preset: {
                get: function() {
                    return d.parent ? d.getRoot().preset : a.load.preset
                },
                set: function(b) {
                    d.parent ? d.getRoot().preset = b : a.load.preset = b,
                    z(this),
                    d.revert()
                }
            },
            width: {
                get: function() {
                    return a.width
                },
                set: function(b) {
                    a.width = b,
                    w(d, b)
                }
            },
            name: {
                get: function() {
                    return a.name
                },
                set: function(b) {
                    a.name = b,
                    g && (g.innerHTML = a.name)
                }
            },
            closed: {
                get: function() {
                    return a.closed
                },
                set: function(b) {
                    a.closed = b,
                    a.closed ? n.addClass(d.__ul, M.CLASS_CLOSED) : n.removeClass(d.__ul, M.CLASS_CLOSED),
                    this.onResize(),
                    d.__closeButton && (d.__closeButton.innerHTML = b ? M.TEXT_OPEN : M.TEXT_CLOSED)
                }
            },
            load: {
                get: function() {
                    return a.load
                }
            },
            useLocalStorage: {
                get: function() {
                    return e
                },
                set: function(a) {
                    I && (e = a,
                    a ? n.bind(window, "unload", b) : n.unbind(window, "unload", b),
                    localStorage.setItem(t(d, "isLocal"), a))
                }
            }
        }),
        o.isUndefined(a.parent)) {
            if (a.closed = !1,
            n.addClass(this.domElement, M.CLASS_MAIN),
            n.makeSelectable(this.domElement, !1),
            I && e) {
                d.useLocalStorage = !0;
                var f = localStorage.getItem(t(this, "gui"));
                f && (a.load = JSON.parse(f))
            }
            this.__closeButton = document.createElement("div"),
            this.__closeButton.innerHTML = M.TEXT_CLOSED,
            n.addClass(this.__closeButton, M.CLASS_CLOSE_BUTTON),
            this.domElement.appendChild(this.__closeButton),
            n.bind(this.__closeButton, "click", function() {
                d.closed = !d.closed
            })
        } else {
            void 0 === a.closed && (a.closed = !0);
            var g = document.createTextNode(a.name);
            n.addClass(g, "controller-name");
            var h = q(d, g)
              , i = function(a) {
                return a.preventDefault(),
                d.closed = !d.closed,
                !1
            };
            n.addClass(this.__ul, M.CLASS_CLOSED),
            n.addClass(h, "title"),
            n.bind(h, "click", i),
            a.closed || (this.closed = !1)
        }
        a.autoPlace && (o.isUndefined(a.parent) && (J && (D = document.createElement("div"),
        n.addClass(D, E),
        n.addClass(D, M.CLASS_AUTO_PLACE_CONTAINER),
        document.body.appendChild(D),
        J = !1),
        D.appendChild(this.domElement),
        n.addClass(this.domElement, M.CLASS_AUTO_PLACE)),
        this.parent || w(d, a.width)),
        n.bind(window, "resize", function() {
            d.onResize()
        }),
        n.bind(this.__ul, "webkitTransitionEnd", function() {
            d.onResize()
        }),
        n.bind(this.__ul, "transitionend", function() {
            d.onResize()
        }),
        n.bind(this.__ul, "oTransitionEnd", function() {
            d.onResize()
        }),
        this.onResize(),
        a.resizable && v(this);
        d.getRoot();
        a.parent || c()
    };
    return M.toggleHide = function() {
        K = !K,
        o.each(L, function(a) {
            a.domElement.style.zIndex = K ? -999 : 999,
            a.domElement.style.opacity = K ? 0 : 1
        })
    }
    ,
    M.CLASS_AUTO_PLACE = "a",
    M.CLASS_AUTO_PLACE_CONTAINER = "ac",
    M.CLASS_MAIN = "main",
    M.CLASS_CONTROLLER_ROW = "cr",
    M.CLASS_TOO_TALL = "taller-than-window",
    M.CLASS_CLOSED = "closed",
    M.CLASS_CLOSE_BUTTON = "close-button",
    M.CLASS_DRAG = "drag",
    M.DEFAULT_WIDTH = 245,
    M.TEXT_CLOSED = "Close Controls",
    M.TEXT_OPEN = "Open Controls",
    n.bind(window, "keydown", function(a) {
        "text" === document.activeElement.type || a.which !== F && a.keyCode != F || M.toggleHide()
    }, !1),
    o.extend(M.prototype, {
        add: function(a, b) {
            return p(this, a, b, {
                factoryArgs: Array.prototype.slice.call(arguments, 2)
            })
        },
        addColor: function(a, b) {
            return p(this, a, b, {
                color: !0
            })
        },
        remove: function(a) {
            this.__ul.removeChild(a.__li),
            this.__controllers.slice(this.__controllers.indexOf(a), 1);
            var b = this;
            o.defer(function() {
                b.onResize()
            })
        },
        destroy: function() {
            this.autoPlace && D.removeChild(this.domElement)
        },
        addFolder: function(a) {
            if (void 0 !== this.__folders[a])
                throw new Error('You already have a folder in this GUI by the name "' + a + '"');
            var b = {
                name: a,
                parent: this
            };
            b.autoPlace = this.autoPlace,
            this.load && this.load.folders && this.load.folders[a] && (b.closed = this.load.folders[a].closed,
            b.load = this.load.folders[a]);
            var c = new M(b);
            this.__folders[a] = c;
            var d = q(this, c.domElement);
            return n.addClass(d, "folder"),
            c
        },
        open: function() {
            this.closed = !1
        },
        close: function() {
            this.closed = !0
        },
        onResize: function() {
            var a = this.getRoot();
            if (a.scrollable) {
                var b = n.getOffset(a.__ul).top
                  , c = 0;
                o.each(a.__ul.childNodes, function(b) {
                    a.autoPlace && b === a.__save_row || (c += n.getHeight(b))
                }),
                window.innerHeight - b - G < c ? (n.addClass(a.domElement, M.CLASS_TOO_TALL),
                a.__ul.style.height = window.innerHeight - b - G + "px") : (n.removeClass(a.domElement, M.CLASS_TOO_TALL),
                a.__ul.style.height = "auto")
            }
            a.__resize_handle && o.defer(function() {
                a.__resize_handle.style.height = a.__ul.offsetHeight + "px"
            }),
            a.__closeButton && (a.__closeButton.style.width = a.width + "px")
        },
        remember: function() {
            if (o.isUndefined(C) && (C = new m,
            C.domElement.innerHTML = b),
            this.parent)
                throw new Error("You can only call remember on a top level GUI.");
            var a = this;
            o.each(Array.prototype.slice.call(arguments), function(b) {
                0 == a.__rememberedObjects.length && u(a),
                -1 == a.__rememberedObjects.indexOf(b) && a.__rememberedObjects.push(b)
            }),
            this.autoPlace && w(this, this.width)
        },
        getRoot: function() {
            for (var a = this; a.parent; )
                a = a.parent;
            return a
        },
        getSaveObject: function() {
            var a = this.load;
            return a.closed = this.closed,
            this.__rememberedObjects.length > 0 && (a.preset = this.preset,
            a.remembered || (a.remembered = {}),
            a.remembered[this.preset] = x(this)),
            a.folders = {},
            o.each(this.__folders, function(b, c) {
                a.folders[c] = b.getSaveObject()
            }),
            a
        },
        save: function() {
            this.load.remembered || (this.load.remembered = {}),
            this.load.remembered[this.preset] = x(this),
            A(this, !1)
        },
        saveAs: function(a) {
            this.load.remembered || (this.load.remembered = {},
            this.load.remembered[H] = x(this, !0)),
            this.load.remembered[a] = x(this),
            this.preset = a,
            y(this, a, !0)
        },
        revert: function(a) {
            o.each(this.__controllers, function(b) {
                this.getRoot().load.remembered ? s(a || this.getRoot(), b) : b.setValue(b.initialValue)
            }, this),
            o.each(this.__folders, function(a) {
                a.revert(a)
            }),
            a || A(this.getRoot(), !1)
        },
        listen: function(a) {
            var b = 0 == this.__listening.length;
            this.__listening.push(a),
            b && B(this.__listening)
        }
    }),
    M
}(dat.utils.css, '<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>', ".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n", dat.controllers.factory = function(a, b, c, d, e, f, g) {
    return function(h, i) {
        var j = h[i];
        return g.isArray(arguments[2]) || g.isObject(arguments[2]) ? new a(h,i,arguments[2]) : g.isNumber(j) ? g.isNumber(arguments[2]) && g.isNumber(arguments[3]) ? new c(h,i,arguments[2],arguments[3]) : new b(h,i,{
            min: arguments[2],
            max: arguments[3]
        }) : g.isString(j) ? new d(h,i) : g.isFunction(j) ? new e(h,i,"") : g.isBoolean(j) ? new f(h,i) : void 0
    }
}(dat.controllers.OptionController, dat.controllers.NumberControllerBox, dat.controllers.NumberControllerSlider, dat.controllers.StringController = function(a, b, c) {
    var d = function(a, c) {
        function e() {
            g.setValue(g.__input.value)
        }
        function f() {
            g.__onFinishChange && g.__onFinishChange.call(g, g.getValue())
        }
        d.superclass.call(this, a, c);
        var g = this;
        this.__input = document.createElement("input"),
        this.__input.setAttribute("type", "text"),
        b.bind(this.__input, "keyup", e),
        b.bind(this.__input, "change", e),
        b.bind(this.__input, "blur", f),
        b.bind(this.__input, "keydown", function(a) {
            13 === a.keyCode && this.blur()
        }),
        this.updateDisplay(),
        this.domElement.appendChild(this.__input)
    };
    return d.superclass = a,
    c.extend(d.prototype, a.prototype, {
        updateDisplay: function() {
            return b.isActive(this.__input) || (this.__input.value = this.getValue()),
            d.superclass.prototype.updateDisplay.call(this)
        }
    }),
    d
}(dat.controllers.Controller, dat.dom.dom, dat.utils.common), dat.controllers.FunctionController, dat.controllers.BooleanController, dat.utils.common), dat.controllers.Controller, dat.controllers.BooleanController, dat.controllers.FunctionController, dat.controllers.NumberControllerBox, dat.controllers.NumberControllerSlider, dat.controllers.OptionController, dat.controllers.ColorController = function(a, b, c, d, e) {
    function f(a, b, c, d) {
        a.style.background = "",
        e.each(i, function(e) {
            a.style.cssText += "background: " + e + "linear-gradient(" + b + ", " + c + " 0%, " + d + " 100%); "
        })
    }
    function g(a) {
        a.style.background = "",
        a.style.cssText += "background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",
        a.style.cssText += "background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",
        a.style.cssText += "background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",
        a.style.cssText += "background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",
        a.style.cssText += "background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"
    }
    var h = function(a, i) {
        function j(a) {
            n(a),
            b.bind(window, "mousemove", n),
            b.bind(window, "mouseup", k)
        }
        function k() {
            b.unbind(window, "mousemove", n),
            b.unbind(window, "mouseup", k)
        }
        function l() {
            var a = d(this.value);
            a !== !1 ? (p.__color.__state = a,
            p.setValue(p.__color.toOriginal())) : this.value = p.__color.toString()
        }
        function m() {
            b.unbind(window, "mousemove", o),
            b.unbind(window, "mouseup", m)
        }
        function n(a) {
            a.preventDefault();
            var c = b.getWidth(p.__saturation_field)
              , d = b.getOffset(p.__saturation_field)
              , e = (a.clientX - d.left + document.body.scrollLeft) / c
              , f = 1 - (a.clientY - d.top + document.body.scrollTop) / c;
            return f > 1 ? f = 1 : 0 > f && (f = 0),
            e > 1 ? e = 1 : 0 > e && (e = 0),
            p.__color.v = f,
            p.__color.s = e,
            p.setValue(p.__color.toOriginal()),
            !1
        }
        function o(a) {
            a.preventDefault();
            var c = b.getHeight(p.__hue_field)
              , d = b.getOffset(p.__hue_field)
              , e = 1 - (a.clientY - d.top + document.body.scrollTop) / c;
            return e > 1 ? e = 1 : 0 > e && (e = 0),
            p.__color.h = 360 * e,
            p.setValue(p.__color.toOriginal()),
            !1
        }
        h.superclass.call(this, a, i),
        this.__color = new c(this.getValue()),
        this.__temp = new c(0);
        var p = this;
        this.domElement = document.createElement("div"),
        b.makeSelectable(this.domElement, !1),
        this.__selector = document.createElement("div"),
        this.__selector.className = "selector",
        this.__saturation_field = document.createElement("div"),
        this.__saturation_field.className = "saturation-field",
        this.__field_knob = document.createElement("div"),
        this.__field_knob.className = "field-knob",
        this.__field_knob_border = "2px solid ",
        this.__hue_knob = document.createElement("div"),
        this.__hue_knob.className = "hue-knob",
        this.__hue_field = document.createElement("div"),
        this.__hue_field.className = "hue-field",
        this.__input = document.createElement("input"),
        this.__input.type = "text",
        this.__input_textShadow = "0 1px 1px ",
        b.bind(this.__input, "keydown", function(a) {
            13 === a.keyCode && l.call(this)
        }),
        b.bind(this.__input, "blur", l),
        b.bind(this.__selector, "mousedown", function() {
            b.addClass(this, "drag").bind(window, "mouseup", function() {
                b.removeClass(p.__selector, "drag")
            })
        });
        var q = document.createElement("div");
        e.extend(this.__selector.style, {
            width: "122px",
            height: "102px",
            padding: "3px",
            backgroundColor: "#222",
            boxShadow: "0px 1px 3px rgba(0,0,0,0.3)"
        }),
        e.extend(this.__field_knob.style, {
            position: "absolute",
            width: "12px",
            height: "12px",
            border: this.__field_knob_border + (this.__color.v < .5 ? "#fff" : "#000"),
            boxShadow: "0px 1px 3px rgba(0,0,0,0.5)",
            borderRadius: "12px",
            zIndex: 1
        }),
        e.extend(this.__hue_knob.style, {
            position: "absolute",
            width: "15px",
            height: "2px",
            borderRight: "4px solid #fff",
            zIndex: 1
        }),
        e.extend(this.__saturation_field.style, {
            width: "100px",
            height: "100px",
            border: "1px solid #555",
            marginRight: "3px",
            display: "inline-block",
            cursor: "pointer"
        }),
        e.extend(q.style, {
            width: "100%",
            height: "100%",
            background: "none"
        }),
        f(q, "top", "rgba(0,0,0,0)", "#000"),
        e.extend(this.__hue_field.style, {
            width: "15px",
            height: "100px",
            display: "inline-block",
            border: "1px solid #555",
            cursor: "ns-resize"
        }),
        g(this.__hue_field),
        e.extend(this.__input.style, {
            outline: "none",
            textAlign: "center",
            color: "#fff",
            border: 0,
            fontWeight: "bold",
            textShadow: this.__input_textShadow + "rgba(0,0,0,0.7)"
        }),
        b.bind(this.__saturation_field, "mousedown", j),
        b.bind(this.__field_knob, "mousedown", j),
        b.bind(this.__hue_field, "mousedown", function(a) {
            o(a),
            b.bind(window, "mousemove", o),
            b.bind(window, "mouseup", m)
        }),
        this.__saturation_field.appendChild(q),
        this.__selector.appendChild(this.__field_knob),
        this.__selector.appendChild(this.__saturation_field),
        this.__selector.appendChild(this.__hue_field),
        this.__hue_field.appendChild(this.__hue_knob),
        this.domElement.appendChild(this.__input),
        this.domElement.appendChild(this.__selector),
        this.updateDisplay()
    };
    h.superclass = a,
    e.extend(h.prototype, a.prototype, {
        updateDisplay: function() {
            var a = d(this.getValue());
            if (a !== !1) {
                var b = !1;
                e.each(c.COMPONENTS, function(c) {
                    return e.isUndefined(a[c]) || e.isUndefined(this.__color.__state[c]) || a[c] === this.__color.__state[c] ? void 0 : (b = !0,
                    {})
                }, this),
                b && e.extend(this.__color.__state, a)
            }
            e.extend(this.__temp.__state, this.__color.__state),
            this.__temp.a = 1;
            var g = this.__color.v < .5 || this.__color.s > .5 ? 255 : 0
              , h = 255 - g;
            e.extend(this.__field_knob.style, {
                marginLeft: 100 * this.__color.s - 7 + "px",
                marginTop: 100 * (1 - this.__color.v) - 7 + "px",
                backgroundColor: this.__temp.toString(),
                border: this.__field_knob_border + "rgb(" + g + "," + g + "," + g + ")"
            }),
            this.__hue_knob.style.marginTop = 100 * (1 - this.__color.h / 360) + "px",
            this.__temp.s = 1,
            this.__temp.v = 1,
            f(this.__saturation_field, "left", "#fff", this.__temp.toString()),
            e.extend(this.__input.style, {
                backgroundColor: this.__input.value = this.__color.toString(),
                color: "rgb(" + g + "," + g + "," + g + ")",
                textShadow: this.__input_textShadow + "rgba(" + h + "," + h + "," + h + ",.7)"
            })
        }
    });
    var i = ["-moz-", "-o-", "-webkit-", "-ms-", ""];
    return h
}(dat.controllers.Controller, dat.dom.dom, dat.color.Color = function(a, b, c, d) {
    function e(a, b, c) {
        Object.defineProperty(a, b, {
            get: function() {
                return "RGB" === this.__state.space ? this.__state[b] : (g(this, b, c),
                this.__state[b])
            },
            set: function(a) {
                "RGB" !== this.__state.space && (g(this, b, c),
                this.__state.space = "RGB"),
                this.__state[b] = a
            }
        })
    }
    function f(a, b) {
        Object.defineProperty(a, b, {
            get: function() {
                return "HSV" === this.__state.space ? this.__state[b] : (h(this),
                this.__state[b])
            },
            set: function(a) {
                "HSV" !== this.__state.space && (h(this),
                this.__state.space = "HSV"),
                this.__state[b] = a
            }
        })
    }
    function g(a, c, e) {
        if ("HEX" === a.__state.space)
            a.__state[c] = b.component_from_hex(a.__state.hex, e);
        else {
            if ("HSV" !== a.__state.space)
                throw "Corrupted color state";
            d.extend(a.__state, b.hsv_to_rgb(a.__state.h, a.__state.s, a.__state.v))
        }
    }
    function h(a) {
        var c = b.rgb_to_hsv(a.r, a.g, a.b);
        d.extend(a.__state, {
            s: c.s,
            v: c.v
        }),
        d.isNaN(c.h) ? d.isUndefined(a.__state.h) && (a.__state.h = 0) : a.__state.h = c.h
    }
    var i = function() {
        if (this.__state = a.apply(this, arguments),
        this.__state === !1)
            throw "Failed to interpret color arguments";
        this.__state.a = this.__state.a || 1
    };
    return i.COMPONENTS = ["r", "g", "b", "h", "s", "v", "hex", "a"],
    d.extend(i.prototype, {
        toString: function() {
            return c(this)
        },
        toOriginal: function() {
            return this.__state.conversion.write(this)
        }
    }),
    e(i.prototype, "r", 2),
    e(i.prototype, "g", 1),
    e(i.prototype, "b", 0),
    f(i.prototype, "h"),
    f(i.prototype, "s"),
    f(i.prototype, "v"),
    Object.defineProperty(i.prototype, "a", {
        get: function() {
            return this.__state.a
        },
        set: function(a) {
            this.__state.a = a
        }
    }),
    Object.defineProperty(i.prototype, "hex", {
        get: function() {
            return "HEX" !== !this.__state.space && (this.__state.hex = b.rgb_to_hex(this.r, this.g, this.b)),
            this.__state.hex
        },
        set: function(a) {
            this.__state.space = "HEX",
            this.__state.hex = a
        }
    }),
    i
}(dat.color.interpret, dat.color.math = function() {
    var a;
    return {
        hsv_to_rgb: function(a, b, c) {
            var d = Math.floor(a / 60) % 6
              , e = a / 60 - Math.floor(a / 60)
              , f = c * (1 - b)
              , g = c * (1 - e * b)
              , h = c * (1 - (1 - e) * b)
              , i = [[c, h, f], [g, c, f], [f, c, h], [f, g, c], [h, f, c], [c, f, g]][d];
            return {
                r: 255 * i[0],
                g: 255 * i[1],
                b: 255 * i[2]
            }
        },
        rgb_to_hsv: function(a, b, c) {
            var d, e, f = Math.min(a, b, c), g = Math.max(a, b, c), h = g - f;
            return 0 == g ? {
                h: 0 / 0,
                s: 0,
                v: 0
            } : (e = h / g,
            d = a == g ? (b - c) / h : b == g ? 2 + (c - a) / h : 4 + (a - b) / h,
            d /= 6,
            0 > d && (d += 1),
            {
                h: 360 * d,
                s: e,
                v: g / 255
            })
        },
        rgb_to_hex: function(a, b, c) {
            var d = this.hex_with_component(0, 2, a);
            return d = this.hex_with_component(d, 1, b),
            d = this.hex_with_component(d, 0, c)
        },
        component_from_hex: function(a, b) {
            return a >> 8 * b & 255
        },
        hex_with_component: function(b, c, d) {
            return d << (a = 8 * c) | b & ~(255 << a)
        }
    }
}(), dat.color.toString, dat.utils.common), dat.color.interpret, dat.utils.common), dat.utils.requestAnimationFrame = function() {
    return window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(a) {
        window.setTimeout(a, 1e3 / 60)
    }
}(), dat.dom.CenteredDiv = function(a, b) {
    var c = function() {
        this.backgroundElement = document.createElement("div"),
        b.extend(this.backgroundElement.style, {
            backgroundColor: "rgba(0,0,0,0.8)",
            top: 0,
            left: 0,
            display: "none",
            zIndex: "1000",
            opacity: 0,
            WebkitTransition: "opacity 0.2s linear"
        }),
        a.makeFullscreen(this.backgroundElement),
        this.backgroundElement.style.position = "fixed",
        this.domElement = document.createElement("div"),
        b.extend(this.domElement.style, {
            position: "fixed",
            display: "none",
            zIndex: "1001",
            opacity: 0,
            WebkitTransition: "-webkit-transform 0.2s ease-out, opacity 0.2s linear"
        }),
        document.body.appendChild(this.backgroundElement),
        document.body.appendChild(this.domElement);
        var c = this;
        a.bind(this.backgroundElement, "click", function() {
            c.hide()
        })
    };
    return c.prototype.show = function() {
        var a = this;
        this.backgroundElement.style.display = "block",
        this.domElement.style.display = "block",
        this.domElement.style.opacity = 0,
        this.domElement.style.webkitTransform = "scale(1.1)",
        this.layout(),
        b.defer(function() {
            a.backgroundElement.style.opacity = 1,
            a.domElement.style.opacity = 1,
            a.domElement.style.webkitTransform = "scale(1)"
        })
    }
    ,
    c.prototype.hide = function() {
        var b = this
          , c = function() {
            b.domElement.style.display = "none",
            b.backgroundElement.style.display = "none",
            a.unbind(b.domElement, "webkitTransitionEnd", c),
            a.unbind(b.domElement, "transitionend", c),
            a.unbind(b.domElement, "oTransitionEnd", c)
        };
        a.bind(this.domElement, "webkitTransitionEnd", c),
        a.bind(this.domElement, "transitionend", c),
        a.bind(this.domElement, "oTransitionEnd", c),
        this.backgroundElement.style.opacity = 0,
        this.domElement.style.opacity = 0,
        this.domElement.style.webkitTransform = "scale(1.1)"
    }
    ,
    c.prototype.layout = function() {
        this.domElement.style.left = window.innerWidth / 2 - a.getWidth(this.domElement) / 2 + "px",
        this.domElement.style.top = window.innerHeight / 2 - a.getHeight(this.domElement) / 2 + "px"
    }
    ,
    c
}(dat.dom.dom, dat.utils.common), dat.dom.dom, dat.utils.common),
function(a, b) {
    "use strict";
    function c(a) {
        return document.createElement(a)
    }
    function d(a, b) {
        for (var c in b)
            try {
                a.style[c] = b[c]
            } catch (d) {}
        return a
    }
    function e(a) {
        return null == a ? String(a) : "object" == typeof a || "function" == typeof a ? Object.prototype.toString.call(a).match(/\s([a-z]+)/i)[1].toLowerCase() || "object" : typeof a
    }
    function f(a, b) {
        if ("array" !== e(b))
            return -1;
        if (b.indexOf)
            return b.indexOf(a);
        for (var c = 0, d = b.length; d > c; c++)
            if (b[c] === a)
                return c;
        return -1
    }
    function g() {
        var a = arguments;
        for (var b in a[1])
            if (a[1].hasOwnProperty(b))
                switch (e(a[1][b])) {
                case "object":
                    a[0][b] = g({}, a[0][b], a[1][b]);
                    break;
                case "array":
                    a[0][b] = a[1][b].slice(0);
                    break;
                default:
                    a[0][b] = a[1][b]
                }
        return a.length > 2 ? g.apply(null, [a[0]].concat(Array.prototype.slice.call(a, 2))) : a[0]
    }
    function h(a, b, c) {
        var d, e, f, g, h, j, k, l, m;
        return g = .5 >= c ? c * (1 + b) : c + b - c * b,
        0 === g ? "#000" : (h = 2 * c - g,
        j = (g - h) / g,
        a = 6 * a,
        k = Math.floor(a),
        l = a - k,
        m = g * j * l,
        0 === k || 6 === k ? (d = g,
        e = h + m,
        f = h) : 1 === k ? (d = g - m,
        e = g,
        f = h) : 2 === k ? (d = h,
        e = g,
        f = h + m) : 3 === k ? (d = h,
        e = g - m,
        f = g) : 4 === k ? (d = h + m,
        e = h,
        f = g) : (d = g,
        e = h,
        f = g - m),
        "#" + i(d) + i(e) + i(f))
    }
    function i(a) {
        return a = Math.round(255 * a).toString(16),
        1 === a.length ? "0" + a : a
    }
    function j(a, b, c, d) {
        a.addEventListener ? a[d ? "removeEventListener" : "addEventListener"](b, c, !1) : a.attachEvent && a[d ? "detachEvent" : "attachEvent"]("on" + b, c)
    }
    function k(a, i) {
        function r() {
            for (I = L.history; I--; )
                U[I] = 0 === I ? K.fps : U[I - 1],
                V[I] = 0 === I ? K.duration : V[I - 1]
        }
        function s(a, b, c, d) {
            return C[0 | a][Math.round(Math.min((b - c) / (d - c) * O, O))]
        }
        function t() {
            M.legend.fps !== W && (M.legend.fps = W,
            M.legend[o] = W ? "FPS" : "ms"),
            H = W ? K.fps : K.duration,
            M.count[o] = H > 999 ? "999+" : H.toFixed(H > 99 ? 0 : L.decimals)
        }
        function u() {
            if (D = l(),
            T < D - L.threshold && (K.fps -= K.fps / Math.max(1, 60 * L.smoothing / L.interval),
            K.duration = 1e3 / K.fps),
            r(),
            t(),
            L.heat) {
                if (P.length)
                    for (I = P.length; I--; )
                        P[I].el.style[B[P[I].name].heatOn] = W ? s(B[P[I].name].heatmap, K.fps, 0, L.maxFps) : s(B[P[I].name].heatmap, K.duration, L.threshold, 0);
                if (M.graph && B.column.heatOn)
                    for (I = N.length; I--; )
                        N[I].style[B.column.heatOn] = W ? s(B.column.heatmap, U[I], 0, L.maxFps) : s(B.column.heatmap, V[I], L.threshold, 0)
            }
            if (M.graph)
                for (J = 0; J < L.history; J++)
                    N[J].style.height = (W ? U[J] ? Math.round(G / L.maxFps * Math.min(U[J], L.maxFps)) : 0 : V[J] ? Math.round(G / L.threshold * Math.min(V[J], L.threshold)) : 0) + "px"
        }
        function v() {
            L.interval < 20 ? (E = n(v),
            u()) : (E = setTimeout(v, L.interval),
            F = n(u))
        }
        function w(a) {
            a = a || window.event,
            a.preventDefault ? (a.preventDefault(),
            a.stopPropagation()) : (a.returnValue = !1,
            a.cancelBubble = !0),
            K.toggle()
        }
        function x() {
            L.toggleOn && j(M.container, L.toggleOn, w, 1),
            a.removeChild(M.container)
        }
        function y() {
            if (B = k.theme[L.theme],
            C = B.compiledHeatmaps || [],
            !C.length && B.heatmaps.length) {
                for (J = 0; J < B.heatmaps.length; J++)
                    for (C[J] = [],
                    I = 0; O >= I; I++)
                        C[J][I] = h(.33 / O * I, B.heatmaps[J].saturation, B.heatmaps[J].lightness);
                B.compiledHeatmaps = C
            }
        }
        function z() {
            M.container && x(),
            y(),
            M.container = d(c("div"), B.container),
            M.count = M.container.appendChild(d(c("div"), B.count)),
            M.legend = M.container.appendChild(d(c("div"), B.legend)),
            M.graph = L.graph ? M.container.appendChild(d(c("div"), B.graph)) : 0,
            P.length = 0;
            for (var b in M)
                M[b] && B[b].heatOn && P.push({
                    name: b,
                    el: M[b]
                });
            if (N.length = 0,
            M.graph)
                for (M.graph.style.width = L.history * B.column.width + (L.history - 1) * B.column.spacing + "px",
                I = 0; I < L.history; I++)
                    N[I] = M.graph.appendChild(d(c("div"), B.column)),
                    N[I].style.position = "absolute",
                    N[I].style.bottom = 0,
                    N[I].style.right = I * B.column.width + I * B.column.spacing + "px",
                    N[I].style.width = B.column.width + "px",
                    N[I].style.height = "0px";
            A(),
            t(),
            a.appendChild(M.container),
            M.graph && (G = M.graph.clientHeight),
            L.toggleOn && ("click" === L.toggleOn && (M.container.style.cursor = "pointer"),
            j(M.container, L.toggleOn, w))
        }
        function A() {
            d(M.container, L)
        }
        "object" === e(a) && a.nodeType === b && (i = a,
        a = document.body),
        a || (a = document.body);
        var B, C, D, E, F, G, H, I, J, K = this, L = g({}, k.defaults, i || {}), M = {}, N = [], O = 100, P = [], Q = 0, R = L.threshold, S = 0, T = l() - R, U = [], V = [], W = "fps" === L.show;
        K.options = L,
        K.fps = 0,
        K.duration = 0,
        K.isPaused = 0,
        K.tickStart = function() {
            S = l()
        }
        ,
        K.tick = function() {
            D = l(),
            Q = D - T,
            R += (Q - R) / L.smoothing,
            K.fps = 1e3 / R,
            K.duration = T > S ? R : D - S,
            T = D
        }
        ,
        K.pause = function() {
            return E && (K.isPaused = 1,
            clearTimeout(E),
            m(E),
            m(F),
            E = F = 0),
            K
        }
        ,
        K.resume = function() {
            return E || (K.isPaused = 0,
            v()),
            K
        }
        ,
        K.set = function(a, b) {
            return L[a] = b,
            W = "fps" === L.show,
            -1 !== f(a, p) && z(),
            -1 !== f(a, q) && A(),
            K
        }
        ,
        K.showDuration = function() {
            return K.set("show", "ms"),
            K
        }
        ,
        K.showFps = function() {
            return K.set("show", "fps"),
            K
        }
        ,
        K.toggle = function() {
            return K.set("show", W ? "ms" : "fps"),
            K
        }
        ,
        K.hide = function() {
            return K.pause(),
            M.container.style.display = "none",
            K
        }
        ,
        K.show = function() {
            return K.resume(),
            M.container.style.display = "block",
            K
        }
        ,
        K.destroy = function() {
            K.pause(),
            x(),
            K.tick = K.tickStart = function() {}
        }
        ,
        function() {
            z(),
            v()
        }()
    }
    var l;
    !function() {
        var b = a.performance;
        if (b && (b.now || b.webkitNow)) {
            var c = b.now ? "now" : "webkitNow";
            l = b[c].bind(b)
        } else
            l = function() {
                return +new Date
            }
    }();
    var m = a.cancelAnimationFrame || a.cancelRequestAnimationFrame
      , n = a.requestAnimationFrame;
    !function() {
        for (var b = ["moz", "webkit", "o"], c = 0, d = 0, e = b.length; e > d && !m; ++d)
            m = a[b[d] + "CancelAnimationFrame"] || a[b[d] + "CancelRequestAnimationFrame"],
            n = m && a[b[d] + "RequestAnimationFrame"];
        m || (n = function(b) {
            var d = l()
              , e = Math.max(0, 16 - (d - c));
            return c = d + e,
            a.setTimeout(function() {
                b(d + e)
            }, e)
        }
        ,
        m = function(a) {
            clearTimeout(a)
        }
        )
    }();
    var o = "string" === e(document.createElement("div").textContent) ? "textContent" : "innerText";
    k.extend = g,
    window.FPSMeter = k,
    k.defaults = {
        interval: 100,
        smoothing: 10,
        show: "fps",
        toggleOn: "click",
        decimals: 1,
        maxFps: 60,
        threshold: 100,
        position: "absolute",
        zIndex: 10,
        left: "5px",
        top: "5px",
        right: "auto",
        bottom: "auto",
        margin: "0 0 0 0",
        theme: "dark",
        heat: 0,
        graph: 0,
        history: 20
    };
    var p = ["toggleOn", "theme", "heat", "graph", "history"]
      , q = ["position", "zIndex", "left", "top", "right", "bottom", "margin"]
}(window),
function(a, b) {
    "use strict";
    b.theme = {};
    var c = b.theme.base = {
        heatmaps: [],
        container: {
            heatOn: null,
            heatmap: null,
            padding: "5px",
            minWidth: "95px",
            height: "30px",
            lineHeight: "30px",
            textAlign: "right",
            textShadow: "none"
        },
        count: {
            heatOn: null,
            heatmap: null,
            position: "absolute",
            top: 0,
            right: 0,
            padding: "5px 10px",
            height: "30px",
            fontSize: "24px",
            fontFamily: "Consolas, Andale Mono, monospace",
            zIndex: 2
        },
        legend: {
            heatOn: null,
            heatmap: null,
            position: "absolute",
            top: 0,
            left: 0,
            padding: "5px 10px",
            height: "30px",
            fontSize: "12px",
            lineHeight: "32px",
            fontFamily: "sans-serif",
            textAlign: "left",
            zIndex: 2
        },
        graph: {
            heatOn: null,
            heatmap: null,
            position: "relative",
            boxSizing: "padding-box",
            MozBoxSizing: "padding-box",
            height: "100%",
            zIndex: 1
        },
        column: {
            width: 4,
            spacing: 1,
            heatOn: null,
            heatmap: null
        }
    };
    b.theme.dark = b.extend({}, c, {
        heatmaps: [{
            saturation: .8,
            lightness: .8
        }],
        container: {
            background: "#222",
            color: "#fff",
            border: "1px solid #1a1a1a",
            textShadow: "1px 1px 0 #222"
        },
        count: {
            heatOn: "color"
        },
        column: {
            background: "#3f3f3f"
        }
    }),
    b.theme.light = b.extend({}, c, {
        heatmaps: [{
            saturation: .5,
            lightness: .5
        }],
        container: {
            color: "#666",
            background: "#fff",
            textShadow: "1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",
            boxShadow: "0 0 0 1px rgba(0,0,0,.1)"
        },
        count: {
            heatOn: "color"
        },
        column: {
            background: "#eaeaea"
        }
    }),
    b.theme.colorful = b.extend({}, c, {
        heatmaps: [{
            saturation: .5,
            lightness: .6
        }],
        container: {
            heatOn: "backgroundColor",
            background: "#888",
            color: "#fff",
            textShadow: "1px 1px 0 rgba(0,0,0,.2)",
            boxShadow: "0 0 0 1px rgba(0,0,0,.1)"
        },
        column: {
            background: "#777",
            backgroundColor: "rgba(0,0,0,.2)"
        }
    }),
    b.theme.transparent = b.extend({}, c, {
        heatmaps: [{
            saturation: .8,
            lightness: .5
        }],
        container: {
            padding: 0,
            color: "#fff",
            textShadow: "1px 1px 0 rgba(0,0,0,.5)"
        },
        count: {
            padding: "0 5px",
            height: "40px",
            lineHeight: "40px"
        },
        legend: {
            padding: "0 5px",
            height: "40px",
            lineHeight: "42px"
        },
        graph: {
            height: "40px"
        },
        column: {
            width: 5,
            background: "#999",
            heatOn: "backgroundColor",
            opacity: .5
        }
    })
}(window, FPSMeter),
function(a) {
    function b(a, b) {
        return function(c) {
            return i(a.call(this, c), b)
        }
    }
    function c(a, b) {
        return function(c) {
            return this.lang().ordinal(a.call(this, c), b)
        }
    }
    function d() {}
    function e(a) {
        u(a),
        g(this, a)
    }
    function f(a) {
        var b = o(a)
          , c = b.year || 0
          , d = b.month || 0
          , e = b.week || 0
          , f = b.day || 0
          , g = b.hour || 0
          , h = b.minute || 0
          , i = b.second || 0
          , j = b.millisecond || 0;
        this._input = a,
        this._milliseconds = +j + 1e3 * i + 6e4 * h + 36e5 * g,
        this._days = +f + 7 * e,
        this._months = +d + 12 * c,
        this._data = {},
        this._bubble()
    }
    function g(a, b) {
        for (var c in b)
            b.hasOwnProperty(c) && (a[c] = b[c]);
        return b.hasOwnProperty("toString") && (a.toString = b.toString),
        b.hasOwnProperty("valueOf") && (a.valueOf = b.valueOf),
        a
    }
    function h(a) {
        return 0 > a ? Math.ceil(a) : Math.floor(a)
    }
    function i(a, b) {
        for (var c = a + ""; c.length < b; )
            c = "0" + c;
        return c
    }
    function j(a, b, c, d) {
        var e, f, g = b._milliseconds, h = b._days, i = b._months;
        g && a._d.setTime(+a._d + g * c),
        (h || i) && (e = a.minute(),
        f = a.hour()),
        h && a.date(a.date() + h * c),
        i && a.month(a.month() + i * c),
        g && !d && bb.updateOffset(a),
        (h || i) && (a.minute(e),
        a.hour(f))
    }
    function k(a) {
        return "[object Array]" === Object.prototype.toString.call(a)
    }
    function l(a) {
        return "[object Date]" === Object.prototype.toString.call(a) || a instanceof Date
    }
    function m(a, b, c) {
        var d, e = Math.min(a.length, b.length), f = Math.abs(a.length - b.length), g = 0;
        for (d = 0; e > d; d++)
            (c && a[d] !== b[d] || !c && q(a[d]) !== q(b[d])) && g++;
        return g + f
    }
    function n(a) {
        if (a) {
            var b = a.toLowerCase().replace(/(.)s$/, "$1");
            a = Kb[a] || Lb[b] || b
        }
        return a
    }
    function o(a) {
        var b, c, d = {};
        for (c in a)
            a.hasOwnProperty(c) && (b = n(c),
            b && (d[b] = a[c]));
        return d
    }
    function p(b) {
        var c, d;
        if (0 === b.indexOf("week"))
            c = 7,
            d = "day";
        else {
            if (0 !== b.indexOf("month"))
                return;
            c = 12,
            d = "month"
        }
        bb[b] = function(e, f) {
            var g, h, i = bb.fn._lang[b], j = [];
            if ("number" == typeof e && (f = e,
            e = a),
            h = function(a) {
                var b = bb().utc().set(d, a);
                return i.call(bb.fn._lang, b, e || "")
            }
            ,
            null != f)
                return h(f);
            for (g = 0; c > g; g++)
                j.push(h(g));
            return j
        }
    }
    function q(a) {
        var b = +a
          , c = 0;
        return 0 !== b && isFinite(b) && (c = b >= 0 ? Math.floor(b) : Math.ceil(b)),
        c
    }
    function r(a, b) {
        return new Date(Date.UTC(a, b + 1, 0)).getUTCDate()
    }
    function s(a) {
        return t(a) ? 366 : 365
    }
    function t(a) {
        return a % 4 === 0 && a % 100 !== 0 || a % 400 === 0
    }
    function u(a) {
        var b;
        a._a && -2 === a._pf.overflow && (b = a._a[gb] < 0 || a._a[gb] > 11 ? gb : a._a[hb] < 1 || a._a[hb] > r(a._a[fb], a._a[gb]) ? hb : a._a[ib] < 0 || a._a[ib] > 23 ? ib : a._a[jb] < 0 || a._a[jb] > 59 ? jb : a._a[kb] < 0 || a._a[kb] > 59 ? kb : a._a[lb] < 0 || a._a[lb] > 999 ? lb : -1,
        a._pf._overflowDayOfYear && (fb > b || b > hb) && (b = hb),
        a._pf.overflow = b)
    }
    function v(a) {
        a._pf = {
            empty: !1,
            unusedTokens: [],
            unusedInput: [],
            overflow: -2,
            charsLeftOver: 0,
            nullInput: !1,
            invalidMonth: null,
            invalidFormat: !1,
            userInvalidated: !1,
            iso: !1
        }
    }
    function w(a) {
        return null == a._isValid && (a._isValid = !isNaN(a._d.getTime()) && a._pf.overflow < 0 && !a._pf.empty && !a._pf.invalidMonth && !a._pf.nullInput && !a._pf.invalidFormat && !a._pf.userInvalidated,
        a._strict && (a._isValid = a._isValid && 0 === a._pf.charsLeftOver && 0 === a._pf.unusedTokens.length)),
        a._isValid
    }
    function x(a) {
        return a ? a.toLowerCase().replace("_", "-") : a
    }
    function y(a, b) {
        return b.abbr = a,
        mb[a] || (mb[a] = new d),
        mb[a].set(b),
        mb[a]
    }
    function z(a) {
        delete mb[a]
    }
    function A(a) {
        var b, c, d, e, f = 0, g = function(a) {
            if (!mb[a] && nb)
                try {
                    require("./lang/" + a)
                } catch (b) {}
            return mb[a]
        };
        if (!a)
            return bb.fn._lang;
        if (!k(a)) {
            if (c = g(a))
                return c;
            a = [a]
        }
        for (; f < a.length; ) {
            for (e = x(a[f]).split("-"),
            b = e.length,
            d = x(a[f + 1]),
            d = d ? d.split("-") : null; b > 0; ) {
                if (c = g(e.slice(0, b).join("-")))
                    return c;
                if (d && d.length >= b && m(e, d, !0) >= b - 1)
                    break;
                b--
            }
            f++
        }
        return bb.fn._lang
    }
    function B(a) {
        return a.match(/\[[\s\S]/) ? a.replace(/^\[|\]$/g, "") : a.replace(/\\/g, "")
    }
    function C(a) {
        var b, c, d = a.match(rb);
        for (b = 0,
        c = d.length; c > b; b++)
            d[b] = Pb[d[b]] ? Pb[d[b]] : B(d[b]);
        return function(e) {
            var f = "";
            for (b = 0; c > b; b++)
                f += d[b]instanceof Function ? d[b].call(e, a) : d[b];
            return f
        }
    }
    function D(a, b) {
        return a.isValid() ? (b = E(b, a.lang()),
        Mb[b] || (Mb[b] = C(b)),
        Mb[b](a)) : a.lang().invalidDate()
    }
    function E(a, b) {
        function c(a) {
            return b.longDateFormat(a) || a
        }
        var d = 5;
        for (sb.lastIndex = 0; d >= 0 && sb.test(a); )
            a = a.replace(sb, c),
            sb.lastIndex = 0,
            d -= 1;
        return a
    }
    function F(a, b) {
        var c;
        switch (a) {
        case "DDDD":
            return vb;
        case "YYYY":
        case "GGGG":
        case "gggg":
            return wb;
        case "YYYYY":
        case "GGGGG":
        case "ggggg":
            return xb;
        case "S":
        case "SS":
        case "SSS":
        case "DDD":
            return ub;
        case "MMM":
        case "MMMM":
        case "dd":
        case "ddd":
        case "dddd":
            return zb;
        case "a":
        case "A":
            return A(b._l)._meridiemParse;
        case "X":
            return Cb;
        case "Z":
        case "ZZ":
            return Ab;
        case "T":
            return Bb;
        case "SSSS":
            return yb;
        case "MM":
        case "DD":
        case "YY":
        case "GG":
        case "gg":
        case "HH":
        case "hh":
        case "mm":
        case "ss":
        case "M":
        case "D":
        case "d":
        case "H":
        case "h":
        case "m":
        case "s":
        case "w":
        case "ww":
        case "W":
        case "WW":
        case "e":
        case "E":
            return tb;
        default:
            return c = new RegExp(N(M(a.replace("\\", "")), "i"))
        }
    }
    function G(a) {
        var b = (Ab.exec(a) || [])[0]
          , c = (b + "").match(Hb) || ["-", 0, 0]
          , d = +(60 * c[1]) + q(c[2]);
        return "+" === c[0] ? -d : d
    }
    function H(a, b, c) {
        var d, e = c._a;
        switch (a) {
        case "M":
        case "MM":
            null != b && (e[gb] = q(b) - 1);
            break;
        case "MMM":
        case "MMMM":
            d = A(c._l).monthsParse(b),
            null != d ? e[gb] = d : c._pf.invalidMonth = b;
            break;
        case "D":
        case "DD":
            null != b && (e[hb] = q(b));
            break;
        case "DDD":
        case "DDDD":
            null != b && (c._dayOfYear = q(b));
            break;
        case "YY":
            e[fb] = q(b) + (q(b) > 68 ? 1900 : 2e3);
            break;
        case "YYYY":
        case "YYYYY":
            e[fb] = q(b);
            break;
        case "a":
        case "A":
            c._isPm = A(c._l).isPM(b);
            break;
        case "H":
        case "HH":
        case "h":
        case "hh":
            e[ib] = q(b);
            break;
        case "m":
        case "mm":
            e[jb] = q(b);
            break;
        case "s":
        case "ss":
            e[kb] = q(b);
            break;
        case "S":
        case "SS":
        case "SSS":
        case "SSSS":
            e[lb] = q(1e3 * ("0." + b));
            break;
        case "X":
            c._d = new Date(1e3 * parseFloat(b));
            break;
        case "Z":
        case "ZZ":
            c._useUTC = !0,
            c._tzm = G(b);
            break;
        case "w":
        case "ww":
        case "W":
        case "WW":
        case "d":
        case "dd":
        case "ddd":
        case "dddd":
        case "e":
        case "E":
            a = a.substr(0, 1);
        case "gg":
        case "gggg":
        case "GG":
        case "GGGG":
        case "GGGGG":
            a = a.substr(0, 2),
            b && (c._w = c._w || {},
            c._w[a] = b)
        }
    }
    function I(a) {
        var b, c, d, e, f, g, h, i, j, k, l = [];
        if (!a._d) {
            for (d = K(a),
            a._w && null == a._a[hb] && null == a._a[gb] && (f = function(b) {
                return b ? b.length < 3 ? parseInt(b, 10) > 68 ? "19" + b : "20" + b : b : null == a._a[fb] ? bb().weekYear() : a._a[fb]
            }
            ,
            g = a._w,
            null != g.GG || null != g.W || null != g.E ? h = X(f(g.GG), g.W || 1, g.E, 4, 1) : (i = A(a._l),
            j = null != g.d ? T(g.d, i) : null != g.e ? parseInt(g.e, 10) + i._week.dow : 0,
            k = parseInt(g.w, 10) || 1,
            null != g.d && j < i._week.dow && k++,
            h = X(f(g.gg), k, j, i._week.doy, i._week.dow)),
            a._a[fb] = h.year,
            a._dayOfYear = h.dayOfYear),
            a._dayOfYear && (e = null == a._a[fb] ? d[fb] : a._a[fb],
            a._dayOfYear > s(e) && (a._pf._overflowDayOfYear = !0),
            c = S(e, 0, a._dayOfYear),
            a._a[gb] = c.getUTCMonth(),
            a._a[hb] = c.getUTCDate()),
            b = 0; 3 > b && null == a._a[b]; ++b)
                a._a[b] = l[b] = d[b];
            for (; 7 > b; b++)
                a._a[b] = l[b] = null == a._a[b] ? 2 === b ? 1 : 0 : a._a[b];
            l[ib] += q((a._tzm || 0) / 60),
            l[jb] += q((a._tzm || 0) % 60),
            a._d = (a._useUTC ? S : R).apply(null, l)
        }
    }
    function J(a) {
        var b;
        a._d || (b = o(a._i),
        a._a = [b.year, b.month, b.day, b.hour, b.minute, b.second, b.millisecond],
        I(a))
    }
    function K(a) {
        var b = new Date;
        return a._useUTC ? [b.getUTCFullYear(), b.getUTCMonth(), b.getUTCDate()] : [b.getFullYear(), b.getMonth(), b.getDate()]
    }
    function L(a) {
        a._a = [],
        a._pf.empty = !0;
        var b, c, d, e, f, g = A(a._l), h = "" + a._i, i = h.length, j = 0;
        for (d = E(a._f, g).match(rb) || [],
        b = 0; b < d.length; b++)
            e = d[b],
            c = (F(e, a).exec(h) || [])[0],
            c && (f = h.substr(0, h.indexOf(c)),
            f.length > 0 && a._pf.unusedInput.push(f),
            h = h.slice(h.indexOf(c) + c.length),
            j += c.length),
            Pb[e] ? (c ? a._pf.empty = !1 : a._pf.unusedTokens.push(e),
            H(e, c, a)) : a._strict && !c && a._pf.unusedTokens.push(e);
        a._pf.charsLeftOver = i - j,
        h.length > 0 && a._pf.unusedInput.push(h),
        a._isPm && a._a[ib] < 12 && (a._a[ib] += 12),
        a._isPm === !1 && 12 === a._a[ib] && (a._a[ib] = 0),
        I(a),
        u(a)
    }
    function M(a) {
        return a.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function(a, b, c, d, e) {
            return b || c || d || e
        })
    }
    function N(a) {
        return a.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&")
    }
    function O(a) {
        var b, c, d, e, f;
        if (0 === a._f.length)
            return a._pf.invalidFormat = !0,
            a._d = new Date(0 / 0),
            void 0;
        for (e = 0; e < a._f.length; e++)
            f = 0,
            b = g({}, a),
            v(b),
            b._f = a._f[e],
            L(b),
            w(b) && (f += b._pf.charsLeftOver,
            f += 10 * b._pf.unusedTokens.length,
            b._pf.score = f,
            (null == d || d > f) && (d = f,
            c = b));
        g(a, c || b)
    }
    function P(a) {
        var b, c = a._i, d = Db.exec(c);
        if (d) {
            for (a._pf.iso = !0,
            b = 4; b > 0; b--)
                if (d[b]) {
                    a._f = Fb[b - 1] + (d[6] || " ");
                    break
                }
            for (b = 0; 4 > b; b++)
                if (Gb[b][1].exec(c)) {
                    a._f += Gb[b][0];
                    break
                }
            Ab.exec(c) && (a._f += "Z"),
            L(a)
        } else
            a._d = new Date(c)
    }
    function Q(b) {
        var c = b._i
          , d = ob.exec(c);
        c === a ? b._d = new Date : d ? b._d = new Date(+d[1]) : "string" == typeof c ? P(b) : k(c) ? (b._a = c.slice(0),
        I(b)) : l(c) ? b._d = new Date(+c) : "object" == typeof c ? J(b) : b._d = new Date(c)
    }
    function R(a, b, c, d, e, f, g) {
        var h = new Date(a,b,c,d,e,f,g);
        return 1970 > a && h.setFullYear(a),
        h
    }
    function S(a) {
        var b = new Date(Date.UTC.apply(null, arguments));
        return 1970 > a && b.setUTCFullYear(a),
        b
    }
    function T(a, b) {
        if ("string" == typeof a)
            if (isNaN(a)) {
                if (a = b.weekdaysParse(a),
                "number" != typeof a)
                    return null
            } else
                a = parseInt(a, 10);
        return a
    }
    function U(a, b, c, d, e) {
        return e.relativeTime(b || 1, !!c, a, d)
    }
    function V(a, b, c) {
        var d = eb(Math.abs(a) / 1e3)
          , e = eb(d / 60)
          , f = eb(e / 60)
          , g = eb(f / 24)
          , h = eb(g / 365)
          , i = 45 > d && ["s", d] || 1 === e && ["m"] || 45 > e && ["mm", e] || 1 === f && ["h"] || 22 > f && ["hh", f] || 1 === g && ["d"] || 25 >= g && ["dd", g] || 45 >= g && ["M"] || 345 > g && ["MM", eb(g / 30)] || 1 === h && ["y"] || ["yy", h];
        return i[2] = b,
        i[3] = a > 0,
        i[4] = c,
        U.apply({}, i)
    }
    function W(a, b, c) {
        var d, e = c - b, f = c - a.day();
        return f > e && (f -= 7),
        e - 7 > f && (f += 7),
        d = bb(a).add("d", f),
        {
            week: Math.ceil(d.dayOfYear() / 7),
            year: d.year()
        }
    }
    function X(a, b, c, d, e) {
        var f, g, h = new Date(Date.UTC(a, 0)).getUTCDay();
        return c = null != c ? c : e,
        f = e - h + (h > d ? 7 : 0),
        g = 7 * (b - 1) + (c - e) + f + 1,
        {
            year: g > 0 ? a : a - 1,
            dayOfYear: g > 0 ? g : s(a - 1) + g
        }
    }
    function Y(a) {
        var b = a._i
          , c = a._f;
        return "undefined" == typeof a._pf && v(a),
        null === b ? bb.invalid({
            nullInput: !0
        }) : ("string" == typeof b && (a._i = b = A().preparse(b)),
        bb.isMoment(b) ? (a = g({}, b),
        a._d = new Date(+b._d)) : c ? k(c) ? O(a) : L(a) : Q(a),
        new e(a))
    }
    function Z(a, b) {
        bb.fn[a] = bb.fn[a + "s"] = function(a) {
            var c = this._isUTC ? "UTC" : "";
            return null != a ? (this._d["set" + c + b](a),
            bb.updateOffset(this),
            this) : this._d["get" + c + b]()
        }
    }
    function $(a) {
        bb.duration.fn[a] = function() {
            return this._data[a]
        }
    }
    function _(a, b) {
        bb.duration.fn["as" + a] = function() {
            return +this / b
        }
    }
    function ab(a) {
        var b = !1
          , c = bb;
        "undefined" == typeof ender && (this.moment = a ? function() {
            return !b && console && console.warn && (b = !0,
            console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),
            c.apply(null, arguments)
        }
        : bb)
    }
    for (var bb, cb, db = "2.4.0", eb = Math.round, fb = 0, gb = 1, hb = 2, ib = 3, jb = 4, kb = 5, lb = 6, mb = {}, nb = "undefined" != typeof module && module.exports, ob = /^\/?Date\((\-?\d+)/i, pb = /(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/, qb = /^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/, rb = /(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g, sb = /(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g, tb = /\d\d?/, ub = /\d{1,3}/, vb = /\d{3}/, wb = /\d{1,4}/, xb = /[+\-]?\d{1,6}/, yb = /\d+/, zb = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i, Ab = /Z|[\+\-]\d\d:?\d\d/i, Bb = /T/i, Cb = /[\+\-]?\d+(\.\d{1,3})?/, Db = /^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d:?\d\d|Z)?)?$/, Eb = "YYYY-MM-DDTHH:mm:ssZ", Fb = ["YYYY-MM-DD", "GGGG-[W]WW", "GGGG-[W]WW-E", "YYYY-DDD"], Gb = [["HH:mm:ss.SSSS", /(T| )\d\d:\d\d:\d\d\.\d{1,3}/], ["HH:mm:ss", /(T| )\d\d:\d\d:\d\d/], ["HH:mm", /(T| )\d\d:\d\d/], ["HH", /(T| )\d\d/]], Hb = /([\+\-]|\d\d)/gi, Ib = "Date|Hours|Minutes|Seconds|Milliseconds".split("|"), Jb = {
        Milliseconds: 1,
        Seconds: 1e3,
        Minutes: 6e4,
        Hours: 36e5,
        Days: 864e5,
        Months: 2592e6,
        Years: 31536e6
    }, Kb = {
        ms: "millisecond",
        s: "second",
        m: "minute",
        h: "hour",
        d: "day",
        D: "date",
        w: "week",
        W: "isoWeek",
        M: "month",
        y: "year",
        DDD: "dayOfYear",
        e: "weekday",
        E: "isoWeekday",
        gg: "weekYear",
        GG: "isoWeekYear"
    }, Lb = {
        dayofyear: "dayOfYear",
        isoweekday: "isoWeekday",
        isoweek: "isoWeek",
        weekyear: "weekYear",
        isoweekyear: "isoWeekYear"
    }, Mb = {}, Nb = "DDD w W M D d".split(" "), Ob = "M D H h m s w W".split(" "), Pb = {
        M: function() {
            return this.month() + 1
        },
        MMM: function(a) {
            return this.lang().monthsShort(this, a)
        },
        MMMM: function(a) {
            return this.lang().months(this, a)
        },
        D: function() {
            return this.date()
        },
        DDD: function() {
            return this.dayOfYear()
        },
        d: function() {
            return this.day()
        },
        dd: function(a) {
            return this.lang().weekdaysMin(this, a)
        },
        ddd: function(a) {
            return this.lang().weekdaysShort(this, a)
        },
        dddd: function(a) {
            return this.lang().weekdays(this, a)
        },
        w: function() {
            return this.week()
        },
        W: function() {
            return this.isoWeek()
        },
        YY: function() {
            return i(this.year() % 100, 2)
        },
        YYYY: function() {
            return i(this.year(), 4)
        },
        YYYYY: function() {
            return i(this.year(), 5)
        },
        gg: function() {
            return i(this.weekYear() % 100, 2)
        },
        gggg: function() {
            return this.weekYear()
        },
        ggggg: function() {
            return i(this.weekYear(), 5)
        },
        GG: function() {
            return i(this.isoWeekYear() % 100, 2)
        },
        GGGG: function() {
            return this.isoWeekYear()
        },
        GGGGG: function() {
            return i(this.isoWeekYear(), 5)
        },
        e: function() {
            return this.weekday()
        },
        E: function() {
            return this.isoWeekday()
        },
        a: function() {
            return this.lang().meridiem(this.hours(), this.minutes(), !0)
        },
        A: function() {
            return this.lang().meridiem(this.hours(), this.minutes(), !1)
        },
        H: function() {
            return this.hours()
        },
        h: function() {
            return this.hours() % 12 || 12
        },
        m: function() {
            return this.minutes()
        },
        s: function() {
            return this.seconds()
        },
        S: function() {
            return q(this.milliseconds() / 100)
        },
        SS: function() {
            return i(q(this.milliseconds() / 10), 2)
        },
        SSS: function() {
            return i(this.milliseconds(), 3)
        },
        SSSS: function() {
            return i(this.milliseconds(), 3)
        },
        Z: function() {
            var a = -this.zone()
              , b = "+";
            return 0 > a && (a = -a,
            b = "-"),
            b + i(q(a / 60), 2) + ":" + i(q(a) % 60, 2)
        },
        ZZ: function() {
            var a = -this.zone()
              , b = "+";
            return 0 > a && (a = -a,
            b = "-"),
            b + i(q(10 * a / 6), 4)
        },
        z: function() {
            return this.zoneAbbr()
        },
        zz: function() {
            return this.zoneName()
        },
        X: function() {
            return this.unix()
        }
    }, Qb = ["months", "monthsShort", "weekdays", "weekdaysShort", "weekdaysMin"]; Nb.length; )
        cb = Nb.pop(),
        Pb[cb + "o"] = c(Pb[cb], cb);
    for (; Ob.length; )
        cb = Ob.pop(),
        Pb[cb + cb] = b(Pb[cb], 2);
    for (Pb.DDDD = b(Pb.DDD, 3),
    g(d.prototype, {
        set: function(a) {
            var b, c;
            for (c in a)
                b = a[c],
                "function" == typeof b ? this[c] = b : this["_" + c] = b
        },
        _months: "January_February_March_April_May_June_July_August_September_October_November_December".split("_"),
        months: function(a) {
            return this._months[a.month()]
        },
        _monthsShort: "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),
        monthsShort: function(a) {
            return this._monthsShort[a.month()]
        },
        monthsParse: function(a) {
            var b, c, d;
            for (this._monthsParse || (this._monthsParse = []),
            b = 0; 12 > b; b++)
                if (this._monthsParse[b] || (c = bb.utc([2e3, b]),
                d = "^" + this.months(c, "") + "|^" + this.monthsShort(c, ""),
                this._monthsParse[b] = new RegExp(d.replace(".", ""),"i")),
                this._monthsParse[b].test(a))
                    return b
        },
        _weekdays: "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),
        weekdays: function(a) {
            return this._weekdays[a.day()]
        },
        _weekdaysShort: "Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),
        weekdaysShort: function(a) {
            return this._weekdaysShort[a.day()]
        },
        _weekdaysMin: "Su_Mo_Tu_We_Th_Fr_Sa".split("_"),
        weekdaysMin: function(a) {
            return this._weekdaysMin[a.day()]
        },
        weekdaysParse: function(a) {
            var b, c, d;
            for (this._weekdaysParse || (this._weekdaysParse = []),
            b = 0; 7 > b; b++)
                if (this._weekdaysParse[b] || (c = bb([2e3, 1]).day(b),
                d = "^" + this.weekdays(c, "") + "|^" + this.weekdaysShort(c, "") + "|^" + this.weekdaysMin(c, ""),
                this._weekdaysParse[b] = new RegExp(d.replace(".", ""),"i")),
                this._weekdaysParse[b].test(a))
                    return b
        },
        _longDateFormat: {
            LT: "h:mm A",
            L: "MM/DD/YYYY",
            LL: "MMMM D YYYY",
            LLL: "MMMM D YYYY LT",
            LLLL: "dddd, MMMM D YYYY LT"
        },
        longDateFormat: function(a) {
            var b = this._longDateFormat[a];
            return !b && this._longDateFormat[a.toUpperCase()] && (b = this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g, function(a) {
                return a.slice(1)
            }),
            this._longDateFormat[a] = b),
            b
        },
        isPM: function(a) {
            return "p" === (a + "").toLowerCase().charAt(0)
        },
        _meridiemParse: /[ap]\.?m?\.?/i,
        meridiem: function(a, b, c) {
            return a > 11 ? c ? "pm" : "PM" : c ? "am" : "AM"
        },
        _calendar: {
            sameDay: "[Today at] LT",
            nextDay: "[Tomorrow at] LT",
            nextWeek: "dddd [at] LT",
            lastDay: "[Yesterday at] LT",
            lastWeek: "[Last] dddd [at] LT",
            sameElse: "L"
        },
        calendar: function(a, b) {
            var c = this._calendar[a];
            return "function" == typeof c ? c.apply(b) : c
        },
        _relativeTime: {
            future: "in %s",
            past: "%s ago",
            s: "a few seconds",
            m: "a minute",
            mm: "%d minutes",
            h: "an hour",
            hh: "%d hours",
            d: "a day",
            dd: "%d days",
            M: "a month",
            MM: "%d months",
            y: "a year",
            yy: "%d years"
        },
        relativeTime: function(a, b, c, d) {
            var e = this._relativeTime[c];
            return "function" == typeof e ? e(a, b, c, d) : e.replace(/%d/i, a)
        },
        pastFuture: function(a, b) {
            var c = this._relativeTime[a > 0 ? "future" : "past"];
            return "function" == typeof c ? c(b) : c.replace(/%s/i, b)
        },
        ordinal: function(a) {
            return this._ordinal.replace("%d", a)
        },
        _ordinal: "%d",
        preparse: function(a) {
            return a
        },
        postformat: function(a) {
            return a
        },
        week: function(a) {
            return W(a, this._week.dow, this._week.doy).week
        },
        _week: {
            dow: 0,
            doy: 6
        },
        _invalidDate: "Invalid date",
        invalidDate: function() {
            return this._invalidDate
        }
    }),
    bb = function(b, c, d, e) {
        return "boolean" == typeof d && (e = d,
        d = a),
        Y({
            _i: b,
            _f: c,
            _l: d,
            _strict: e,
            _isUTC: !1
        })
    }
    ,
    bb.utc = function(b, c, d, e) {
        var f;
        return "boolean" == typeof d && (e = d,
        d = a),
        f = Y({
            _useUTC: !0,
            _isUTC: !0,
            _l: d,
            _i: b,
            _f: c,
            _strict: e
        }).utc()
    }
    ,
    bb.unix = function(a) {
        return bb(1e3 * a)
    }
    ,
    bb.duration = function(a, b) {
        var c, d, e, g = bb.isDuration(a), h = "number" == typeof a, i = g ? a._input : h ? {} : a, j = null;
        return h ? b ? i[b] = a : i.milliseconds = a : (j = pb.exec(a)) ? (c = "-" === j[1] ? -1 : 1,
        i = {
            y: 0,
            d: q(j[hb]) * c,
            h: q(j[ib]) * c,
            m: q(j[jb]) * c,
            s: q(j[kb]) * c,
            ms: q(j[lb]) * c
        }) : (j = qb.exec(a)) && (c = "-" === j[1] ? -1 : 1,
        e = function(a) {
            var b = a && parseFloat(a.replace(",", "."));
            return (isNaN(b) ? 0 : b) * c
        }
        ,
        i = {
            y: e(j[2]),
            M: e(j[3]),
            d: e(j[4]),
            h: e(j[5]),
            m: e(j[6]),
            s: e(j[7]),
            w: e(j[8])
        }),
        d = new f(i),
        g && a.hasOwnProperty("_lang") && (d._lang = a._lang),
        d
    }
    ,
    bb.version = db,
    bb.defaultFormat = Eb,
    bb.updateOffset = function() {}
    ,
    bb.lang = function(a, b) {
        var c;
        return a ? (b ? y(x(a), b) : null === b ? (z(a),
        a = "en") : mb[a] || A(a),
        c = bb.duration.fn._lang = bb.fn._lang = A(a),
        c._abbr) : bb.fn._lang._abbr
    }
    ,
    bb.langData = function(a) {
        return a && a._lang && a._lang._abbr && (a = a._lang._abbr),
        A(a)
    }
    ,
    bb.isMoment = function(a) {
        return a instanceof e
    }
    ,
    bb.isDuration = function(a) {
        return a instanceof f
    }
    ,
    cb = Qb.length - 1; cb >= 0; --cb)
        p(Qb[cb]);
    for (bb.normalizeUnits = function(a) {
        return n(a)
    }
    ,
    bb.invalid = function(a) {
        var b = bb.utc(0 / 0);
        return null != a ? g(b._pf, a) : b._pf.userInvalidated = !0,
        b
    }
    ,
    bb.parseZone = function(a) {
        return bb(a).parseZone()
    }
    ,
    g(bb.fn = e.prototype, {
        clone: function() {
            return bb(this)
        },
        valueOf: function() {
            return +this._d + 6e4 * (this._offset || 0)
        },
        unix: function() {
            return Math.floor(+this / 1e3)
        },
        toString: function() {
            return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")
        },
        toDate: function() {
            return this._offset ? new Date(+this) : this._d
        },
        toISOString: function() {
            return D(bb(this).utc(), "YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")
        },
        toArray: function() {
            var a = this;
            return [a.year(), a.month(), a.date(), a.hours(), a.minutes(), a.seconds(), a.milliseconds()]
        },
        isValid: function() {
            return w(this)
        },
        isDSTShifted: function() {
            return this._a ? this.isValid() && m(this._a, (this._isUTC ? bb.utc(this._a) : bb(this._a)).toArray()) > 0 : !1
        },
        parsingFlags: function() {
            return g({}, this._pf)
        },
        invalidAt: function() {
            return this._pf.overflow
        },
        utc: function() {
            return this.zone(0)
        },
        local: function() {
            return this.zone(0),
            this._isUTC = !1,
            this
        },
        format: function(a) {
            var b = D(this, a || bb.defaultFormat);
            return this.lang().postformat(b)
        },
        add: function(a, b) {
            var c;
            return c = "string" == typeof a ? bb.duration(+b, a) : bb.duration(a, b),
            j(this, c, 1),
            this
        },
        subtract: function(a, b) {
            var c;
            return c = "string" == typeof a ? bb.duration(+b, a) : bb.duration(a, b),
            j(this, c, -1),
            this
        },
        diff: function(a, b, c) {
            var d, e, f = this._isUTC ? bb(a).zone(this._offset || 0) : bb(a).local(), g = 6e4 * (this.zone() - f.zone());
            return b = n(b),
            "year" === b || "month" === b ? (d = 432e5 * (this.daysInMonth() + f.daysInMonth()),
            e = 12 * (this.year() - f.year()) + (this.month() - f.month()),
            e += (this - bb(this).startOf("month") - (f - bb(f).startOf("month"))) / d,
            e -= 6e4 * (this.zone() - bb(this).startOf("month").zone() - (f.zone() - bb(f).startOf("month").zone())) / d,
            "year" === b && (e /= 12)) : (d = this - f,
            e = "second" === b ? d / 1e3 : "minute" === b ? d / 6e4 : "hour" === b ? d / 36e5 : "day" === b ? (d - g) / 864e5 : "week" === b ? (d - g) / 6048e5 : d),
            c ? e : h(e)
        },
        from: function(a, b) {
            return bb.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)
        },
        fromNow: function(a) {
            return this.from(bb(), a)
        },
        calendar: function() {
            var a = this.diff(bb().zone(this.zone()).startOf("day"), "days", !0)
              , b = -6 > a ? "sameElse" : -1 > a ? "lastWeek" : 0 > a ? "lastDay" : 1 > a ? "sameDay" : 2 > a ? "nextDay" : 7 > a ? "nextWeek" : "sameElse";
            return this.format(this.lang().calendar(b, this))
        },
        isLeapYear: function() {
            return t(this.year())
        },
        isDST: function() {
            return this.zone() < this.clone().month(0).zone() || this.zone() < this.clone().month(5).zone()
        },
        day: function(a) {
            var b = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
            return null != a ? (a = T(a, this.lang()),
            this.add({
                d: a - b
            })) : b
        },
        month: function(a) {
            var b, c = this._isUTC ? "UTC" : "";
            return null != a ? "string" == typeof a && (a = this.lang().monthsParse(a),
            "number" != typeof a) ? this : (b = this.date(),
            this.date(1),
            this._d["set" + c + "Month"](a),
            this.date(Math.min(b, this.daysInMonth())),
            bb.updateOffset(this),
            this) : this._d["get" + c + "Month"]()
        },
        startOf: function(a) {
            switch (a = n(a)) {
            case "year":
                this.month(0);
            case "month":
                this.date(1);
            case "week":
            case "isoWeek":
            case "day":
                this.hours(0);
            case "hour":
                this.minutes(0);
            case "minute":
                this.seconds(0);
            case "second":
                this.milliseconds(0)
            }
            return "week" === a ? this.weekday(0) : "isoWeek" === a && this.isoWeekday(1),
            this
        },
        endOf: function(a) {
            return a = n(a),
            this.startOf(a).add("isoWeek" === a ? "week" : a, 1).subtract("ms", 1)
        },
        isAfter: function(a, b) {
            return b = "undefined" != typeof b ? b : "millisecond",
            +this.clone().startOf(b) > +bb(a).startOf(b)
        },
        isBefore: function(a, b) {
            return b = "undefined" != typeof b ? b : "millisecond",
            +this.clone().startOf(b) < +bb(a).startOf(b)
        },
        isSame: function(a, b) {
            return b = "undefined" != typeof b ? b : "millisecond",
            +this.clone().startOf(b) === +bb(a).startOf(b)
        },
        min: function(a) {
            return a = bb.apply(null, arguments),
            this > a ? this : a
        },
        max: function(a) {
            return a = bb.apply(null, arguments),
            a > this ? this : a
        },
        zone: function(a) {
            var b = this._offset || 0;
            return null == a ? this._isUTC ? b : this._d.getTimezoneOffset() : ("string" == typeof a && (a = G(a)),
            Math.abs(a) < 16 && (a = 60 * a),
            this._offset = a,
            this._isUTC = !0,
            b !== a && j(this, bb.duration(b - a, "m"), 1, !0),
            this)
        },
        zoneAbbr: function() {
            return this._isUTC ? "UTC" : ""
        },
        zoneName: function() {
            return this._isUTC ? "Coordinated Universal Time" : ""
        },
        parseZone: function() {
            return "string" == typeof this._i && this.zone(this._i),
            this
        },
        hasAlignedHourOffset: function(a) {
            return a = a ? bb(a).zone() : 0,
            (this.zone() - a) % 60 === 0
        },
        daysInMonth: function() {
            return r(this.year(), this.month())
        },
        dayOfYear: function(a) {
            var b = eb((bb(this).startOf("day") - bb(this).startOf("year")) / 864e5) + 1;
            return null == a ? b : this.add("d", a - b)
        },
        weekYear: function(a) {
            var b = W(this, this.lang()._week.dow, this.lang()._week.doy).year;
            return null == a ? b : this.add("y", a - b)
        },
        isoWeekYear: function(a) {
            var b = W(this, 1, 4).year;
            return null == a ? b : this.add("y", a - b)
        },
        week: function(a) {
            var b = this.lang().week(this);
            return null == a ? b : this.add("d", 7 * (a - b))
        },
        isoWeek: function(a) {
            var b = W(this, 1, 4).week;
            return null == a ? b : this.add("d", 7 * (a - b))
        },
        weekday: function(a) {
            var b = (this.day() + 7 - this.lang()._week.dow) % 7;
            return null == a ? b : this.add("d", a - b)
        },
        isoWeekday: function(a) {
            return null == a ? this.day() || 7 : this.day(this.day() % 7 ? a : a - 7)
        },
        get: function(a) {
            return a = n(a),
            this[a]()
        },
        set: function(a, b) {
            return a = n(a),
            "function" == typeof this[a] && this[a](b),
            this
        },
        lang: function(b) {
            return b === a ? this._lang : (this._lang = A(b),
            this)
        }
    }),
    cb = 0; cb < Ib.length; cb++)
        Z(Ib[cb].toLowerCase().replace(/s$/, ""), Ib[cb]);
    Z("year", "FullYear"),
    bb.fn.days = bb.fn.day,
    bb.fn.months = bb.fn.month,
    bb.fn.weeks = bb.fn.week,
    bb.fn.isoWeeks = bb.fn.isoWeek,
    bb.fn.toJSON = bb.fn.toISOString,
    g(bb.duration.fn = f.prototype, {
        _bubble: function() {
            var a, b, c, d, e = this._milliseconds, f = this._days, g = this._months, i = this._data;
            i.milliseconds = e % 1e3,
            a = h(e / 1e3),
            i.seconds = a % 60,
            b = h(a / 60),
            i.minutes = b % 60,
            c = h(b / 60),
            i.hours = c % 24,
            f += h(c / 24),
            i.days = f % 30,
            g += h(f / 30),
            i.months = g % 12,
            d = h(g / 12),
            i.years = d
        },
        weeks: function() {
            return h(this.days() / 7)
        },
        valueOf: function() {
            return this._milliseconds + 864e5 * this._days + this._months % 12 * 2592e6 + 31536e6 * q(this._months / 12)
        },
        humanize: function(a) {
            var b = +this
              , c = V(b, !a, this.lang());
            return a && (c = this.lang().pastFuture(b, c)),
            this.lang().postformat(c)
        },
        add: function(a, b) {
            var c = bb.duration(a, b);
            return this._milliseconds += c._milliseconds,
            this._days += c._days,
            this._months += c._months,
            this._bubble(),
            this
        },
        subtract: function(a, b) {
            var c = bb.duration(a, b);
            return this._milliseconds -= c._milliseconds,
            this._days -= c._days,
            this._months -= c._months,
            this._bubble(),
            this
        },
        get: function(a) {
            return a = n(a),
            this[a.toLowerCase() + "s"]()
        },
        as: function(a) {
            return a = n(a),
            this["as" + a.charAt(0).toUpperCase() + a.slice(1) + "s"]()
        },
        lang: bb.fn.lang,
        toIsoString: function() {
            var a = Math.abs(this.years())
              , b = Math.abs(this.months())
              , c = Math.abs(this.days())
              , d = Math.abs(this.hours())
              , e = Math.abs(this.minutes())
              , f = Math.abs(this.seconds() + this.milliseconds() / 1e3);
            return this.asSeconds() ? (this.asSeconds() < 0 ? "-" : "") + "P" + (a ? a + "Y" : "") + (b ? b + "M" : "") + (c ? c + "D" : "") + (d || e || f ? "T" : "") + (d ? d + "H" : "") + (e ? e + "M" : "") + (f ? f + "S" : "") : "P0D"
        }
    });
    for (cb in Jb)
        Jb.hasOwnProperty(cb) && (_(cb, Jb[cb]),
        $(cb.toLowerCase()));
    _("Weeks", 6048e5),
    bb.duration.fn.asMonths = function() {
        return (+this - 31536e6 * this.years()) / 2592e6 + 12 * this.years()
    }
    ,
    bb.lang("en", {
        ordinal: function(a) {
            var b = a % 10
              , c = 1 === q(a % 100 / 10) ? "th" : 1 === b ? "st" : 2 === b ? "nd" : 3 === b ? "rd" : "th";
            return a + c
        }
    }),
    nb ? (module.exports = bb,
    ab(!0)) : "function" == typeof define && define.amd ? define("moment", function(b, c, d) {
        return d.config().noGlobal !== !0 && ab(d.config().noGlobal === a),
        bb
    }) : ab()
}
.call(this),
function() {
    "use strict";
    function a(a, b) {
        var c = a[0] - b[0]
          , d = a[1] - b[1];
        return c * c + d * d
    }
    function b(a, b, c) {
        var d = b[0]
          , e = b[1]
          , f = c[0] - d
          , g = c[1] - e;
        if (0 !== f || 0 !== g) {
            var h = ((a[0] - d) * f + (a[1] - e) * g) / (f * f + g * g);
            h > 1 ? (d = c[0],
            e = c[1]) : h > 0 && (d += f * h,
            e += g * h)
        }
        return f = a[0] - d,
        g = a[1] - e,
        f * f + g * g
    }
    function c(b, c) {
        for (var d, e = b[0], f = [e], g = 1, h = b.length; h > g; g++)
            d = b[g],
            a(d, e) > c && (f.push(d),
            e = d);
        return e !== d && f.push(d),
        f
    }
    function d(a, c) {
        var d, e, f, g, h = a.length, i = "undefined" != typeof Uint8Array ? Uint8Array : Array, j = new i(h), k = 0, l = h - 1, m = [], n = [];
        for (j[k] = j[l] = 1; l; ) {
            for (e = 0,
            d = k + 1; l > d; d++)
                f = b(a[d], a[k], a[l]),
                f > e && (g = d,
                e = f);
            e > c && (j[g] = 1,
            m.push(k, g, g, l)),
            l = m.pop(),
            k = m.pop()
        }
        for (d = 0; h > d; d++)
            j[d] && n.push(a[d]);
        return n
    }
    function e(a, b, e) {
        var f = void 0 !== b ? b * b : 1;
        return a = e ? a : c(a, f),
        a = d(a, f)
    }
    "function" == typeof define && define.amd ? define(function() {
        return e
    }) : "undefined" != typeof module ? module.exports = e : window.simplify = e
}(),
!function(a) {
    if ("object" == typeof exports)
        module.exports = a();
    else if ("function" == typeof define && define.amd)
        define(a);
    else {
        var b;
        "undefined" != typeof window ? b = window : "undefined" != typeof global ? b = global : "undefined" != typeof self && (b = self),
        b.throat = a()
    }
}(function() {
    return function a(b, c, d) {
        function e(g, h) {
            if (!c[g]) {
                if (!b[g]) {
                    var i = "function" == typeof require && require;
                    if (!h && i)
                        return i(g, !0);
                    if (f)
                        return f(g, !0);
                    throw new Error("Cannot find module '" + g + "'")
                }
                var j = c[g] = {
                    exports: {}
                };
                b[g][0].call(j.exports, function(a) {
                    var c = b[g][1][a];
                    return e(c ? c : a)
                }, j, j.exports, a, b, c, d)
            }
            return c[g].exports
        }
        for (var f = "function" == typeof require && require, g = 0; g < d.length; g++)
            e(d[g]);
        return e
    }({
        1: [function(a, b) {
            "use strict";
            function c(a, b) {
                function c(b, c, h) {
                    if (a) {
                        a--;
                        var i = new e(function(a) {
                            a(b.apply(c, h))
                        }
                        );
                        return i.done(f, f),
                        i
                    }
                    return new e(function(a) {
                        g.push(new d(a,b,c,h))
                    }
                    )
                }
                function f() {
                    if (a++,
                    g.length) {
                        var b = g.shift();
                        b.resolve(c(b.fn, b.self, b.args))
                    }
                }
                var g = [];
                return "function" == typeof b ? function() {
                    return c(b, this, arguments)
                }
                : function(a) {
                    return c(a, this, Array.prototype.slice.call(arguments, 1))
                }
            }
            function d(a, b, c, d) {
                this.resolve = a,
                this.fn = b,
                this.self = c || null,
                this.args = d || null
            }
            var e = a("promise");
            b.exports = c
        }
        , {
            promise: 3
        }],
        2: [function(a, b) {
            "use strict";
            function c(a) {
                function b(a) {
                    return null === k ? (n.push(a),
                    void 0) : (e(function() {
                        var b = k ? a.onFulfilled : a.onRejected;
                        if (null === b)
                            return (k ? a.resolve : a.reject)(m),
                            void 0;
                        var c;
                        try {
                            c = b(m)
                        } catch (d) {
                            return a.reject(d),
                            void 0
                        }
                        a.resolve(c)
                    }),
                    void 0)
                }
                function f(a) {
                    l || g(a)
                }
                function g(a) {
                    if (null === k)
                        try {
                            if (a === o)
                                throw new TypeError("A promise cannot be resolved with itself.");
                            if (a && ("object" == typeof a || "function" == typeof a)) {
                                var b = a.then;
                                if ("function" == typeof b)
                                    return l = !0,
                                    b.call(a, g, i),
                                    void 0
                            }
                            k = !0,
                            m = a,
                            j()
                        } catch (c) {
                            i(c)
                        }
                }
                function h(a) {
                    l || i(a)
                }
                function i(a) {
                    null === k && (k = !1,
                    m = a,
                    j())
                }
                function j() {
                    for (var a = 0, c = n.length; c > a; a++)
                        b(n[a]);
                    n = null
                }
                if (!(this instanceof c))
                    return new c(a);
                if ("function" != typeof a)
                    throw new TypeError("not a function");
                var k = null
                  , l = !1
                  , m = null
                  , n = []
                  , o = this;
                this.then = function(a, e) {
                    return new c(function(c, f) {
                        b(new d(a,e,c,f))
                    }
                    )
                }
                ;
                try {
                    a(f, h)
                } catch (p) {
                    h(p)
                }
            }
            function d(a, b, c, d) {
                this.onFulfilled = "function" == typeof a ? a : null,
                this.onRejected = "function" == typeof b ? b : null,
                this.resolve = c,
                this.reject = d
            }
            var e = a("./lib/next-tick");
            b.exports = c
        }
        , {
            "./lib/next-tick": 4
        }],
        3: [function(a, b) {
            "use strict";
            var c = a("./core.js")
              , d = a("./lib/next-tick");
            b.exports = c,
            c.from = function(a) {
                return a instanceof c ? a : new c(function(b) {
                    b(a)
                }
                )
            }
            ,
            c.denodeify = function(a) {
                return function() {
                    var b = this
                      , d = Array.prototype.slice.call(arguments);
                    return new c(function(c, e) {
                        d.push(function(a, b) {
                            a ? e(a) : c(b)
                        }),
                        a.apply(b, d)
                    }
                    )
                }
            }
            ,
            c.nodeify = function(a) {
                return function() {
                    var b = Array.prototype.slice.call(arguments)
                      , e = "function" == typeof b[b.length - 1] ? b.pop() : null;
                    try {
                        return a.apply(this, arguments).nodeify(e)
                    } catch (f) {
                        if (null == e)
                            return new c(function(a, b) {
                                b(f)
                            }
                            );
                        d(function() {
                            e(f)
                        })
                    }
                }
            }
            ,
            c.all = function() {
                var a = Array.prototype.slice.call(1 === arguments.length && Array.isArray(arguments[0]) ? arguments[0] : arguments);
                return new c(function(b, c) {
                    function d(f, g) {
                        try {
                            if (g && ("object" == typeof g || "function" == typeof g)) {
                                var h = g.then;
                                if ("function" == typeof h)
                                    return h.call(g, function(a) {
                                        d(f, a)
                                    }, c),
                                    void 0
                            }
                            a[f] = g,
                            0 === --e && b(a)
                        } catch (i) {
                            c(i)
                        }
                    }
                    if (0 === a.length)
                        return b([]);
                    for (var e = a.length, f = 0; f < a.length; f++)
                        d(f, a[f])
                }
                )
            }
            ,
            c.prototype.done = function() {
                var a = arguments.length ? this.then.apply(this, arguments) : this;
                a.then(null, function(a) {
                    d(function() {
                        throw a
                    })
                })
            }
            ,
            c.prototype.nodeify = function(a) {
                return null == a ? this : (this.then(function(b) {
                    d(function() {
                        a(null, b)
                    })
                }, function(b) {
                    d(function() {
                        a(b)
                    })
                }),
                void 0)
            }
        }
        , {
            "./core.js": 2,
            "./lib/next-tick": 4
        }],
        4: [function(a, b) {
            (function(a) {
                "use strict";
                b.exports = "function" == typeof setImmediate ? function(a) {
                    setImmediate(a)
                }
                : "undefined" != typeof a && a && "function" == typeof a.nextTick ? function(b) {
                    a.nextTick(b)
                }
                : function(a) {
                    setTimeout(a, 0)
                }
            }
            ).call(this, a("/usr/local/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
        }
        , {
            "/usr/local/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js": 5
        }],
        5: [function(a, b) {
            var c = b.exports = {};
            c.nextTick = function() {
                var a = "undefined" != typeof window && window.setImmediate
                  , b = "undefined" != typeof window && window.postMessage && window.addEventListener;
                if (a)
                    return function(a) {
                        return window.setImmediate(a)
                    }
                    ;
                if (b) {
                    var c = [];
                    return window.addEventListener("message", function(a) {
                        var b = a.source;
                        if ((b === window || null === b) && "process-tick" === a.data && (a.stopPropagation(),
                        c.length > 0)) {
                            var d = c.shift();
                            d()
                        }
                    }, !0),
                    function(a) {
                        c.push(a),
                        window.postMessage("process-tick", "*")
                    }
                }
                return function(a) {
                    setTimeout(a, 0)
                }
            }(),
            c.title = "browser",
            c.browser = !0,
            c.env = {},
            c.argv = [],
            c.binding = function() {
                throw new Error("process.binding is not supported")
            }
            ,
            c.cwd = function() {
                return "/"
            }
            ,
            c.chdir = function() {
                throw new Error("process.chdir is not supported")
            }
        }
        , {}]
    }, {}, [1])(1)
}),
function() {
    "use strict";
    var a = {
        VERSION: 1,
        DEBUG: !1
    };
    // console.log("\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n\r\n\u2588\u2588\u2557   \u2588\u2588\u2557\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2557 \u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\r\n\u2588\u2588\u2551   \u2588\u2588\u2551\u2588\u2588\u2551\u255a\u2550\u2550\u2588\u2588\u2588\u2554\u255d\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255d\u2588\u2588\u2551\u255a\u2550\u2550\u2588\u2588\u2554\u2550\u2550\u255d\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255d\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255d\r\n\u2588\u2588\u2551   \u2588\u2588\u2551\u2588\u2588\u2551  \u2588\u2588\u2588\u2554\u255d \u2588\u2588\u2551\u2588\u2588\u2551     \u2588\u2588\u2551   \u2588\u2588\u2551   \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\r\n\u255a\u2588\u2588\u2557 \u2588\u2588\u2554\u255d\u2588\u2588\u2551 \u2588\u2588\u2588\u2554\u255d  \u2588\u2588\u2551\u2588\u2588\u2551     \u2588\u2588\u2551   \u2588\u2588\u2551   \u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u255d  \u255a\u2550\u2550\u2550\u2550\u2588\u2588\u2551\r\n \u255a\u2588\u2588\u2588\u2588\u2554\u255d \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2551\u255a\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2551   \u2588\u2588\u2551   \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\r\n  \u255a\u2550\u2550\u2550\u255d  \u255a\u2550\u255d\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u255d\u255a\u2550\u255d \u255a\u2550\u2550\u2550\u2550\u2550\u255d\u255a\u2550\u255d   \u255a\u2550\u255d   \u255a\u2550\u255d\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u255d\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u255d\r\n\r\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 0.1.0 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550"),
    window.MapGL = a
}(),
function() {
    "use strict";
    MapGL.Log = function() {
        if (MapGL.DEBUG) {
            var a = Array.prototype.slice.call(arguments)
              , b = "[" + moment().format("HH:mm:ss.SSS") + "]";
            a.unshift(b),
            console && console.log.apply(console, a)
        }
    }
}(),
function() {
    "use strict";
    MapGL.Mediator = function() {
        var a = {}
          , b = function(b, c) {
            return a[b] || (a[b] = []),
            a[b].push({
                context: this,
                callback: c
            }),
            this
        }
          , c = function(b) {
            var c;
            if (!a[b])
                return !1;
            c = Array.prototype.slice.call(arguments, 1);
            for (var d = 0, e = a[b].length; e > d; d++) {
                var f = a[b][d];
                f.callback.apply(f.context, c)
            }
            return this
        };
        return {
            publish: c,
            subscribe: b
        }
    }()
}(),
function() {
    "use strict";
    MapGL.Animation = function() {
        var a = {
            cubicIn: function(a) {
                return Math.pow(a, 3)
            },
            cubicInOut: function(b) {
                return .5 > b ? a.cubicIn(2 * b) / 2 : 1 - a.cubicIn(2 * (1 - b)) / 2
            }
        };
        return {
            easing: a
        }
    }()
}(),
function() {
    "use strict";
    MapGL.Dat = function() {
        MapGL.Log("Inititialising dat.GUI"),
        _.extend(this, MapGL.Mediator),
        this.gui = this.createGUI(),
        this.subscribe("addToDat", this.addToDat)
    }
    ,
    MapGL.Dat.prototype.createGUI = function() {
        MapGL.Log("Creating dat.GUI");
        var a = new dat.GUI;
        return a.close(),
        a
    }
    ,
    MapGL.Dat.prototype.addToDat = function(a, b) {
        MapGL.Log("Adding " + b.name + " to dat.GUI");
        var c = this.gui.addFolder(b.name);
        _.each(b.properties, function(b) {
            var d = c.add(a, b).listen();
            a.datChange && d.onChange(function() {
                a.datChange()
            })
        })
    }
}(),
function() {
    "use strict";
    MapGL.FPS = function() {
        MapGL.Log("Inititialising FPS meter"),
        _.extend(this, MapGL.Mediator),
        this.domContainer = this.createDOMContainer(),
        this.meters = {},
        this.subscribe("fpsTickStart", this.tickStart),
        this.subscribe("fpsTickEnd", this.tickEnd)
    }
    ,
    MapGL.FPS.prototype.createDOMContainer = function() {
        MapGL.Log("Creating FPS meter DOM container");
        var a = document.createElement("div");
        return a.id = "fps-container",
        a.style.position = "absolute",
        a.style.left = 0,
        a.style.top = 0,
        document.body.appendChild(a),
        a
    }
    ,
    MapGL.FPS.prototype.createDOMElement = function() {
        MapGL.Log("Creating FPS meter DOM element");
        var a = document.createElement("div");
        return a.style.float = "left",
        this.domContainer.appendChild(a),
        a
    }
    ,
    MapGL.FPS.prototype.createDOMTitle = function(a) {
        var b = document.createElement("p");
        return b.style.color = "#999",
        b.style.fontFamily = "sans-serif",
        b.style.fontSize = "10px",
        b.style.fontWeight = "bold",
        b.style.margin = "0 5px 5px 5px",
        b.style.textAlign = "left",
        b.style.textTransform = "uppercase",
        b.innerHTML = a,
        b
    }
    ,
    MapGL.FPS.prototype.createMeter = function(a) {
        MapGL.Log("Creating FPS meter: " + a);
        var b = this.createDOMElement(a)
          , c = new FPSMeter(b,{
            theme: "colorful",
            decimals: 0,
            heat: 1,
            graph: 1,
            history: 20,
            position: "relative",
            left: 0,
            top: 0,
            margin: "5px 0 5px 5px"
        });
        return b.appendChild(this.createDOMTitle(a)),
        this.meters[a] = c,
        c
    }
    ,
    MapGL.FPS.prototype.tickStart = function(a) {
        var b = this.meters[a] ? this.meters[a] : this.createMeter(a);
        b.tickStart()
    }
    ,
    MapGL.FPS.prototype.tickEnd = function(a) {
        var b = this.meters[a] ? this.meters[a] : this.createMeter(a);
        b.tick()
    }
}(),
function() {
    "use strict";
    MapGL.RendererInfo = function() {
        MapGL.Log("Inititialising renderer info"),
        _.extend(this, MapGL.Mediator),
        this.domContainer = this.createDOMContainer(),
        this.domRender = this.createDOMElement(),
        this.domMemory = this.createDOMElement(),
        this.subscribe("updateRendererInfo", this.update)
    }
    ,
    MapGL.RendererInfo.prototype.createDOMContainer = function() {
        MapGL.Log("Creating renderer info DOM container");
        var a = document.createElement("div");
        return a.id = "renderer-info-container",
        a.style.position = "absolute",
        a.style.left = 0,
        a.style.bottom = 0,
        document.body.appendChild(a),
        a
    }
    ,
    MapGL.RendererInfo.prototype.createDOMElement = function() {
        MapGL.Log("Creating renderer info DOM element");
        var a = document.createElement("div");
        return a.style.float = "left",
        a.style.color = "#999",
        a.style.fontFamily = "sans-serif",
        a.style.fontSize = "10px",
        a.style.fontWeight = "bold",
        a.style.lineHeight = "1.2em",
        a.style.margin = "5px",
        a.style.textAlign = "left",
        a.style.textTransform = "uppercase",
        a.style.width = "100px",
        this.domContainer.appendChild(a),
        a
    }
    ,
    MapGL.RendererInfo.prototype.createInfoStrings = function(a) {
        var b = "";
        b += "Programs: " + a.memory.programs + "<br>",
        b += "Geometries: " + a.memory.geometries + "<br>",
        b += "Textures: " + a.memory.textures + "<br>";
        var c = "";
        return c += "Calls: " + a.render.calls + "<br>",
        c += "Vertices: " + a.render.vertices + "<br>",
        c += "Faces: " + a.render.faces + "<br>",
        c += "Points: " + a.render.points + "<br>",
        [c, b]
    }
    ,
    MapGL.RendererInfo.prototype.update = function(a) {
        var b = this.createInfoStrings(a);
        this.domRender.innerHTML = b[0],
        this.domMemory.innerHTML = b[1]
    }
}(),
function() {
    "use strict";
    MapGL.Loading = function() {
        MapGL.Log("Initialising loading UI"),
        _.extend(this, MapGL.Mediator),
        this.domContainer = void 0,
        this.domTimer = void 0,
        this.domIndicator = void 0
    }
    ,
    MapGL.Loading.prototype.init = function(a) {
        return this.domContainer = this.createDOMContainer(a),
        this.domTimer = this.createDOMTimer(),
        this.domIndicator = this.createDOMIndicator(),
        this.subscribe("loadingProgress", this.progress),
        this.subscribe("loadingComplete", function() {
            this.remove(a)
        }),
        Q.fcall(function() {})
    }
    ,
    MapGL.Loading.prototype.createDOMContainer = function(a) {
        MapGL.Log("Creating loading UI DOM container");
        var b = document.createElement("div");
        return b.id = "ui-loading-container",
        b.style.background = "#666",
        b.style.left = 0,
        b.style.height = "100%",
        b.style.position = "absolute",
        b.style.top = 0,
        b.style.width = "100%",
        b.style.zIndex = 9999,
        a.appendChild(b),
        b
    }
    ,
    MapGL.Loading.prototype.createDOMTimer = function() {
        MapGL.Log("Creating loading UI timer DOM");
        var a = document.createElement("div");
        a.classList.add("ui-loading-timer-container");
        var b = document.createElement("div");
        b.classList.add("ui-loading-timer");
        var c = document.createElement("div");
        return c.classList.add("ui-loading-hand"),
        b.appendChild(c),
        a.appendChild(b),
        this.domContainer.appendChild(a),
        a
    }
    ,
    MapGL.Loading.prototype.createDOMIndicator = function() {
        MapGL.Log("Creating loading UI indicator DOM");
        var a = document.createElement("div");
        a.classList.add("ui-loading-indicator-container");
        var b = document.createElement("div");
        return b.classList.add("ui-loading-indicator-bar"),
        a.appendChild(b),
        this.domContainer.appendChild(a),
        b
    }
    ,
    MapGL.Loading.prototype.progress = function(a) {
        var b = -100 + 100 * a + "%";
        this.domIndicator.style.WebkitTransform = "translate3d(" + b + ", 0, 0)",
        this.domIndicator.style.MozTransform = "translate3d(" + b + ", 0, 0)",
        this.domIndicator.style.transform = "translate3d(" + b + ", 0, 0)"
    }
    ,
    MapGL.Loading.prototype.remove = function(a) {
        var b = this;
        setTimeout(function() {
            b.domContainer.classList.add("inactive")
        }, 800),
        setTimeout(function() {
            MapGL.Log("Removing loading UI DOM container"),
            a.removeChild(b.domContainer)
        }, 2e3)
    }
}(),
function() {
    "use strict";
    MapGL.Attribution = function() {
        MapGL.Log("Initialising attribution UI"),
        _.extend(this, MapGL.Mediator),
        this.domContainer = void 0,
        this.domAttribution = void 0
    }
    ,
    MapGL.Attribution.prototype.init = function() {
        return this.domContainer = this.createDOMContainer(),
        this.domAttribution = this.createDOMAttribution(),
        Q.fcall(function() {})
    }
    ,
    MapGL.Attribution.prototype.createDOMContainer = function() {
        MapGL.Log("Creating attribution UI DOM container");
        var a = document.createElement("div");
        return a.id = "ui-attribution-container",
        a.style.bottom = "0",
        a.style.fontFamily = "Arial, Verdana, sans-serif",
        a.style.fontSize = "10px",
        a.style.position = "absolute",
        a.style.right = "0",
        a.style.zIndex = "9998",
        document.body.appendChild(a),
        a
    }
    ,
    MapGL.Attribution.prototype.createDOMAttribution = function() {
        MapGL.Log("Creating attribution UI MapGL DOM");
        var a = document.createElement("p");
        return a.classList.add("ui-attribution"),
        a.innerHTML = "<a href='https://www.openstreetmap.org/copyright'>Data &copy; OpenStreetMap contributors</a> | <a href='http://github.com/robhawkes/mapgl'>Powered by MapGL</a>",
        a.style.background = "rgba(255, 255, 255, 0.6)",
        a.style.borderRadius = "3px 0 0",
        a.style.padding = "3px 5px",
        this.domContainer.appendChild(a),
        a
    }
}(),
function() {
    "use strict";
    MapGL.OSMEdit = function() {
        MapGL.Log("Initialising OSM edit UI"),
        _.extend(this, MapGL.Mediator),
        this.domContainer = void 0,
        this.domOSMEdit = void 0,
        this.subscribe("centerPositionChanged", function(a, b) {
            this.updatePosition(b)
        })
    }
    ,
    MapGL.OSMEdit.prototype.init = function() {
        return this.domContainer = this.createDOMContainer(),
        this.domOSMEdit = this.createDOMOSMEdit(),
        Q.fcall(function() {})
    }
    ,
    MapGL.OSMEdit.prototype.createDOMContainer = function() {
        MapGL.Log("Creating OSM edit UI DOM container");
        var a = document.createElement("div");
        return a.id = "ui-osm-edit-container",
        a.style.bottom = "0",
        a.style.fontFamily = "Arial, Verdana, sans-serif",
        a.style.fontSize = "10px",
        a.style.position = "absolute",
        a.style.left = "0",
        a.style.zIndex = "9998",
        document.body.appendChild(a),
        a
    }
    ,
    MapGL.OSMEdit.prototype.createDOMOSMEdit = function() {
        MapGL.Log("Creating OSM edit UI MapGL DOM");
        var a = document.createElement("p");
        return a.classList.add("ui-osm-edit"),
        a.innerHTML = "<a href='http://www.openstreetmap.org/edit'>Does this area look wrong? Edit it in OpenStreetMap</a>",
        a.style.background = "rgba(255, 255, 255, 0.6)",
        a.style.borderRadius = "0 3px 0 0",
        a.style.padding = "3px 5px",
        this.domContainer.appendChild(a),
        a
    }
    ,
    MapGL.OSMEdit.prototype.updatePosition = function(a) {
        this.domOSMEdit.firstChild.href = "http://www.openstreetmap.org/edit#map=16/" + a[1] + "/" + a[0]
    }
}(),
function() {
    "use strict";
    MapGL.Geo = function() {
        var a = function(a) {
            _.extend(this, MapGL.Mediator),
            this.metersPerLat = 111319.49,
            this.tileSize = 256,
            this.tileZoom = 15,
            this.projection = this.setProjection(a.center),
            this.center = a.center || [0, 0],
            this.centerPixels = this.projection(this.center),
            this.bounds = this.getBounds(this.center),
            this.pixelsPerMeter = this.setPixelsPerMeter(),
            this.subscribe("targetPositionChanged", this.onTargetChanged)
        };
        a.prototype.setProjection = function(a) {
            return d3.geo.mercator().center(a).translate([0, 0]).scale(this.tileSize << this.tileZoom)
        }
        ,
        a.prototype.setPixelsPerMeter = function() {
            var a = this.projection([0, 50])[1] - this.projection([0, 51])[1];
            return a / this.metersPerLat
        }
        ,
        a.prototype.getBounds = function(a, b) {
            var c = b || .009
              , d = 2 * c
              , e = {
                n: this.decimalPlaces(a[1] + c),
                e: this.decimalPlaces(a[0] + d),
                s: this.decimalPlaces(a[1] - c),
                w: this.decimalPlaces(a[0] - c)
            };
            return e
        }
        ,
        a.prototype.onTargetChanged = function(a) {
            this.centerPixels = [a.x, a.z],
            this.center = this.projection.invert(this.centerPixels),
            this.bounds = this.getBounds(this.center),
            this.publish("centerPositionChanged", this.centerPixels, this.center, this.bounds)
        }
        ,
        a.prototype.decimalPlaces = function(a, b) {
            return b = b || 5,
            parseFloat(a).toFixed(b)
        }
        ;
        var b, c = {
            name: "MapGL.Geo",
            getInstance: function(c) {
                return void 0 === b && (b = new a(c)),
                b
            }
        };
        return c
    }()
}(),
function() {
    "use strict";
    MapGL.City = function() {
        MapGL.Log("Inititialising city"),
        _.extend(this, MapGL.Mediator),
        this.dat = void 0,
        this.fps = void 0,
        this.rendererInfo = void 0,
        this.options = void 0,
        this.ui = {},
        this.ui.loading = void 0,
        this.ui.attribution = void 0,
        this.ui.osmEdit = void 0,
        this.geo = void 0,
        this.grid = void 0,
        this.data = void 0,
        this.webgl = void 0,
        this.domElement = void 0,
        this.domEvents = void 0,
        this.controls = void 0,
        this.floor = void 0,
        this.loop = void 0,
        this.publish("addToDat", this, {
            name: "City",
            properties: ["init"]
        }),
        this.subscribe("hashchange", this.onHashchange)
    }
    ,
    MapGL.City.prototype.init = function(a) {
        MapGL.Log("Loading city");
        var b = Date.now()
          , c = this
          , d = Q.defer();
        a || (a = {}),
        c.options = a;
        var e = window.location.hash.replace("#", "")
          , f = /^(\-?\d+(\.\d+)?),(\-?\d+(\.\d+)?)$/;
        return f.test(e) && (a.coords = e.split(",").reverse()),
        _.defaults(a, {
            coords: [-.01924, 51.50358],
            capZoom: !0,
            capOrbit: !0,
            overpass: !0,
            overpassGridUpdate: !0,
            overpassWayIntersect: !1,
            controls: {
                enable: !0
            }
        }),
        MapGL.Log(a),
        c.geo = MapGL.Geo.getInstance({
            center: a.coords
        }),
        c.domElement = c.options.domElement,
        c.publish("loadingProgress", 0),
        c.initLoadingUI().then(function() {
            return c.publish("loadingProgress", .1),
            c.initDebug()
        }).then(function() {
            c.publish("loadingProgress", .15);
            var a = [];
            return a.push(c.initAttributionUI()),
            a.push(c.initOSMEditUI()),
            Q.allSettled(a)
        }).then(function() {
            return c.publish("loadingProgress", .25),
            c.initWebGL(a)
        }).then(function() {
            c.publish("loadingProgress", .3);
            var a = [];
            return a.push(c.initDOMEvents()),
            a.push(c.initControls()),
            Q.allSettled(a)
        }).then(function() {
            return c.publish("loadingProgress", .4),
            c.initGrid()
        }).then(function() {
            c.publish("loadingProgress", .5);
            var b = [];
            return b.push(c.loadCoreObjects()),
            a.overpass && (c.data = new MapGL.DataOverpass({
                gridUpdate: a.overpassGridUpdate
            }),
            b.push(c.loadOverpass(a.overpassWayIntersect))),
            Q.allSettled(b)
        }).then(function() {
            c.loop = new MapGL.Loop,
            c.publish("loadingProgress", 1),
            c.publish("loadingComplete"),
            MapGL.Log("Finished loading city in " + (Date.now() - b) + "ms"),
            d.resolve()
        }),
        d.promise
    }
    ,
    MapGL.City.prototype.initAttributionUI = function() {
        var a = Date.now()
          , b = Q.defer();
        return this.ui.attribution = new MapGL.Attribution,
        this.ui.attribution.init().then(function() {
            MapGL.Log("Finished intialising attribution UI in " + (Date.now() - a) + "ms"),
            b.resolve()
        }),
        b.promise
    }
    ,
    MapGL.City.prototype.initOSMEditUI = function() {
        var a = Date.now()
          , b = Q.defer();
        return this.ui.osmEdit = new MapGL.OSMEdit,
        this.ui.osmEdit.init().then(function() {
            MapGL.Log("Finished intialising OSM edit UI in " + (Date.now() - a) + "ms"),
            b.resolve()
        }),
        b.promise
    }
    ,
    MapGL.City.prototype.initLoadingUI = function() {
        var a = Date.now()
          , b = Q.defer();
        return this.ui.loading = new MapGL.Loading,
        this.ui.loading.init(this.domElement).then(function() {
            MapGL.Log("Finished intialising loading UI in " + (Date.now() - a) + "ms"),
            b.resolve()
        }),
        b.promise
    }
    ,
    MapGL.City.prototype.initDebug = function() {
        MapGL.Log("Intialising debug tools");
        var a = Date.now();
        return MapGL.DEBUG && (this.dat = new MapGL.Dat,
        this.fps = new MapGL.FPS,
        this.rendererInfo = new MapGL.RendererInfo),
        MapGL.Log("Finished intialising debug tools in " + (Date.now() - a) + "ms"),
        Q.fcall(function() {})
    }
    ,
    MapGL.City.prototype.initWebGL = function(a) {
        var b = Date.now()
          , c = Q.defer();
        return this.webgl = new MapGL.WebGL,
        this.webgl.init(this.domElement, this.geo.centerPixels, a.capZoom, a.capOrbit).then(function() {
            MapGL.Log("Finished intialising WebGL in " + (Date.now() - b) + "ms"),
            c.resolve()
        }),
        c.promise
    }
    ,
    MapGL.City.prototype.initDOMEvents = function() {
        var a = Date.now()
          , b = Q.defer();
        return this.domEvents = new MapGL.DOMEvents,
        this.domEvents.init().then(function() {
            MapGL.Log("Finished intialising DOM events in " + (Date.now() - a) + "ms"),
            b.resolve()
        }),
        b.promise
    }
    ,
    MapGL.City.prototype.initControls = function() {
        var a = Date.now()
          , b = Q.defer();
        return this.controls = MapGL.Controls.getInstance(),
        this.controls.init(this.domElement, this.webgl.camera, this.options.controls).then(function() {
            MapGL.Log("Finished intialising controls in " + (Date.now() - a) + "ms"),
            b.resolve()
        }),
        b.promise
    }
    ,
    MapGL.City.prototype.initGrid = function() {
        var a = Date.now()
          , b = Q.defer();
        return this.grid = MapGL.Grid.getInstance(),
        this.grid.init(this.geo.center).then(function() {
            MapGL.Log("Finished intialising grid manager in " + (Date.now() - a) + "ms"),
            b.resolve()
        }),
        b.promise
    }
    ,
    MapGL.City.prototype.loadCoreObjects = function() {
        MapGL.Log("Loading core objects");
        var a = Date.now();
        return this.floor = new MapGL.Floor,
        MapGL.Log("Finished loading core objects in " + (Date.now() - a) + "ms"),
        Q.fcall(function() {})
    }
    ,
    MapGL.City.prototype.loadOverpass = function(a) {
        MapGL.Log("Loading data from OSM Overpass API");
        var b = Date.now();
        return a ? this.data.updateByWayIntersect(a).done(function() {
            MapGL.Log("Finished loading Overpass data using way intersection in " + (Date.now() - b) + "ms")
        }) : this.data.update().done(function() {
            MapGL.Log("Finished loading Overpass data in " + (Date.now() - b) + "ms")
        }),
        Q.fcall(function() {})
    }
    ,
    MapGL.City.prototype.onHashchange = function() {
        window.location.reload()
    }
}(),
function() {
    "use strict";
    MapGL.Loop = function() {
        MapGL.Log("Inititialising application loop"),
        _.extend(this, MapGL.Mediator),
        this.startTime = 0,
        this.lastTickTime = 0,
        this.stopLoop = !1,
        this.publish("addToDat", this, {
            name: "Loop",
            properties: ["start", "stop"]
        }),
        this.start()
    }
    ,
    MapGL.Loop.prototype.start = function() {
        MapGL.Log("Starting application loop"),
        this.stopLoop = !1,
        this.startTime = window.performance && window.performance.now ? window.performance.now() + window.performance.timing.navigationStart : Date.now(),
        this.tick()
    }
    ,
    MapGL.Loop.prototype.stop = function() {
        MapGL.Log("Stopping application loop"),
        this.stopLoop = !0
    }
    ,
    MapGL.Loop.prototype.tick = function(a) {
        this.publish("fpsTickStart", "Main Loop");
        var b = a - this.lastTickTime;
        this.lastTickTime = a,
        this.publish("update", b, this.lastTickTime),
        this.publish("render", b, this.lastTickTime),
        this.stopLoop || window.requestAnimationFrame(this.tick.bind(this)),
        this.publish("fpsTickEnd", "Main Loop")
    }
}(),
function() {
    "use strict";
    MapGL.DOMEvents = function() {
        MapGL.Log("Inititialising DOM events"),
        _.extend(this, MapGL.Mediator)
    }
    ,
    MapGL.DOMEvents.prototype.init = function() {
        var a = this;
        return window.addEventListener("resize", function(b) {
            a.publish("resize", b)
        }, !1),
        window.addEventListener("hashchange", function(b) {
            a.publish("hashchange", b)
        }, !1),
        Q.fcall(function() {})
    }
}(),
function() {
    "use strict";
    MapGL.WebGL = function() {
        MapGL.Log("Initialising WebGL"),
        _.extend(this, MapGL.Mediator),
        this.domContainer = void 0,
        this.scene = void 0,
        this.camera = void 0,
        this.renderer = void 0,
        this.lights = []
    }
    ,
    MapGL.WebGL.prototype.init = function(a, b, c, d) {
        return this.domContainer = this.createDOMContainer(a),
        this.scene = new MapGL.Scene,
        this.camera = new MapGL.Camera(b,c,d),
        this.renderer = new MapGL.Renderer(this.scene,this.camera,this.domContainer),
        this.lights = [],
        this.addLights(),
        Q.fcall(function() {})
    }
    ,
    MapGL.WebGL.prototype.createDOMContainer = function(a) {
        MapGL.Log("Creating WebGL DOM container");
        var b = document.createElement("div");
        return b.classList.add("mapgl-webgl-container"),
        a.appendChild(b),
        b
    }
    ,
    MapGL.WebGL.prototype.addLights = function() {
        MapGL.Log("Adding lights to scene");
        var a = new THREE.DirectionalLight(10066329);
        a.intesity = .1,
        a.position.x = 1,
        a.position.y = 1,
        a.position.z = 1,
        this.lights.push(a),
        this.publish("addToScene", a);
        var b = new THREE.DirectionalLight(10066329);
        b.intesity = .1,
        b.position.x = -1,
        b.position.y = 1,
        b.position.z = -1,
        this.lights.push(b),
        this.publish("addToScene", b)
    }
    ,
    MapGL.applyVertexColors = function(a, b) {
        a.faces.forEach(function(a) {
            for (var c = a instanceof THREE.Face3 ? 3 : 4, d = 0; c > d; d++)
                a.vertexColors[d] = b
        })
    }
}(),
function() {
    "use strict";
    MapGL.Scene = function() {
        MapGL.Log("Inititialising WebGL scene"),
        _.extend(this, MapGL.Mediator),
        this.scene = this.createScene(),
        this.objects = [],
        this.subscribe("addToScene", function(a) {
            MapGL.Log("Scene add object handler"),
            MapGL.Log(a),
            this.addToScene(a)
        }),
        this.subscribe("removeFromScene", function(a) {
            MapGL.Log("Scene remove object handler"),
            MapGL.Log(a),
            this.removeFromScene(a)
        })
    }
    ,
    MapGL.Scene.prototype.createScene = function() {
        MapGL.Log("Creating WebGL scene");
        var a = new THREE.Scene;
        return a.fog = new THREE.Fog(16777215,1,4e4),
        a
    }
    ,
    MapGL.Scene.prototype.addToScene = function(a) {
        this.scene.add(a),
        this.objects.push(a)
    }
    ,
    MapGL.Scene.prototype.removeFromScene = function(a) {
        this.scene.remove(a),
        a.geometry && a.geometry.dispose(),
        a.material && a.material.dispose(),
        a.texture && a.texture.dispose();
        var b = _.indexOf(this.objects, a);
        b > -1 && this.objects.splice(b, 1)
    }
}(),
function() {
    "use strict";
    MapGL.Camera = function(a, b, c) {
        MapGL.Log("Inititialising WebGL camera"),
        _.extend(this, MapGL.Mediator),
        this.cameraRadius = 1500,
        this.theta = 45,
        this.phi = 80,
        this.capZoom = b === !1 ? !1 : !0,
        this.capOrbit = c === !1 ? !1 : !0,
        this.target = new THREE.Object3D,
        this.updateTargetPositon(a),
        this.camera = this.createCamera(),
        this.lookAtTarget(),
        this.publish("addToScene", this.camera),
        this.publish("addToDat", this, {
            name: "Camera",
            properties: ["cameraRadius", "theta", "phi"]
        }),
        this.subscribe("resize", this.resize),
        this.subscribe("zoomControl", this.zoom),
        this.subscribe("panControl", this.pan),
        this.subscribe("orbitControl", this.orbit)
    }
    ,
    MapGL.Camera.prototype.createCamera = function() {
        MapGL.Log("Creating WebGL camera");
        var a = new THREE.PerspectiveCamera(40,window.innerWidth / window.innerHeight,2,4e4);
        return this.updatePosition(a),
        a
    }
    ,
    MapGL.Camera.prototype.updatePosition = function(a) {
        a = a ? a : this.camera,
        a.position.x = this.target.position.x + this.cameraRadius * Math.sin(this.theta * Math.PI / 360) * Math.cos(this.phi * Math.PI / 360),
        a.position.y = this.target.position.y + this.cameraRadius * Math.sin(this.phi * Math.PI / 360),
        a.position.z = this.target.position.z + this.cameraRadius * Math.cos(this.theta * Math.PI / 360) * Math.cos(this.phi * Math.PI / 360),
        a.updateMatrix(),
        this.publish("targetPositionChanged", this.target.position)
    }
    ,
    MapGL.Camera.prototype.updateTargetPositon = function(a) {
        this.target.position.x = a[0],
        this.target.position.z = a[1]
    }
    ,
    MapGL.Camera.prototype.lookAtTarget = function() {
        this.camera.lookAt(this.target.position)
    }
    ,
    MapGL.Camera.prototype.resize = function() {
        this.camera.aspect = window.innerWidth / window.innerHeight,
        this.camera.updateProjectionMatrix()
    }
    ,
    MapGL.Camera.prototype.zoom = function(a) {
        var b = this.cameraRadius;
        this.cameraRadius += a;
        var c = this.cameraRadius - b;
        if (this.capZoom) {
            var d = 250;
            this.cameraRadius < d && (this.cameraRadius = d,
            c = d - b);
            var e = 2e3;
            this.cameraRadius > e && (this.cameraRadius = e,
            c = e - b)
        }
        this.camera.translateZ(c),
        this.updatePosition(),
        this.publish("render")
    }
    ,
    MapGL.Camera.prototype.pan = function(a) {
        this.target.position.x += a.x,
        this.target.position.z += a.z,
        this.updatePosition(),
        this.publish("render")
    }
    ,
    MapGL.Camera.prototype.orbit = function(a, b, c) {
        this.theta = -(.5 * a.x) + b,
        this.phi = .5 * a.y + c,
        this.capOrbit && (this.phi = Math.min(175, Math.max(65, this.phi)),
        (175 === this.phi || 65 === this.phi) && this.publish("orbitControlCap")),
        this.updatePosition(),
        this.lookAtTarget(),
        this.publish("render")
    }
    ,
    MapGL.Camera.prototype.datChange = function() {
        this.updatePosition(),
        this.lookAtTarget()
    }
}(),
function() {
    "use strict";
    MapGL.Renderer = function(a, b, c) {
        MapGL.Log("Inititialising WebGL renderer"),
        _.extend(this, MapGL.Mediator),
        this.scene = a.scene,
        this.camera = b.camera,
        this.domContainer = c,
        this.renderer = this.createRenderer(),
        this.subscribe("render", this.render),
        this.subscribe("resize", this.resize)
    }
    ,
    MapGL.Renderer.prototype.createRenderer = function() {
        var a = new THREE.WebGLRenderer({
            antialias: !1
        });
        return a.setSize(window.innerWidth, window.innerHeight),
        a.setClearColor(this.scene.fog.color, 1),
        a.gammaInput = !0,
        a.gammaOutput = !0,
        a.physicallyBasedShading = !0,
        a.shadowMapEnabled = !0,
        a.shadowMapSoft = !0,
        this.domContainer.appendChild(a.domElement),
        a
    }
    ,
    MapGL.Renderer.prototype.render = function() {
        this.publish("fpsTickStart", "render"),
        this.renderer.render(this.scene, this.camera),
        this.publish("updateRendererInfo", this.renderer.info),
        this.publish("fpsTickEnd", "render")
    }
    ,
    MapGL.Renderer.prototype.resize = function() {
        this.renderer.setSize(window.innerWidth, window.innerHeight)
    }
}(),
function() {
    "use strict";
    MapGL.ObjectManager = function() {
        _.extend(this, MapGL.Mediator),
        this.combinedMaterial = new THREE.MeshLambertMaterial({
            vertexColors: THREE.VertexColors
        }),
        this.combinedObjects = void 0
    }
    ,
    MapGL.ObjectManager.prototype.processFeatures = function(a) {
        var b = Date.now()
          , c = _.map(a, this.processFeature);
        MapGL.Log(Date.now() - b),
        this.combinedObjects = this.combineObjects(c),
        this.publish("addToScene", this.combinedObjects)
    }
    ,
    MapGL.ObjectManager.prototype.workerPromise = function(a, b, c) {
        var d = Q.defer()
          , e = Date.now();
        return a.process([b, c]).then(function(a) {
            var b = a.startTime - e
              , c = Date.now() - a.timeSent;
            d.resolve({
                data: a,
                timeToArrive: c,
                timeToSend: b
            })
        }),
        d.promise
    }
    ,
    MapGL.ObjectManager.prototype.processFeaturesWorker = function() {}
    ,
    MapGL.ObjectManager.prototype.processFeature = function() {}
    ,
    MapGL.ObjectManager.prototype.combineObjects = function(a) {
        var b = new THREE.Geometry;
        return _.each(a, function(a) {
            a.object && THREE.GeometryUtils.merge(b, a.object)
        }),
        b.computeFaceNormals(),
        new THREE.Mesh(b,this.combinedMaterial)
    }
}(),
function() {
    "use strict";
    MapGL.ObjectManagerOverpass = function() {
        _.extend(this, MapGL.Mediator),
        MapGL.ObjectManager.call(this),
        this.combinedMaterial = new THREE.MeshLambertMaterial({
            vertexColors: THREE.VertexColors
        }),
        this.combinedObjects = void 0,
        this.objectAnimations = {},
        this.subscribe("update", this.animate)
    }
    ,
    MapGL.ObjectManagerOverpass.prototype = Object.create(MapGL.ObjectManager.prototype),
    MapGL.ObjectManagerOverpass.prototype.processFeaturesWorker = function(a, b) {
        MapGL.Log("Processing features using worker");
        for (var c = Q.defer(), d = cw({
            process: function(a, b) {
                importScripts("worker/three.min.js", "worker/GeometryExporter.js", "worker/underscore.min.js");
                var c = a[0]
                  , d = a[1]
                  , e = JSON.stringify(c).length
                  , f = Date.now()
                  , g = new THREE.GeometryExporter
                  , h = function(a, b) {
                    a.faces.forEach(function(a) {
                        for (var c = a instanceof THREE.Face3 ? 3 : 4, d = 0; c > d; d++)
                            a.vertexColors[d] = b
                    })
                }
                  , i = function(a) {
                    var b = a.properties
                      , c = []
                      , d = a.coordinates
                      , e = new THREE.Shape;
                    _.each(d, function(a, b) {
                        0 === c.length && (c[0] = -1 * a[0],
                        c[1] = -1 * a[1]),
                        0 === b ? e.moveTo(a[0] + c[0], a[1] + c[1]) : e.lineTo(a[0] + c[0], a[1] + c[1])
                    }),
                    a.holes && a.holes.length > 0 && _.each(a.holes, function(a) {
                        var b = new THREE.Path;
                        _.each(a, function(a, d) {
                            0 === d ? b.moveTo(a[0] + c[0], a[1] + c[1]) : b.lineTo(a[0] + c[0], a[1] + c[1])
                        }),
                        e.holes.push(b)
                    });
                    var f = b.height
                      , g = 0;
                    b.minHeight && (g = b.minHeight);
                    var i = {
                        amount: f - g,
                        bevelEnabled: !1
                    }
                      , j = new THREE.ExtrudeGeometry(e,i);
                    if (4 === e.curves.length && "gabled" === b.roof.shape) {
                        var k = new THREE.Geometry
                          , l = e.extractPoints()
                          , m = -(f / 2)
                          , n = l.shape[0].clone().lerp(l.shape[1], .5)
                          , p = l.shape[2].clone().lerp(l.shape[3], .5)
                          , q = [new THREE.Vector3(l.shape[0].x,l.shape[0].y,0), new THREE.Vector3(n.x,n.y,m), new THREE.Vector3(l.shape[1].x,l.shape[1].y,0), new THREE.Vector3(l.shape[2].x,l.shape[2].y,0), new THREE.Vector3(p.x,p.y,m), new THREE.Vector3(l.shape[3].x,l.shape[3].y,0)]
                          , r = THREE.Shape.Utils.isClockWise(q);
                        r || (q = q.reverse()),
                        k.vertices = q,
                        k.faces.push(new THREE.Face3(3,4,1)),
                        k.faces.push(new THREE.Face3(3,1,2)),
                        k.faces.push(new THREE.Face3(4,3,5)),
                        k.faces.push(new THREE.Face3(1,0,2)),
                        k.faces.push(new THREE.Face3(0,1,4)),
                        k.faces.push(new THREE.Face3(0,4,5)),
                        _.each(k.faces, function() {
                            k.faceVertexUvs[0].push([!1, !1, !1])
                        }),
                        THREE.GeometryUtils.merge(j, k)
                    }
                    var s = b.colour ? new THREE.Color(b.colour) : o;
                    h(j, s),
                    j.computeFaceNormals();
                    var t = new THREE.Mesh(j);
                    return t.position.y = f,
                    t.position.x = -1 * c[0],
                    t.position.z = -1 * c[1],
                    t.rotation.x = 90 * Math.PI / 180,
                    t
                }
                  , j = .01 * d
                  , k = 4 * d
                  , l = [new THREE.Vector2(-j,k / 2), new THREE.Vector2(-j,-k / 2), new THREE.Vector2(j,-k / 2), new THREE.Vector2(j,k / 2), new THREE.Vector2(-j,k / 2)]
                  , m = new THREE.Shape(l)
                  , n = function(a) {
                    var b = a.properties
                      , c = b.highway;
                    if ("footway" !== c && "pedestrian" !== c && "steps" !== c && "cycleway" !== c) {
                        var d = (Number(b.layer),
                        new THREE.Color(12698049))
                          , e = []
                          , f = []
                          , g = a.coordinates;
                        _.each(g, function(a) {
                            0 === e.length && (e[0] = -1 * a[0],
                            e[1] = -1 * a[1]),
                            f.push(new THREE.Vector3(a[0] + e[0],j / 2,a[1] + e[1]))
                        });
                        for (var i = new THREE.SplineCurve3(f), k = Math.max(10, Math.floor(.05 * i.getLength())), l = {
                            tangents: [],
                            normals: [],
                            binormals: []
                        }, n = new THREE.Vector3(0,1,0), o = 0; k + 1 > o; o++) {
                            var p = o / k
                              , q = i.getTangentAt(p).normalize();
                            l.tangents[o] = q,
                            l.normals[o] = n,
                            l.binormals[o] = q.clone().cross(n)
                        }
                        var r = {
                            generateTopUV: THREE.ExtrudeGeometry.WorldUVGenerator.generateTopUV,
                            generateBottomUV: THREE.ExtrudeGeometry.WorldUVGenerator.generateBottomUV,
                            generateSideWallUV: THREE.ExtrudeGeometry.WorldUVGenerator.generateSideWallUV,
                            foo: function() {
                                var a = new THREE.Vector2(0,1);
                                return [a, a, a, a]
                            }
                        }
                          , s = new THREE.ExtrudeGeometry(m,{
                            extrudePath: i,
                            frames: l,
                            steps: k,
                            closed: !1,
                            UVGenerator: r
                        });
                        s.computeVertexNormals(),
                        h(s, d),
                        s.computeFaceNormals();
                        var t = new THREE.Mesh(s);
                        return t.position.x = -1 * e[0],
                        t.position.z = -1 * e[1],
                        t
                    }
                }
                  , o = new THREE.Color(16746492)
                  , p = new THREE.Geometry
                  , q = 0;
                _.each(c, function(a) {
                    var b, c = a.properties;
                    b = c.building ? i(a) : c.highway ? n(a) : i(a),
                    THREE.GeometryUtils.merge(p, b),
                    q++
                });
                var r = THREE.GeometryUtils.center(p)
                  , s = Date.now() - f
                  , t = g.parse(p)
                  , u = JSON.stringify(t).length
                  , v = new Float64Array(t.vertices)
                  , w = new Float64Array(t.normals)
                  , x = new Float64Array(t.uvs[0])
                  , y = new Float64Array(t.faces)
                  , z = {
                    metadata: t.metadata,
                    colors: t.colors,
                    vertices: v,
                    normals: w,
                    uvs: x,
                    faces: y
                }
                  , A = Date.now()
                  , B = {
                    model: z,
                    offset: r,
                    outputSize: u,
                    inputSize: e,
                    count: q,
                    startTime: f,
                    timeTaken: s,
                    timeSent: A
                };
                b(B, [z.vertices.buffer, z.normals.buffer, z.uvs.buffer, z.faces.buffer])
            }
        }), e = Date.now(), f = a.length < 100 ? 6 : 12, g = a.length % f, h = a.length < f ? a.length : f, i = Math.floor(a.length / h), j = [], k = 0; h > k; k++) {
            var l = k * i
              , m = l + i;
            k === h - 1 && (m += g);
            var n = a.slice(l, m);
            j.push(this.workerPromise(d, n, b))
        }
        var o, p = new THREE.JSONLoader, q = new THREE.MeshLambertMaterial({
            vertexColors: THREE.VertexColors,
            ambient: 16777215,
            emissive: 13421772,
            shading: THREE.FlatShading,
            transparent: !0
        }), r = this;
        return Q.allSettled(j).then(function(a) {
            var b = 0
              , c = new THREE.Geometry;
            _.each(a, function(a) {
                if ("fulfilled" === a.state) {
                    var d = a.value
                      , e = d.data
                      , f = d.timeToSend
                      , g = d.timeToArrive
                      , h = e.timeTaken
                      , i = e.inputSize
                      , j = e.outputSize
                      , k = e.count
                      , l = e.model
                      , m = e.offset;
                    l.vertices = Array.apply([], l.vertices),
                    l.normals = Array.apply([], l.normals),
                    l.uvs = [Array.apply([], l.uvs)];
                    var n = [];
                    _.each(l.faces, function(a) {
                        n.push(a)
                    }),
                    l.faces = n,
                    b += g,
                    MapGL.Log("Worker input sent in " + f + "ms"),
                    MapGL.Log("Worker input size is " + i),
                    MapGL.Log("Worker output received in " + g + "ms"),
                    MapGL.Log("Worker output size is " + j),
                    MapGL.Log("Processed " + k + " features in " + h + "ms");
                    var o = p.parse(l)
                      , q = new THREE.Mesh(o.geometry);
                    q.position.x = -1 * m.x,
                    q.position.y = -1 * m.y,
                    q.position.z = -1 * m.z,
                    THREE.GeometryUtils.merge(c, q)
                }
            });
            var d = THREE.GeometryUtils.center(c);
            if (c.applyMatrix((new THREE.Matrix4).makeTranslation(0, -1 * d.y, 0)),
            o = new THREE.Mesh(c,q),
            MapGL.ENABLE_OUTLINES) {
                var f = new THREE.EdgesHelper(o,2236962);
                f.material.linewidth = 1,
                o.add(f)
            }
            o.position.x = -1 * d.x,
            o.position.z = -1 * d.z,
            o.scale.y = -.01,
            r.objectAnimations[o.id] = {
                mesh: o,
                startTime: null,
                duration: 2e3,
                startValue: -.01,
                endValue: 1,
                currentValue: -.01
            },
            r.publish("addToScene", o),
            MapGL.Log("Average output received time is " + b / h + "ms"),
            MapGL.Log("Overall worker time is " + (Date.now() - e) + "ms")
        }).done(function() {
            d.close(),
            c.resolve(o)
        }),
        c.promise
    }
    ,
    MapGL.ObjectManagerOverpass.prototype.animate = function(a, b) {
        var c = this;
        _.each(c.objectAnimations, function(a, d) {
            a.startTime || (a.startTime = b);
            var e = MapGL.Animation.easing.cubicInOut((b - a.startTime) / a.duration)
              , f = a.startValue + e * (a.endValue - a.startValue)
              , g = a.mesh;
            g.scale.y = f,
            g.material.opacity = f,
            a.currentValue = f,
            g.scale.y > a.endValue && (g.scale.y = a.endValue,
            g.material.opacity = a.endValue,
            delete c.objectAnimations[d])
        })
    }
}(),
function() {
    "use strict";
    MapGL.Object = function() {
        _.extend(this, MapGL.Mediator),
        this.geo = MapGL.Geo.getInstance(),
        this.object = void 0
    }
    ,
    MapGL.Object.prototype.createObject = function() {}
}(),
function() {
    "use strict";
    MapGL.Floor = function() {
        MapGL.Log("Inititialising floor object"),
        MapGL.Object.call(this),
        this.object = this.createObject()
    }
    ,
    MapGL.Floor.prototype = Object.create(MapGL.Object.prototype),
    MapGL.Floor.prototype.createObject = function() {
        var a = new THREE.Object3D
          , b = new THREE.CircleGeometry(2e4,32)
          , c = new THREE.MeshBasicMaterial({
            color: 16316664
        })
          , d = new THREE.Mesh(b,c);
        return d.position.y = -.4,
        d.rotation.x = -90 * Math.PI / 180,
        a.add(d),
        this.publish("addToScene", a),
        a
    }
}(),
function() {
    "use strict";
    MapGL.Data = function() {
        _.extend(this, MapGL.Mediator),
        this.geo = MapGL.Geo.getInstance(),
        this.grid = MapGL.Grid.getInstance(),
        this.cache = new MapGL.Cache,
        this.objects = {},
        this.processedIds = {},
        this.url = "",
        this.dataBoundsDistance = .009,
        this.dataTileSize = .005,
        this.clockwise = "cw",
        this.counterClockwise = "ccw",
        this.YARD_TO_METER = .9144,
        this.FOOT_TO_METER = .3048,
        this.INCH_TO_METER = .0254,
        this.METERS_PER_LEVEL = 3
    }
    ,
    MapGL.Data.prototype.load = function(a, b, c) {
        var d = this
          , e = Q.defer()
          , f = this.cache.get(c);
        return f ? (MapGL.Log("Loading tile from cache:", c),
        d.loadProcess(f, c).done(function() {
            e.resolve()
        }),
        e.promise) : (a = a.replace(/\{([swne])\}/g, function(a, c) {
            return b[c]
        }),
        MapGL.Log("Requesting URL", a),
        d3.json(a, function(b, f) {
            if (MapGL.Log("Response for URL", a),
            b)
                e.reject(new Error(b));
            else {
                if (0 === f.elements.length)
                    return e.resolve(),
                    void 0;
                var g = d.process(f, !0);
                d.cache.add(c, g),
                MapGL.Log("Added data to cache:", c),
                d.loadProcess(g, c).done(function() {
                    e.resolve()
                })
            }
        }),
        e.promise)
    }
    ,
    MapGL.Data.prototype.loadProcess = function(a, b) {
        var c = this
          , d = Q.defer()
          , e = [];
        return _.each(a, function(a) {
            if (!a)
                return MapGL.Log("Skipping undefined feature"),
                void 0;
            var d = _.find(c.processedIds, function(b) {
                return -1 === _.indexOf(b, a.id) ? !1 : !0
            });
            return d ? (MapGL.Log("Skipping duplicated feature"),
            void 0) : (c.processedIds[b] || (c.processedIds[b] = []),
            c.processedIds[b].push(a.id),
            e.push(a),
            void 0)
        }),
        0 === e.length ? (MapGL.Log("No features left to pass to worker"),
        d.resolve(),
        void 0) : (c.generateFeatures(e).then(function(a) {
            c.objects[b] = a,
            d.resolve()
        }, void 0, function(a) {
            d.notify(a)
        }),
        d.promise)
    }
    ,
    MapGL.Data.prototype.update = function() {}
    ,
    MapGL.Data.prototype.process = function() {}
    ,
    MapGL.Data.prototype.generateFeatures = function() {}
    ,
    MapGL.Data.prototype.checkDuplicateCoords = function(a, b) {
        var c = !1;
        return _.each(a, function(a) {
            a[0] === b[0] && a[1] === b[1] && (c = !0)
        }),
        c
    }
    ,
    MapGL.Data.prototype.makeWinding = function(a, b) {
        var c = THREE.Shape.Utils.isClockWise(a) ? this.clockwise : this.counterClockwise;
        return c === b ? a : a.reverse()
    }
    ,
    MapGL.Data.prototype.toMeters = function(a) {
        a = "" + a;
        var b = parseFloat(a);
        if (b === a)
            return b << 0;
        if (~a.indexOf("m"))
            return b << 0;
        if (~a.indexOf("yd"))
            return b * this.YARD_TO_METER << 0;
        if (~a.indexOf("ft"))
            return b * this.FOOT_TO_METER << 0;
        if (~a.indexOf("'")) {
            var c = a.split("'")
              , d = c[0] * this.FOOT_TO_METER + c[1] * this.INCH_TO_METER;
            return d << 0
        }
        return b << 0
    }
}(),
function() {
    "use strict";
    MapGL.DataOverpass = function(a) {
        MapGL.Log("Inititialising Overpass API manager"),
        MapGL.Data.call(this),
        _.defaults(a, {
            gridUpdate: !0
        }),
        this.objectManager = new MapGL.ObjectManagerOverpass,
        this.queryHigh = "[out:json];((rel({s},{w},{n},{e})[%22building%22];rel({s},{w},{n},{e})[type=%22building%22];);(._;way(r););(._;node(w););(way({s},{w},{n},{e})[%22building%22];way({s},{w},{n},{e})[%22building:part%22];way({s},{w},{n},{e})[aeroway~%22aerodrome|runway%22];way({s},{w},{n},{e})[waterway~%22riverbank|dock%22];way({s},{w},{n},{e})[waterway=%22canal%22][area=%22yes%22];way({s},{w},{n},{e})[natural~%22water|scrub%22];way({s},{w},{n},{e})[leisure~%22park|pitch%22];way({s},{w},{n},{e})[landuse~%22grass|meadow|forest%22];" + (MapGL.ENABLE_ROADS ? "way({s},{w},{n},{e})[highway~%22motorway|trunk|primary|secondary|tertiary|motorway_link|primary_link|secondary_link|tertiary_link|road%22];" : "") + ");(._;node(w);););out;",
        this.queryLow = "[out:json];((rel({s},{w},{n},{e})[waterway~%22riverbank|dock%22];rel({s},{w},{n},{e})[waterway=%22canal%22][area=%22yes%22];rel({s},{w},{n},{e})[natural~%22water|scrub%22];rel({s},{w},{n},{e})[leisure~%22park|pitch%22];rel({s},{w},{n},{e})[landuse~%22grass|meadow|forest|commercial|retail|industrial|construction|brownfield%22];);(._;way(r););(._;node(w););(way({s},{w},{n},{e})[waterway~%22riverbank|dock%22];way({s},{w},{n},{e})[waterway=%22canal%22][area=%22yes%22];way({s},{w},{n},{e})[natural~%22water|scrub%22];way({s},{w},{n},{e})[leisure~%22park|pitch%22];way({s},{w},{n},{e})[landuse~%22grass|meadow|forest|commercial|retail|industrial|construction|brownfield%22];);(._;node(w);););out;",
        this.urlBase = "http://overpass-api.de/api/interpreter?data=",
        this.urlHigh = this.urlBase + this.queryHigh,
        this.urlLow = this.urlBase + this.queryLow,
        a.gridUpdate && this.subscribe("gridUpdated", this.update)
    }
    ,
    MapGL.DataOverpass.prototype = Object.create(MapGL.Data.prototype),
    MapGL.DataOverpass.prototype.update = function() {
        var a = this
          , b = Q.defer();
        a.clearTiles(a.grid.boundsLow);
        var c = [];
        return c.push(a.updateByLevel(a.grid.boundsHigh, a.urlHigh)),
        Q.all(c).done(function() {
            b.resolve()
        }, function(a) {
            b.reject(a)
        }),
        b.promise
    }
    ,
    MapGL.DataOverpass.prototype.updateByLevel = function(a, b) {
        for (var c = this, d = Q.defer(), e = [], f = [a.e - a.w, a.s - a.n], g = 0; g < f[0]; g++)
            for (var h = 0; h < f[1]; h++) {
                var i = [a.w + h, a.n + g]
                  , j = {
                    n: a.n + g,
                    e: 1 + a.w + h,
                    s: 1 + a.n + g,
                    w: a.w + h
                }
                  , k = c.grid.getBoundsLonLat(j)
                  , l = i[0] + ":" + i[1];
                c.objects[l] ? MapGL.Log("Skipping tile already in view", l) : e.push([c.load, [b, k, l]])
            }
        return Q.all(e.map(throat(1, function(a) {
            return a[0].apply(c, a[1])
        }))).done(function() {
            d.resolve()
        }, function(a) {
            d.reject(a)
        }),
        d.promise
    }
    ,
    MapGL.DataOverpass.prototype.clearTiles = function(a) {
        var b = this;
        _.each(b.objects, function(c, d) {
            var e = d.split(":");
            (e[0] >= a.e || e[0] < a.w || e[1] >= a.s || e[1] < a.n) && (MapGL.Log("Removing mesh from scene", d),
            b.publish("removeFromScene", c),
            delete b.objects[d],
            delete b.processedIds[d])
        })
    }
    ,
    MapGL.DataOverpass.prototype.updateByWayIntersect = function(a) {
        var b = this
          , c = Q.defer()
          , d = this.urlBase + "[out:json];(way(" + a + "));(._;node(w););out;";
        return MapGL.Log("Requesting URL", d),
        d3.json(d, function(a, e) {
            if (MapGL.Log("Response for URL", d),
            a)
                c.reject(new Error(a));
            else {
                if (0 === e.elements.length)
                    return c.resolve(),
                    void 0;
                var f = b.process(e, !1, !1)[0];
                MapGL.Log(f);
                var g = f.coordinates
                  , h = {};
                _.each(g, function(a) {
                    var c = b.grid.lonlat2tile(a[0], a[1], b.geo.tileZoom);
                    h[c[1]] || (h[c[1]] = []),
                    -1 === _.indexOf(h[c[1]], c[0]) && h[c[1]].push(c[0])
                }),
                MapGL.Log(h);
                var i = [];
                _.each(h, function(a, c) {
                    var d = _.min(a)
                      , e = _.max(a)
                      , f = _.range(d, e + 1);
                    _.each(f, function(a) {
                        var d = {
                            n: Number(c),
                            e: a + 1,
                            s: Number(c) + 1,
                            w: a
                        }
                          , e = b.grid.getBoundsLonLat(d)
                          , f = a + ":" + c;
                        i.push([b.load, [b.urlHigh, e, f]])
                    })
                }),
                Q.all(i.map(throat(1, function(a) {
                    return a[0].apply(b, a[1])
                }))).done(function() {}, function() {}),
                c.resolve()
            }
        }),
        c.promise
    }
    ,
    MapGL.DataOverpass.prototype.process = function(a, b, c) {
        var d = this
          , e = {}
          , f = {}
          , g = []
          , h = a.elements;
        return _.each(h, function(a) {
            switch (a.type) {
            case "node":
                d.processNode(e, a, c);
                break;
            case "way":
                d.processWay(g, f, e, a, b);
                break;
            case "relation":
                d.processRelation(g, f, e, a)
            }
        }),
        g
    }
    ,
    MapGL.DataOverpass.prototype.processNode = function(a, b, c) {
        a[b.id] = c === !1 ? [b.lon, b.lat] : this.geo.projection([b.lon, b.lat])
    }
    ,
    MapGL.DataOverpass.prototype.processWay = function(a, b, c, d, e) {
        var f = this
          , g = d.tags || {}
          , h = f.createOutline(c, d.nodes);
        if (!h)
            return MapGL.Log("Skipping feature as it has duplicate coordinates", d.id, h),
            void 0;
        if (!g.highway && h.length < 4)
            return MapGL.Log("Skipping feature as it hasn't enough coordinates", d.id, h),
            void 0;
        var i = f.processArea(h);
        if (!g.highway && e) {
            var j = 3;
            if (h = simplify(h, j),
            h.length < 4)
                return
        }
        g["mapgl:area"] = i,
        g.height = this.processHeight(g),
        (g.min_height || g["building:min_height"] || g.min_levels || g["building:min_levels"]) && (g.minHeight = this.processMinHeight(g)),
        g.colour = this.processColour(g),
        g.roof = this.processRoof(g);
        var k = {
            id: d.id,
            coordinates: h,
            properties: g
        };
        b[k.id] = k,
        f.isResult(k) && (k.coordinates = f.makeWinding(k.coordinates, f.clockwise),
        a.push(k))
    }
    ,
    MapGL.DataOverpass.prototype.processRelation = function(a, b, c, d) {
        var e = this;
        if ("multipolygon" === d.tags.type || "building" === d.tags.type) {
            var f = e.getRelationWays(d.members, b);
            if (f) {
                var g = f.outer;
                if (g.coordinates = e.makeWinding(g.coordinates, e.clockwise),
                g) {
                    var h = [];
                    _.each(f.inner, function(a) {
                        if (a.coordinates) {
                            var b = 3
                              , c = simplify(a.coordinates, b);
                            if (c.length < 4)
                                return;
                            h.unshift(e.makeWinding(c, e.counterClockwise))
                        }
                    }),
                    h.length && (g.holes = h),
                    _.extend(g.properties, d.tags),
                    g.properties.height = null,
                    g.properties.minHeight && (g.properties.minHeight = null),
                    g.properties.colour = null,
                    g.properties.roof = null,
                    g.properties.height = e.processHeight(g.properties),
                    g.properties.minHeight && (g.properties.minHeight = e.processMinHeight(g.properties)),
                    g.properties.colour = e.processColour(g.properties),
                    g.properties.roof = e.processRoof(g.properties),
                    a.push(g)
                }
            }
        }
    }
    ,
    MapGL.DataOverpass.prototype.getRelationWays = function(a, b) {
        for (var c, d, e = [], f = 0, g = a.length; g > f; f++)
            c = a[f],
            "way" === c.type && b[c.ref] && (c.role && "outer" !== c.role ? "inner" !== c.role && "enclave" !== c.role || e.push(b[c.ref]) : d = b[c.ref]);
        return d ? {
            outer: d,
            inner: e
        } : void 0
    }
    ,
    MapGL.DataOverpass.prototype.createOutline = function(a, b) {
        var c = this
          , d = b.length
          , e = []
          , f = !1;
        return _.each(b, function(b, g) {
            d - 1 > g && c.checkDuplicateCoords(e, a[b]) && (f = !0),
            e.push(a[b])
        }),
        f ? !1 : e
    }
    ,
    MapGL.DataOverpass.prototype.processArea = function(a) {
        for (var b = this, c = a.length, d = 0, e = c - 1, f = 0; c > f; f++)
            d += (a[e][0] + a[f][0]) * (a[e][1] - a[f][1]),
            e = f;
        return Math.abs(d / 2 / b.geo.pixelsPerMeter)
    }
    ,
    MapGL.DataOverpass.prototype.processHeight = function(a) {
        var b, c = "office" === a.building ? 1.45 : 1;
        return b = a.height ? this.toMeters(a.height) : !b && a["building:height"] ? this.toMeters(a["building:height"]) : !b && a.levels ? a.levels * this.METERS_PER_LEVEL * c << 0 : !b && a["building:levels"] ? a["building:levels"] * this.METERS_PER_LEVEL * c << 0 : a.building ? 10 + 10 * Math.random() : "forest" === a.landuse ? 7 : a.waterway || "water" === a.natural ? 4 : "scrub" === a.natural || a.leisure && /park|pitch/.test(a.leisure) || a.landuse && /grass|meadow/.test(a.landuse) || "runway" === a.aeroway ? 3 : 1,
        b *= this.geo.pixelsPerMeter
    }
    ,
    MapGL.DataOverpass.prototype.processMinHeight = function(a) {
        var b, c = "office" === a.building ? 1.45 : 1;
        return a.min_height ? b = this.toMeters(a.min_height) : !b && a["building:min_height"] ? b = this.toMeters(a["building:min_height"]) : !b && a.min_levels ? b = a.min_levels * this.METERS_PER_LEVEL * c << 0 : !b && a["building:min_levels"] && (b = a["building:min_levels"] * this.METERS_PER_LEVEL * c << 0),
        b *= this.geo.pixelsPerMeter
    }
    ,
    MapGL.DataOverpass.prototype.processRoof = function(a) {
        var b = {
            shape: "flat"
        };
        return void 0 !== a["roof:shape"] && (b.shape = a["roof:shape"]),
        b
    }
    ,
    MapGL.DataOverpass.prototype.processColour = function(a) {
        var b;
        return a.building || a["building:part"] ? b = MapGL.ENABLE_OUTLINES ? 16777215 : 15658734 : a.waterway || "water" === a.natural ? b = 7195903 : "forest" === a.landuse ? b = 8299536 : "scrub" === a.natural || a.leisure && /park|pitch/.test(a.leisure) || a.landuse && /grass|meadow/.test(a.landuse) ? b = 12638837 : a.landuse && /industrial|construction|brownfield/.test(a.landuse) ? b = 14206901 : a.landuse && /commercial|retail/.test(a.landuse) ? b = 11123670 : "aerodrome" === a.aeroway ? b = 15658734 : "runway" === a.aeroway ? b = 6710886 : (MapGL.Log("Setting default colour for feaure", a),
        b = 16711680),
        b
    }
    ,
    MapGL.DataOverpass.prototype.generateFeatures = function(a) {
        var b = this
          , c = Q.defer();
        return b.objectManager.processFeaturesWorker(a, b.geo.pixelsPerMeter).then(function(a) {
            c.resolve(a)
        }, void 0, function(a) {
            c.notify(a)
        }),
        c.promise
    }
    ,
    MapGL.DataOverpass.prototype.isResult = function(a) {
        var b = a.properties;
        return b && (b.building || b["building:part"] || b.waterway || b.natural || b.landuse || b.leisure || b.aeroway || b.highway && !b.area)
    }
}(),
function() {
    "use strict";
    MapGL.Grid = function() {
        var a = function() {
            MapGL.Log("Inititialising grid manager"),
            _.extend(this, MapGL.Mediator),
            this.geo = MapGL.Geo.getInstance(),
            this.pos2d = new THREE.Vector2,
            this.centerTile = [],
            this.tilesPerDirectionHigh = 1,
            this.tilesPerDirectionLow = 5,
            this.tileSize = 0,
            this.boundsHigh = {},
            this.boundsHighLonLat = {},
            this.boundsLow = {},
            this.boundsLowLonLat = {},
            this.gridModel = new THREE.Object3D,
            this.subscribe("centerPositionChanged", this.onCenterChanged)
        };
        a.prototype.init = function(a) {
            var b = this.geo.projection(a);
            return this.pos2d.x = b[0],
            this.pos2d.y = b[1],
            this.centerTile = this.lonlat2tile(a[0], a[1], this.geo.tileZoom, !0),
            this.boundsHigh = this.getBounds(this.tilesPerDirectionHigh),
            this.boundsLow = this.getBounds(this.tilesPerDirectionLow),
            this.boundsHighLonLat = this.getBoundsLonLat(this.boundsHigh),
            this.boundsLowLonLat = this.getBoundsLonLat(this.boundsLow),
            MapGL.DEBUG && (this.createDebug(),
            this.publish("addToScene", this.gridModel)),
            Q.fcall(function() {})
        }
        ,
        a.prototype.update = function() {
            this.pos2d.clone(),
            {
                n: this.boundsHigh.n,
                e: this.boundsHigh.e,
                s: this.boundsHigh.s,
                w: this.boundsHigh.w
            },
            {
                n: this.boundsLow.n,
                e: this.boundsLow.e,
                s: this.boundsLow.s,
                w: this.boundsLow.w
            }
        }
        ,
        a.prototype.getBounds = function(a) {
            var b = {
                n: Math.floor(this.centerTile[1]) - a,
                e: Math.ceil(this.centerTile[0]) + a,
                s: Math.ceil(this.centerTile[1]) + a,
                w: Math.floor(this.centerTile[0]) - a
            };
            return b
        }
        ,
        a.prototype.getBoundsLonLat = function(a) {
            var b = this.tile2lonlat(a.e, a.n, this.geo.tileZoom)
              , c = this.tile2lonlat(a.w, a.s, this.geo.tileZoom)
              , d = {
                n: this.geo.decimalPlaces(b[1]),
                e: this.geo.decimalPlaces(b[0]),
                s: this.geo.decimalPlaces(c[1]),
                w: this.geo.decimalPlaces(c[0])
            };
            return d
        }
        ,
        a.prototype.onCenterChanged = function(a, b) {
            var c = this.lonlat2tile(b[0], b[1], this.geo.tileZoom, !0)
              , d = [Math.floor(c[0]) - Math.floor(this.centerTile[0]), Math.floor(c[1]) - Math.floor(this.centerTile[1])];
            (Math.abs(d[0]) > 0 || Math.abs(d[1]) > 0) && (MapGL.Log("Update grid", d),
            this.pos2d.x = a[0],
            this.pos2d.y = a[1],
            this.centerTile = c,
            this.boundsHigh = this.getBounds(this.tilesPerDirectionHigh),
            this.boundsLow = this.getBounds(this.tilesPerDirectionLow),
            this.boundsHighLonLat = this.getBoundsLonLat(this.boundsHigh),
            this.boundsLowLonLat = this.getBoundsLonLat(this.boundsLow),
            this.gridModel.position.x += this.tileSize * d[0],
            this.gridModel.position.z += this.tileSize * d[1],
            this.publish("gridUpdated"))
        }
        ,
        a.prototype.createDebug = function() {
            var a = this.tile2lonlat(Math.floor(this.centerTile[0]), Math.floor(this.centerTile[1]), this.geo.tileZoom)
              , b = this.tile2lonlat(Math.floor(this.centerTile[0]) + 1, Math.floor(this.centerTile[1]) + 1, this.geo.tileZoom);
            this.tileSize = this.geo.projection(b)[0] - this.geo.projection(a)[0];
            var c = new THREE.LineBasicMaterial({
                color: 13369344,
                linewidth: 6
            })
              , d = new THREE.LineBasicMaterial({
                color: 204,
                linewidth: 6
            })
              , e = new THREE.Geometry
              , f = e.vertices;
            f.push(new THREE.Vector3(0,0,0)),
            f.push(new THREE.Vector3(this.tileSize,0,0)),
            f.push(new THREE.Vector3(this.tileSize,0,this.tileSize)),
            f.push(new THREE.Vector3(0,0,this.tileSize)),
            f.push(new THREE.Vector3(0,0,0)),
            e.computeLineDistances();
            var g, h, i, j, k, l = [this.boundsHigh.e - this.boundsHigh.w, this.boundsHigh.s - this.boundsHigh.n];
            for (g = 0; g < l[0]; g++)
                for (h = 0; h < l[1]; h++)
                    i = [this.boundsHigh.w + h, this.boundsHigh.n + g],
                    j = this.geo.projection(this.tile2lonlat(i[0], i[1], this.geo.tileZoom)),
                    k = new THREE.Line(e,c),
                    k.position.y = 2,
                    k.position.x = j[0],
                    k.position.z = j[1],
                    this.gridModel.add(k);
            var m = [this.boundsLow.e - this.boundsLow.w, this.boundsLow.s - this.boundsLow.n];
            for (g = 0; g < m[0]; g++)
                for (h = 0; h < m[1]; h++)
                    i = [this.boundsLow.w + h, this.boundsLow.n + g],
                    j = this.geo.projection(this.tile2lonlat(i[0], i[1], this.geo.tileZoom)),
                    k = new THREE.Line(e,d),
                    k.position.y = .1,
                    k.position.x = j[0],
                    k.position.z = j[1],
                    this.gridModel.add(k)
        }
        ,
        a.prototype.lonlat2tile = function(a, b, c, d) {
            a = Number(a);
            var e, f;
            return d ? (e = (a + 180) / 360 * Math.pow(2, c),
            f = (1 - Math.log(Math.tan(b * Math.PI / 180) + 1 / Math.cos(b * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, c)) : (e = Math.floor((a + 180) / 360 * Math.pow(2, c)),
            f = Math.floor((1 - Math.log(Math.tan(b * Math.PI / 180) + 1 / Math.cos(b * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, c))),
            [e, f]
        }
        ,
        a.prototype.tile2lonlat = function(a, b, c) {
            var d = a / Math.pow(2, c) * 360 - 180
              , e = Math.PI - 2 * Math.PI * b / Math.pow(2, c)
              , f = 180 / Math.PI * Math.atan(.5 * (Math.exp(e) - Math.exp(-e)));
            return [d, f]
        }
        ;
        var b, c = {
            name: "MapGL.Grid",
            getInstance: function() {
                return void 0 === b && (b = new a),
                b
            }
        };
        return c
    }()
}(),
function() {
    "use strict";
    MapGL.Mouse = function() {
        var a = function(a, b) {
            MapGL.Log("Inititialising mouse manager"),
            _.extend(this, MapGL.Mediator),
            this.camera = b,
            this.projector = new THREE.Projector,
            this.state = {
                buttons: {
                    left: !1,
                    right: !1,
                    middle: !1
                },
                pos2d: new THREE.Vector2,
                downPos2d: new THREE.Vector2,
                downPos2dDelta: new THREE.Vector2,
                pos3d: new THREE.Vector3,
                downPos3d: new THREE.Vector3,
                pos2dDelta: new THREE.Vector2,
                pos3dDelta: new THREE.Vector3,
                wheelDelta: 0,
                camera: {
                    startTheta: this.camera.theta,
                    startPhi: this.camera.phi
                }
            },
            this.initDOMEvents(a)
        };
        a.prototype.initDOMEvents = function(a) {
            var b = this;
            a.addEventListener("mousedown", function(a) {
                b.onMouseDown(a)
            }, !1),
            a.addEventListener("mousemove", function(a) {
                b.onMouseMove(a)
            }, !1),
            a.addEventListener("mouseup", function(a) {
                b.onMouseUp(a)
            }, !1);
            var c = "wheel";
            void 0 === window.onwheel && (c = "mousewheel"),
            a.addEventListener(c, function(a) {
                b.onMouseWheel(a)
            }, !1)
        }
        ,
        a.prototype.onMouseDown = function(a) {
            a.preventDefault();
            var b = this.state;
            0 === a.button && (b.buttons.left = !0),
            1 === a.button && (b.buttons.middle = !0),
            2 === a.button && (b.buttons.right = !0),
            b.pos2d.x = a.clientX,
            b.pos2d.y = a.clientY,
            b.downPos2d.x = a.clientX,
            b.downPos2d.y = a.clientY,
            b.pos2dDelta.x = 0,
            b.pos2dDelta.y = 0;
            var c = this.mouseIn3d(b.downPos2d);
            b.pos3d.x = c.x,
            b.pos3d.y = c.y,
            b.pos3d.z = c.z,
            b.downPos3d.x = c.x,
            b.downPos3d.y = c.y,
            b.downPos3d.z = c.z,
            b.pos3dDelta.x = 0,
            b.pos3dDelta.y = 0,
            b.pos3dDelta.z = 0,
            b.camera.startTheta = this.camera.theta,
            b.camera.startPhi = this.camera.phi
        }
        ,
        a.prototype.onMouseMove = function(a) {
            a.preventDefault();
            var b = this.state;
            b.pos2dDelta.x = a.clientX - b.pos2d.x,
            b.pos2dDelta.y = a.clientY - b.pos2d.y,
            b.pos2d.x = a.clientX,
            b.pos2d.y = a.clientY;
            var c = this.mouseIn3d(b.pos2d);
            b.pos3d.x = c.x,
            b.pos3d.y = c.y,
            b.pos3d.z = c.z,
            (b.buttons.left || b.buttons.middle) && (b.downPos2dDelta.x = a.clientX - b.downPos2d.x,
            b.downPos2dDelta.y = a.clientY - b.downPos2d.y,
            b.pos3dDelta.x = b.downPos3d.x - c.x,
            b.pos3dDelta.y = b.downPos3d.y - c.y,
            b.pos3dDelta.z = b.downPos3d.z - c.z)
        }
        ,
        a.prototype.onMouseUp = function(a) {
            a.preventDefault();
            var b = this.state;
            0 === a.button && (b.buttons.left = !1),
            1 === a.button && (b.buttons.middle = !1),
            2 === a.button && (b.buttons.right = !1),
            b.downPos2dDelta.x = 0,
            b.downPos2dDelta.y = 0
        }
        ,
        a.prototype.onMouseWheel = function(a) {
            a.preventDefault();
            var b = this.state;
            void 0 !== a.deltaY ? b.wheelDelta -= a.deltaY : b.wheelDelta += a.wheelDeltaY
        }
        ,
        a.prototype.resetDelta = function() {
            var a = this.state;
            a.pos2dDelta.x = 0,
            a.pos2dDelta.y = 0,
            a.pos3dDelta.x = 0,
            a.pos3dDelta.y = 0,
            a.pos3dDelta.z = 0,
            a.wheelDelta = 0
        }
        ,
        a.prototype.mouseIn3d = function(a) {
            var b = this.camera.camera
              , c = new THREE.Vector3(a.x / window.innerWidth * 2 - 1,2 * -(a.y / window.innerHeight) + 1,.5);
            this.projector.unprojectVector(c, b);
            var d = c.sub(b.position).normalize()
              , e = -b.position.y / d.y
              , f = b.position.clone().add(d.multiplyScalar(e));
            return f
        }
        ,
        a.prototype.updateCamera = function() {
            var a = this.state;
            a.downPos2d.x = a.pos2d.x,
            a.downPos2d.y = a.pos2d.y,
            a.downPos2dDelta.x = 0,
            a.downPos2dDelta.y = 0,
            a.camera.startTheta = this.camera.theta,
            a.camera.startPhi = this.camera.phi
        }
        ;
        var b, c = {
            name: "MapGL.Mouse",
            getInstance: function(c, d) {
                return void 0 === b && (b = new a(c,d)),
                b
            }
        };
        return c
    }()
}(),
function() {
    "use strict";
    MapGL.Keyboard = function() {
        var a = function(a) {
            MapGL.Log("Inititialising mouse manager"),
            _.extend(this, MapGL.Mediator),
            this.state = {
                keys: {}
            },
            this.initDOMEvents(a)
        };
        a.prototype.initDOMEvents = function() {
            var a = this;
            document.addEventListener("keydown", function(b) {
                a.onKeyDown(b)
            }, !1),
            document.addEventListener("keyup", function(b) {
                a.onKeyUp(b)
            }, !1)
        }
        ,
        a.prototype.onKeyDown = function(a) {
            var b = this.keyCodeToString(a.keyCode);
            b && (this.state.keys[b] = !0)
        }
        ,
        a.prototype.onKeyUp = function(a) {
            var b = this.keyCodeToString(a.keyCode);
            b && (this.state.keys[b] = !1)
        }
        ,
        a.prototype.keyCodeToString = function(a) {
            var b;
            switch (a) {
            case 16:
                b = "shift";
                break;
            default:
                b = !1
            }
            return b
        }
        ;
        var b, c = {
            name: "MapGL.Keyboard",
            getInstance: function(c) {
                return void 0 === b && (b = new a(c)),
                b
            }
        };
        return c
    }()
}(),
function() {
    "use strict";
    MapGL.Controls = function() {
        var a = function() {
            MapGL.Log("Inititialising controls"),
            _.extend(this, MapGL.Mediator),
            this.enabled = void 0,
            this.mouse = void 0,
            this.keyboard = void 0
        };
        a.prototype.init = function(a, b, c) {
            return c.enable && (this.mouse = MapGL.Mouse.getInstance(a, b),
            this.keyboard = MapGL.Keyboard.getInstance(a),
            this.subscribe("update", this.onUpdate),
            this.subscribe("orbitControlCap", this.orbitCapReset)),
            this.enabled = c.enable,
            Q.fcall(function() {})
        }
        ,
        a.prototype.onUpdate = function() {
            var a = this.mouse.state
              , b = this.keyboard.state;
            0 !== a.wheelDelta && this.publish("zoomControl", -1 * a.wheelDelta),
            a.buttons.left && !b.keys.shift && this.publish("panControl", a.pos3dDelta),
            (a.buttons.left && b.keys.shift || a.buttons.middle) && this.publish("orbitControl", a.downPos2dDelta, a.camera.startTheta, a.camera.startPhi),
            this.mouse.resetDelta()
        }
        ,
        a.prototype.orbitCapReset = function() {
            this.mouse.updateCamera()
        }
        ;
        var b, c = {
            name: "MapGL.Controls",
            getInstance: function() {
                return void 0 === b && (b = new a),
                b
            }
        };
        return c
    }()
}(),
function() {
    "use strict";
    MapGL.Cache = function() {
        _.extend(this, MapGL.Mediator),
        this.data = {}
    }
    ,
    MapGL.Cache.prototype.get = function(a) {
        return this.data[a]
    }
    ,
    MapGL.Cache.prototype.add = function(a, b) {
        this.data[a] = b
    }
}();
